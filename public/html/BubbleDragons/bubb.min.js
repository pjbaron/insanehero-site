!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e.touchEvent=!1,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=0,e._debugText=null,window.addEventListener("resize",e.resizeCanvas,!1)}function s(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function i(e){return e?e+"Hidden":"hidden"}function a(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.anchor.set(0,0),this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.updateCallback=null,this.globalScale=null}function o(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0}function r(){this.parent=null,this.managers=null,this.bg=null,this.texts=null,this.icon=null,this.underline=null,this.fields=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1}function h(){this.parent=null,this.managers=null,this.text=null}function u(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function d(e){n.call(this),this.textures=null,this.type=e||d.TYPE_BUTTON,this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,this.enabled=!1}function p(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[]}function g(e){this.levelData=e,this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.page=0,this.title=null,this.icon=null,this.nameText=null,this.nameDesc=null,this.nextPageBtn=null,this.prevPageBtn=null}function y(){}function b(){this.managers=null}function m(){this.strings=null}function f(e,t,s){w.debug&&console.log("FontLoaded loading: "+e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=f.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function _(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function v(e){this.game=e,this.list=null}function x(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e}function w(){w.self=this,w.VERSION="v1.25",w.testKeys=!1,w.debug=!1,w.debugSpam=!1,w.showFPS=!1,w.showLockedCursor=!1,w.showLevelSelect=!1,w.challengeMode=!0,w.pauseOnFocusLoss=!1,w.playAgainCount=0,w.totalShots=0,w.playMidRollAd=!1,w.playMidRollAdAfterPause=!1,w.eventChangeAdOnMatch=!1,w.eventChangeAdOnTitlesShow=!1,w.eventChangeAdOnTitlesClose=!1,w.eventChangeAdOnRotate=!1,w.eventChangeAdOnPopup=!0,w.eventChangeAdOnOptions=!0,w.eventChangeAdOnIdle=0,w.idleTimer=Number.MAX_VALUE,w.timerStart=120999,w.gameWide=1520,w.gameHigh=1310,w.volumeControl=.5,w.shortTapDurationMS=400,w.click=null,w.hover=null,w.mouseDown=null,w.mouseUp=null,w.swipe=0,w.swipeEnabled=!1,w.forceResize=!1,w.resized=!1,w.resizeConsumed=!1,w.time=0,w.elapsedTime=0,w.muteUntil=-1,w.countryCode="en-US",w.nowTime=0,w.repeatedGamesLeft=0,w.aspectRatio=1,w.isPortrait=!1,w.lowResolutionAssets=!1,w.suppressBigAnimations=!1,w.pieceScale=1,w.marginWidth=0,w._lastTime=0,this.gameControl=null}function T(){this.preloader=null,this.titles=null,this.game=null,this.bm=null}function L(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function S(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.menu=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=w.showLevelSelect?S.LEVEL_SELECT:S.LEVEL_START,this.nextState=-1,this.delay=0,this.foodTotal=0,this.foodCount=0,this.droppedLastFish=!1,S.paused=!1,S.requestQuit=!1,w.debug&&console.log("new Game() resetting shotsLeft to zero"),S.shotsLeft=0,S.score=0,S.levelType=LevelType.GOAL_PROTECT_BARRIER,LevelType.ConvertNames=[],LevelType.ConvertNames.level_protect_barrier=LevelType.GOAL_PROTECT_BARRIER,LevelType.ConvertNames.level_collect_fish=LevelType.GOAL_RESCUE_FISH,LevelType.ConvertNames.level_hatch_egg=LevelType.GOAL_BREAK_EGG,S.options=null}function I(e){this.game=e,I.effects=null,this.managers=null,this.lastMatchTime=-1,this.shotsText=null,this.fishText=null,this.fishIcon=null,this.fishWidget=null,this.scoreText=null,this.bm=null,this.boostIcon=null,this.endSequence=!1,this.shootBubblesAfter=void 0,this.uiBits=null,this.star1=this.star2=this.star3=null,this.launcherMeter=null,this.launcherRing=null,this.launcherBeam=null,this.launcherButton=null,this.launcherMask=null,this.ignoreClick=null,this.usePlayerInput=null,this.playField=null,this.gridCollide=null,this.shooter=null}function k(e,t,s,i){this.game=e,this.managers=t,this.parent=s,this.playField=this.game.world.playField,this.grid=this.playField.grid,this.gridCollide=i,this.sprite=null,this.under_type=null,this.overlay=null,this.vx=0,this.vy=0,this.mx=0,this.my=0,this.wobbleTime=0,this.wobblex=this.wobbley=0,this.updateCallback=null}function B(e){this.game=e,this.grid=null,this.gridCollide=null,this.scrollY=0,this.introScroll=!0,this.scrollBackAllowed=!0,this.scrollDownBonus=!1,this.bg=null,this.uiPanel=null,this.rightBlanker=null,this.topBar=null,this.barrier=null,this.barrierHighlight=null,this.hitGong=!1,this.lowestBubbleY=0,this.explosionList=null,this.resizeChargeBlocker=0}function E(e){this.game=e}function A(e,t){void 0!=window.ArenaXApi&&null!=window.ArenaXApi&&(this._arenaXapi=ArenaXApi.init(e,t),this._arenaXapi.dispatch({type:"GAME_REGISTERED",payload:null})),void 0!=window.ARK_game_arena_connector&&window.ARK_game_arena_connector.init()}function C(){this.pending=0,this.loader=null}function M(){this.list=null,this.pending=0}function O(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null}var F=[];F.UNDEFINED={type:-1,name:"undefined",animations:{interval:0,"default":["undefined"]}},F.RED={type:1,name:"bubble_red",normal:!0,animations:{interval:0,"default":["bble_red.png"]}},F.GREEN={type:2,name:"bubble_green",normal:!0,animations:{interval:0,"default":["bble_green.png"]}},F.BLUE={type:3,name:"bubble_blue",normal:!0,animations:{interval:0,"default":["bble_blu.png"]}},F.YELLOW={type:4,name:"bubble_yellow",normal:!0,animations:{interval:0,"default":["bble_orng.png"]}},F.PURPLE={type:5,name:"bubble_purple",normal:!0,animations:{interval:0,"default":["bble_prpl.png"]}},F.RAINBOW={type:6,name:"boost_wild",normal:!0,animations:{interval:0,"default":["bble_wild.png"],boost:["boostIcon_rbow.png"]}},F.FIREBALL={type:20,name:"boost_fireball",normal:!1,animations:{interval:100,"default":["fireball_rotate/00.png","fireball_rotate/01.png","fireball_rotate/02.png"],bonus:["fireball_rotate/00.png"],boost:["boostIcon_flame.png"]}},F.MINE={type:21,name:"boost_mine",normal:!1,animations:{interval:0,"default":["mine.png"],boost:["boostIcon_mine.png"]}},F.ICE={type:50,name:"special_frozen_bubble",normal:!1,animations:{noRepeat:!0,interval:150,"default":["frozen01.png"],cracking:["frozen01.png","frozen02.png","frozen03.png","frozen04.png","frozen05.png","frozen06.png","frozen07.png"]}},F.BOMB={type:51,name:"special_bomb",normal:!1,animations:{randomise:!0,interval:250,"default":["bomb_spark/bomb00.png","bomb_spark/bomb01.png","bomb_spark/bomb02.png"],waiting:["bombWait.png"]}},F.ROCKET={type:52,name:"special_rocket",normal:!1,animations:{noRepeat:!0,interval:100,"default":["rocket.png"]}},F.EGG={type:53,name:"goal_egg",normal:!1,animations:{noRepeat:!0,interval:150,"default":["collect_egg.png"],cracking:["egg_crack/00.png","egg_crack/01.png","egg_crack/02.png","egg_crack/03.png","egg_crack/04.png","egg_crack/05.png"]}},F.FISH={type:54,animations:{noRepeat:!0,interval:150,"default":["collect_fish.png"]}},F.DRAGON_EGG={type:60,normal:!1,animations:{interval:250,"default":["gold_flying/00.png","gold_flying/01.png","gold_flying/02.png","gold_flying/01.png"]}},F.DRAGON_PURPLE={type:61,name:"special_carry_bubble",normal:!1,animations:{interval:200,"default":["special_dragon_grab.png"],flying:["purple_flying/00.png","purple_flying/01.png","purple_flying/02.png","purple_flying/01.png"],gliding:["purple_glide_02.png","purple_glide_03.png","purple_glide_02.png","purple_glide_04.png"]}},F.DRAGON_ORANGE={type:62,name:"special_burst_bubble",normal:!1,animations:{interval:100,"default":["special_dragon_pop.png"],flying:["orange_flying/00.png","orange_flying/01.png","orange_flying/02.png","orange_flying/01.png"],shooting:["orange_fireBlow/00.png","orange_fireBlow/01.png","orange_fireBlow/01.png","orange_fireBlow/02.png","orange_fireBlow/02.png","orange_fireBlow/03.png","orange_fireBlow/03.png","orange_fireBlow/04.png","orange_fireBlow/04.png","orange_fireBlow/05.png","orange_fireBlow/05.png"]}},F.DRAGON_BLUE={type:100,name:"boost_convert_dragon",animations:{interval:200,"default":["blue_flying/00.png"],flying:["blue_flying/00.png","blue_flying/01.png","blue_flying/02.png","blue_flying/01.png"],shooting:["blue_shake/00.png","blue_shake/01.png","blue_shake/02.png","blue_shake/03.png","blue_shake/00.png"],boost:["boostIcon_bluDrag.png"]}},F.PLUS5={type:101,name:"boost_extra_moves",animations:{interval:0,"default":["5plus.png"],boost:["5plus.png"]}},F.EFFECT_POP_BUBBLE={type:200,animations:{noRepeat:!0,interval:50,"default":["zzz_explosion/0000","zzz_explosion/0001","zzz_explosion/0002","zzz_explosion/0003","zzz_explosion/0004","zzz_explosion/0005","zzz_explosion/0006","zzz_explosion/0007","zzz_explosion/0008","zzz_explosion/0009","zzz_explosion/0010","zzz_explosion/0011","zzz_explosion/0012","zzz_explosion/0013","zzz_explosion/0014","zzz_explosion/0015","zzz_explosion/0016","zzz_explosion/0017","zzz_explosion/0018"]}},F.EFFECT_FALL_BUBBLE={type:201,animations:{noRepeat:!0,interval:2e4,"default":["bble_red.png"]}},F.EFFECT_DROP_FISH={type:202,animations:{interval:150,"default":["fish/fish_00.png","fish/fish_01.png","fish/fish_02.png","fish/fish_01.png"]}},F.EFFECT_EXPLOSION={type:203,animations:{noRepeat:!0,interval:50,"default":["00.png","01.png","02.png","03.png","04.png","05.png","06.png","07.png"]}},F.EFFECT_ROCKET_SMOKE={type:206,animations:{noRepeat:!0,interval:250,"default":["rocket_smoke/00.png","rocket_smoke/01.png","rocket_smoke/02.png"]}},F.EFFECT_ROCKET_FIRE={type:207,animations:{interval:150,"default":["rocket_fire/00.png","rocket_fire/01.png","rocket_fire/02.png"]}},F.EFFECT_DRAGON_FLAME_JET={type:208,animations:{noRepeat:!0,interval:100,"default":["orange_fireball/00.png","orange_fireball/01.png","orange_fireball/02.png"]}},F.EFFECT_BOOST_SMOKE={type:209,animations:{noRepeat:!0,interval:250,"default":["fireball_smoke/00.png","fireball_smoke/01.png","fireball_smoke/02.png"]}},F.EFFECT_DRAGON_LIGHTNING={type:210,animations:{noRepeat:!0,interval:150,"default":["blue_lightning/00.png","blue_lightning/01.png","blue_lightning/02.png"]}},F.EFFECT_FISH_SPLASH={type:211,animations:{noRepeat:!0,interval:75,"default":["fishSplash_01.png","fishSplash_02.png","fishSplash_03.png","fishSplash_04.png","fishSplash_05.png"]}},F.EFFECT_FAKE_BUBBLE={type:213,animations:{interval:0,"default":["bble_red.png"]}},F.EFFECT_SPARKLES_WHITE={type:214,animations:{noRepeat:!0,interval:100,"default":["sparkles_white/sparkleWhite_00.png","sparkles_white/sparkleWhite_01.png","sparkles_white/sparkleWhite_02.png","sparkles_white/sparkleWhite_03.png"]}},F.EFFECT_SPARKLES_RAINBOW={type:215,animations:{noRepeat:!0,interval:120,"default":["sparkles_rainbow/sprkleRnbw_00.png","sparkles_rainbow/sprkleRnbw_01.png","sparkles_rainbow/sprkleRnbw_02.png","sparkles_rainbow/sprkleRnbw_03.png"]}},F.LAUNCHER_METER={type:300,animations:{interval:0,"default":["launchMeter.png"]}},F.CEILING_BEAM={type:301,animations:{interval:250,"default":["ceiling/00.png","ceiling/01.png","ceiling/02.png"]}},F.PRELOADER={type:400,key:"load_spinner"},function(){for(var e in F)void 0!==F[e].type&&(F[F[e].type]=F[e]),void 0!==F[e].name&&(F[F[e].name]=F[e])}(),e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.touchDownHandler),t.plugins.interaction.on("touchmove",e.touchMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.touchUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){w.click=e.mouseToStage(t.data.global.x,t.data.global.y),w.mouseMoveLocal=t.data.getLocalPosition(w.gameUILayer),w.mouseUpLocal=t.data.getLocalPosition(w.gameUILayer),w.debug&&console.log("EventHandlers.inputClickHandler")},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(Math.abs(e.deltaX)>=20?(w.swipe=e.deltaX,w.debug&&console.log("swipe detected = "+w.swipe)):w.swipe=0)},e.mouseOutHandler=function(){w.mouseOut=!0},e.mouseMoveHandler=function(t){return e.touchEvent=!1,e.touchMoveHandler(t)},e.touchMoveHandler=function(t){w.mouseOut&&(w.mouseOut=!1),w.hover=e.mouseToStage(t.data.global.x,t.data.global.y),w.mouseMoveLocal=t.data.getLocalPosition(w.gameUILayer),e._mouseSwipeStart&&w.swipeEnabled&&G.distanceBetween(e._mouseSwipeStart,w.hover)>=e.swipeDistance&&w.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:w.hover.x-e._mouseSwipeStart.x,deltaY:w.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,w.mouseDown=null)},e.touchDownHandler=function(t){e.touchEvent=!0,e.mouseDownHandler(t),w.mouseMoveLocal=w.mouseDownLocal},e.mouseDownHandler=function(t){e._showDebugWindowData&&e._showDebugWindowData<w.nowTime&&(e._debugText.destroy(),e._debugText=null,e._showDebugWindowData=0),e._mouseDownWhen=w.nowTime,w.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),w.mouseDownLocal=t.data.getLocalPosition(w.gameUILayer),!e._mouseSwipeStart&&w.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",w.mouseDown.x,w.mouseDown.y)},e.touchUpHandler=function(t){e.touchEvent=!0,e.mouseUpHandler(t),w.mouseMoveLocal=w.mouseUpLocal},e.mouseUpHandler=function(t){var s=0;w.mouseUp&&w.mouseDown&&(s=G.distanceBetween(w.mouseUp,w.mouseDown)),w.mouseDown&&(!w.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||w.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(w.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),w.mouseUpLocal=t.data.getLocalPosition(w.gameUILayer),w.mouseUp&&w.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:w.mouseUp.x-w.mouseDown.x,deltaY:w.mouseUp.y-w.mouseDown.y}))),e._mouseDownWhen=0,w.mouseDown=null,w.mouseDownLocal=null,e._mouseSwipeStart=null},e.resizeCanvas=function(){w.HTMLElement?(w.width!=w.HTMLElement.clientWidth||w.height!=w.HTMLElement.clientHeight)&&e._internalResize(w.HTMLElement.clientWidth,w.HTMLElement.clientHeight):(w.width!=window.innerWidth||w.height!=window.innerHeight)&&e._internalResize(window.innerWidth,window.innerHeight)},e._internalResize=function(e,t){w.resizeTime=w.nowTime,w.width=e,w.height=t,w.resized=!0,w.resizeConsumed=!1,w.forceResize=!1,w.aspectRatio=w.width/w.height,w.isPortrait=w.aspectRatio+1e-5<4/3,w.lowResolutionAssets=Math.max(w.width,w.height)<640||Math.min(w.width,w.height)<480},e.resizeContent=function(){w.aspectRatio=w.width/w.height,w.isPortrait=w.aspectRatio+1e-5<4/3,w.lowResolutionAssets=Math.max(w.width,w.height)<640||Math.min(w.width,w.height)<480,w.renderer.resize(w.width,w.height),w.stage.x=Math.round(w.width/2),w.stage.y=Math.round(w.height/2);var e=w.width/w.gameWide,t=w.height/w.gameHigh,s=Math.max(e,t);w.bgImage.scale.set(s);var i="landscape";w.isPortrait&&(i="portrait");var a=Math.round(4*w.height/3),n=Math.round(a*w.shiftPlayfield),o=a-n,r=o/S.width,l=r/S.bubbleDiameter,h={portrait:w.width/(2*S.sideBarOffset),landscape:l},u={portrait:0,landscape:(w.width-a)/2},d={portrait:0,landscape:u.landscape+n+o/2-w.width/2},c={portrait:w.width,landscape:o},p={portrait:w.width,landscape:a};w.bubbleLayer.scale.set(h[i]),w.gameUILayer.scale.set(h[i]),w.backgroundLayer.scale.set(h[i]),w.bubbleLayer.x=w.gameUILayer.x=w.backgroundLayer.x=d[i],w.marginWidth=u[i],w.backgroundLayer.bubbleAreaWidth=c[i],w.bottomUI.rectWidth=w.topUI.rectWidth=p[i],w.topUI.x=0,w.bottomUI.x=0,w.bottomUI.texture&&!w.bottomUI.texture.noFrame&&w.topUI.texture&&!w.topUI.texture.noFrame&&(w.bottomUI.width=w.bottomUI.rectWidth,w.bottomUI.height=w.height,w.bottomUI.y=w.bottomUI.parent.y,w.topUI.width=w.topUI.rectWidth,w.topUI.height=w.height,w.topUI.y=-w.topUI.parent.y),w.fullUI.scale.set(Math.min(e*w.fullUIScale,t*w.fullUIScale)),w.debug&&(console.log("\nBubble Dragons",w.width,"x",w.height),console.log("aspectRatio:",w.aspectRatio,w.isPortrait?"portrait":"landscape"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",w.lowResolutionAssets?"low":"high"),console.log("View ratio: ",e,":",t),console.log("stage offset: ",w.stage.x,",",w.stage.y,"\n"))},e.registerCallback=function(t,s,i){e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var a=e.callbackList.length-1;a>=0;--a){var n=e.callbackList[a];n.event==t&&n.callback.call(n.arg.context,s,i,n.arg.args)}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var a=e.callbackList[i];if(a.event==t&&a.callback==s){e.callbackList.splice(i,1);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=w.width/w.gameWide,s=w.height/w.gameHigh,i="aspectRatio: "+w.aspectRatio+" "+(w.isPortrait>=1?"portrait":"landscape")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(w.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var a=new o(i,w.textStyleMediumTiny);a.create(w.topUI,-0.45,.25,!0),a.anchor.y=1,e._debugText=a,e._showDebugWindowData=w.nowTime+5e3}};var R={};R.isPressed=null,R.edgeDown=null,R.edgeUp=null,R.debug=!1,R.create=function(e){R.debug=e||!1,R.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",R.keyDown,!0):document.addEventListener?document.addEventListener("keydown",R.keyDown,!0):window.addEventListener?window.addEventListener("keydown",R.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",R.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",R.keyUp,!0):document.addEventListener?document.addEventListener("keyup",R.keyUp,!0):window.addEventListener?window.addEventListener("keyup",R.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",R.keyUp)},R.destroy=function(){R.isPressed=null,R.edgeDown=null,R.edgeUp=null},R.update=function(){return!0},R.reset=function(e){void 0===e?(R.isPressed=[],R.edgeDown=[],R.edgeUp=[]):(R.isPressed[e]=!1,R.edgeDown[e]=!1,R.edgeUp[e]=!1)},R.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(w.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},R.keyDown=function(e){e.preventDefault();var t=R.getCode(e);R.isPressed[t]||(R.edgeDown[t]=!0),R.isPressed[t]=!0},R.keyUp=function(e){e.preventDefault();var t=R.getCode(e);R.isPressed[t]&&(R.edgeUp[t]=!0),R.isPressed[t]=!1};var U={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},G={};G.limit=function(e,t,s){return e>=0?Math.min(e,t):Math.max(e,-s)},G.countInList=function(e,t){for(var s=0,i=0,a=e.length;a>i;i++)e[i]==t&&s++;return s},G.formatBigNumber=function(e){var t=e.toString();if(t.length<=3)return t;for(var s=t.length-3;s>0;s-=3)t=t.slice(0,s)+","+t.slice(s);return t},G.sign0=function(e){return e>0?1:0>e?-1:0},G.near=function(e,t){return{x:e.x+2*Math.random()*t-t,y:e.y+2*Math.random()*t-t}},G.removeFromIndexedList=function(e,t,s,i,a){if(e)for(var n=0,o=e.length;o>n;n++){var r=t(e,n);if((s&&r[s]==i||!s&&r==i)&&(e.splice(n,1),!a))return e}return e},G.findPointInList=function(e,t,s){if(t)for(var i,a=0,n=t.length;n>a;a++)if(i=void 0===s?t[a]:t[a][param],i&&i.x==e.x&&i.y==e.y)return a;return-1},G.findNearestPointInList=function(e,t,s){var i=Number.POSITIVE_INFINITY,a=-1;if(t)for(var n,o=0,r=t.length;r>o;o++)if(n=void 0===s?t[o]:t[o][param]){var l=n.x-e.x,h=n.y-e.y,u=l*l+h*h;i>u&&(i=u,a=o)}return a},G.pickRandomFromList=function(e){if(!e||0===e.length)return null;var t=Math.random()*e.length;return e[Math.floor(t)]},G.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},G.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},G.distance=function(e,t,s,i){var a=s-e,n=i-t;return Math.sqrt(a*a+n*n)},G.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},G.distanceBetweenScaled=function(e,t,s,i){var a=(t.x-e.x)*s,n=(t.y-e.y)*i;return Math.sqrt(a*a+n*n)},G.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var a,n=i/2,o=G.normaliseAnglePositive(e-t+i,i);return a=o>n?e+Math.min(i-o,s):0!==o?e-Math.min(o,s):t,G.normaliseAngle(a,i)},G.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},G.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},G.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,a=e.length;a>i;i++)if(e[i][t]==s)return i;return-1},G.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},G.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),a=(Math.floor(t)%60).toString();return a.length<2&&(a="0"+a),i+":"+a},G.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},G.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},G.randomFromList=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},G.makeFunctionForSprite=function(e){return function(t){G.setValuesFromObject(e,t)}},G.focusChangeCallback=null,G.focusChangeContext=null,G._visListener=!1,G._hidden=!1,G._focusIn=function(){G._hidden=!1,w.debug&&console.log("Utils._focusIn hidden =",G._hidden),G.focusChangeContext&&G.focusChangeCallback&&G.focusChangeCallback.call(G.focusChangeContext,G._hidden)},G._focusOut=function(){G._hidden=!0,w.debug&&console.log("Utils._focusOut hidden =",G._hidden),G.focusChangeContext&&G.focusChangeCallback&&G.focusChangeCallback.call(G.focusChangeContext,G._hidden)},G.detectHidden=function(){if(!G._visListener){var e=s(),t=i(e),n=a(e);document.addEventListener(n,function(){document[t]?G._focusOut():G._focusIn()}),window.addEventListener("focus",G._focusIn,!1),window.addEventListener("blur",G._focusOut,!1),G._visListener=!0}},G.isHidden=function(){return document.hidden},G.blanker=null,G.addBlanker=function(e){return null!==G.blanker?void G.blanker.instances++:(G.blanker=new n,G.blanker.create(w.fullUI,"blanker",e,0,0),G.blanker.anchor.set(.5),G.blanker.scale.set(40),void(G.blanker.instances=1))},G.removeBlanker=function(){G.blanker&&(G.blanker.instances--,G.blanker.instances<=0&&(G.blanker.destroy(),G.blanker=null))},Math.rnd=function(e){return function(){return e=1e4*Math.sin(e),e-Math.floor(e)}},Math.mySeed=function(e){Math.myRandom=Math.rnd(e)},function(){var e=this,t=function(e){return e instanceof t?e:this instanceof t?void(this._wrapped=e):new t(e)};if(t.userAgent=null,t.getUserAgent=function(){return this.userAgent},t.setUserAgent=function(e){this.userAgent=e},t.isAndroid=function(){return this.getUserAgent().match(/Android/i)},t.isBlackBerry=function(){return this.getUserAgent().match(/BlackBerry/i)},t.isBlackBerryPlayBook=function(){return this.getUserAgent().match(/PlayBook/i)},t.isBlackBerry10=function(){return this.getUserAgent().match(/BB10/i)},t.isIOS=function(){return this.isIPhone()||this.isIPad()||this.isIPod()},t.isIPhone=function(){return this.getUserAgent().match(/iPhone/i)},t.isIPad=function(){return this.getUserAgent().match(/iPad/i)},t.isIPod=function(){return this.getUserAgent().match(/iPod/i)},t.isOpera=function(){return this.getUserAgent().match(/Opera Mini/i)},t.isWindows=function(){return this.isWindowsDesktop()||this.isWindowsMobile()},t.isWindowsMobile=function(){return this.getUserAgent().match(/IEMobile/i)},t.isWindowsDesktop=function(){return this.getUserAgent().match(/WPDesktop/i)},t.isFireFox=function(){return this.getUserAgent().match(/Firefox/i)},t.isNexus=function(){return this.getUserAgent().match(/Nexus/i)},t.isKindleFire=function(){return this.getUserAgent().match(/Kindle Fire/i)},t.isPalm=function(){return this.getUserAgent().match(/PalmSource|Palm/i)},t.isAny=function(){var e=!1,s=Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]});for(var i in s)if("setUserAgent"!==s[i]&&"getUserAgent"!==s[i]&&"isAny"!==s[i]&&"isWindows"!==s[i]&&"isIOS"!==s[i]&&t[s[i]]()){e=!0;break}return e},("function"==typeof window||"object"==typeof window)&&t.setUserAgent(navigator.userAgent),"undefined"!=typeof exports){var s=function(e){return e=void 0===e?!0:e,e?function(e,s,i){var a=e.headers["user-agent"]||"";t.setUserAgent(a),e.SmartPhone=t,"function"==typeof s.locals?s.locals({SmartPhone:t}):s.locals.SmartPhone=t,i()}:t};"undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports=s}else e.SmartPhone=t}.call(this),n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,a,n,o){this.textures=s,this.animation="default",this.frameIndex=0,this.atEnd=!1,this.animInterval=0,this.animNextTick=0,this.taskDone=!1,this.setType(t),this.myFilters=null,this.destroyTexture=!1,this.updateCallback=null,this.key&&(this.texture=this.textures.get(this.key),!this.texture&&w.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+this.key)),o?e.addChildAt(this,0):e.addChild(this),n?(this.pcntx=i||0,this.pcnty=a||0):(this.x=i||0,this.y=a||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.globalScale=null,this.texture&&this.destroyTexture&&this.texture.destroy({texture:!0,baseTexture:!0}),this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this),this.parent=null},n.prototype.update=function(e){return this._texture&&!this._texture.orig&&console.log("_texture has no orig! "+this.key),w.resized&&(this.getGlobalScale(!0),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),w.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),0!==this.animInterval&&0!==this.animNextTick&&w.nowTime>=this.animNextTick&&(this.animNextTick=w.nowTime+this.animInterval,this.frameIndex++,this.frameIndex>=F[this.type].animations[this.animation].length&&(this.atEnd=!0,this.frameIndex=this.noRepeat?F[this.type].animations[this.animation].length-1:0),this.setFrame(F[this.type].animations[this.animation][this.frameIndex])),this.updateCallback&&this.updateCallback(this),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setAnimation=function(e,t,s){if(s||this.animation!=e){this.animation=e,this.atEnd=!1,t||(this.frameIndex=0);var i=F[this.type].animations;if(i)return this.setFrame(i[this.animation][this.frameIndex]),this.noRepeat=i.noRepeat,this.animInterval=i.interval,this.animNextTick=i.randomise?w.nowTime+Math.floor(this.animInterval*Math.random()):w.nowTime+this.animInterval,!0}return!1},n.prototype.setFrame=function(e,t){return(t||this.key!=e)&&(this.key=e,this.key)?(this.texture=this.textures.get(e),!0):!1},n.prototype.setType=function(e){e!=this.type&&(this.type=e,this.animation="default",this.animInterval=0,this.animNextTick=0,this.frameIndex=0,this.atEnd=!1),F[this.type]?this.setAnimation(this.animation,!0,!0)||(F[this.type].key?this.setFrame(F[this.type].key):console.error("ERROR: Sprite.create there is no key or animations for _type: '"+e+"'!")):this.setFrame(this.type)},n.prototype.moveToFront=function(){var e=this.parent;e.removeChild(this),e.addChildAt(this,e.children.length-1)},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),a=this.pickerMaskData[s+i*this.texture.frame.width*4];return a?!0:!1},n.prototype.createCanvasFromTexture=function(){var e=document.createElement("canvas");e.width=this.texture.frame.width,e.height=this.texture.frame.height;var t=e.getContext("2d");return t.drawImage(this.texture.baseTexture.source,this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),e},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,a,n){this.fader=new _,this.fader.setFade(e,t,s,i,a,n)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return w.renderer.render(this,e),w.renderer.extract.pixels(e)},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&(this.x=this.parent.texture.noFrame?e/this.parent.scale.x*w.width:e/this.parent.scale.x*this.parent.width)
}},pcnty:{set:function(e){this.percenty=e,this.parent&&(this.y=this.parent.texture.noFrame?e/this.parent.scale.y*w.height:e/this.parent.scale.y*this.parent.height)}},setx:{set:function(e){this.x=e,this.parent&&(this.percentx=e/this.parent.width)}},sety:{set:function(e){this.y=e,this.parent&&(this.percenty=e/this.parent.height)}}}),o.prototype=Object.create(PIXI.Text.prototype),o.prototype.constructor=o,o.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},o.prototype.destroy=function(){PIXI.Text.prototype.destroy.call(this)},o.prototype.update=function(){return w.resized&&(isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),w.resizeConsumed=!0),!0},Object.defineProperties(o.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&(this.x=this.parent.texture.noFrame?e/this.parent.scale.x*w.width:e/this.parent.scale.x*this.parent.width)}},pcnty:{set:function(e){this.percenty=e,this.parent&&(this.y=this.parent.texture.noFrame?e/this.parent.scale.y*w.height:e/this.parent.scale.y*this.parent.height)}},setx:{set:function(e){this.x=e,this.parent&&(this.percentx=this.parent.texture.noFrame?e/w.width:e/this.parent.width)}},sety:{set:function(e){this.y=e,this.parent&&(this.percenty=this.parent.texture.noFrame?e/w.height:e/this.parent.height)}}}),r.prototype.create=function(e,t,s,i,a,o,r,l,h){this.parent=e,this.managers=t,this.texts=[],G.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5,.5),this._create(e,t,s,i,a,o,r,l,h)},r.prototype.createLevelWon=function(e,s,i,a,l){this.parent=e,this.managers=s,this.texts=[],G.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5,.5),this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0;var h,u;i&&(h=w.textStyleBigMessageTitle.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(i)||i,t=new o(u,h),t.create(this.bg,0,-.2,!0),t.anchor.set(.5,.5),this.texts.push(t)),h=w.textStyleBigMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(a)||a,t=new o(u,h),t.create(this.bg,0,-.1,!0),t.anchor.set(.5,0),this.texts.push(t),l&&(h=w.textStyleMediumMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(l)||l,t=new o(u,h),t.create(this.bg,0,.05,!0),t.anchor.set(.5,0),this.texts.push(t)),r.tweenIn.step=G.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(r.tweenIn)},r.prototype.createObjective=function(e,s,i,a,l){var h,u,d;this.parent=e,this.managers=s,this.texts=[],G.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5),d=new n,d.create(this.bg,l,this.managers.textures,-.225,-.03,!0),d.anchor.set(.5),d.scale.set(1.6),this.icon=d,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,h=w.textStyleBigMessageObjTitle.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(a)||a,t=new o(u,h),t.create(this.bg,-.1,-.18,!0),t.anchor.set(0,.5),this.texts.push(t),d=new n,d.create(this.bg,"hud_line2px.png",this.managers.textures,-.1,-.11,!0),d.anchor.set(0,.5),d.scale.set(.9,1),this.underline=d,h=w.textStyleBigMessageObjective.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(i)||i,t=new o(u,h),t.create(this.bg,-.1,0,!0),t.anchor.set(0,.5),this.texts.push(t),r.tweenIn.step=G.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(r.tweenIn)},r.prototype.createWinLose=function(e,s,i,a,l){w.debug&&console.log("BigMessage _subText = "+a+" shotsLeft = "+S.shotsLeft);var h,u,d;this.parent=e,this.managers=s,this.texts=[],G.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_large_v03.png",this.managers.textures),this.bg.anchor.set(.5),h=w.textStyleBigMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get(i)||i,t=new o(u,h),t.create(this.bg,0,-.24,!0),t.anchor.set(.5),this.texts.push(t),a&&(S.shotsLeft<=0&&(a="string_level_out_of_shots"),h=w.textStyleBigMessageSubText.clone(),h.wordWrapWidth=800,h.wordWrap=!0,w.debug&&console.log("BigMessage _subText = "+a),u=this.managers.locale.get(a)||a,t=new o(u,h),t.create(this.bg,0,.175,!0),t.anchor.set(.5,0),this.texts.push(t)),d=new n,d.create(this.bg,"field_01.png",this.managers.textures,0,.02,!0),d.anchor.set(.5),d.scale.set(1),this.fields=[d],h=w.textStyleMediumMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get("string_score"),t=new o(u,h),t.create(d,0,-.14,!0),t.anchor.set(.5,1),this.texts.push(t),h=w.textStyleBigMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=G.formatBigNumber(S.score),t=new o(u,h),t.create(d,0,-.08,!0),t.anchor.set(.5),this.texts.push(t),l&&(d=new n,d.create(this.bg,"field_01.png",this.managers.textures,0,.22,!0),d.anchor.set(.5),d.scale.set(1),this.fields.push(d),h=w.textStyleMediumMessage.clone(),h.wordWrapWidth=800,h.wordWrap=!0,u=this.managers.locale.get("string_high_score"),t=new o(u,h),t.create(d,0,-.14,!0),t.anchor.set(.5,1),this.texts.push(t),u=G.formatBigNumber(S.highScore),h=w.textStyleBigMessage.clone(),t=new o(u,h),t.create(d,0,-.08,!0),t.anchor.set(.5),this.texts.push(t)),this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,r.tweenIn.step=G.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(r.tweenIn)},r.prototype._create=function(e,s,i,a,l,h,u,d,c){this.callback=a||null,this.context=l||null,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0;var p,g,y;h&&(p=w.textStyleBigMessageTitle.clone(),p.wordWrapWidth=800,p.wordWrap=!0,g=this.managers.locale.get(h)||h,t=new o(g,p),t.create(this.bg,0,-.2,!0),t.anchor.set(.5,.5),this.texts.push(t)),p=w.textStyleBigMessage.clone(),p.wordWrapWidth=800,p.wordWrap=!0,g=this.managers.locale.get(i)||i,t=new o(g,p),t.create(this.bg,0,0,!0),t.anchor.set(.5,.5),this.texts.push(t),u&&(y=new n,y.create(this.bg,u,this.managers.textures,d,c,!0),y.anchor.set(.5),this.icon=y),r.tweenIn.step=G.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(r.tweenIn)},r.prototype.addButton=function(e,t){var s=new d(d.TYPE_BUTTON);s.create(this.bg,"menu_play_button",this.managers,0,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down",t||"click1_event"),s.anchor.set(.5,.5);var i=new o(this.managers.locale.get(e),w.textStyleBoldButtonsLarge);i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",this.buttons.push(s)},r.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new d(d.TYPE_BUTTON);i.create(this.bg,"menu_play_button",this.managers,-200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click1_event"),i.anchor.set(.5,.5);var a=new o(this.managers.locale.get(e),w.textStyleBoldButtonsLarge);a.create(i,0,0,!0),a.anchor.set(.5,.5),i.text=a,i.sfx="snd_clickPlay",this.buttons.push(i),i=new d(d.TYPE_BUTTON),i.create(this.bg,"menu_play_button",this.managers,200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click2_event"),i.anchor.set(.5,.5),a=new o(this.managers.locale.get(t),w.textStyleBoldButtonsLarge),a.create(i,0,0,!0),a.anchor.set(.5,.5),i.text=a,i.sfx="snd_clickPlay",this.buttons.push(i)},r.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(r.tweenOut.step=G.makeFunctionForSprite(this.bg),this.bg.tweener.owner=this,this.bg.tweener.context=this,this.bg.tweener.tween(r.tweenOut)),this.removeContext=e||null,this.removeArgument=t||null,!0)},r.prototype.destroy=function(){var e,t;if(G.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();if(this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.icon&&this.icon.destroy(),this.icon=null,this.underline&&this.underline.destroy(),this.underline=null,this.texts)for(e=0,t=this.texts.length;t>e;e++)this.texts[e].destroy();if(this.texts=null,this.fields)for(e=0,t=this.fields.length;t>e;e++)this.fields[e].destroy();this.fields=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,w.idleTimer=w.eventChangeAdOnIdle},r.prototype.update=function(e){if(this.doneIn&&(w.eventChangeAdOnPopup&&!this.adShown&&(w.arenaHelper.sendEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),this.timeOut&&(this.timeOut-=w.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var t,s,i;for(t=0,s=this.buttons.length;s>t&&(i=this.buttons[t].update(),1!=this.buttons[t].alpha&&(i=null),!i);t++);if("click1_event"==i){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==i){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}}return!this.doneOut},r.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var P=300;r.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:P,easing:"easeInQuad",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneIn=!0}},r.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:P,easing:"easeFrom",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},h.prototype.create=function(e,t,s,i,a,n,r,l){this.parent=i,this.managers=a,this.text=new o(n,s),this.text.create(this.parent,e,t,!1),this.text.anchor.set(.5,.5),h.tweenOut.step=G.makeFunctionForSprite(this.text),h.tweenOut.from.y=t,h.tweenOut.to.y=t+(r||-100),h.tweenOut.duration=l||300*Math.random()+700,this.text.tweener=new Tweenable,this.text.tweener.tween(h.tweenOut),this.text.tweener.context=this},h.prototype.destroy=function(){this.text&&this.text.tweener&&(this.text.tweener.stop(),this.text.tweener.context=null),this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1},h.prototype.active=function(){return null!==this.text},h.tweenOut={from:{y:0},to:{y:0},duration:0,easing:"easeFrom",step:null,finish:function(){this.context.destroy()}},u.prototype.create=function(e,t,s,i,a,r){w.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=a,this.onNo=r,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(w.bgImage,"game_title",t.textures),this.bg.anchor.set(.5,1),this.bg.y=w.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(w.fullUI,"menu_bg",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new d(d.TYPE_BUTTON);l.create(this.panel,"menu_play_button",this.managers,-.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var h=new o(this.managers.locale.get("quit_yes_button_string"),w.textStyleBoldButtons);h.create(l,0,0,!0),h.anchor.set(.5,.5),l.text=h,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new d(d.TYPE_BUTTON),l.create(this.panel,"menu_play_button",this.managers,.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),h=new o(this.managers.locale.get("quit_no_button_string"),w.textStyleBoldButtons),h.create(l,0,0,!0),h.anchor.set(.5,.5),l.text=h,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l);var u=w.textStyleBold.clone();u.wordWrap=!0,u.wordWrapWidth=800,h=new o(this.managers.locale.get(s),u),h.create(this.panel,0,-.1,!0),h.anchor.set(.5,.5),this.texts.push(h),_gameGATracker("send","pageview",{page:"/ExitGamePopup"})},u.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,w.resized=!0,w.resizeConsumed=!1,w.swipeEnabled=!1},u.prototype.update=function(){var e,t;if(this.bg.y=w.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(w.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(w.click=null,this.onNo.call(this.context),!1):!0},d.TYPE_BUTTON=1,d.TYPE_CHECKBOX=2,d.TYPE_TOGGLE=3,d.TYPE_NOLATCH=4,d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.prototype.create=function(t,s,i,a,o,r,l,h,u,d,c,p,g,y,b,m){this.managers=i,n.prototype.create.call(this,t,s,this.managers.textures,a,o,r),this.upKey={on:l,off:p},this.overKey={on:h,off:g},this.downKey={on:u,off:y},this.downEvent={on:d,off:b},this.overEvent={on:c,off:m},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,this.enabled=!0,e.registerCallback("mousedown",this.playSfx,{context:this})},d.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.managers=null,n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this._toggled=null,this.sfx=this.sfxHover=null},d.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return s=this.type==d.TYPE_BUTTON||this.type==d.TYPE_NOLATCH?this.downDetected&&null!==w.mouseDown&&i.contains(w.mouseDown.x,w.mouseDown.y)||null!==w.click&&i.contains(w.click.x,w.click.y):null!==w.click&&i.contains(w.click.x,w.click.y),s&&(this.setFrame(this.downKey[this._toggled]),w.mouseDown=w.click=null,this.enabled&&(e=this.downEvent[this._toggled]),t=!0),this.type==d.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&w.hover&&i.contains(w.hover.x,w.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&this.enabled&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==d.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},d.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},Object.defineProperties(d.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),p.prototype.create=function(e,t){w.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,G.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(w.fullUI,"popup_small_v03.png",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new d(d.TYPE_BUTTON);s.create(this.panel,"button_close.png",this.managers,.42,-.329,!0,"button_close.png","button_close.png","button_close.png","click_close_event"),s.anchor.set(.5),s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",this.buttons.push(s);var i=-.2,a=-.15,o=.16;w.isAndroid&&w.isChromeMobile||(i=0,a=.15,o=.16,s=new d(d.TYPE_BUTTON),s.create(this.panel,"settingsScreen/settingsBtn_fxOn.png",this.managers,-.3,-.06,!0,"settingsScreen/settingsBtn_fxOn.png","settingsScreen/settingsBtn_fxOn.png","settingsScreen/settingsBtn_fxOn.png","click_sound_event",null,"settingsScreen/settingsBtn_fxOff.png","settingsScreen/settingsBtn_fxOff.png","settingsScreen/settingsBtn_fxOff.png","click_sound_event_mute",null),s.anchor.set(.5),s.toggled=!this.managers.audio.mute,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",this.buttons.push(s),this.soundBtn=s,s=new d(d.TYPE_BUTTON),s.create(this.panel,"settingsScreen/settingsBtn_musicOn.png",this.managers,-.1,-.06,!0,"settingsScreen/settingsBtn_musicOn.png","settingsScreen/settingsBtn_musicOn.png","settingsScreen/settingsBtn_musicOn.png","click_music_event",null,"settingsScreen/settingsBtn_musicOff.png","settingsScreen/settingsBtn_musicOff.png","settingsScreen/settingsBtn_musicOff.png","click_music_event_mute"),s.anchor.set(.5),s.toggled=!this.managers.audio.tunesMuted,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",this.buttons.push(s),this.musicBtn=s),s=new d(d.TYPE_NOLATCH),s.create(this.panel,"settingsScreen/settingsBtn_help.png",this.managers,.1+i,-.06,!0,"settingsScreen/settingsBtn_help.png","settingsScreen/settingsBtn_helpDown.png","settingsScreen/settingsBtn_helpDown.png","click_help_event"),s.anchor.set(.5),s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",this.buttons.push(s),s=new d(d.TYPE_NOLATCH),s.create(this.panel,"settingsScreen/settingsBtn_exit.png",this.managers,.3+i,-.06,!0,"settingsScreen/settingsBtn_exit.png","settingsScreen/settingsBtn_exitDown.png","settingsScreen/settingsBtn_exitDown.png","click_quit_event"),s.anchor.set(.5),s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",this.buttons.push(s),p.tweenIn.step=G.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.context=this,this.panel.tweener.tween(p.tweenIn),this.removing=!1,this.managers.audio.play("snd_rotate")},p.prototype.remove=function(e){this.removing||(this.removing=!0,w.debug&&console.log("Options.remove"),p.tweenOut.step=G.makeFunctionForSprite(this.panel),this.panel.tweener.tween(p.tweenOut),this.panel.tweener.context=this,this.destroyCallback=e)},p.prototype.destroy=function(){var e;if(w.debug&&console.log("Options.destroy"),G.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,w.resized=!0,w.resizeConsumed=!1,w.swipeEnabled=!1,w.idleTimer=w.eventChangeAdOnIdle},p.prototype.update=function(){var e,t;if(this.doneIn&&w.eventChangeAdOnOptions&&!this.adShown&&(w.arenaHelper.sendEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}switch(t){case"click_close_event":return w.click=null,R.reset(U.space_bar),w.playMidRollAdAfterPause&&w.arenaHelper.requestMidroll(),!1;case"click_help_event":this.game.showHelp();break;case"click_quit_event":this.onYesQuit();break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",w.VERSION,"sound","BUBB_HTML5",1));break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",w.VERSION,"sound","BUBB_HTML5",1));break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",w.VERSION,"sound","BUBB_HTML5",1));break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",w.VERSION,"sound","BUBB_HTML5",1))}return!0},p.prototype.onYesQuit=function(){this.destroy(),S.requestQuit=!0,S.options=null},p.prototype.onNoQuit=function(){};var P=350;p.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:P,easing:"easeInQuad",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneIn=!0}},p.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:P,easing:"easeFrom",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneOut=!0,this.context&&(this.context.destroy(),this.context=null)}},g.titles=["help_title_boost","help_title_boost","help_title_boost","help_title_boost","help_title_boost","help_title_special","help_title_special","help_title_special","help_title_special","help_title_special","help_title_special"],g.names=["name_boost_mine","name_boost_wild","name_boost_fireball","name_boost_extra_moves","name_boost_convert_dragon","name_special_bomb","name_special_rocket","name_special_frozen_bubble","name_special_carry_dragon","name_special_burst_dragon","name_special_convert_dragon"],g.descriptions=["desc_boost_mine","desc_boost_wild","desc_boost_fireball","desc_boost_extra_moves","desc_boost_convert_dragon","desc_special_bomb","desc_special_rocket","desc_special_frozen_bubble","desc_special_carry_dragon","desc_special_burst_dragon","desc_special_convert_dragon"],g.icons=["boostIcon_mine.png","bble_wild.png","boostIcon_flame.png","5plus.png","boostIcon_bluDrag.png","bomb_spark/bomb00.png","rocket.png","frozen01.png","purple_flying/00.png","orange_flying/00.png","blue_flying/00.png"],g.requirements=["boost_mine","boost_wild","boost_fireball","boost_extra_moves","boost_convert_dragon","special_bomb","special_rocket","special_frozen_bubble","special_carry_dragon","special_burst_dragon","special_convert_dragon"],g.prototype.create=function(e){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],G.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(w.fullUI,"popup_large_v03.png",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.panel.scale.set(1.1),this.sprites.push(this.panel);var t,s,i;s=new n,s.create(this.panel,"help_banner.png",this.managers.textures,0,-.275,!0),s.anchor.set(.5),this.sprites.push(s);var a=w.textStyleBigMessageObjTitle.clone();txt=this.managers.locale.get("help_title_boost"),i=new o(txt,a),i.create(this.panel,0,-0.267,!0),i.anchor.set(.5),this.title=i,this.texts.push(i),t=new d(d.TYPE_BUTTON),t.create(this.panel,"help_arwRgt.png",this.managers,.3,-.1,!0,"help_arwRgt.png","help_arwRgt.png","help_arwRgt.png","click_nextPage_event"),t.anchor.set(.5),t.sfx="snd_clickPlay",t.sfxHover="snd_rollOver",this.nextPageBtn=t,this.buttons.push(t),t=new d(d.TYPE_BUTTON),t.create(this.panel,"help_arwLft.png",this.managers,-.3,-.1,!0,"help_arwLft.png","help_arwLft.png","help_arwLft.png","click_prevPage_event"),t.anchor.set(.5),t.sfx="snd_clickPlay",t.sfxHover="snd_rollOver",t.visible=!1,this.prevPageBtn=t,this.buttons.push(t),s=new n,s.create(this.panel,"boostIcon_mine.png",this.managers.textures,0,-.1,!0),s.anchor.set(.5),s.scale.set(1.5),this.icon=s,this.sprites.push(s),a=w.textStyleHelpBoostTitle.clone(),txt=this.managers.locale.get("name_boost_mine"),i=new o(txt,a),i.create(this.panel,0,.05,!0),i.anchor.set(.5),this.nameText=i,this.texts.push(i),a=w.textStyleHelpBoostDescription.clone(),a.wordWrap=!0,a.wordWrapWidth=800,txt=this.managers.locale.get("desc_boost_mine"),i=new o(txt,a),i.create(this.panel,0,.1,!0),i.anchor.set(.5,0),this.nameDesc=i,this.texts.push(i),t=new d(d.TYPE_BUTTON),t.create(this.panel,"button_close.png",this.managers,.412,-.382,!0,"button_close.png","button_close.png","button_close.png","click_close_event"),t.anchor.set(.5),t.scale.set(1.05),t.sfx="snd_clickPlay",t.sfxHover="snd_rollOver",this.buttons.push(t),this.page=this.nextPage(-1),this.showPage(),g.tweenIn.step=G.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(g.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},g.prototype.remove=function(e){this.removing||(this.removing=!0,w.debug&&console.log("Help.remove"),g.tweenOut.step=G.makeFunctionForSprite(this.panel),this.panel.tweener.tween(g.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},g.prototype.destroy=function(){var e;if(G.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.managers=null,this.title=null,this.icon=null,this.nameText=null,this.nameDesc=null,this.nextPageBtn=null,this.prevPageBtn=null,w.resized=!0,w.resizeConsumed=!1},g.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return"click_prevPage_event"==t&&this.page>0&&(this.page=this.previousPage(this.page),this.showPage()),"click_nextPage_event"==t&&this.page<g.icons.length-1&&(this.page=this.nextPage(this.page),this.showPage()),"click_close_event"==t?(w.resetInput(),!1):!0},g.prototype.previousPage=function(e){var t=e;do if(t--,0>t)return e;while(!this.validPage(t));return t},g.prototype.nextPage=function(e){var t=e;do if(t++,t>=g.icons.length-1)return e;while(!this.validPage(t));return t},g.prototype.validPage=function(e){if(this.levelData){var t=g.requirements[e];if(this.levelData.boost.id==t)return!0;for(var s=this.levelData.specials,i=0,a=s.length;a>i;i++)if(void 0!==s[i][t])return!0;return!1}return!0},g.prototype.showPage=function(){var e=this.managers.locale.get(g.titles[this.page]),t=this.managers.locale.get(g.names[this.page]),s=this.managers.locale.get(g.descriptions[this.page]),i=g.icons[this.page];this.title.text=e,this.nameText.text=t,this.nameDesc.text=s,this.icon.setFrame(i),this.prevPageBtn.visible=this.previousPage(this.page)!=this.page,this.nextPageBtn.visible=this.nextPage(this.page)!=this.page};var N=350;g.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:N,easing:"easeInQuad",step:null,finish:function(){}},g.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:N,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},y.createTweens=function(e,t,s,i,a,r){isNaN(i)&&(i=0),isNaN(a)&&(a=0);for(var l=[],h=[],u=0;u<e.length;u++){var c=e[u];if(c.button){var p=new d(d.TYPE_BUTTON);if(p.create(t,c.key,s,c.x+i,c.y+a,!1,c.key,c.button.over,c.button.down,c.button.clickEvent),p.anchor.x=p.anchor.y=.5,void 0!==c.visible&&(p.visible=c.visible),p.sfx=c.button.sfx,p.sfxHover=c.button.sfxHover,void 0!==c.button.text){var g=new o(s.locale.get(c.button.text),r||w.textStyleBoldButtons);g.create(p,0,0,!0),g.anchor.set(.5,.5),p.text=g}void 0!==c.fade&&p.addFader(c.fade,c.alpha),void 0!==c.tween&&(c.tween.step=G.makeFunctionForSprite(p),p.tweener=new Tweenable,p.tweener.tween(c.tween),p.tweener.owner=p),h.push(p)}else{var y=new n;y.create(t,c.key,s.textures,c.x+i,c.y+a,!1),y.anchor.x=y.anchor.y=.5,void 0!==c.visible&&(y.visible=c.visible),void 0!==c.fade&&y.addFader(c.fade,c.alpha),void 0!==c.tween&&(c.tween.step=G.makeFunctionForSprite(y),y.tweener=new Tweenable,y.tweener.tween(c.tween),y.tweener.owner=y),l.push(y)}}return{sprites:l,buttons:h}},b.prototype.create=function(e){this.managers=e},b.prototype.destroy=function(){this.managers=null},b.prototype.loadGameStatus=function(){w.debug&&console.log("loadGameStatus");var e=localStorage.BubbleBoo2_status;if(e){var t=JSON.parse(e);return w.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),O.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),!0}return w.debug&&console.log("Game data is not available in localStorage."),!1},b.prototype.saveGameStatus=function(){w.debug&&console.log("saveGameStatus");var e={sfxVolume:O.sfxVolume,musicVolume:O.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted},t=JSON.stringify(e);return localStorage.BubbleBoo2_status=t,!0},m.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},m.prototype.get=function(e){if(!this.dataManager)return w.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=G.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(w.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},m.prototype.onLocaleChanged=function(){w.countryCode=w.arenaHelper.getLocale();var e=this.dataManager.get("localizations");w.debug&&console.log("available languages: ",e),e&&e.availableLocales&&-1==G.indexOfStringNoCase(e.availableLocales,w.countryCode)&&(w.debug&&console.log("language is not available: ",w.countryCode),w.countryCode="en-US"),w.debug&&console.log("language code = ",w.countryCode),this.dataManager.loadData("strings",w.arenaHelper.getAbsoluteURL("")+"data/locale/"+w.countryCode+"/strings.json"),this.strings=null},f.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];f.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(w.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else w.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(w.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),w.debug&&console.log("All fonts loaded or failed."),!0)},f.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var a=i.offsetWidth;return i.parentNode.removeChild(i),a},_.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},_.prototype.setFade=function(e,t,s,i,a,n){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=a,null!==n&&(this.trigger=n,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))
},_.prototype.reached=function(e){return this.fadeValue==e},_.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,w.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,w.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},v.GRAVITY=11,v.POP_BUBBLE=1,v.FALL_BUBBLE=2,v.ROCKET=3,v.EXPLOSION=4,v.DRAGON_BLUE=5,v.BOOST_BONUS5=6,v.ROCKET_SMOKE=7,v.ROCKET_FIRE=8,v.DRAGON_FLAME_JET=9,v.BOOST_SMOKE=10,v.DRAGON_LIGHTNING=11,v.DRAGON_GOLD=12,v.CRACK_ICE=13,v.FAKE_BUBBLE=14,v.SPARKLES_WHITE=15,v.SPARKLES_RAINBOW=16,v.DROP_FISH=17,v.DRAGON_ORANGE=18,v.DRAGON_PURPLE=19,v.DRAGON_PURPLE_LEAVE=20,v.FISH_SPLASH=21,v.definitions=[{},{type:F.EFFECT_POP_BUBBLE.type,animation:"default",scale:.75,sound:"snd_pop",soundDelay:.15},{type:F.EFFECT_FALL_BUBBLE.type,animation:"default",lockLast:!0,scale:1},{type:F.ROCKET.type,animation:"default",lockLast:!0,scale:1},{type:F.EFFECT_EXPLOSION.type,animation:"default",scale:1,sound:"snd_bomb",soundDelay:.15},{type:F.DRAGON_BLUE.type,animation:"flying",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:F.PLUS5.type,speed:0,key:"5plus.png",scale:1},{type:F.EFFECT_ROCKET_SMOKE.type,animation:"default",lockLast:!0,scale:1},{type:F.EFFECT_ROCKET_FIRE.type,animation:"default",repeat:!0,scale:1},{type:F.EFFECT_DRAGON_FLAME_JET.type,animation:"default",scale:1,sound:"snd_dragon_fire"},{type:F.EFFECT_BOOST_SMOKE.type,animation:"default",lockLast:!0,scale:1},{type:F.EFFECT_DRAGON_LIGHTNING.type,animation:"default",scale:1,sound:"snd_dragon_zap"},{type:F.DRAGON_EGG.type,animation:"default",repeat:!0,scale:1,sound:"snd_dragon_zap"},{type:F.ICE.type,animation:"cracking",scale:1},{type:F.EFFECT_FAKE_BUBBLE.type,lockLast:!0,key:"bble_red.png",scale:1,noAnim:!0},{type:F.EFFECT_SPARKLES_WHITE.type,animation:"default",scale:1},{type:F.EFFECT_SPARKLES_RAINBOW.type,animation:"default",scale:1},{type:F.EFFECT_DROP_FISH.type,animation:"default",repeat:!0,scale:1},{type:F.DRAGON_ORANGE.type,animation:"flying",repeat:!0,fadeOut:.1,soundOnLoop:"snd_wing",scale:1},{type:F.DRAGON_PURPLE.type,animation:"flying",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:F.DRAGON_PURPLE.type,animation:"gliding",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:F.EFFECT_FISH_SPLASH.type,animation:"default",scale:1}],v.prototype.create=function(e,t,s,i){this.world=e,this.managers=t,this.playField=s,this.gridCollide=i,this.list=[]},v.prototype.destroy=function(){w.debug&&console.log("Effects.destroy"),this.reset(),this.list=null,this.gridCollide=null,this.playField=null,this.managers=null,this.world=null,this.game=null,this.target=null},v.prototype.reset=function(){w.debug&&console.log("Effects.reset");for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=[]},v.prototype.add=function(e,t,s,i,a,o,r,l){var h=new n,u=v.definitions[e];return h.create(t,u.type,this.managers.textures,s,i,l,r),h.anchor.set(.5),h.scale.set(u.scale),h.fxType=e,h.vx=h.vy=0,h.repeat=u.repeat,this.bespokeInit(e,h,t)?(void 0!==u.animation?h.setAnimation(u.animation,!1,!0):h.fxFrameNumber=u.first,h.bespokeLogic=a?a:null,h.bespokeLogicContext=o?o:this,this.list.push(h),u.sound&&this.game.managers.audio.play(u.sound),w.debugSpam&&console.log("Effects.add ["+this.list.length+"] type = "+e+" "+s+","+i),h):(h.destroy(),void(h=null))},v.prototype.bespokeInit=function(e,t){var s;switch(e){case v.DRAGON_GOLD:t.vx=96*Math.random()-48,t.vy=-48,t.hoverDelay=2e3;break;case v.DRAGON_BLUE:if(s=this.game.world.playField.pickVisibleBubble(this.game.world.playField.grid[0].length-5,this.game.world.playField.grid[0].length-2),!s)return!1;t.dest=s,t.sx=35,t.sy=31,t.dx=t.dy=.92,t.vx=400,t.vy=0,t.leaving=!1,t.target=this.game.world.playField.grid[s.y][s.x];break;case v.DRAGON_ORANGE:if(s=this.game.world.playField.pickVisibleBubble(),!s)return!1;t.dest=s,t.vx=40*Math.random()-20,t.vy=-30,t.target=this.game.world.playField.grid[s.y][s.x],t.hoverDelay=1e3;break;case v.DRAGON_PURPLE:if(s=this.playField.pickVisibleSpace(),!s)return!1;var i=this.gridCollide.bubbleToGameUi(t),a=new n;a.create(w.gameUILayer,F.EFFECT_FAKE_BUBBLE.type,this.managers.textures,i.x,i.y,!1,!0),a.anchor.set(.5),t.dest=s,t.vx=40*Math.random()-20,t.vy=-30,t.target=this.game.world.playField.grid[s.y][s.x],t.hoverDelay=1e3,t.vx=64*Math.random()-32,t.vy=-50,t.dragging=a;break;case v.DRAGON_PURPLE_LEAVE:t.vy=-100-100*Math.random();break;case v.BOOST_BONUS5:t.vx=300,t.vy=0,t.sx=21,t.sy=25,t.dx=t.dy=.965,t.landingSpeed=90;break;case v.ROCKET:t.effectOverlay=this.addAttached(v.ROCKET_FIRE,t,-16,0);break;case v.FALL_BUBBLE:t.vx=40*Math.random()-20,t.vy=-60-100*Math.random();break;case v.DROP_FISH:t.moveToFront()}return!0},v.prototype.addAttached=function(e,t,s,i,a,o){w.debugSpam&&console.log("Effects.addAttached type = "+e+" "+s+","+i);var r=new n,l=v.definitions[e];return r.create(t.parent,l.type,this.managers.textures,t.x+s,t.y+i,!1),t.parent.setChildIndex(r,t.parent.getChildIndex(t)),r.anchor.set(t.anchor.x,t.anchor.y),r.scale.set(l.scale),r.fxType=e,r.fxFrameNumber=l.first,r.tz=t.tz,r.repeat=l.repeat,r.bespokeLogic=a?a:null,r.bespokeLogicContext=o?o:this,this.list.push(r),l.sound&&this.game.managers.audio.play(l.sound),r},v.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(null!==t.parent)if(t.shouldDie||t.bespokeLogic&&!t.bespokeLogic.call(t.bespokeLogicContext,t)){t.effectOverlay&&(t.effectOverlay.shouldDie=!0),t.dragging&&t.dragging.parent&&(t.dragging.destroy(),t.dragging=null);var s=t.fxType;t.destroy(),this.list.splice(e,1),w.debugSpam&&console.log("Effects destroy ["+this.list.length+"] type = "+s)}else{var i=v.definitions[t.fxType];if(i.animation&&t.atEnd){if(i.soundOnLoop&&t.repeat&&this.game.managers.audio.play(i.soundOnLoop),!t.repeat&&!i.lockLast){if(i.fadeOut>0&&(t.alpha-=i.fadeOut,t.alpha>0))continue;var a=t.fxType;t.destroy(),this.list.splice(e,1),w.debugSpam&&console.log("Effects anim destroy ["+this.list.length+"] type = "+a);continue}t.atEnd=!1}t.update(),i.rotation&&(t.rotation+=i.rotation)}else t.destroy(),this.list.splice(e,1)}return this.list.length},v.prototype.getKeyName=function(e,t){var s=v.definitions[e];return s.key?s.key:void 0===t||0===s.speed?s.baseKey+(s.keySubscript?s.keySubscript:""):s.digits?s.baseKey+G.padToLength(t.toString(),s.digits,"0",!1)+(s.keySubscript?s.keySubscript:""):s.baseKey+t.toString()+(s.keySubscript?s.keySubscript:"")},v.swoopToGridTarget=function(e,t,s){if(e.target&&null===e.target.game){var i=t.pickVisibleBubble();if(!i)return e.target=null,!1;e.dest=i,e.target=t.grid[i.y][i.x]}var a=t.gridCollide.gridToGameUi(e.dest);return s&&(a.x+=s.x,a.y+=s.y),v.swoopToTarget(e,a)},v.swoopToTarget=function(e,t){var s=t.x-e.x,i=t.y-e.y,a=s*s+i*i,n=Math.sqrt(a);return e.vx+=(e.sx||25)*s/n,e.vy+=(e.sy||21)*i/n,e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3,n<4*S.bubbleRadius?(e.vx*=e.dx||.94,e.vy*=e.dy||.94):(e.vx*=.98,e.vy*=.98),n<S.bubbleRadius&&Math.abs(e.vx)+1.6*Math.abs(e.vy)<(e.landingSpeed||55)?!1:!0},v.prototype.countDragonsFlying=function(){for(var e=0,t=this.list.length-1;t>=0;--t){var s=this.list[t];(s.fxType==v.DRAGON_BLUE||s.fxType==v.DRAGON_ORANGE)&&e++}return e},v.prototype.count=function(){return this.list.length},v.bubbleFall=function(e){var t;switch(v.fall(e),e.type){case F.EFFECT_DROP_FISH.type:e.rotation+=e.vr,e.y>=S.killAtBottom&&(I.effects.add(v.FISH_SPLASH,e.parent,e.x,e.y),t=I.effects.add(v.FISH_SPLASH,this.game.world.fishWidget,.25,-.5,null,null,!1,!0),t.scale.set(1),this.game.foodCount--,this.game.managers.audio.play("snd_collect_fish"))}return e.y<S.killAtBottom},v.fall=function(e){e.vx*=.985,e.vy+=v.GRAVITY,e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3},GridCollide=function(){},GridCollide.prototype.create=function(e,t,s){this.grid=e,this.offsetY=0,this.spacingx=t,this.spacingy=s},GridCollide.prototype.destroy=function(){w.debug&&console.log("GridCollide.destroy"),this.grid=null},GridCollide.prototype.gameUiToGrid=function(e){var t=(e.x+S.gridOffsetX)/this.spacingx,s=(e.y+S.gridOffsetY-this.offsetY)/this.spacingy,i=Math.round(t),a=Math.round(s);return 0>a&&(console.log("gameUiToGrid outside y "+a),a=0),a>=this.grid.length&&(console.log("gameUiToGrid outside y "+a),a=this.grid.length-1),0>i&&(console.log("gameUiToGrid outside x "+i),i=0),i>=this.grid[a].length&&(console.log("gameUiToGrid outside x "+i),i=this.grid[a].length-1),-1==this.grid[a][i]?i>=this.grid[a].length-1||i>0&&t-Math.floor(t)>=.5?{x:i-1,y:a}:{x:i+1,y:a}:{x:i,y:a}},GridCollide.prototype.bubbleToGrid=function(e){var t=(e.x+S.gridOffsetX)/this.spacingx,s=(e.y+S.gridOffsetY)/this.spacingy,i=Math.round(t),a=Math.round(s);return a>=0&&a<this.grid.length&&i>=0&&i<this.grid[a].length?-1==this.grid[a][i]?i>=this.grid[a].length-1?{x:i-1,y:a}:0>=i?{x:i+1,y:a}:t-Math.floor(t)<.5?{x:i-1,y:a}:{x:i+1,y:a}:{x:i,y:a}:(w.debug&&console.log("WARNING: bubbleToGrid outside of grid. rx="+i+" ry="+a),{x:i,y:a})},GridCollide.prototype.bubbleToFractionalGrid=function(e){var t=(e.x+S.gridOffsetX)/this.spacingx,s=(e.y+S.gridOffsetY)/this.spacingy;return{x:t,y:s}},GridCollide.prototype.gridToGameUi=function(e){var t=e.x*this.spacingx-S.gridOffsetX,s=e.y*this.spacingy-S.gridOffsetY+this.offsetY;return{x:t,y:s}},GridCollide.prototype.gridToBubble=function(e){var t=e.x*this.spacingx-S.gridOffsetX,s=e.y*this.spacingy-S.gridOffsetY;return{x:t,y:s}},GridCollide.prototype.gameUiToBubble=function(e){return{x:e.x,y:e.y-this.offsetY}},GridCollide.prototype.bubbleToGameUi=function(e){return{x:e.x,y:e.y+this.offsetY}},GridCollide.prototype.empty=function(e){if(e.y<0||e.y>=this.grid.length)return!1;if(e.x<0||e.x>=this.grid[e.y].length)return!1;var t=this.grid[e.y][e.x];return!t},GridCollide.prototype.get=function(e){var t=Math.floor(e.y);if(0>t||t>=this.grid.length)return null;var s=Math.floor(e.x);return 0>s||s>=this.grid[t].length?null:this.grid[t][s]},GridCollide.prototype.collide=function(e,t){for(var s=[],i=this.gameUiToGrid(e),a=i.y-t;a<=i.y+t;a++)if(a>=0&&a<this.grid.length)for(var n=i.x-2*t;n<=i.x+2*t;n++)if(n>=0&&n<this.grid[a].length){var o=this.grid[a][n];o&&-1!==o&&s.push(this.grid[a][n])}return s},GridCollide.prototype.outsideGrid=function(e){var t=e.x;if(t<-S.gridOffsetX)return!0;if(t>S.gridOffsetX)return!0;var s=e.y+S.gridOffsetY;return s<S.mapTop[S.levelType]?!0:!1},GridCollide.prototype.randomLocation=function(e,t,s){void 0===s&&(s=Math.random);var i,a;do a=Math.floor(s()*e.length),i=Math.floor(s()*e[a].length);while(-1==e[a][i]||t&&!e[a][i]);return{x:i,y:a}},GridCollide.prototype.removeBubble=function(e){if(this.grid){var t=this.bubbleToGrid(e.sprite),s=this.get(t);s==e&&(w.debugSpam&&console.log("GridCollide.removeBubble "+e.key+" at "+t.x+","+t.y),this.grid[t.y][t.x]=0)}},x.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new C,this.textureManager.create(),this.dataManager=new M,this.dataManager.create(),this.localeManager=new m,this.audioManager=new O,this.loadManager=new b,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers());var s=this.lowResolution?"low":"high";this.textureManager.addImage("load_spinner",this.baseUrl+"images/_reduced/"+s+"/preloader/loading.png"),this.textureManager.addImage("preloader_bg",this.baseUrl+"images/_reduced/high/preloader/splash_screen.jpg"),this.textureManager.addImage("square_red",this.baseUrl+"images/_reduced/high/preloader/redSquare.png"),this.textureManager.addImage("square_green",this.baseUrl+"images/_reduced/high/preloader/greenSquare.png"),this.textureManager.addImage("square_cyan",this.baseUrl+"images/_reduced/high/preloader/cyanSquare.png"),this.textureManager.addImage("square_empty",this.baseUrl+"images/_reduced/high/preloader/emptySquare.png"),this.textureManager.startLoading(this.preloaderReady,this)},x.prototype.preloaderReady=function(){var e=this;w.bottomUI.texture=this.textureManager.get("square_empty"),w.bottomUI.width=w.bottomUI.rectWidth,w.bottomUI.height=w.height,w.bottomUI.y=w.bottomUI.parent.y,w.topUI.texture=this.textureManager.get("square_empty"),w.topUI.width=w.topUI.rectWidth,w.topUI.height=w.height,w.topUI.y=-w.topUI.parent.y,this.bg=new n,this.bg.create(w.bgImage,"preloader_bg",this.textureManager),this.bg.anchor.set(.5),this.loadWidget=new n,this.loadWidget.create(w.fullUI,"load_spinner",this.textureManager),this.loadWidget.anchor.set(.5),this.loadWidget.scale.set(this.lowResolution?4:2);var t=this.baseUrl+(this.lowResolution?"images/_reduced/low/":"images/_reduced/high/");this.textureManager.addImage("game_title",t+"UI/TitlePage/title_bg.jpg"),this.textureManager.addImage("title_text",t+"UI/TitlePage/title_bubdrag.png"),this.textureManager.addImage("menu_play_button",t+"UI/TitlePage/button_start.png"),this.textureManager.addImage("blanker",t+"menus/blanker.png"),this.textureManager.addAtlas("panelsAtlas",t+"panelsAtlas.json",t+"panelsAtlas.png"),this.textureManager.addAtlas("gameAtlas",t+"gameAtlas.json",t+"gameAtlas.png"),this.textureManager.addImage("game_bg1",t+"backgrounds/forest-stage-bg.jpg"),this.textureManager.addImage("game_bg2",t+"backgrounds/river-stage-bg.jpg"),this.textureManager.addImage("game_bg3",t+"backgrounds/cave-stage-bg.jpg"),this.textureManager.addImage("game_bg4",t+"backgrounds/desert-stage-bg.jpg"),this.textureManager.addImage("game_bg5",t+"backgrounds/lake-stage-bg.jpg"),this.textureManager.addImage("game_bg6",t+"backgrounds/cave-stage-bg2.jpg"),this.textureManager.startLoading(),this.loadAudioAssets(),this.dataManager.loadData("levels",this.baseUrl+"data/levelData.json",function(){e.levels=e.dataManager.get("levels").levels.length}),this.dataManager.loadData("symbol_offsets",this.baseUrl+"data/symbol_offsets.json"),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){w.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)})},x.prototype.loadAudioAssets=function(){this.audioManager.loadAudio("game_over_tune",this.baseUrl+"sounds/bgm_game_over",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_win_tune",this.baseUrl+"sounds/bgm_game_win",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/bgm_gameplay",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_title_tune",this.baseUrl+"sounds/bgm_opening",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_bomb",this.baseUrl+"sounds/sfx_bomb_explosion",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_bubbleBounce",this.baseUrl+"sounds/sfx_bubble_bounce",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_fireball",this.baseUrl+"sounds/sfx_bubble_fireball",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_mine",this.baseUrl+"sounds/sfx_booster_mine",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_pop",this.baseUrl+"sounds/sfx_bubble_pop",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_shoot",this.baseUrl+"sounds/sfx_bubble_shoot",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_stick",this.baseUrl+"sounds/sfx_bubble_stick",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_dragon_zap",this.baseUrl+"sounds/sfx_booster_dragon_zap",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_click",this.baseUrl+"sounds/sfx_button_click",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_crack",this.baseUrl+"sounds/sfx_crack_open",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_firework_launch",this.baseUrl+"sounds/sfx_firework_launch",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_moves_up",this.baseUrl+"sounds/sfx_booster_extra_moves",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_popup_flying",this.baseUrl+"sounds/sfx_popup_movement",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_warning",this.baseUrl+"sounds/sfx_warning_sound",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_wing",this.baseUrl+"sounds/sfx_dragon_fly",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_booster_award",this.baseUrl+"sounds/sfx_booster_gained",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_stick_top",this.baseUrl+"sounds/sfx_bubble_stick_top",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_collect_fish",this.baseUrl+"sounds/sfx_collect_fish",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_ice_crack",this.baseUrl+"sounds/sfx_ice_break",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_dragon_fire",this.baseUrl+"sounds/sfx_special_dragon_fire",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_rainbow",this.baseUrl+"sounds/sfx_special_wild",["mp3","m4a","ogg"])},x.prototype.cleanUp=function(){this.root=null,this.loadWidget&&(this.loadWidget.destroy(),this.loadWidget=null),this.bg&&(this.bg.destroy(),this.bg=null)},x.prototype.update=function(){this.loadWidget&&(this.loadWidget.rotation+=Math.PI/180,this.loadWidget.update())},x.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.cleanUp(),!0):!1},x.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},w.timeStarted=Date.now(),w.width=null,w.height=null,w.HTMLElement=null,w.shiftPlayfield=.37083333,w.self=null,w.prototype.createGame=function(t,s,i){new e,e.resizeCanvas(),w.arenaHelper||(w.arenaHelper=new A),w.app=new PIXI.Application(t||w.gameWide,s||w.gameHigh,{autoResize:!0}),w.renderer=w.app.renderer,w.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device"));var a=null;null!==i&&(a=document.getElementById(i)),w.HTMLElement=a,a?a.appendChild(w.app.view):document.body.appendChild(w.app.view),w.getFocus(),w.suppressBigAnimations=w.renderer instanceof PIXI.CanvasRenderer?!0:!1,w.debug&&console.log("Main.suppressBigAnimations =",w.suppressBigAnimations),w.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,w.debug&&console.log("Main.android device =",w.isAndroid),w.isChromeMobile=PIXI.utils.isMobile.other.chrome,w.debug&&console.log("Main.isChromeMobile =",w.isChromeMobile),w.stage=w.app.stage,w.stage.x=w.gameWide/2,w.stage.y=w.gameHigh/2,w.bgImage=new PIXI.Sprite,w.bgImage.anchor.set(.5,.5),w.stage.addChild(w.bgImage),w.backgroundLayer=new PIXI.Sprite,w.backgroundLayer.anchor.set(.5,.5),w.stage.addChild(w.backgroundLayer),w.bubbleLayer=new PIXI.Sprite,w.bubbleLayer.anchor.set(.5,1),w.stage.addChild(w.bubbleLayer),w.gameUILayer=new PIXI.Sprite,w.gameUILayer.anchor.set(.5,.5),w.stage.addChild(w.gameUILayer),w.bottomUI=new PIXI.Sprite,w.bottomUI.anchor.set(.5,1),w.stage.addChild(w.bottomUI),w.topUI=new PIXI.Sprite,w.topUI.anchor.set(.5,0),w.stage.addChild(w.topUI),w.fullUI=new PIXI.Sprite,w.fullUI.anchor.set(.5,.5),w.fullUIScale=1,w.stage.addChild(w.fullUI),e.resizeCanvas(),e.pixiListeners(w.renderer),_gameGATracker("create","UA-68188765-28","auto"),_gameGATracker("send","pageview",{page:"/LoadingScene"}),w.nowTime=Date.now(),w.time=0,w.repeatedGamesLeft=w.playAgainCount,this.gameControl=new T,this.gameControl.create(),new f(["bub_font1","bub_font2"],this.playGame,this)},w.prototype.playGame=function(){w.debug&&console.log("starting game loop");var t=null;w.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=PIXI.ticker.shared;i.autoStart=!1,i.stop(),i=PIXI.ticker,i.autoStart=!1;var a=!1,n=function(){a?requestAnimationFrame(n):(a=!0,w._lastTime=w.nowTime,w.nowTime=Date.now(),w.elapsedTime=Math.min(w.nowTime-w._lastTime,33),w.time+=w.elapsedTime,requestAnimationFrame(n),t&&t.begin(),w.resized?w.nowTime-w.resizeTime>100&&(e.resizeContent(),s.gameControl.update()):s.gameControl.update(),w.resizeConsumed&&(w.resized=!1,w.resizeConsumed=!1),w.forceResize&&e.resizeCanvas(),t&&t.end(),a=!1)};requestAnimationFrame(n)},w.createTextStyles=function(e){var t=e.get("text_styles");w.textStyleVersionTiny=w.wrapTextStyle(t.textStyleVersionTiny),w.textStyleBigMessageTitle=w.wrapTextStyle(t.textStyleBigMessageTitle),w.textStyleBigMessage=w.wrapTextStyle(t.textStyleBigMessage),w.textStyleMediumMessage=w.wrapTextStyle(t.textStyleMediumMessage),w.textStyleBigMessageSubText=w.wrapTextStyle(t.textStyleBigMessageSubText),w.textStyleBigMessageObjective=w.wrapTextStyle(t.textStyleBigMessageObjective),w.textStyleBigMessageObjTitle=w.wrapTextStyle(t.textStyleBigMessageObjTitle),w.textStyleHelpBannerTitle=w.wrapTextStyle(t.textStyleHelpBannerTitle),w.textStyleHelpBoostTitle=w.wrapTextStyle(t.textStyleHelpBoostTitle),w.textStyleHelpBoostDescription=w.wrapTextStyle(t.textStyleHelpBoostDescription),w.textStyleUIScoreAndShots=w.wrapTextStyle(t.textStyleUIScoreAndShots),w.textStyleUILevelNumber=w.wrapTextStyle(t.textStyleUILevelNumber),w.textStyleBold=w.wrapTextStyle(t.textStyleBold),w.textStyleBoldSmall=w.wrapTextStyle(t.textStyleBoldSmall),w.textStyleBoldButtons=w.wrapTextStyle(t.textStyleBoldButtons),w.textStyleBoldButtonsLarge=w.wrapTextStyle(t.textStyleBoldButtonsLarge),w.textStyleBoldButtonTitles=w.wrapTextStyle(t.textStyleBoldButtonTitles),w.textStyleBoldLargeCentered=w.wrapTextStyle(t.textStyleBoldLargeCentered),w.textStyleMedium=w.wrapTextStyle(t.textStyleMedium),w.textStyleMedium2=w.wrapTextStyle(t.textStyleMedium2),w.textStyleMediumTiny=w.wrapTextStyle(t.textStyleMediumTiny),w.textStyleLarge=w.wrapTextStyle(t.textStyleLarge)},w.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return G.setValuesFromObject(t,e),t},w.render=function(){w.renderer.render(w.stage),e.resizeCanvas()},w.resetInput=function(){e.resetInput(),w.click=null,w.hover=null,w.mouseDown=null,w.mouseUp=null,w.swipe=0},w.getFocus=function(){w.app&&w.app.view&&(w.app.view.setAttribute("tabindex","-1"),w.app.view.focus()),R.create()},T.GameStates={NONE:-1,PRELOAD:0,TITLES:1,PLAY:2},T.pageHidden=!1,T.prototype.create=function(){this.preloader=new x(w.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,w.lowResolutionAssets),this.lastState=T.GameStates.NONE,this.state=T.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null},T.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,w.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case T.GameStates.PRELOAD:if(this.preloader.update(),this.preloader.allLoaded()){this.state=T.GameStates.TITLES,G.focusChangeCallback=this.onFocusChange,G.focusChangeContext=this,G.detectHidden(),T.pageHidden=G.isHidden();var i=this.preloader.dataManager.get("levels");w.totalShots=i.numShots,this.preloader.loadManager.loadGameStatus(),t=!0}break;case T.GameStates.TITLES:s&&(R.create(),e.clearCallbacks(),this.preloader.audioManager.stopTune(),this.resetInput(),this.titles=new L,this.titles.create(this.preloader)),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,this.state=T.GameStates.PLAY);break;case T.GameStates.PLAY:s&&(w.arenaHelper.sendGameStart(),this.resetInput(),this.game=new S,this.game.create(this.preloader.getManagers(),this.preloader.levels),this.preloader.audioManager.startTune("game_tune")),this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,this.state=T.GameStates.TITLES)}}while(t);w.mouseDown&&w.getFocus(),w.render()},T.prototype.resetInput=function(){R.reset(),w.resetInput()},T.prototype.onFocusChange=function(e){e||w.getFocus(),(w.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(S.paused=null!==S.options,w.time=1e3*Math.floor(w.time/1e3)+999,this.preloader.audioManager.visibilityMute(T.pageHidden),w.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},L.ready=!1,L.first=!0;var P=800,D=100;L.pieces=[{key:"title_text",x:0,y:-90,alpha:0,fade:.05},{key:"menu_play_button",x:0,y:300,button:{over:"menu_play_button",down:"menu_play_button",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){L.ready=!0},duration:P+5*D,easing:"bounce"}}],L.prototype.create=function(e){L.ready=!1,this.preloader=e,this.managers=this.preloader.getManagers(),this.bg=new n,this.bg.create(w.bgImage,"game_title",this.managers.textures),this.bg.anchor.set(.5),this.bg.y=0,this.version=new o(w.VERSION,w.textStyleVersionTiny),this.version.create(w.fullUI,.49,.49,!0),this.version.anchor.set(1),this.version.scale.set(.5/w.fullUI.scale.x),w.fullUIScale=1,w.forceResize=!0;var t=y.createTweens(L.pieces,w.fullUI,this.managers,0,0,w.textStyleBoldButtonTitles);this.sprites=t.sprites,this.buttons=t.buttons,this.fader=new _,this.fader.setFade(.1),w.debug&&console.log("titles are fading in"),L.first||this.managers.audio.startTune("game_title_tune"),L.first=!1,w.eventChangeAdOnTitlesShow&&w.arenaHelper.sendEventChange()},L.prototype.startAudio=function(){e.clearCallback("mousedown",this.startAudio),w.debugSpam&&console.log("Titles.startAudio"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(console.log("retry loadAudioAssets from input gesture"),this.preloader.loadAudioAssets()),this.managers.audio.play("snd_click"))},L.prototype.destroy=function(){var e;if(w.fullUIScale=1,w.forceResize=!0,this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},L.prototype.update=function(){var e,t="";if(w.resized&&(this.version.destroy(),this.version=new o(w.VERSION,w.textStyleVersionTiny),this.version.create(w.fullUI,.49,.49,!0),this.version.anchor.set(1),this.version.scale.set(.5/w.fullUI.scale.x)),!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&L.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.version&&this.version.update(),this.fader.reached(1)&&(0!==w.eventChangeAdOnIdle&&(w.idleTimer-=w.elapsedTime,w.idleTimer<0&&(w.arenaHelper.sendEventChange(),w.idleTimer=Number.MAX_VALUE)),("click_start"==t||R.isPressed[32])&&(this.managers.audio.play("snd_click"),_gameGATracker("send","event",w.VERSION,"start_game","BUBB_HTML5",1),w.idleTimer=w.eventChangeAdOnIdle,w.hover=null,w.click=null,R.reset(32),this.fader.setFade(-.05),w.eventChangeAdOnTitlesClose&&w.arenaHelper.sendEventChange(),w.debug&&console.log("Titles: start fading out"))),!0},S.firstLevel=1,S.maxRowsHigh=12,S.width=12,S.height=200,S.bubbleRadius=43,S.bubbleDiameter=2*S.bubbleRadius,S.scrollSpeed=176,S.shotSpeed=2e3,S.shotStep=2,S.trajectoryLength=25,S.mapTop=[-180,5*-S.bubbleDiameter,5*-S.bubbleDiameter],S.gameUILayerTop=-615,S.scrollLineY=[14*-S.bubbleRadius,10*-S.bubbleRadius,10*-S.bubbleRadius],S.goalStrings=["string_level_goal_protect","string_level_goal_crack_egg","string_level_goal_collect"],S.goalFailStrings=["string_level_goal_protect_fail","string_level_goal_crack_egg_fail","string_level_goal_collect_fail"],S.goalIcons=["barrier_objective.png","egg_objective.png","fish_objective.png"],S.barrierOffsetY=2*-S.bubbleDiameter,S.bubbleInvasionY=1.25*-S.bubbleDiameter,S.bubbleInvasionUrgent=2.5*-S.bubbleDiameter,S.bubbleInvasionWarning=3.5*-S.bubbleDiameter,S.killAtBottom=6*S.bubbleDiameter,S.aimAngleLimit=75,S.shooterRadius=1.7*S.bubbleDiameter,S.launcherY=.5,S.shotOffsetY=3.5*S.bubbleDiameter,S.queuePositionX1=2.12*S.bubbleDiameter,S.queuePositionY1=2*S.bubbleDiameter,S.queuePositionScale=.85,S.bubbleRub=10,S.bubbleCollisionRadius=S.bubbleRadius-S.bubbleRub,S.sideBarOffset=S.width/2*S.bubbleDiameter,S.gridOffsetX=(S.width-1)*S.bubbleRadius,S.gridOffsetY=159,S.survivalSpeed=11,S.chainReactionDelay=250,S.pulseScaler=.75,S.pulseDecay=.82,S.fireBallDeceleration=.83,S.bonusShootDelay=100,S.bonusShootSpeed=20,S.popBoost=1,S.catchUpBoost=2,S.dropBubbleBoost=10,S.boostImageOffsetX=-2.17*S.bubbleDiameter,S.boostImageOffsetY=2.6*-S.bubbleDiameter,S.scoreFirstPop=100,S.scoreMultiplyPop=10,S.scoreFirstDrop=20,S.scoreSpecialBadDrop=10,S.scoreSpecialGoodDrop=30,S.scoreNormalBonus=250,S.scoreSpecialBonus=500,S.scoreCatchUp=5,S.frameCount=0,S.paused=!1,S.lossCounter=0,S.boostFullBar=100,S.boostGainCost=20,S.boostCharge=0,S.boostCanCharge=!0,S.boostType=-1,S.requestQuit=!1,S.score=0,S.highScore=0,w.debug&&console.log("Game() instanciation resetting shotsLeft"),S.shotsLeft=0,S.options=null,S.levelType=0,S.popCount=0,S.LEVEL_SELECT=0,S.LEVEL_START=1,S.LEVEL_INTRO=2,S.PLAYING=3,S.WON_LEVEL=4,S.LOST_LEVEL=5,S.FINAL_MESSAGE=6,S.NEXT_LEVEL=7,S.GAME_WON=8,S.WAIT_DELAY=9,S.REMOVE_MSG_QUIT=10,S.QUIT_REQUEST=11,LevelType={},LevelType.ConvertNames=null,LevelType.GOAL_PROTECT_BARRIER=0,LevelType.GOAL_BREAK_EGG=1,LevelType.GOAL_RESCUE_FISH=2,S.prototype.create=function(e,t){this.managers=e,this.numLevels=t,w.bubbleLayer.alpha=.01,S.paused=!1,S.requestQuit=!1,S.score=0,w.debug&&console.log("Game.create resetting shotsLeft"),S.shotsLeft=w.challengeMode?w.totalShots:0,this.level=S.firstLevel-1,this.help=null,this.menu=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=w.showLevelSelect?S.LEVEL_SELECT:S.LEVEL_START,this.nextState=-1,this.delay=0,this.foodCount=0,this.foodTotal=0,this.droppedLastFish=!1,w.arenaHelper.addPauseAndResumeActions(S.pauseGame.bind(this),S.resumeGame.bind(this)),_gameGATracker("send","pageview",{page:"/GameScene"})},S.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.menu&&(this.menu.destroy(),this.menu=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),S.options&&(S.options.destroy(),S.options=null),this.managers=null},S.prototype.update=function(){function e(){s.menu=null,s.state=S.LEVEL_START}var t=!0,s=this;if(S.frameCount++,this.confirm){if(this.confirm.update())return t;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return t;this.help.remove(function(){s.help=null})}if(S.paused&&S.options)return S.options.update()?t:(S.options.remove(S.optionsDestroyed),t);S.requestQuit&&(S.requestQuit=!1,this.state=S.QUIT_REQUEST),w.bubbleLayer.alpha<1&&(w.bubbleLayer.alpha=Math.min(w.bubbleLayer.alpha+.05,1),w.backgroundLayer.alpha=w.gameUILayer.alpha=w.bubbleLayer.alpha);var i,a;do switch(a=this.lastState!=this.state,this.lastState=this.state,i=!1,this.state){case S.LEVEL_SELECT:a&&(this.menu=new LevelSelect,this.menu.create(this,this.managers)),this.menu.update()||this.menu.remove(e);break;case S.LEVEL_START:if(a||this.world&&!this.world.game){a||console.log("WARNING: emergency procedures initiated!  Chrome has done something weird again..."),this.managers.audio.startTune("game_tune",!1),_gameGATracker("send","event",w.VERSION,"start_level_"+(this.level+1),"BUBB_HTML5",0),S.boostCharge=0,S.boostCanCharge=!0,this.world=new I(this),this.world.create(this.managers,this.level),w.bubbleLayer.alpha=.01;var n=S.lossCounter>=3?Math.floor(S.lossCounter/3):0;S.boostFullBar=Math.max(S.boostFullCost-10*n,S.boostFullCost/2)}this.world.update(),this.world.levelShown()&&(this.state=S.LEVEL_INTRO);
break;case S.LEVEL_INTRO:if(a){this.foodTotal=this.foodCount,this.droppedLastFish=!1;var o=S.goalIcons[S.levelType];this.bm=new r,this.bm.createObjective(w.fullUI,this.managers,S.goalStrings[S.levelType],"string_level_goal_title",o),this.bm.timeOut=3e3}this.bm?((w.click||R.isPressed[32])&&(w.click=null,R.reset(),this.bm.remove(this,"bm")),this.bm.update()||(this.bm.destroy(),this.bm=null)):this.state=S.PLAYING;break;case S.PLAYING:a&&(w.idleTimer=w.eventChangeAdOnIdle),this.world.update()?0!==w.eventChangeAdOnIdle&&(w.idleTimer-=w.elapsedTime,w.idleTimer<0&&(w.arenaHelper.sendEventChange(),w.idleTimer=Number.MAX_VALUE)):(this.world.shooter.hideTrajectory(),this.world.levelBeaten()?(w.debug&&console.log("level won"),_gameGATracker("send","pageview",{page:"/LevelCompletePopup"}),this.state=S.WON_LEVEL):(w.debug&&console.log("level lost"),this.state=S.LOST_LEVEL));break;case S.WON_LEVEL:if(a){w.debug&&console.log("level won"),this.managers.audio.startTune("game_win_tune",!0),S.lossCounter=0,_gameGATracker("send","event",w.VERSION,"win_level_"+(this.level+1),"BUBB_HTML5",S.score);var l=(this.level+1).toString()+" / "+this.numLevels.toString(),h=null;w.challengeMode&&this.level<this.numLevels-1&&(h=this.managers.locale.get("string_level_complete_carried1")+" "+S.shotsLeft.toString()+" "+this.managers.locale.get("string_level_complete_carried2")),this.bm=new r,this.bm.createLevelWon(w.fullUI,this.managers,this.managers.locale.get("string_level_complete"),l,h),this.bm.timeOut=3800}this.world&&this.world.updateScore(),this.bm.update()||(S.shotsLeft>0||this.world.endSequence?this.state=S.NEXT_LEVEL:(w.debug&&console.log("level lost (no shots left)"),this.state=S.LOST_LEVEL));break;case S.NEXT_LEVEL:if(this.level++,this.level>this.numLevels-1){this.state=S.GAME_WON,i=!0;break}this.world.destroy(),this.state=S.LEVEL_START,i=!0;break;case S.LOST_LEVEL:a&&(this.managers.audio.startTune("game_over_tune",!0),S.lossCounter++,S.score>S.highScore&&(S.highScore=S.score),this.bm=new r,this.bm.createWinLose(w.fullUI,this.managers,"string_lose",S.goalFailStrings[S.levelType],!1),this.state=S.FINAL_MESSAGE);break;case S.GAME_WON:_gameGATracker("send","event",w.VERSION,"win_game_timer","BUBB_HTML5",0),S.score>S.highScore&&(S.highScore=S.score),this.bm=new r,this.bm.createWinLose(w.fullUI,this.managers,"string_win",null,!0),this.state=S.FINAL_MESSAGE;break;case S.QUIT_REQUEST:if(a){_gameGATracker("send","event",w.VERSION,"quit_game_timer","BUBB_HTML5",Math.round((w.nowTime-w.timeStarted)/1e3)),_gameGATracker("send","event",w.VERSION,"submit_score","BUBB_HTML5",S.score),this.level==this.numLevels-1,0===S.score&&_gameGATracker("send","event",w.VERSION,"abandon","BUBB_HTML5",1),S.score>S.highScore&&(S.highScore=S.score),this.bm=new r;var u=this.managers.locale.get("game_quit_title")+"\n\n"+this.managers.locale.get("string_score")+" "+G.formatBigNumber(S.score)+"\n"+this.managers.locale.get("string_high_score")+" "+G.formatBigNumber(S.highScore)+"\n";this.bm.create(w.fullUI,this.managers,u),this.state=S.FINAL_MESSAGE}break;case S.FINAL_MESSAGE:if(a){{Math.min(this.level+1,this.numLevels)}this.bm.timeOut=5e3,_gameGATracker("send","pageview",{page:"/GameOverPopup"})}this.world&&this.world.updateScore(),this.bm.update()||(this.bm.destroy(),this.bm=null,_gameGATracker("send","event",w.VERSION,"submit_score","BUBB_HTML5",S.score),w.arenaHelper.sendGameEnd(S.highScore),this.delay=4e3,this.state=S.WAIT_DELAY,this.nextState=S.REMOVE_MSG_QUIT);break;case S.WAIT_DELAY:this.delay=Math.max(this.delay-w.elapsedTime,0),0===this.delay?(this.state=this.nextState,i=!0):this.bm&&this.bm.update();break;case S.REMOVE_MSG_QUIT:a&&this.bm&&this.bm.remove(this,"bm"),this.bm?this.bm.update()||(this.bm=null):(this.world.destroy(),t=!1)}while(i);return t},S.prototype.showHelp=function(){this.help=new g(this.world.levelData),this.help.create(this.managers)},S.prototype.showConfirm=function(e,t,s,i){this.confirm=new u,this.confirm.create(this,this.managers,e,t,s,i)},S.prototype.pauseToggle=function(){S.paused=!S.paused,w.debug&&console.log(S.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),S.paused?(S.options=new p,S.options.create(this,this.managers),_gameGATracker("send","event",w.VERSION,"help","BUBB_HTML5",1)):S.options&&(S.options.destroy(),S.options=null)},S.pauseGame=function(){w.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),S.paused=!0,_gameGATracker("send","pageview",{page:"/PausePopup"})},S.resumeGame=function(){w.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),S.paused=null!==S.options,_gameGATracker("send","pageview",{page:"/GameScene"})},S.optionsDestroyed=function(){S.options=null,S.paused=!1},I.brighter=null,I.brighter2=null,I.effects=null,I.prototype.create=function(e,t){w.debug&&console.log("World.create "+t),this.managers=e,this.level=t,w.swipeEnabled=!1,w.mouseMoveLocal=null,w.mouseUpLocal=null,w.mouseDown=null,w.mouseUp=null,w.click=null,R.reset(),this.uiBits=null,this.star1=this.star2=this.star3=null,I.SelectionPreviewY=.23,I.SelectionPreviewBotY=.24,I.brighter=new PIXI.filters.ColorMatrixFilter,I.brighter.brightness(1.5,!0),I.brighter2=new PIXI.filters.ColorMatrixFilter,I.brighter2.brightness(1.2,!0);var s=this.managers.data.get("levels").levels;if(S.levelType=LevelType.ConvertNames[s[this.level%s.length]._id],this.levelData=s[this.level%s.length],!w.challengeMode){switch(S.shotsLeft=0,S.levelType){case LevelType.GOAL_PROTECT_BARRIER:break;case LevelType.GOAL_BREAK_EGG:S.shotsLeft=this.levelData.turns;break;case LevelType.GOAL_RESCUE_FISH:S.shotsLeft=this.levelData.turns}w.debug&&console.log("World.create resetting shotsLeft = "+S.shotsLeft)}this.playField=new B(this.game),this.playField.create(this,this.managers,this.level,this.levelData),this.gridCollide=this.playField.getGridCollide(),this._createUI(),this.shooter=new E(this.game),this.shooter.create(this,this.managers,this.playField,this.levelData,this.gridCollide),I.effects=new v(this.game),I.effects.create(this,this.managers,this.playField,this.gridCollide),w.resized=!0,w.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.bm=null,this.endSequence=!1,this.shootBubblesAfter=void 0},I.prototype.destroy=function(){this.managers=null;var e,t;if(this.uiBits){for(e=0,t=this.uiBits.length;t>e;e++){var s=this.uiBits[e];s.destroy()}this.uiBits=null}this.boostIcon=null,this.fishIcon=null,this.fishWidget=null,this.scoreText=null,this.shotsText=null,this.fishText=null,this.usePlayerInput&&(this.usePlayerInput.destroy(),this.usePlayerInput=null),I.effects&&(I.effects.destroy(),I.effects=null),this.playField&&(this.playField.destroy(),this.playField=null),this.shooter&&(this.shooter.destroy(),this.shooter=null),I.brighter=null,I.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.star1=this.star2=this.star3=null,this.ignoreClick=null,this.game=null},I.prototype.update=function(){if(w.resized&&this._createUI(),this._levelTypeUpdate(),this._background(),this._movesUpdate(),this._userInterface(),this._userInput(),I.effects.update(),this.endSequence||(this.playField&&this.playField.update(),this.shooter&&this.shooter.update()),this.endSequence)return this.levelEndSequence();if(this.levelEnded()&&(this.endSequence=!0),w.testKeys){if(R.edgeDown[U.key_x])return console.log("cheat key x used"),R.edgeDown[U.key_x]=!1,this.playField.clearAll(),!0;if(R.edgeDown[U.key_l])return console.log("cheat key l used"),R.edgeDown[U.key_l]=!1,!1}return!0},I.prototype.levelShown=function(){return!this.playField.introScroll},I.prototype.levelEndSequence=function(){if(void 0===this.shootBubblesAfter)return this.playField.won()?this.game.level>=this.game.numLevels-1?(this.shootBubblesAfter=w.nowTime+1e3,!0):!1:this.playField.lost()||0===S.shotsLeft?!1:!0;if(w.challengeMode&&this.game.level>=this.game.numLevels-1){if(w.nowTime>this.shootBubblesAfter){this.shooter.hideTrajectory(),this.shooter.shootRemaining(),this.shootBubblesAfter=w.nowTime+200;var e=S.shotsLeft.toString();this.shotsText.text!=e&&(this.shotsText.text=e)}return S.shotsLeft>0||I.effects.count()>0}return!0},I.prototype.levelEnded=function(){if(this.playField.effectContinues()||I.effects.count()>0)return(this.playField.lost()||this.playField.won())&&this.shooter.endLevel(),!1;if(this.playField.lost())return!0;if(this.playField.won())return!0;if(this.shooter.state==E.OUTOFAMMO)switch(S.levelType){case LevelType.GOAL_PROTECT_BARRIER:if(w.challengeMode&&S.shotsLeft<=0)return!0;break;case LevelType.GOAL_BREAK_EGG:if(S.shotsLeft<=0)return!0;break;case LevelType.GOAL_RESCUE_FISH:if(S.shotsLeft<=0)return!0}return!1},I.prototype.levelBeaten=function(){return this.playField?this.playField.lost()?!1:this.playField.won():!0},I.prototype.updateScore=function(){if(S.score=Math.floor(S.score),S.score>this.scoreText._visibleScore){var e=S.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e,this.scoreText.text=G.formatBigNumber(this.scoreText._visibleScore)}},I.prototype._createUI=function(){if(w.debug&&console.log("World._createUI "+(w.isPortrait?"portrait":"landscape")+" "+(w.challengeMode?"challenge":"saga")),this.uiBits)for(var e=0,t=this.uiBits.length;t>e;e++)this.uiBits[e].destroy();this.uiBits=[],w.isPortrait?this._portraitLayout():this._landscapeLayout(),this.launcherMeter=new n,this.launcherMeter.create(w.backgroundLayer,F.LAUNCHER_METER.type,this.managers.textures,0,S.launcherY,!0),this.launcherMeter.anchor.set(.5,1),this.launcherMeter.scale.set(1),this.uiBits.push(this.launcherMeter),this.launcherBeam=new n,this.launcherBeam.create(w.backgroundLayer,"beam.png",this.managers.textures,0,S.launcherY,!0,!0),this.launcherBeam.anchor.set(.5,1),this.launcherBeam.scale.set(1),this.launcherBeam.alpha=.1,this.uiBits.push(this.launcherBeam),this.launcherRing=new n,this.launcherRing.create(w.backgroundLayer,"indicator.png",this.managers.textures,0,S.launcherY,!0),this.launcherRing.anchor.set(.5,1),this.launcherRing.scale.set(1),this.launcherRing.alpha=.1,this.uiBits.push(this.launcherRing),this.launcherButton=new n,this.launcherButton.create(w.backgroundLayer,"button_swap.png",this.managers.textures,0,S.launcherY,!0),this.launcherButton.anchor.set(.5,1),this.launcherButton.scale.set(1),this.uiBits.push(this.launcherButton),this.launcherBar=new n,this.launcherBar.create(this.launcherMeter,"meterFull.png",this.managers.textures,0,0,!0),this.launcherBar.anchor.set(.5,1),this.launcherBar.scale.set(1/this.launcherMeter.scale.x,1/this.launcherMeter.scale.y),this.uiBits.push(this.launcherBar),this.launcherMask=new PIXI.Graphics,this.launcherMask.x=-50,this.launcherMask.y=-150,this.launcherMask.rotation=2.1,this.launcherMask.beginFill(16711680,.3),this.launcherMask.drawRect(0,-220,-300,450),this.launcherMask.endFill(),this.uiBits.push(this.launcherMask),this.launcherBar.addChild(this.launcherMask),this.launcherBar.mask=this.launcherMask;var s=new o("",w.textStyleUIScoreAndShots);s.create(this.launcherMeter,0,-.44,!0),s.anchor.set(.5),s.scale.set(1),this.shotsText=s,this.uiBits.push(s);var i=new n;i.create(this.launcherMeter,S.boostType,this.managers.textures,S.boostImageOffsetX,S.boostImageOffsetY,!1),i.setAnimation("boost"),i.anchor.set(.5),i.scale.set(S.queuePositionScale),this.boostIcon=i,this.playField.introScroll&&(this.boostIcon.visible=!1),this.uiBits.push(i)},I.prototype._portraitLayout=function(){var e,t,s,i=w.width/640*.5;e=new d(d.TYPE_NOLATCH),e.create(w.bottomUI,"button_settings.png",this.managers,.45,-.01,!0,"button_settings.png","button_settings.png","button_settings.png","click_pause_event"),e.anchor.set(.5,1),e.scale.set(i/w.bottomUI.scale.x,i/w.bottomUI.scale.y),e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.uiBits.push(e),t=new n,t.create(w.topUI,"hud_backing.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y);var a=t;this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_lvl.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),w.challengeMode||(t=new n,t.create(w.topUI,"hud_meterEmpty.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_meterFull.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star01grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star02grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star03grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star01.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star1=t,t=new n,t.create(w.topUI,"hud_star02.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star2=t,t=new n,t.create(w.topUI,"hud_star03.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star3=t),s=new o(G.padToLength((this.game.level+1).toString(),3,"0"),w.textStyleUILevelNumber),s.create(a,.02,.45,!0),s.anchor.set(0,1),this.uiBits.push(s),s=new o(G.formatBigNumber(S.score),w.textStyleUIScoreAndShots),w.challengeMode?s.create(a,.22,.3,!0):s.create(a,.22,.01,!0),s.anchor.set(0,1),this.scoreText=s,this.scoreText._visibleScore=S.score,this.uiBits.push(s),S.levelType==LevelType.GOAL_RESCUE_FISH&&(t=new n,t.create(w.bottomUI,"goal_backing.png",this.managers.textures,-.49,-.01,!0),t.anchor.set(0,1),t.scale.set(1*i/w.bottomUI.scale.x,1*i/w.bottomUI.scale.y),t.visible=!1,this.fishWidget=t,this.uiBits.push(t),t=new n,t.create(this.fishWidget,"goal_fishIcon.png",this.managers.textures,.44,-.5,!0),t.anchor.set(.5),t.scale.set(1),this.fishIcon=t,this.uiBits.push(t),s=new o("",w.textStyleUIScoreAndShots),s.create(this.fishWidget,-.05+.53,-.45,!0),s.anchor.set(0,.5),s.scale.set(.8),this.fishText=s,this.uiBits.push(s))},I.prototype._landscapeLayout=function(){var e,t,s,i=w.height/640*.48,a=.9;e=new d(d.TYPE_NOLATCH),e.create(w.topUI,"button_settings.png",this.managers,-.185,.94,!0,"button_settings.png","button_settings.png","button_settings.png","click_pause_event"),e.anchor.set(.5),e.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.uiBits.push(e),t=new n,t.create(w.topUI,"hud_backing.png",this.managers.textures,-.488,.055,!0),t.anchor.set(0,.5),t.scale.set(a*i/w.topUI.scale.x,a*i/w.topUI.scale.y);var r=t;this.uiBits.push(t),t=new n,t.create(r,"hud_lvl.png",this.managers.textures,0,.01,!0),t.anchor.set(0,.5),this.uiBits.push(t),w.challengeMode||(t=new n,t.create(w.topUI,"hud_meterEmpty.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_meterFull.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star01grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star02grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star03grey.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),t=new n,t.create(w.topUI,"hud_star01.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star1=t,t=new n,t.create(w.topUI,"hud_star02.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star2=t,t=new n,t.create(w.topUI,"hud_star03.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/w.topUI.scale.x,i/w.topUI.scale.y),this.uiBits.push(t),this.star3=t),s=new o(G.padToLength((this.game.level+1).toString(),3,"0"),w.textStyleUILevelNumber),s.create(r,.02,.45,!0),s.anchor.set(0,1),this.uiBits.push(s),s=new o(G.formatBigNumber(S.score),w.textStyleUIScoreAndShots),w.challengeMode?s.create(r,.22,.3,!0):s.create(r,.22,.01,!0),s.anchor.set(0,1),this.scoreText=s,this.scoreText._visibleScore=S.score,this.uiBits.push(s),S.levelType==LevelType.GOAL_RESCUE_FISH&&(t=new n,t.create(w.bottomUI,"goal_backing.png",this.managers.textures,-.49,-.01,!0),t.anchor.set(0,1),t.scale.set(1*i/w.bottomUI.scale.x,1*i/w.bottomUI.scale.y),t.visible=!1,this.fishWidget=t,this.uiBits.push(t),t=new n,t.create(this.fishWidget,"goal_fishIcon.png",this.managers.textures,.44,-.5,!0),t.anchor.set(.5),t.scale.set(1),this.fishIcon=t,this.uiBits.push(t),s=new o("",w.textStyleUIScoreAndShots),s.create(this.fishWidget,-.05+.53,-.45,!0),s.anchor.set(0,.5),s.scale.set(.8),this.fishText=s,this.uiBits.push(s))},I.prototype.showBoost=function(e){this.boostIcon&&this.boostIcon.parent&&(void 0!==e&&(this.boostIcon.visible=e),this.boostIcon.x=S.boostImageOffsetX,this.boostIcon.y=S.boostImageOffsetY)},I.prototype._movesUpdate=function(){var e=S.shotsLeft.toString();this.shotsText.text!=e&&(this.shotsText.text=e),this.game.foodTotal>=this.game.foodCount&&(e=(this.game.foodTotal-this.game.foodCount).toString()+"/"+this.game.foodTotal.toString(),this.fishText&&this.fishText.text!=e&&(this.fishWidget.visible=!0,this.fishText.text=e)),S.shotsLeft<4&&w.nowTime%1e3<500?16711680!=this.shotsText.tint&&(this.shotsText.tint=16711680):16777215!=this.shotsText.tint&&(this.shotsText.tint=16777215)},I.prototype._levelTypeUpdate=function(){if(!this.playField||!this.playField.introScroll)switch(S.levelType){case LevelType.GOAL_PROTECT_BARRIER:this.playField&&(this.playField.scrollBackAllowed=!1,this.playField.scrollDownAllowed=!1,this.playField.isFairyFlying()||this.playField.autoScroll(S.survivalSpeed*w.elapsedTime/1e3));break;case LevelType.GOAL_BREAK_EGG:break;case LevelType.GOAL_RESCUE_FISH:}},I.prototype._background=function(){},I.prototype._awardBoost=function(){this.managers.audio.play("snd_booster_award");var e;S.boostType==F.DRAGON_BLUE.type?(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=w.gameUILayer.toLocal(e),I.effects.add(v.DRAGON_BLUE,w.gameUILayer,e.x,e.y,this.playField.fairyBoostFly,this.playField)):S.boostType==F.PLUS5.type?(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=w.gameUILayer.toLocal(e),fx=I.effects.add(v.BOOST_BONUS5,w.gameUILayer,e.x,e.y,this.playField.bonus5BoostFly,this.playField)):(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=w.gameUILayer.toLocal(e),this.shooter.addBoostToQueue(S.boostType,e),this.showBoost(!1))},I.prototype._userInterface=function(){R.update();var e=S.boostCharge/S.boostFullBar*2.9+2.1;this.launcherMask.rotation=(7*this.launcherMask.rotation+e)/8,this.launcherBeam.alpha=Math.max(Math.abs(S.frameCount%200-100)/100,.5),this.launcherMeter&&this.launcherMeter.update(),S.boostCharge>=S.boostFullBar&&S.boostCanCharge&&(S.boostCanCharge=!1,S.boostFullBar+=S.boostGainCost,S.boostCharge=S.boostFullBar,this._awardBoost()),w.testKeys&&R.edgeDown[U.key_b]&&(console.log("cheat key b used"),R.edgeDown[U.key_b]=!1,this._awardBoost());var t,s;for(t=0,l=this.uiBits.length;t<l;t++){var i=this.uiBits[t];i instanceof d?(null===s||void 0===s)&&(s=i.update()):i instanceof PIXI.Graphics||i.update()}switch(s){case"click_pause_event":this.game.pauseToggle()}this.updateScore()},I.prototype._userInput=function(){this.bm||(w.testKeys&&R.edgeDown[U.key_c]&&(R.edgeDown[U.key_c]=!1,w.showLockedCursor=!w.showLockedCursor),w.testKeys&&(R.isPressed[U.key_v]||w.mouseDown&&w.mouseDown.x<30&&w.mouseDown.y<30)&&e.debugWindowData())},I.prototype.getLevelBonus=function(){return this.playField.levelBonusValues?this.playField.levelBonusValues[this.game.level]:0},I.prototype.GetTurnCountLocation=function(){var e=this.shotsText.toGlobal({x:0,y:0}),t=w.gameUILayer.toLocal(e);return{x:t.x,y:t.y}},I.prototype.getLauncherLocation=function(e){var t=new PIXI.Point(0,0);t=this.launcherMeter.toGlobal(t);var s=e.toLocal(t);return s.y-=S.shotOffsetY,s},I.prototype.launcherRingReset=function(){this.launcherRing.scale.set(1),this.launcherRing.alpha=0},I.prototype.updateLauncherEffect=function(e){if(this.launcherBeam&&this.launcherRing)if(500>e){var t=e/500;this.launcherBeam.alpha=.5+.5*t,this.launcherRing.alpha=.25+.5*t,this.launcherRing.scale.set(1.015*this.launcherRing.scale.x)}else this.launcherRing.scale.set(1.01*this.launcherRing.scale.x),this.launcherRing.alpha>0&&(this.launcherRing.alpha-=.05),this.launcherBeam.alpha>0&&(this.launcherBeam.alpha-=.05)},k.prototype.create=function(e,t,s,i){var a={x:s,y:i},o=this.gridCollide.gridToBubble(a),r=this.getFromGrid(a);w.debug&&0!==r&&null!==r&&console.log("WARNING: bubble created in invalid grid location! "+r),this.type=t,this.under_type=F.UNDEFINED.type,this.overlay=null,this.vx=0,this.vy=0,this.mx=0,this.my=0,this.sprite=new n,this.sprite.create(e,this.type,this.managers.textures,o.x,o.y,!1),this.sprite.anchor.set(.5),this.addToGrid(a),w.debugSpam&&console.log("Bubble.create "+this.sprite.key+" "+t+" "+s+","+i+" "+o.x+","+o.y)},k.prototype.destroy=function(){w.debugSpam&&console.log(this.sprite?"Bubble.destroy at "+this.sprite.x+","+this.sprite.y:"Bubble.destroy WARNING no sprite"),this.gridCollide&&(this.gridCollide.removeBubble(this),this.gridCollide=null),this.overlay&&(this.overlay.destroy(),this.overlay=null),this.sprite&&(this.sprite.dragging&&(this.sprite.dragging.destroy(),this.sprite.dragging=null),this.sprite.destroy(),this.sprite=null),this.updateCallback=null,this.under_type=F.UNDEFINED.type,this.grid=null,this.parent=null,this.managers=null,this.game=null,this.playField=null},k.prototype.update=function(){return 0!==this.wobbleTime&&(this.wobbleTime>w.nowTime?(this.sprite.x=this.wx+Math.random()*this.wobblex*2-this.wobblex,this.sprite.y=this.wy+Math.random()*this.wobbley*2-this.wobbley):(this.sprite.x=this.wx,this.sprite.y=this.wy,this.wobbleTime=0)),this.updateCallback&&this.updateCallback(this),this.sprite.update(),!0},k.prototype.getFromGrid=function(e){return e&&e.y>=0&&e.y<this.grid.length&&e.x>=0&&e.x<this.grid[e.y].length?this.grid[e.y][e.x]:null},k.prototype.addToGrid=function(e){e&&e.y>=0&&e.y<this.grid.length&&e.x>=0&&e.x<this.grid[e.y].length&&(this.grid[e.y][e.x]=this)},k.prototype.matchCheck=function(e){return this.type==e?!0:this.type==F.ICE.type?this.under_type==e:e==F.RAINBOW.type||this.type==F.RAINBOW.type?!0:!1},k.prototype.addOverlay=function(e){w.debug&&console.log("Bubble.addOverlay "+e+" on "+this.sprite.key);var t=new n;return t.create(this.sprite,e,this.managers.textures,0,0,!1),t.anchor.set(.5),this.overlay=t,t},k.prototype.pop=function(e){if(null===this.game)return void(w.debug&&console.log("WARNING: bubble already destroyed!"));if(this.type==F.EGG.type)return void(w.debug&&console.log("Bubble.pop will not pop the egg, it cracks and destroys itself"));w.debugSpam&&console.log("Bubble.pop at "+e.x+","+e.y),S.boostCanCharge&&(S.boostCharge+=S.popBoost),(e.y<0||e.x<0||e.x>=this.grid[e.y].length||-1==this.grid[e.y][e.x])&&alert("snafu!"),this.grid[e.y][e.x]=0,this.overlay&&this.releaseOverlay(!1);var t=this.gridCollide.bubbleToGameUi(this.sprite);this.type!=F.BOMB.type&&I.effects.add(v.POP_BUBBLE,w.gameUILayer,t.x,t.y);var s=S.scoreFirstPop+S.popCount*S.scoreMultiplyPop;S.popCount++,S.score+=s;var i=new h;i.create(t.x,t.y,w.textStyleBoldSmall,w.gameUILayer,this.managers,s.toString()),this.destroy()},k.prototype.changeType=function(e){return this.under_type=this.type,this.type=e,this.sprite.setType(this.type),this},k.prototype.isNormal=function(e){return k.isNormal(this.type,e)},k.isNormal=function(e,t){return F[e].normal?"RAINBOW"==e||e==F.RAINBOW.type&&t===!1?!1:!0:!1},k.isNormalKey=function(e,t){F.UNDEFINED.type;for(var s in F){var i=F[s];if(i.animations&&i.animations["default"]&&i.animations["default"][0]==e&&i.normal)return i.type==F.RAINBOW.type&&t===!1?!1:!0}return!1},k.prototype.releaseOverlay=function(e){w.debug&&console.log("Bubble.releaseOverlay "+this.overlay.key+" on "+this.sprite.key);var t,s=!0,i=this.gridCollide.bubbleToGameUi(this.sprite);switch(i.x+=this.overlay.x,i.y+=this.overlay.y,this.overlay.type){case F.FISH.type:t=I.effects.add(v.DROP_FISH,w.gameUILayer,i.x,i.y,v.bubbleFall),t.vr=.25*Math.random()-.125,1==this.game.foodCount&&(this.game.droppedLastFish=!0);break;case F.DRAGON_ORANGE.type:e||"default"!=this.overlay.animation||(t=I.effects.add(v.DRAGON_ORANGE,w.gameUILayer,i.x,i.y,this.orangeDragonLogic,this),t.playField=this.playField,s=!1);break;case F.DRAGON_PURPLE.type:e&&!this.playField.hitGong?"default"==this.overlay.animation&&(t=I.effects.add(v.DRAGON_PURPLE,w.gameUILayer,i.x,i.y,this.purpleDragonLogic,this),t.playField=this.playField,t.gridCollide=this.gridCollide,t.game=this.game,t.managers=this.managers,t.dragging&&t.dragging.setType(this.type),s=!1):(t=I.effects.add(v.DRAGON_PURPLE_LEAVE,w.gameUILayer,i.x,i.y,this.purpleDragonLeave,this),t.vx=200+50*Math.random(),t.vy=-75-50*Math.random())}return this.overlay.destroy(),this.overlay=null,s},k.prototype.wobble=function(e,t,s){this.wobbleTime=w.nowTime+1e3*e,this.wobblex=t,this.wobbley=s,this.wx=this.sprite.x,this.wy=this.sprite.y},k.prototype.purpleDragonLogic=function(e){var t,s,i,a,n;switch(e.animation){case"gliding":break;case"flying":if(e.alpha<1){if(e.alpha-=w.elapsedTime/1e3,e.alpha<=0)return!1;break}if(e.dragging&&(e.gridCollide.get(e.dest)||!e.playField.adjacentFilled(e.dest))){if(t=e.playField.pickVisibleSpace(),!t){e.alpha-=w.elapsedTime/1e3;break}e.alpha=1,e.dest=t}if(target=e.gridCollide.gridToGameUi(e.dest),s=target.x-e.x,i=target.y-e.y-S.bubbleRadius,a=s*s+i*i,n=Math.sqrt(a),e.vx+=22*s/n,e.vy+=15*i/n,e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3,e.y>w.height/3*2&&(e.vy=Math.min(e.vy,-30),e.dest=e.playField.pickVisibleSpace(),null===e.dest&&(e.alpha-=w.elapsedTime/1e3)),e.dragging&&(e.dragging.x=e.x,e.dragging.y=e.y+S.bubbleRadius),e.vx*=.94,e.vy*=.94,n<S.bubbleRadius&&(!e.dragging||Math.abs(e.vx)+1.6*Math.abs(e.vy)<24)){if(e.dragging&&e.y<w.height/3*2){var o=new k(e.game,e.managers,e.playField,e.gridCollide);o.create(w.bubbleLayer,e.dragging.type,e.dest.x,e.dest.y),o.addOverlay(F.DRAGON_PURPLE.type)}return!1}}return!0},k.prototype.purpleDragonLeave=function(e){return e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3,e.vx+=10,e.vy*=.995,Math.abs(e.x)>S.gridOffsetX&&(e.alpha-=.05,e.alpha<=0)?!1:!0},k.prototype.orangeDragonLogic=function(e){switch(e.animation){case"flying":v.swoopToGridTarget(e,e.playField,{x:-80,y:4})||(e.setAnimation("shooting"),e.shootingFlag=!1,e.noRepeat=!0,e.repeat=!1);break;case"shooting":if(7==e.frameIndex&&!e.shootingFlag){var t=I.effects.add(v.DRAGON_FLAME_JET,e.parent,e.x,e.y,this.orangeFlameLogic,this);e.shootingFlag=!0,t.target=e.target,t.dest=e.dest,t.playField=e.playField}}return!0},k.prototype.orangeFlameLogic=function(e){return e.target&&e.atEnd?(e.target&&e.target.sprite&&(e.playField.matchAt(e.dest,e.target,2),e.target.pop(e.dest),e.target=null,e.playField.looseFall()),!1):!0},B.prototype.create=function(e,t,s,i){this.world=e,this.managers=t,this.level=s,this.levelData=i,this.resizeChargeBlocker=0,this.scrollY=-1,this.introScroll=!0,this.scrollBackAllowed=!0,this.scrollDownBonus=!1,w.bubbleLayer.y=Math.floor(this.scrollY*w.bubbleLayer.scale.y),S.boostType=F[this.levelData.boost.id].type,S.boostFullCost=1*this.levelData.boost.cost,S.boostGainCost=1*this.levelData.boost.gain,this.bg=new n,this.bg.create(w.bgImage,this.levelData.BackgroundImage,this.managers.textures),this.bg.anchor.set(.5),this.uiPanel=new n,this.uiPanel.create(w.backgroundLayer,"blanker",this.managers.textures,-S.sideBarOffset,0,!1),this.uiPanel.scale.set(5,8),this.uiPanel.anchor.set(1,.5),this.uiPanel.alpha=.75,this.rightBlanker=new n,this.rightBlanker.create(w.backgroundLayer,"blanker",this.managers.textures,S.sideBarOffset,0,!1),this.rightBlanker.scale.set(4,8),this.rightBlanker.anchor.set(0,.5),this.rightBlanker.alpha=.75,this.hitGong=!1,this.lowestBubbleY=0,this.explosionList=[],this.createGrid(S.width,S.height),this.populateLevel(this.levelData);var a=this.gridCollide.gridToBubble({x:0,y:-.4});this.topBar=new n,this.topBar.create(w.bubbleLayer,F.CEILING_BEAM.type,this.managers.textures,0,a.y,!1),this.topBar.anchor.set(.5,1),this.topBar.scale.set(w.backgroundLayer.bubbleAreaWidth/(1920*w.bubbleLayer.scale.x)),S.levelType==LevelType.GOAL_PROTECT_BARRIER&&(this.scrollDownBonus=!0,this.barrier=new n,this.barrier.create(w.backgroundLayer,"barrier.png",this.managers.textures,0,0,!1),this.barrier.anchor.set(.5,0),this.barrier.scale.set(w.backgroundLayer.bubbleAreaWidth/(1520*w.backgroundLayer.scale.x)),this.barrier.alpha=0,this.barrierHighlight=new n,this.barrierHighlight.create(w.backgroundLayer,"barrier_red.png",this.managers.textures,0,0,!1),this.barrierHighlight.anchor.set(.5,0),this.barrierHighlight.scale.set(w.backgroundLayer.bubbleAreaWidth/(1520*w.backgroundLayer.scale.x)),this.barrierHighlight.visible=!1)},B.prototype.destroy=function(){this.gridCollide.destroy(),this.gridCollide=null,this.bg&&(this.bg.destroy(),this.bg=null),this.uiPanel&&(this.uiPanel.destroy(),this.uiPanel=null),this.rightBlanker&&(this.rightBlanker.destroy(),this.rightBlanker=null),this.topBar&&(this.topBar.destroy(),this.topBar=null),this.barrier&&(this.barrier.destroy(),this.barrier=null),this.barrierHighlight&&(this.barrierHighlight.destroy(),this.barrierHighlight=null),this.clearAll(),this.grid=null,this.game=null,this.world=null,this.managers=null},B.prototype.clearAll=function(){if(this.game.foodCount=0,this.hitGong=!0,this.grid)for(var e=0;e<this.grid.length;e++)for(var t=0;t<this.grid[e].length;t++)this.grid[e][t]&&-1!=this.grid[e][t]&&(this.grid[e][t].destroy(),this.grid[e][t]=null)};B.prototype.update=function(){var e=this.world.getLauncherLocation(w.gameUILayer);w.resized&&(this.adjustScroll(),this.resizeChargeBlocker=S.frameCount,this.setBarrierPosition());var t=Number.POSITIVE_INFINITY;if(this.lowestBubbleY=Number.NEGATIVE_INFINITY,this.topBar.update(),this.explosionList&&this.explosionList.length>0&&w.nowTime>this.explosionList[0].when){var s=this.explosionList.shift();w.debug&&console.log("*** explosion *** at "+s.loc.x+","+s.loc.y+" list length now = "+this.explosionList.length);var i=this.gridCollide.gridToGameUi(s.loc);I.effects.add(v.EXPLOSION,w.gameUILayer,i.x,i.y),this.radiusEffect(s.loc,Math.sqrt(5),this.explodeBubble),this.looseFall()}for(var a=this.getAllBubbles(),n=a.length-1;n>=0;--n){var o=a[n];if(o&&null!==o.game)if(o.update())if(o.sprite){var r=this.gridCollide.bubbleToGameUi(o.sprite);r.y>this.lowestBubbleY&&(this.lowestBubbleY=r.y),r.y<t&&(t=r.y)}else a.splice(n,1),o.destroy();else a.splice(n,1);else a.splice(n,1)}if(this.lowestBubbleYOffset=e.y-this.lowestBubbleY,a.length>0){var l=this.scrollControl(e);this.scrollY=l,this.gridCollide.offsetY=this.scrollY,w.bubbleLayer.y=Math.floor(this.scrollY*w.bubbleLayer.scale.y)}if(!this.introScroll&&S.levelType==LevelType.GOAL_PROTECT_BARRIER){var h=this.barrierHighlight.visible;this.lowestBubbleY>e.y+S.bubbleInvasionUrgent?(this.barrierHighlight.visible=w.nowTime%500>250?!1:!0,this.barrierHighlight.visible&&!h&&this.managers.audio.play("snd_warning"),this.barrier.alpha>.2&&(this.barrier.alpha-=.01)):this.lowestBubbleY>e.y+S.bubbleInvasionWarning?(this.barrierHighlight.visible=w.nowTime%1e3>500?!1:!0,this.barrierHighlight.visible&&!h&&this.managers.audio.play("snd_warning")):(this.barrierHighlight.visible=!1,this.barrier.alpha<1&&(this.barrier.alpha+=.1))
}this.gridCollide.offsetY=this.scrollY,w.bubbleLayer.y=Math.floor(this.scrollY*w.bubbleLayer.scale.y);var u=w.bubbleLayer.children.length-(this.topBar?1:0);return u>0},B.prototype.setBarrierPosition=function(){if(this.barrier){var e=this.world.getLauncherLocation(this.barrier.parent);this.barrier.x=this.barrierHighlight.x=e.x,this.barrier.y=this.barrierHighlight.y=e.y+S.barrierOffsetY}},B.prototype.shotFired=function(e){this.world.updateLauncherEffect(e)},B.prototype.lost=function(){switch(S.levelType){case LevelType.GOAL_PROTECT_BARRIER:this.setBubbleValues();var e=this.world.getLauncherLocation(this.barrier.parent);if(!this.introScroll&&this.lowestBubbleY>e.y+S.bubbleInvasionY)return this.barrierHighlight.visible=!0,!0}return!1},B.prototype.won=function(){var e=w.bubbleLayer.children.length-(this.topBar?1:0);switch(S.levelType){case LevelType.GOAL_PROTECT_BARRIER:return 0>=e;case LevelType.GOAL_RESCUE_FISH:return this.game.foodCount<=0;case LevelType.GOAL_BREAK_EGG:return this.hitGong&&0>=e}return!1},B.prototype.createGrid=function(e,t){this.grid=[];for(var s=0;t>s;s++){this.grid[s]=[];for(var i=0;2*e-1>i;i++)this.grid[s][i]=1&s?1&i?0:-1:1&i?-1:0}},B.prototype.colourMatch=function(e,t,s,i){void 0===s&&(s=[]),void 0===i&&(i=[]),i.push(e);var a,n;return n={x:e.x-2,y:e.y},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),n={x:e.x+2,y:e.y},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),n={x:e.x-1,y:e.y-1},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),n={x:e.x+1,y:e.y-1},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),n={x:e.x-1,y:e.y+1},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),n={x:e.x+1,y:e.y+1},(a=this.bubbleCheck(n,t,i))&&(s.push({bubble:a,loc:n}),this.colourMatch(n,a.type,s,i)),s},B.prototype.matchAt=function(e,t,s){if(t.sprite){var i=this.colourMatch(e,t.sprite.type);if(i.push({bubble:t,loc:e}),this.radiusEffect(e,Math.sqrt(5),this.pulseBubble),i.length>=s){var a=this.reduceMatches(i);w.debug&&console.log("matched "+a.length+" at "+e.x+","+e.y),a.length>=s&&this.removeList(a)}}},B.prototype.bubbleCheck=function(e,t,s){if(e.y<0||e.y>=this.grid.length)return null;if(e.x<0||e.x>=this.grid[e.y].length)return null;var i=this.grid[e.y][e.x];return i&&-1!=i?i.overlay&&i.overlay.type==F.EGG?null:t&&!i.matchCheck(t)?null:-1!=G.findPointInList(e,s)?null:i:null},B.prototype.reduceMatches=function(e,t){function s(e,t){return e[t].bubble}for(var i=[],a=[],n=0,o=e.length;o>n;n++){i.push(e[n]);var r=e[n].bubble.type;r==F.ICE.type&&(r=e[n].bubble.under_type),a[r]=a[r]+1||1}var l=a[F.RAINBOW.type]||0;delete a[F.RAINBOW.type];for(var h in a)a[h]+l<t&&(i=G.removeFromIndexedList(i,s,"type",h));return i},B.prototype.removeList=function(e){var t,s;for(t=0,s=e.length;s>t;t++){var i=e[t].loc,a=e[t].bubble;a&&a.pop(i)}},B.prototype.looseFall=function(e){var t,s,i,a,n,o,r,l=[],u=[];for(a=0,s=this.grid.length;s>a;a++)for(i=0,n=this.grid[a].length;n>i;i++)r=this.grid[a][i],r&&-1!=r&&(l.push({x:i,y:a}),0===a&&u.push({x:i,y:a}));if(!this.hitGong)for(t=0,s=u.length;s>t;t++)u[t]&&this.connectedGroup(u[t],this.removeFromList,u,l);for(t=0,s=l.length;s>t;t++)if(o=l[t]){if(r=this.grid[o.y][o.x],r&&-1!=r){if(e){r.destroy(),this.grid[o.y][o.x]=0;continue}if(r.type==F.BOMB.type&&"waiting"==r.sprite.animation)continue;var d,c=!0;if(r.overlay&&(c=r.releaseOverlay(!0)),c){var p=this.gridCollide.bubbleToGameUi(r.sprite);w.debugSpam&&console.log("dropping bubble "+p.x+","+p.y),d=I.effects.add(v.FALL_BUBBLE,w.gameUILayer,p.x,p.y,v.bubbleFall,null,this.hitGong),d.setFrame(r.sprite.key);var g=this.droppingScore(r);if(S.score+=g,d){var y=new h;y.create(d.x,d.y,w.textStyleBoldSmall,w.gameUILayer,this.managers,g.toString())}S.boostCanCharge&&(S.boostCharge+=S.dropBubbleBoost)}r.destroy()}-1==this.grid[o.y][o.x]&&alert("SNAFU!"),this.grid[o.y][o.x]=0}},B.prototype.droppingScore=function(e){var t=0;if(e.overlay)switch(e.overlay.type){case F.FISH.type:case F.EGG.type:case F.DRAGON_ORANGE.type:t=S.scoreSpecialGoodDrop;break;case F.DRAGON_PURPLE.type:t=S.scoreSpecialBadDrop;break;default:t=S.scoreFirstDrop}else switch(e.type){case F.ICE.type:t=S.scoreSpecialBadDrop;break;case F.RAINBOW.type:case F.BOMB.type:case F.ROCKET.type:t=S.scoreSpecialGoodDrop;break;default:t=S.scoreFirstDrop}return t},B.prototype.removeFromList=function(e,t){var s=G.findPointInList(e,t);-1!==s&&(t[s]=null)},B.prototype.connectedGroup=function(e,t,s,i,a){void 0===a&&(a=[]),a.push(e),t(e,s),t(e,i);var n,o;o={x:e.x-2,y:e.y},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a),o={x:e.x+2,y:e.y},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a),o={x:e.x-1,y:e.y-1},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a),o={x:e.x+1,y:e.y-1},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a),o={x:e.x-1,y:e.y+1},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a),o={x:e.x+1,y:e.y+1},(n=this.bubbleCheck(o,null,a))&&this.connectedGroup(o,t,s,i,a)},B.prototype.radiusEffect=function(e,t,s){for(var i=Math.floor(e.x-2*t);i<=e.x+2*t;i++)for(var a=Math.floor(e.y-t);a<=e.y+t;a++){var n={x:i,y:a},o=this.gridCollide.get(n);if(o&&-1!=o){var r=(e.x-i)/2,l=e.y-a,h=Math.sqrt(r*r+l*l);t>=h&&s.call(this,o,e,n,h)}}},B.prototype.explodeBubble=function(e,t,s){var i,a=this.grid[s.y][s.x];if(a&&-1!=a&&a==e){if(e.type==F.EGG.type&&"cracking"==e.sprite.animation)return e.wobble(.75,8,4),!1;switch(e.type){case F.BOMB.type:if("default"==e.sprite.animation)return this.addExplosion(s,e),w.debug&&console.log("bomb chain reaction at "+s.x+","+s.y+" list = "+this.explosionList.length),!0;if(s.x!=t.x||s.y!=t.y)return!0;break;case F.ROCKET.type:w.debug&&console.log("explosion triggered rocket bubble at "+s.x+","+s.y),i=I.effects.add(v.ROCKET,w.bubbleLayer,e.sprite.x,e.sprite.y,this.rocketLogic,this),i.scale.x*=G.sign0(e.sprite.scale.x),this.managers.audio.play("snd_firework_launch"),i.vx=50*G.sign0(e.sprite.scale.x);break;case F.ICE.type:w.debug&&console.log("explosion opened shell at "+s.x+","+s.y),this.crackShell(e,s,!0);break;case F.EGG.type:return e.wobble(.75,8,4),!0}return e.pop(s),!0}return!1},B.prototype.pulseBubble=function(e,t,s,i){if(!e.updateCallback){var a=(s.y-t.y)*i*S.pulseScaler,n=(s.x-t.x)*i*S.pulseScaler*(0===a?.5:1);return e.px=e.sprite.x,e.py=e.sprite.y,e.sprite.x+=n,e.sprite.y+=a,e.vx=e.vy=0,e.updateCallback=function(e){e.vx+=.125*(e.px-e.sprite.x),e.vy+=.125*(e.py-e.sprite.y),e.sprite.x+=e.vx*=S.pulseDecay,e.sprite.y+=e.vy*=S.pulseDecay,Math.abs(e.vx)<.25&&Math.abs(e.vy)<.25&&Math.abs(e.sprite.x-e.px)<.1&&Math.abs(e.sprite.y-e.py)<.1&&(e.updateCallback=null,e.sprite.x=e.px,e.sprite.y=e.py)},!0}return!1},B.prototype.addExplosion=function(e,t){var s,i=this.explosionList.length;s=0===i?w.nowTime+S.chainReactionDelay:this.explosionList[i-1].when+S.chainReactionDelay,t.sprite.setAnimation("waiting",!1,!0),this.explosionList.push({loc:e,when:s})},B.prototype.autoScroll=function(e){this.scrollY+=e},B.prototype.directHit=function(e){var t={x:e.x-2,y:e.y};this.hit(t),t={x:e.x+2,y:e.y},this.hit(t),t={x:e.x-1,y:e.y-1},this.hit(t),t={x:e.x+1,y:e.y-1},this.hit(t),t={x:e.x-1,y:e.y+1},this.hit(t),t={x:e.x+1,y:e.y+1},this.hit(t)},B.prototype.hit=function(e,t){if(!(e.y<0||e.y>=this.grid.length||e.x<0||e.x>=this.grid[0].length)){var s=this.grid[e.y][e.x];if(s){var i,a;switch(s.type){case F.BOMB.type:w.debug&&console.log("direct hit on bomb bubble at "+e.x+","+e.y),s.sprite.key="invalid_key",a=this.gridCollide.gridToGameUi(e),I.effects.add(v.EXPLOSION,w.gameUILayer,a.x,a.y),this.radiusEffect(e,Math.sqrt(5),this.explodeBubble),this.looseFall();break;case F.ROCKET.type:w.debug&&console.log("hit rocket bubble at "+e.x+","+e.y),i=I.effects.add(v.ROCKET,w.bubbleLayer,s.sprite.x,s.sprite.y,this.rocketLogic,this),i.scale.x*=G.sign0(s.sprite.scale.x),this.managers.audio.play("snd_firework_launch"),i.vx=50*G.sign0(s.sprite.scale.x),s.destroy();break;case F.ICE.type:w.debug&&console.log("hit shell bubble at "+e.x+","+e.y+" "+s.under_type),this.crackShell(s,e,!1);break;case F.EGG.type:return w.debug&&console.log("hit egg bubble at "+e.x+","+e.y),t||void 0===t?(this.crackEgg(s),s.wobble(0,0,0)):s.wobble(1,8,4),!0}}return!1}},B.prototype.crackShell=function(e,t,s){this.managers.audio.play("snd_ice_crack");this.gridCollide.gridToGameUi(t);if(e.changeType(e.under_type),s){var i=I.effects.add(v.FAKE_BUBBLE,e.sprite.parent,e.sprite.x,e.sprite.y,this.fakeBubbleLogic,this);i.setFrame(e.sprite.key),i.createdTime=w.nowTime}I.effects.add(v.CRACK_ICE,e.sprite.parent,e.sprite.x,e.sprite.y)},B.prototype.crackEgg=function(e){e.overlay&&(this.managers.audio.play("snd_crack"),e.sprite.setAnimation("cracking",!0,!0),e.overlay.destroy(),e.overlay=null,e.animDelay=100,e.animTime=w.nowTime+e.animDelay,e.playField=this,e.updateCallback=function(){if(0===(1&S.frameCount)){var e=this.gridCollide.bubbleToGameUi(this.sprite),t=G.near(e,S.bubbleRadius);I.effects.add(v.SPARKLES_WHITE,w.gameUILayer,t.x,t.y)}})},B.prototype.fairyBoostFly=function(e){if(e.leaving)return e.vx-=12,e.vy+=8*Math.random()-4,e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3,e.vy*=.99,e.x<-S.sideBarOffset-1*S.bubbleDiameter&&(e.alpha-=.05,e.alpha<=0)?!1:!0;if(e.type==F.DRAGON_BLUE.type&&"shooting"==e.animation)if(2!=e.frameIndex||e.shootingFlag){if(4==e.frameIndex){var t=this.pickVisibleBubble(e.dest.x-8,e.dest.x-5,!1);if(!t||e.transformCount>=3)return w.debug&&console.log("fairy leaving the grid..."),e.leaving=!0,e.animation="flying",S.boostCharge=0,S.boostCanCharge=!0,!0;e.dest=t,e.vx=0,e.vy=-9,e.target=this.grid[t.y][t.x],e.animation="flying"}}else this.changeToSpecial(e.dest),e.shootingFlag=!0,void 0===e.transformCount&&(e.transformCount=0),e.transformCount++;else v.swoopToGridTarget(e,this,{x:-80,y:35})||(I.effects.add(v.DRAGON_LIGHTNING,e.parent,e.x,e.y),e.setAnimation("shooting"),e.shootingFlag=!1);return!0},B.prototype.bonus5BoostFly=function(e){return v.swoopToTarget(e,this.game.world.GetTurnCountLocation())?!0:(S.boostCharge=0,S.boostCanCharge=!0,S.shotsLeft+=5,this.managers.audio.play("snd_moves_up"),!1)},B.prototype.fakeBubbleLogic=function(e){if(w.nowTime<e.createdTime+1e3)return!0;var t=this.gridCollide.bubbleToGameUi(e);return I.effects.add(v.POP_BUBBLE,w.gameUILayer,t.x,t.y),!1},B.prototype.smokeLogic=function(e){return e.y+=e.vy*w.elapsedTime/1e3,e.vy-=10,e.alpha-=.03,e.alpha<=0?!1:!0},B.prototype.rocketLogic=function(e){var t=G.sign0(e.scale.x);e.x+=e.vx*w.elapsedTime/1e3,e.vx=Math.min(e.vx+21*t,880),0===(1&S.frameCount)&&I.effects.add(v.ROCKET_SMOKE,e.parent,e.x-.9*S.bubbleDiameter*t,e.y,this.smokeLogic,this),e.effectOverlay&&(e.effectOverlay.x=e.x-1.3*S.bubbleRadius*t);var s=this.gridCollide.bubbleToGrid(e);if(Math.abs(e.x)>S.gridOffsetX||!s)return e.alpha-=.05,e.alpha<=0?(this.looseFall(),!1):!0;var i=this.gridCollide.get(s);if(i){switch(i.type){case F.EGG.type:return w.debug&&console.log("rocket hit egg bubble at "+s.x+","+s.y),this.crackEgg(i),!1;case F.BOMB.type:return this.addExplosion(s,i),this.looseFall(),I.effects.add(v.EXPLOSION,w.bubbleLayer,e.x,e.y),!1;case F.ICE.type:return this.crackShell(i,s,!0),!1}i.pop(s)}return!0},B.prototype.dragonHatchLogic=function(e){if(0===(7&S.frameCount)){var t=G.near(e,S.bubbleRadius/2);I.effects.add(v.SPARKLES_WHITE,e.parent,t.x,t.y)}if(e.scale.set(1.002*e.scale.x),e.hoverDelay>0)v.swoopToTarget(e,e.dest)||(e.hoverDelay-=w.elapsedTime);else if(e.alpha-=.75*w.elapsedTime/1e3,e.alpha<=0)return!1;return!0};var H=Math.tan(60*Math.PI/180);B.prototype.populateLevel=function(e){w.forceResize=!0,this.gridCollide=new GridCollide,this.gridCollide.create(this.grid,S.bubbleRadius,S.bubbleRadius*H);for(var t=e.goal_fish?e.goal_fish.count:0,s=0;s<e.height;s++)for(var i=0;i<2*e.width-1;i++)if(-1!=this.grid[s][i]){var a=G.pickRandomFromList(e.list),n=F[a].type;n=this.symmetry(this.grid,i,s,n,e.symmetry);var o=new k(this.game,this.managers,this,this.gridCollide);o.create(w.bubbleLayer,n,i,s)}switch(e.holes&&this.makeHoles(e.holes),this.looseFall(!0),S.levelType){case LevelType.GOAL_PROTECT_BARRIER:break;case LevelType.GOAL_RESCUE_FISH:this.game.foodCount=t,this.addOverlays(this.grid,t,e.goal_fish);break;case LevelType.GOAL_BREAK_EGG:this.addGong()}e.specials&&this.addSpecials(this.grid,e.specials),this.looseFall(!0)},B.prototype.changeToSpecial=function(e){var t=G.pickRandomFromList(["bomb","rocket","fairy","bat"]);w.debug&&console.log("changeToSpecial "+t+" at "+e.x+","+e.y),this.addOneSpecial(e,t)},B.prototype.addOneSpecial=function(e,t){switch(t){case"bomb":this.addBomb(this.grid,e);break;case"rocket":this.addRocket(this.grid,e);break;case"shell":this.addShell(this.grid,e);break;case"fairy":this.addFairy(this.grid,e);break;case"bat":this.addBat(this.grid,e)}},B.prototype.addSpecials=function(e,t){for(var s=0,i=t.length;i>s;s++)this.addSpecial(e,t[s])},B.prototype.addSpecial=function(e,t){void 0!==t.special_bomb&&this.addBombs(e,t.special_bomb),void 0!==t.special_rocket&&this.addRockets(e,t.special_rocket),void 0!==t.special_frozen_bubble&&this.addShells(e,t.special_frozen_bubble),void 0!==t.special_burst_dragon&&this.addFairies(e,t.special_burst_dragon),void 0!==t.special_carry_dragon&&this.addBats(e,t.special_carry_dragon)},B.prototype.addBats=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addBat(e,t)})},B.prototype.addBat=function(e,t){var s=e[t.y][t.x];if(s&&s.isNormal()&&!s.overlay){var i=s.addOverlay(F.DRAGON_PURPLE.type);return i.parent}return null},B.prototype.addFairies=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addFairy(e,t)})},B.prototype.addFairy=function(e,t){var s=e[t.y][t.x];if(s&&s.isNormal()&&!s.overlay){var i=s.addOverlay(F.DRAGON_ORANGE.type);return i.parent}return null},B.prototype.addBombs=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addBomb(e,t)})},B.prototype.addBomb=function(e,t){var s=e[t.y][t.x],i=null;return s&&s.isNormal()&&!s.overlay&&(i=s.changeType(F.BOMB.type)),i},B.prototype.addRockets=function(e,t){var s=this,i=this.createEdgeGrid(e,3,3);this.findLocations(i,t.number,t,function(t){return s.addRocket(e,t)})},B.prototype.addRocket=function(e,t){var s=e[t.y][t.x],i=null;return s&&s.isNormal()&&!s.overlay&&(i=s.changeType(F.ROCKET.type),t.x>=2*S.width/2&&(i.sprite.scale.x=-Math.abs(i.sprite.scale.x))),i},B.prototype.addShells=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addShell(e,t)})},B.prototype.addShell=function(e,t){var s=e[t.y][t.x],i=null;return s.isNormal()&&!s.overlay&&(i=s.changeType(F.ICE.type)),i},B.prototype.addOverlays=function(e,t,s){this.findLocations(e,t,s,function(t){var s=e[t.y][t.x];if(s&&s.isNormal(!1)&&!s.overlay){var i=s.addOverlay(F.FISH.type);return i.parent}return null})},B.prototype.addGong=function(){var e,t=this.grid,s={x:Math.floor(t[0].length/2),y:0},i=s.x;do e=t[s.y][i],-1==e&&(i>2*S.width/2?i--:i++,e=t[s.y][i]),i=Math.floor(Math.random()*S.width*2);while(!e);e.addOverlay(F.EGG.type),e.changeType(F.EGG.type);var a=this;e.sprite.updateCallback=function(e){if("cracking"==e.animation){if(3==e.frameIndex&&!e.taskDone){var t=a.gridCollide.bubbleToGameUi(e),s=I.effects.add(v.DRAGON_GOLD,w.gameUILayer,t.x,t.y,a.dragonHatchLogic,a);s.dest={x:0,y:0},e.taskDone=!0}e.atEnd&&(a.hitGong=!0,a.looseFall())}}},B.prototype.makeHoles=function(e){Math.mySeed(e.seed);for(var t=0;t<e.number;t++){var s,i;do s=this.gridCollide.randomLocation(this.grid,!0,Math.myRandom),i=this.grid[s.y][s.x];while(i.overlay);if(i.destroy(),this.grid[s.y][s.x]=0,e.symmetry)for(var a=e.symmetry.length-1;a>=0;--a){var n=2*e.symmetry[a].x-1,o=n-(s.x-n);if(o>=0&&o<this.grid[s.y].length&&100*Math.random()<e.symmetry[a].pcnt){var r=this.grid[s.y][o];-1!=r?0===r||r.overlay||(this.grid[s.y][o]=0,r.destroy()):(r=this.grid[s.y][o+1].key,0===r||r.overlay||(this.grid[s.y][o+1]=0,r.destroy()))}break}}},B.prototype.symmetry=function(e,t,s,i,a){var n=i;if(a&&a.length>0)for(var o=a.length-1;o>=0;--o){var r=2*a[o].x-1;if(t>r){var l=r-(t-r);l>=0&&l<e[s].length&&100*Math.random()<a[o].pcnt&&(n=e[s][l].type,-1==n&&(n=e[s][l+1].type));break}}return n},B.prototype.findLocations=function(e,t,s,i){for(var a=[],n=100*t,o=t;o>0;){var r=!1,l=this.gridCollide.randomLocation(e,!0);if(this.validateDistanceFromList(e,a,l.x,l.y,s)){var h=i(l);h&&(a.push(h),o--,r=!0)}r||--n<=0&&(w.debug&&console.log("WARNING: PlayField.findLocations got stuck, changing ranges"),s.min>2&&(s.min-=2),s.max<1e3&&(s.max+=2),n=500)}return a},B.prototype.validateDistanceFromList=function(e,t,s,i,a){var n=this.gridCollide.gridToBubble({x:s,y:i}),o=G.findNearestPointInList(n,t);if(-1==o)return!0;var r=G.distanceBetween(n,t[o]);return(!a.min||r>=a.min*S.bubbleRadius/16)&&(!a.max||r<a.max*S.bubbleRadius/16)?!0:!1},B.prototype.createEdgeGrid=function(e,t,s){for(var i=[],a=e[0].length,n=0;n<e.length;n++){i[n]=[];for(var o=0;o<e[n].length;o++)i[n][o]=e[n][o]&&-1==e[n][o]?-1:t>o||o>a-s?e[n][o]:0}return i},B.prototype.effectContinues=function(){return S.frameCount-this.resizeChargeBlocker<4?!0:this.introScroll?!0:this.explosionList&&this.explosionList.length>0?!0:this.isFairyFlying()?!0:!1},B.prototype.isFairyFlying=function(){return I.effects.countDragonsFlying()>0?!0:!1},B.prototype.pickVisibleBubble=function(e,t,s){w.debug&&console.log("PlayField.pickVisibleBubble "+e+" -> "+t),void 0===s&&(s=!0);var i=this.findLowestBubble();if(!i)return w.debug&&console.log("no lowest bubble!"),null;(void 0===e||0>e)&&(e=0),e>=this.grid[0].length&&(e=this.grid[0].length-1),(void 0===t||t>this.grid[0].length)&&(t=this.grid[0].length),0>t&&(t=0);var a,n=5,o=[];do{for(var r=i.y;r>=Math.max(0,i.y-n);--r)for(var l=e;l<Math.min(t,this.grid[r].length);l++){var h=this.grid[r][l];h&&-1!=h&&h.isNormal()&&!h.overlay&&o.push({x:l,y:r})}if(0===o.length){if(n++<=i.y)continue;if(s){if(e-->0)continue;if(t++<this.grid[0].length-1)continue}return w.debug&&console.log("failed to find any bubbles!"),null}a=G.pickRandomFromList(o)}while(!a);return o=null,a},B.prototype.pickVisibleSpace=function(){var e=this.findLowestBubble();if(!e)return null;var t=[],s=e.y;do{for(var i=Math.max(s-6,0),a=s;a>=i;--a)for(var n=0;n<this.grid[a].length;n++){var o=this.grid[a][n];if(!o){var r={x:n,y:a};this.adjacentFilled(r)&&t.push(r)}}s-=6,0>s&&(s=e.y+1)}while(0===t.length);var l=G.pickRandomFromList(t);return t=null,l},B.prototype.adjacentFilled=function(e){return this.gridCollide.get({x:e.x-2,y:e.y})?!0:this.gridCollide.get({x:e.x+2,y:e.y})?!0:this.gridCollide.get({x:e.x-1,y:e.y-1})?!0:this.gridCollide.get({x:e.x+1,y:e.y-1})?!0:this.gridCollide.get({x:e.x-1,y:e.y+1})?!0:this.gridCollide.get({x:e.x+1,y:e.y+1})?!0:!1},B.prototype.findLowestBubble=function(){for(var e=this.grid.length-1;e>=0;--e)for(var t=0;t<this.grid[e].length;t++)if(this.grid[e][t]&&-1!=this.grid[e][t])return{x:t,y:e};return null},B.prototype.getAllBubbles=function(){for(var e=[],t=0;t<this.grid.length;t++)for(var s=0;s<this.grid[t].length;s++)this.grid[t][s]&&-1!=this.grid[t][s]&&e.push(this.grid[t][s]);return e},B.prototype.getGridCollide=function(){return this.gridCollide},B.prototype.setBubbleValues=function(){var e=Number.POSITIVE_INFINITY;this.lowestBubbleY=Number.NEGATIVE_INFINITY;for(var t=this.getAllBubbles(),s=t.length-1;s>=0;--s){var i=t[s];if(i&&null!==i.game){var a=this.gridCollide.bubbleToGameUi(i.sprite);a.y>this.lowestBubbleY&&(this.lowestBubbleY=a.y),a.y<e&&(e=a.y)}}return e},B.prototype.adjustScroll=function(){var e=this.world.getLauncherLocation(w.gameUILayer);if(this.setBubbleValues(),S.levelType==LevelType.GOAL_PROTECT_BARRIER){if(this.lowestBubbleYOffset){var t=e.y-this.lowestBubbleYOffset,s=this.lowestBubbleY-t,i=this.scrollY-s;this.scrollY=i}}else if(!this.introScroll){var t=e.y+S.scrollLineY[S.levelType],s=this.lowestBubbleY-t,i=this.scrollY-s;this.scrollY=i}this.gridCollide.offsetY=this.scrollY,w.bubbleLayer.y=Math.floor(this.scrollY*w.bubbleLayer.scale.y)},B.prototype.scrollControl=function(e){this.setBubbleValues();var t=S.scrollSpeed*w.elapsedTime/1e3,s=20;if(S.levelType==LevelType.GOAL_PROTECT_BARRIER){if(this.introScroll){var i=this.lowestBubbleY-(e.y+S.scrollLineY[S.levelType]),a=this.scrollY-i,n=(this.scrollY*(s-1)+a)/s,o=G.limit(n-this.scrollY,t,5*t);return this.introScroll&&Math.abs(this.scrollY-a)<.5&&(this.introScroll=!1,this.world.showBoost(!0)),this.scrollY+o}if(this.lowestBubbleY<e.y+S.scrollLineY[S.levelType]-3*S.bubbleRadius){var r=S.scrollSpeed*w.elapsedTime/1e3;this.autoScroll(r),this.scrollDownBonus&&S.boostCanCharge&&S.frameCount-this.resizeChargeBlocker>4&&(S.boostCharge+=S.catchUpBoost*r,S.score+=S.scoreCatchUp*r)}return this.scrollY}var i=this.lowestBubbleY-(e.y+S.scrollLineY[S.levelType]),a=this.scrollY-i,n=(this.scrollY*(s-1)+a)/s,o=G.limit(n-this.scrollY,t,4*t);return this.introScroll&&Math.abs(this.scrollY-a)<.5&&(this.introScroll=!1,this.world.showBoost(!0)),this.scrollY+o},E.ANIMATING=0,E.WAITING=1,E.LOADSHOT=2,E.AIMING=3,E.ARM_SHOT=4,E.FIRE=5,E.MOVING=6,E.CANCEL=7,E.CHANGEORDER=8,E.OUTOFAMMO=9,E.ENDOFLEVEL=10,E.colourFromType=[],E.prototype.create=function(e,t,s,i,a){this.world=e,this.managers=t,this.playField=s,this.gridCollide=a,this.bubblesInLevel=i.list,E.colourFromType[F.BLUE.type]="traj_blue.png",E.colourFromType[F.GREEN.type]="traj_green.png",E.colourFromType[F.RED.type]="traj_red.png",E.colourFromType[F.YELLOW.type]="traj_yellow.png",E.colourFromType[F.RAINBOW.type]="traj_special.png",E.colourFromType[F.FIREBALL.type]="traj_special.png",E.colourFromType[F.MINE.type]="traj_special.png",this.state=E.WAITING,this.lastState=-1,this.rememberFiredTypes=[],this.bubbleQueue=[],this.addBubbleToQueue(),this.addBubbleToQueue(),this.shotLoading=!1,this.shotFired=null,this.aimPoint=null,this.angleTooMuch=!0,this.shotStartTime=-1,this.ignoreCollisions=null,this.trajectory=[],this.cursor=null,this.remainingSpread=0,this.remainingAngle=0,this.remainingDelay=0,this.launchTime=0,this.shotLoadedLocation=this.world.getLauncherLocation(w.gameUILayer)},E.prototype.destroy=function(){if(this.game=null,this.world=null,this.playField=null,this.managers=null,this.aimPoint=null,this.ignoreCollisions=null,this.bubblesInLevel=null,this.rememberFiredTypes=null,this.destroyShots(),this.trajectory){for(var e=0;e<this.trajectory.length;e++)this.trajectory[e]&&this.trajectory[e].destroy();this.trajectory=null}this.cursor&&(this.cursor.destroy(),this.cursor=null)},E.prototype.destroyShots=function(){var e=!1;if(this.bubbleQueue){for(var t=0;t<this.bubbleQueue.length;t++)k.isNormalKey(this.bubbleQueue[t].key,!1)||(e=!0),this.bubbleQueue[t].destroy(),this.bubbleQueue[t]=null;this.bubbleQueue=null}return this.shotLoaded&&(k.isNormalKey(this.shotLoaded.key,!1)||(e=!0),this.shotLoaded.destroy(),this.shotLoaded=null),this.shotFired&&(this.shotFired.destroy(),this.shotFired=null),e},E.prototype.update=function(){w.resized&&(this.shotLoadedLocation=this.world.getLauncherLocation(w.gameUILayer),this.shotLoaded&&(this.shotLoaded.x=this.shotLoadedLocation.x,this.shotLoaded.y=this.shotLoadedLocation.y,this.showQueue(1),this.world.showBoost()));var e=this.state!=this.lastState;switch(this.lastState=this.state,this.state){case E.OUTOFAMMO:S.shotsLeft>0&&(this.state=E.WAITING);break;case E.ENDOFLEVEL:case E.ANIMATING:break;case E.WAITING:this.readyForShot()?this.state=E.LOADSHOT:(this.launchTime<500&&(this.launchTime=500),this.playField.shotFired(this.launchTime+=w.elapsedTime),this.hideTrajectory());break;case E.LOADSHOT:if(e&&this.world.launcherRingReset(),0===S.shotsLeft){this.state=E.OUTOFAMMO;break}if(!this.shotLoaded){this.showQueue(0),this.loadShot();break}this.showQueue(1),this.world.showBoost(),this.state=E.AIMING;break;case E.AIMING:if(e&&(this.mouseMoveLocal=null),this.playField.hitGong||this.game.droppedLastFish){this.state=E.CANCEL,this.hideTrajectory();break}this.shotLoaded.alpha<1&&(this.shotLoaded.alpha+=.1),this.specialAim(this.shotLoaded),this.aimShot();break;case E.ARM_SHOT:this.shotLoaded.alpha<1&&(this.shotLoaded.alpha+=.1),this.specialAim(this.shotLoaded),this.readyForShot()?this.armShot():(this.hideTrajectory(),this.state=E.AIMING);break;case E.FIRE:e&&(S.popCount=0,this.shotLoaded.alpha=1,this.specialFire(this.shotLoaded)),this.fireShot(),this.takeBubbleFromQueue(),this.addBubbleToQueue();break;case E.MOVING:e&&(this.ignoreCollisions=[],this.launchTime=0),this.playField.shotFired(this.launchTime+=w.elapsedTime),this.moveShot(this.shotFired,!0)||(this.playField.looseFall(),this.state=E.WAITING);break;case E.CHANGEORDER:this.rotateQueue();break;case E.CANCEL:this.state=E.WAITING}this.playField.introScroll&&this.shotLoaded&&(this.shotLoaded.alpha=0),this.shotLoaded&&null===this.shotLoaded.parent&&(this.shotLoaded=null),this.shotFired&&null===this.shotFired.parent&&(this.shotFired=null),this.shotFired&&this.shotFired.update(),this.shotLoaded&&this.shotLoaded.update()},E.prototype.readyForShot=function(){return this.playField.effectContinues()?!1:this.shotLoading?!1:this.playField.hitGong||this.game.droppedLastFish?!1:!0},E.prototype.showQueue=function(e){var t=this.bubbleQueue[e];t.x=this.shotLoadedLocation.x+S.queuePositionX1,t.y=this.shotLoadedLocation.y+S.queuePositionY1,t.anchor.set(.5),t.scale.set(S.queuePositionScale),t.visible=!0},E.prototype.aimShot=function(){this.matchAvailableColours(),w.mouseMoveLocal&&(this.aimPoint={x:w.mouseMoveLocal.x,y:w.mouseMoveLocal.y},e.touchEvent||(w.showLockedCursor?this.cursor||(this.cursor=new n,this.cursor.create(w.gameUILayer,"bubble_cursor",this.managers.textures,0,0,!1),this.cursor.anchor.set(.5)):this.cursor&&(this.cursor.destroy(),this.cursor=null),S.shotsLeft>0&&this.drawTrajectory(w.mouseMoveLocal,S.trajectoryLength))),S.shotsLeft>0&&(w.mouseDown&&(this.state=E.ARM_SHOT,this.shotStartTime=w.nowTime,w.mouseUp=w.click=null),R.isPressed[U.space_bar]&&(this.state=E.CHANGEORDER))},E.prototype.armShot=function(){return this.drawTrajectory(w.mouseMoveLocal,S.trajectoryLength),this.aimPoint={x:w.mouseMoveLocal.x,y:w.mouseMoveLocal.y},w.mouseUp||w.click?(this.state=this.aimingAtOwnShooter()?w.nowTime-this.shotStartTime<=w.shortTapDurationMS?E.CHANGEORDER:E.WAITING:this.angleTooMuch?E.WAITING:E.FIRE,void(w.mouseUp=w.click=w.mouseUpLocal=null)):void(R.isPressed[U.space_bar]&&(this.state=E.CHANGEORDER))},E.prototype.aimingAtOwnShooter=function(e){if(!e){if(!this.aimPoint)return!1;e=this.aimPoint}var t=this.world.launcherButton,s=new PIXI.Point(0,0);return s=t.toGlobal(s),s.y-=40*w.height/480,t=w.gameUILayer.toLocal(s),G.distanceBetweenScaled(e,{x:t.x,y:t.y},1,1)<S.shooterRadius},E.prototype.hideTrajectory=function(){if(this.trajectory)for(var e=0;e<this.trajectory.length;e++)this.trajectory[e]&&(this.trajectory[e].visible=!1)},E.prototype.drawTrajectory=function(e,t){if(!this.aimingAtOwnShooter(e)){this.trajectory||(this.trajectory=[]);var s=e.x-this.shotLoadedLocation.x,i=e.y-this.shotLoadedLocation.y,a=180*Math.atan2(s,-i)/Math.PI;if(Math.abs(a)<=S.aimAngleLimit){this.angleTooMuch=!1;for(var o=this.simulateShotMovement(),r=0,l=0,h=o.length;h>l&&t>l;l+=S.shotStep){var u=this.trajectory[r];u||(u=new n,u.create(w.gameUILayer,"traj_blue.png",this.managers.textures,0,0,!1,!0),u.anchor.set(.5),this.trajectory[r]=u),u.x=o[l].x,u.y=o[l].y,u.visible=!0,u.setFrame(E.colourFromType[this.shotLoaded.type]),r++}for(h=this.trajectory.length;h>r;r++)this.trajectory[r]&&(this.trajectory[r].destroy(),this.trajectory[r]=null);o=null}else this.angleTooMuch=!0,this.hideTrajectory()}},E.prototype.simulateShotMovement=function(){var e=[];this.simulateShot=new n,this.simulateShot.create(w.gameUILayer,this.shotLoaded.type,this.managers.textures,this.shotLoaded.x,this.shotLoaded.y,!1),this.simulateShot.anchor.set(.5),this.simulateShot.visible=!1;var t=this.aimPoint.x-this.simulateShot.x,s=this.aimPoint.y-this.simulateShot.y,i=Math.sqrt(t*t+s*s);for(this.simulateShot.vx=t/i*S.shotSpeed,this.simulateShot.vy=s/i*S.shotSpeed,this.ignoreCollisions=[];this.moveShot(this.simulateShot,!1);)e.push({x:this.simulateShot.x,y:this.simulateShot.y});return this.cursor&&(this.cursor.x=this.simulateShot.x,this.cursor.y=this.simulateShot.y,this.cursor.visible=!0),this.simulateShot.destroy(),this.simulateShot=null,e},E.prototype.fireShot=function(){if(w.debug&&console.log("*** fireShot *** "+this.shotLoaded.type+" shotsLeft = "+S.shotsLeft),S.shotsLeft>0){for(S.shotsLeft--,this.rememberFiredTypes.push(this.shotLoaded.type);this.rememberFiredTypes.length>4;)this.rememberFiredTypes.shift();w.idleTimer=w.eventChangeAdOnIdle,this.shotFired=this.shotLoaded,this.shotLoaded=null;var e=this.aimPoint.x-this.shotFired.x,t=this.aimPoint.y-this.shotFired.y,s=Math.sqrt(e*e+t*t);this.shotFired.vx=e/s*S.shotSpeed,this.shotFired.vy=t/s*S.shotSpeed,this.state=E.MOVING,this.managers.audio.play("snd_shoot")}this.hideTrajectory()},E.prototype.addBubbleToQueue=function(){if(this.bubbleQueue.length<2){var e=this.pickABubble(),t=new n;t.create(w.gameUILayer,e,this.managers.textures,0,0,!1),t.anchor.set(.5),t.visible=!1,this.bubbleQueue.push(t)}},E.prototype.boostInQueue=function(e){for(var t=0;t<this.bubbleQueue.length;t++)if(this.bubbleQueue[t].type==e)return!0;return!1},E.prototype.addBoostToQueue=function(e,t){if(!this.boostInQueue(e)&&this.bubbleQueue&&this.bubbleQueue.length>0){var s=this.bubbleQueue.pop();s&&(s.setType(e),s.setAnimation("default",!0,!0),this.bubbleQueue.push(s),s.x=t.x,s.y=t.y,this.tweenLoadBoost(s,{x:this.shotLoadedLocation.x+S.queuePositionX1,y:this.shotLoadedLocation.y+S.queuePositionY1,scale:S.queuePositionScale},function(){}))}},E.prototype.loadShot=function(e){var t=this;this.hideTrajectory();var s=this.bubbleQueue[0];s.tweener||(this.shotLoaded=s,w.debug&&console.log("Shooter.loadShot "+this.shotLoaded.key),e!==!1?(this.shotLoading=!0,this.tweenLoad(this.shotLoaded,{x:this.shotLoadedLocation.x,y:this.shotLoadedLocation.y,scale:1},function(){t.showQueue(1),t.world.showBoost(),t.state=E.AIMING,t.shotLoading=!1})):(this.showQueue(1),this.world.showBoost()),this.state=E.WAITING)},E.prototype.rotateQueue=function(){w.debug&&console.log("Shooter.rotateQueue");var e=this;this.state=E.ANIMATING;var t=this.bubbleQueue[this.bubbleQueue.length-1];t.x=this.shotLoadedLocation.x+S.queuePositionX1,t.y=this.shotLoadedLocation.y+S.queuePositionY1,this.tweenSwap(this.bubbleQueue[0],t,function(){var t=e.bubbleQueue.shift();e.bubbleQueue.push(t),e.loadShot(!1),e.showQueue(1),e.state=E.WAITING}),this.hideTrajectory()},E.prototype.pickABubble=function(){var e,t=3;do{var s=G.pickRandomFromList(this.bubblesInLevel);e=F[s].type}while(G.countInList(this.rememberFiredTypes,e)>=3&&t-->0);return e},E.prototype.takeBubbleFromQueue=function(){this.bubbleQueue&&this.bubbleQueue.length>0&&this.bubbleQueue.shift()},E.prototype.moveShot=function(e,t){e.mx=e.x,e.my=e.y,t?(e.x+=e.vx*w.elapsedTime/1e3,e.y+=e.vy*w.elapsedTime/1e3,this.specialAnim(e)):(e.x+=16*e.vx/1e3,e.y+=16*e.vy/1e3),e.x<=-S.gridOffsetX&&(e.x=-S.gridOffsetX+1e-4,e.vx=Math.abs(e.vx),t&&this.managers.audio.play("snd_bubbleBounce")),e.x>=S.gridOffsetX&&(e.x=S.gridOffsetX-1e-4,e.vx=-Math.abs(e.vx),t&&this.managers.audio.play("snd_bubbleBounce"));var s=this.gridCollide.gridToBubble({x:0,y:0}),i=this.gridCollide.bubbleToGameUi(s);e.y<i.y&&(e.y=i.y,e.vy=0);var a=this.gridCollide.gameUiToBubble(e);a.type=e.type;var n=this.gridCollide.gameUiToBubble({x:e.mx,y:e.my});a.mx=n.x,a.my=n.y;var o=this.gridCollide.bubbleToGrid(a);if(o.y>this.playField.grid.length)return!1;if(a.y<=-(S.gridOffsetY-.01)){if(this.canStickToTop(a.type))return t&&this.managers.audio.play("snd_stick_top"),a.x=a.mx,a.y=a.my,this.makeShotIntoBubble(a,t),!1;if(t){if(a.type==F.MINE.type){var r=this.gridCollide.bubbleToGrid(a);this.playField.radiusEffect(r,Math.sqrt(11.5),this.playField.explodeBubble),I.effects.add(v.EXPLOSION,w.gameUILayer,e.x,e.y),w.debug&&console.log("Mine explodes against top at location "+r.x+","+r.y," pixels = "+e.x+","+e.y)}e.destroy()}return!1}var l=this.gridCollide.collide(e,1);return null!==l&&l.length>0&&(l=this.getActualCollisions(a,l,S.bubbleCollisionRadius),l&&l.length>0&&!this.handleCollisions(l,a,e,t))?!1:!0
},E.prototype.canStickToTop=function(e){return e==F.FIREBALL.type?!1:e==F.MINE.type?!1:!0},E.prototype.handleCollisions=function(e,t,s,i){var a=this.specialCollide(s,e,i);if(null!==a)return a;if(s.vx=s.vy=0,t.x=(t.x+t.mx)/2,t.y=(t.y+t.my)/2,s.type==F.MINE.type){if(i){var n=this.gridCollide.bubbleToGrid(t);this.playField.directHit(n),this.playField.radiusEffect(n,Math.sqrt(11.5),this.playField.explodeBubble);var o=I.effects.add(v.EXPLOSION,w.gameUILayer,s.x,s.y);o.scale.set(1.5),this.shotFired.destroy(),this.shotFired=null}return!1}return this.makeShotIntoBubble(t,i),!1},E.prototype.makeShotIntoBubble=function(e,t){var s;if(null!==e.key)if(t){s=this.snapBubbleToGrid(e),w.debug&&console.log("makeShotIntoBubble snapped to "+s.x+","+s.y+" "+e.key);var i=new k(this.game,this.managers,this.playField,this.gridCollide);i.create(w.bubbleLayer,e.type,s.x,s.y),this.shotFired.destroy(),this.shotFired=null,this.managers.audio.play("snd_stick"),this.playField.matchAt(s,i,3),this.playField.directHit(s),this.playField.looseFall()}else{s=this.gridCollide.bubbleToGrid(e);var a=this.gridCollide.gridToGameUi(s);this.simulateShot.x=a.x,this.simulateShot.y=a.y}},E.prototype.snapBubbleToGrid=function(e){return this.findClosestEmptyGridTo(e)},E.prototype.findClosestEmptyGridTo=function(e){for(var t=Number.MAX_VALUE,s=null,i=this.gridCollide.bubbleToGrid(e),a=-1;1>=a;a++)for(var n=-2;2>=n;n++){var o={x:i.x+n,y:i.y+a},r=this.gridCollide.get(o);if(0===r||null===r){var l=this.gridCollide.gridToBubble(o),h=e.x-l.x,u=e.y-l.y,d=h*h+u*u;t>d&&(t=d,s={x:o.x,y:o.y})}}return s},E.prototype.triggerAndPopBubbleFromSprite=function(e,t){if(e&&e.transform){var s=this.gridCollide.bubbleToGrid(e);if(!this.playField.hit(s,t)){var i=this.gridCollide.get(s);i&&-1!=i&&i.pop(s)}}else console.log("WARNING: triggerAndPopBubbleFromSprite has an invalid sprite!"),console.log(e),console.log(e.transform)},E.prototype.getActualCollisions=function(e,t,s){for(var i=[],a=2*s*s*2,n=0,o=t.length;o>n;n++){var r=t[n].sprite;r.transform?this.contact(e,r,a)&&i.push(r):alert("snafu! invalid sprite found")}return i},E.prototype.contact=function(e,t,s){var i=e.x-t.x,a=e.y-t.y,n=i*i+a*a;return s>=n},E.prototype.reverseMotion=function(e,t,s){var i=2*s*2*s,a=e.x,n=e.y,o=e.mx-a,r=e.my-n,l=!0;do{o/=2,r/=2,e.x=a+=o,e.y=n+=r;for(var h=!1,u=0,d=t.length;d>u;u++)if(this.contact(e,t[u],i)){h=!0;break}this.gridCollide.outsideGrid(e)&&(h=!0),h!=l&&(o=-o,r=-r,l=h)}while(Math.abs(o)>=.5||Math.abs(r)>=.5)},E.prototype.matchAvailableColours=function(){if(this.bubbleQueue&&w.bubbleLayer&&w.bubbleLayer.children){var e,t=w.bubbleLayer.children.length-(this.playField.topBar?1:0);if(15>t&&t>0){var s=[];for(e=0;e<w.bubbleLayer.children.length;e++){var i=w.bubbleLayer.children[e];i!=this.playField.topBar&&k.isNormal(i.type,!1)&&-1==s.indexOf(i.type)&&s.push(i.type)}for(e=0;e<this.bubbleQueue.length;e++){var a=this.bubbleQueue[e].type;if(-1==s.indexOf(a)&&k.isNormal(this.bubbleQueue[e].type,!1)){var n=G.pickRandomFromList(s);if(null===n||n===F.UNDEFINED.type)return;this.bubbleQueue[e].setType(n)}}}}},E.prototype.shootRemaining=function(){if(S.shotsLeft>0){var e=!1;if(this.remainingSpread||(w.debug&&console.log("*** start bonus sequence ***"),e=this.destroyShots(),this.remainingSpread=Math.max(70/(S.shotsLeft+1),10),this.remainingAngle=-35+this.remainingSpread,this.remainingDelay=w.nowTime),w.nowTime>=this.remainingDelay){this.remainingDelay=w.nowTime+S.bonusShootDelay;var t=this.world.getLauncherLocation(w.gameUILayer),s=I.effects.add(v.FAKE_BUBBLE,w.gameUILayer,t.x,t.y,this.endSequenceLogic,this);s.vx=Math.sin(this.remainingAngle*Math.PI/180)*S.bonusShootSpeed,s.vy=-Math.cos(this.remainingAngle*Math.PI/180)*S.bonusShootSpeed,s.setType(this.pickABubble()),this.managers.audio.play("snd_shoot"),S.shotsLeft--,w.debug&&console.log("shoot bonus at "+w.nowTime+" next at "+this.remainingDelay+" shotsLeft = "+S.shotsLeft),this.remainingAngle+=this.remainingSpread,this.remainingAngle>35?(this.remainingSpread=-Math.abs(this.remainingSpread),this.remainingAngle=35+this.remainingSpread):this.remainingAngle<-35&&(this.remainingSpread=Math.abs(this.remainingSpread),this.remainingAngle=-35+this.remainingSpread)}}},E.prototype.endLevel=function(){this.hideTrajectory(),this.state=E.ENDOFLEVEL},E.prototype.endSequenceLogic=function(e){if(e.x+=e.vx,e.y+=e.vy,e.y<2*-S.bubbleDiameter){I.effects.add(v.EXPLOSION,w.gameUILayer,e.x,e.y);var t=150;S.score+=t;var s=new h;return s.create(e.x,e.y,w.textStyleBoldSmall,w.gameUILayer,this.managers,t.toString()),!1}return!0},E.prototype.boostSmokeLogic=function(e){return e.y+=e.vy*w.elapsedTime/1e3,e.vy-=1,e.vy>0&&(e.vy=0),e.alpha-=.03,e.alpha<=0?!1:!0},E.prototype.specialAim=function(e){if(e.type==F.FIREBALL.type&&0===(7&S.frameCount))c=e.key.substring(16,18),c=c-0+1,c>2&&(c=0),e.frameIndex=c;else if(e.type==F.RAINBOW.type&&0===(3&S.frameCount)){var t=G.near(e,S.bubbleRadius);Math.random()<.5?I.effects.add(v.SPARKLES_RAINBOW,w.gameUILayer,t.x,t.y):I.effects.add(v.SPARKLES_WHITE,w.gameUILayer,t.x,t.y)}},E.prototype.specialFire=function(e){e.type==F.FIREBALL.type?(this.managers.audio.play("snd_fireball"),S.boostCharge=0,S.boostCanCharge=!0,this.world.showBoost(!0)):e.type==F.MINE.type?(this.managers.audio.play("snd_mine"),S.boostCharge=0,S.boostCanCharge=!0,this.world.showBoost(!0)):e.type==F.RAINBOW.type&&(this.managers.audio.play("snd_rainbow"),S.boostCharge=0,S.boostCanCharge=!0,this.world.showBoost(!0))},E.prototype.specialAnim=function(e){if(e.type==F.FIREBALL.type){if(0===(7&S.frameCount)){var t=e.key.substring(16,18);t=t-0+1,t>2&&(t=0),e.frameIndex=t}if(0===(3&S.frameCount)){var s=I.effects.add(v.BOOST_SMOKE,e.parent,e.x,e.y+16,this.boostSmokeLogic,this,!0);s.scale.set(1.25*s.scale.x,s.scale.y)}Math.abs(e.vx)+Math.abs(e.vy)<.5*S.shotSpeed&&e.scale.set(.95*e.scale.x)}else if(e.type==F.RAINBOW.type&&0===(3&S.frameCount)){var i=G.near(e,S.bubbleRadius);Math.random()<.5?I.effects.add(v.SPARKLES_RAINBOW,w.gameUILayer,i.x,i.y):I.effects.add(v.SPARKLES_WHITE,w.gameUILayer,i.x,i.y)}},E.prototype.specialCollide=function(e,t,s){if(e.type==F.FIREBALL.type){for(var i=0,a=t.length;a>i;i++){var n=t[i];if(!s)return!1;if(this.triggerAndPopBubbleFromSprite(n,Math.abs(e.vx)+Math.abs(e.vy)>.75*S.shotSpeed),e.vx*=S.fireBallDeceleration,e.vy*=S.fireBallDeceleration,Math.abs(e.vx)+Math.abs(e.vy)<S.shotSpeed/4)return e.destroy(),!1}return!0}return null},E.prototype.tweenLoadBoost=function(e,t,s){if(e&&t){if(0===e.x&&0===e.y)return e.x=t.x,e.y=t.y,e.scale.set(t.scale),void(s&&s());E.tweenBoost.from.x=e.x,E.tweenBoost.from.y=e.y,E.tweenBoost.from.scaleFactor=e.scale.x,E.tweenBoost.to.x=t.x,E.tweenBoost.to.y=t.y,E.tweenBoost.to.scaleFactor=t.scale,E.tweenBoost.step=G.makeFunctionForSprite(e),e.tweener=new Tweenable,e.tweener.tween(E.tweenBoost),e.tweener.owner=e,e.tweener.callback=s}},E.prototype.tweenLoad=function(e,t,s){if(e&&t){if(0===e.x&&0===e.y)return e.x=t.x,e.y=t.y,e.scale.set(t.scale),void(s&&s());E.tweenSwap1.from.x=e.x,E.tweenSwap1.from.y=e.y,E.tweenSwap1.from.scaleFactor=e.scale.x,E.tweenSwap1.to.x=t.x,E.tweenSwap1.to.y=t.y,E.tweenSwap1.to.scaleFactor=t.scale,E.tweenSwap1.step=G.makeFunctionForSprite(e),e.tweener=new Tweenable,e.tweener.tween(E.tweenSwap1),e.tweener.owner=e,e.tweener.callback=s}},E.prototype.tweenSwap=function(e,t,s){e&&t&&(E.tweenSwap1.from.x=E.tweenSwap2.to.x=e.x,E.tweenSwap1.from.y=E.tweenSwap2.to.y=e.y,E.tweenSwap1.from.scaleFactor=E.tweenSwap2.to.scaleFactor=e.scale.x,E.tweenSwap2.from.x=E.tweenSwap1.to.x=t.x,E.tweenSwap2.from.y=E.tweenSwap1.to.y=t.y,E.tweenSwap2.from.scaleFactor=E.tweenSwap1.to.scaleFactor=t.scale.x,E.tweenSwap1.step=G.makeFunctionForSprite(e),E.tweenSwap2.step=G.makeFunctionForSprite(t),e.tweener=new Tweenable,e.tweener.tween(E.tweenSwap1),e.tweener.owner=e,e.tweener.callback=null,t.tweener=new Tweenable,t.tweener.tween(E.tweenSwap2),t.tweener.owner=t,t.tweener.callback=s)};var P=350;E.tweenSwap1={from:{scaleFactor:1},to:{scaleFactor:1},duration:P,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},E.tweenSwap2={from:{scaleFactor:1},to:{scaleFactor:1},duration:P,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},E.tweenBoost={from:{scaleFactor:1},to:{scaleFactor:1},duration:2*P,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},A.prototype.addPauseAndResumeActions=function(e,t){this._arenaXapi?(this._arenaXapi.addAction("GAME_PAUSE",e),this._arenaXapi.addAction("GAME_RESUME",t)):(window.ARK_game_arena_connector.registerAction("pause",e),window.ARK_game_arena_connector.registerAction("resume",t))},A.prototype.requestMidroll=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"PAUSE_READY",payload:null}):window.ARK_game_arena_connector.fireEventToArena("pause_ready")},A.prototype.handleMidrollStart=function(){},A.prototype.handleMidrollFinish=function(){},A.prototype.sendEventChange=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"EVENT_CHANGE",payload:null}):window.ARK_game_arena_connector.fireEventToArena("event_change")},A.prototype.sendGameStart=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"GAME_START",payload:null}):window.ARK_game_arena_connector.fireEventToArena("game_start")},A.prototype.sendGameEnd=function(e){this._arenaXapi?(this._arenaXapi.dispatch({type:"CHANGE_SCORE",payload:e}),this._arenaXapi.dispatch({type:"GAME_END",payload:null})):(window.ARK_game_arena_connector.changeScore(e),window.ARK_game_arena_connector.fireEventToArena("game_end"))},A.prototype.shouldShowGameEnd=function(){return this._arenaXapi?!0:"true"==window.ARK_game_arena_connector.showGameEnd()},A.prototype.getAbsoluteURL=function(e){return this._arenaXapi?[this._arenaXapi.assetOriginUrl,e].join(""):e},A.prototype.getLocale=function(){return this._arenaXapi?this._arenaXapi.locale:window.ARK_game_arena_connector.getParam("locale","en-US")},A.prototype.destroy=function(){this._arenaXapi&&(this._arenaXapi.removeAction("GAME_PAUSE"),this._arenaXapi.removeAction("GAME_RESUME"))},C.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},C.prototype.destroy=function(){this.pending=0,this.loader=null},C.prototype.addImage=function(e,t){this.loader.add(e,t),w.debugSpam&&console.log("Textures.addImage ",e,t),this.pending++},C.prototype.addAtlas=function(e,t){this.loader.add(e,t),w.debugSpam&&console.log("Textures.addAtlas ",e,t),this.pending++},C.prototype.startLoading=function(e,t){var s=this;w.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,w.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():w.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},C.prototype.loadImage=function(e,t,s,i){w.debugSpam&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){w.debugSpam&&console.log("Texture loaded!"),s.call(i)}).load()},C.prototype.get=function(e,t){if(!PIXI.loader.resources[e])return PIXI.Texture.fromFrame(e);if(PIXI.loader.resources[e].texture)return PIXI.loader.resources[e].texture;if(t)return null;w.debug&&console.log("texture created from canvas",e);var s=PIXI.Texture.fromCanvas(PIXI.loader.resources[e]);return PIXI.loader.resources[e].texture=s,s},C.prototype.set=function(e,t){var s=PIXI.loader.resources[e];s&&s!=t&&(w.debug&&console.log("Textures.set removing image from cache",e),this.remove(e)),w.debug&&console.log("Textures.set adding image to cache",e,t.width,"x",t.height),s=PIXI.loader.resources[e]=t},C.prototype.exists=function(e,t){return PIXI.loader.resources[e]?PIXI.loader.resources[e].texture?!0:!t:!1},C.isCanvas=function(e){return e?e instanceof HTMLCanvasElement||"HTMLCanvasElement"==e.constructor.name||"HTMLCanvasElement"==(e.prototype?e.prototype.constructor:e.constructor).toString():(w.debug&&alert("ERROR: null or undefined object being tested for HTMLCanvasElement!"),!1)},C.prototype.remove=function(e){var t=PIXI.loader.resources[e];return t?t.texture?(C.isCanvas(t.texture)||t.texture.destroy({texture:!0,baseTexture:!0}),t.texture=null,C.isCanvas(t)?w.debug&&console.log("Textures.remove removing a Texture with a Canvas",e):(w.debug&&console.log("Textures.remove removing a Texture",e),t.destroy({texture:!0,baseTexture:!0})),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):(w.debug&&(C.isCanvas(t)?console.log("Textures.remove removing a Canvas",e):console.log("Textures.remove can't remove a null texture",e)),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):void(w.debug&&alert("ERROR: Textures.remove can't remove a null resource",e))},M.prototype.create=function(){this.list=[]},M.prototype.destroy=function(){this.list=null},M.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];w.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var a=this,n=new XMLHttpRequest;return n.overrideMimeType("application/json"),n.open("GET",t,!0),n.onreadystatechange=function(){4==n.readyState&&"200"==n.status&&(i.isReady=!0,i.data=JSON.parse(n.responseText),s&&s(),a.pending--)},n.send(null),this.pending++,i.src=t,i},M.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(w.debug&&console.log("DataManager.get(): data not in cache",e),null)},M.prototype.set=function(e,t){if(this.list[e])return void(w.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return w.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,w.debug&&console.log("DataManager.set(): data added to cache",e)},O.sfxVolume=.75,O.musicVolume=1,O.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.mute=!1,this.tunesMuted=!1,O.sfxVolume=.75,O.musicVolume=.5},O.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null},O.prototype.loadAudio=function(e,t,s){for(var i=[],a=0,n=s.length;n>a;a++)i.push(t+"."+s[a]);this.pending++,w.debugSpam&&console.log("AudioManager.loadAudio "+e+" "+t);var o=this;this.list[e]=new Howl({src:i,onload:function(){o.pending--}})},O.prototype.play=function(e){if(this.mute||w.isAndroid&&w.isChromeMobile)return null;if(Array.isArray(e)){var t=G.randomFromList(e);return this._playOne(t)}return this._playOne(e)},O.prototype._playOne=function(e){if(w.isAndroid&&w.isChromeMobile)return null;if(e&&this.list&&this.list[e]&&w.muteUntil<=w.time){var t=this.list[e];if("loaded"!=t._state)return w.debug&&console.log("AudioManager.playOne "+e+" SFX not loaded!"),null;t.volume(O.sfxVolume);var s=t.play();return w.debug&&(s||console.log("SFX not playable!")),t}return null},O.prototype.playDelayed=function(e,t,s,i){return w.isAndroid&&w.isChromeMobile?null:(Array.isArray(e)&&(e=G.randomFromList(e)),void(e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:w.time+1e3*t,cancelCallback:s,context:i})))},O.prototype.update=function(){if(!w.isAndroid||!w.isChromeMobile)for(var e=w.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];if(s&&s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time))this.delayed.splice(t,1);else if(e>s.time){var i=this.list[s.key];i.play(),this.delayed.splice(t,1)}}},O.prototype.visibilityMute=function(e){w.isAndroid&&w.isChromeMobile||(w.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0))},O.prototype.setMute=function(e,t){if(!w.isAndroid||!w.isChromeMobile){w.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()}},O.prototype.muteTunes=function(e,t){w.isAndroid&&w.isChromeMobile||(w.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus())},O.prototype.startTune=function(e,t,s){w.debug&&console.log("AudioManager.startTune "+e),w.isAndroid&&w.isChromeMobile||(this.gameTune&&this.stopTune(),this.list[e].loop(t?!1:!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(O.musicVolume*w.volumeControl),void 0!==s?this.muteTunes(s,!0):this.muteTunes(this.tunesMuted,!0))},O.prototype.stopTune=function(){w.isAndroid&&w.isChromeMobile||this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},O.prototype.setMusicVolume=function(e){w.isAndroid&&w.isChromeMobile||(O.musicVolume=e,this.gameTune&&this.gameTune.volume(O.musicVolume*w.volumeControl))},O.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0},console.time("Game create"),w.arenaHelper=new A(null),(new w).createGame(),console.timeEnd("Game create")}();