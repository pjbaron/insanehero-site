!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e.touchEvent=!1,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=0,e._debugText=null,window.addEventListener("resize",e.resizeCanvas,!1)}function s(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function a(e){return e?e+"Hidden":"hidden"}function o(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.anchor.set(0,0),this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.updateCallback=null,this.globalScale=null}function r(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0}function h(){this.parent=null,this.managers=null,this.bg=null,this.texts=null,this.icon=null,this.underline=null,this.fields=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.star1=this.star2=this.star3=null}function u(){this.parent=null,this.managers=null,this.text=null}function d(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function p(){this.sprites=null,this.buttons=null,this.texts=null,this.swipeMem=!1,this.highlight=null,this.levelsData=null,this.page=0,this.switchPage=0,this.levelsPerPage=18,this.scrollAppear=0,this.scrollRemove=0,this.lastUnlockedLevel=0}function g(e){n.call(this),this.textures=null,this.type=e||g.TYPE_BUTTON,this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,this.enabled=!1}function b(e){this.levelData=e,this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.page=0,this.title=null,this.icon=null,this.nameText=null,this.nameDesc=null,this.nextPageBtn=null,this.prevPageBtn=null}function m(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[]}function y(){}function f(){this.managers=null,(L.resetLocalStorage||L.generateLevelData)&&localStorage.clear()}function v(){this.strings=null}function _(e,t,s){L.debug&&console.log("FontLoaded loading: "+e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=_.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function x(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function w(e){this.game=e,this.list=null}function S(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e}function L(){L.self=this,L.VERSION="v2.22",L.testKeys=!0,L.debug=!0,L.debugSpam=!1,L.showFPS=!1,L.showLockedCursor=!1,L.fastLevelSwitch=!1,L.generateLevels=!1,L.accessLocked=!0,L.resetLocalStorage=!1,L.challengeMode=!1,L.generateLevelData=!1,L.generateFirstLevel=1,L.generateLastLevel=100,L.numSagaLevels=100,L.pauseOnFocusLoss=!1,L.playAgainCount=0,L.totalShots=0,L.playMidRollAd=!1,L.playMidRollAdAfterPause=!1,L.eventChangeAdOnMatch=!1,L.eventChangeAdOnTitlesShow=!1,L.eventChangeAdOnTitlesClose=!1,L.eventChangeAdOnRotate=!1,L.eventChangeAdOnPopup=!0,L.eventChangeAdOnOptions=!0,L.eventChangeAdOnIdle=0,L.idleTimer=Number.MAX_VALUE,L.timerStart=120999,L.gameWide=1520,L.gameHigh=1310,L.volumeControl=.5,L.shortTapDurationMS=400,L.click=null,L.hover=null,L.mouseDown=null,L.mouseUp=null,L.swipe=0,L.swipeEnabled=!1,L.forceResize=!1,L.resized=!1,L.resizeConsumed=!1,L.time=0,L.elapsedTime=0,L.muteUntil=-1,L.countryCode="en-US",L.nowTime=0,L.repeatedGamesLeft=0,L.aspectRatio=1,L.isPortrait=!1,L.lowResolutionAssets=!1,L.suppressBigAnimations=!1,L.pieceScale=1,L.marginWidth=0,L._lastTime=0,this.gameControl=null,window.devicePixelRatio||(window.devicePixelRatio=1)}function k(){this.preloader=null,this.titles=null,this.game=null,this.bm=null,this.level=1,this.menu=null}function T(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function I(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.menu=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=I.LEVEL_START,this.nextState=-1,this.delay=0,this.foodTotal=0,this.foodCount=0,this.droppedLastFish=!1,I.paused=!1,I.requestQuit=!1,I.requestQuitHandled=!1,L.debug&&console.log("new Game() resetting shotsLeft to zero"),I.shotsLeft=0,I.starScore=0,I.starsPcnt=0,I.stars=0,I.score=0,I.lastScore=0,I.levelType=LevelType.GOAL_PROTECT_BARRIER,LevelType.ConvertNames=[],LevelType.ConvertNames.level_protect_barrier=LevelType.GOAL_PROTECT_BARRIER,LevelType.ConvertNames.level_collect_fish=LevelType.GOAL_RESCUE_FISH,LevelType.ConvertNames.level_hatch_egg=LevelType.GOAL_BREAK_EGG,I.options=null}function B(e){this.game=e,B.effects=null,this.managers=null,this.lastMatchTime=-1,this.shotsText=null,this.fishText=null,this.fishIcon=null,this.fishWidget=null,this.scoreText=null,this.bm=null,this.boostIcon=null,this.endSequence=!1,this.shootBubblesAfter=void 0,this.uiBits=null,this.star1=this.star2=this.star3=null,this.launcherMeter=null,this.launcherRing=null,this.launcherBeam=null,this.launcherButton=null,this.launcherMask=null,this.starMask=null,this.ignoreClick=null,this.usePlayerInput=null,this.playField=null,this.gridCollide=null,this.shooter=null}function M(e,t,s,i){this.game=e,this.managers=t,this.parent=s,this.playField=this.game.world.playField,this.grid=this.playField.grid,this.gridCollide=i,this.sprite=null,this.under_type=null,this.overlay=null,this.vx=0,this.vy=0,this.mx=0,this.my=0,this.wobbleTime=0,this.wobblex=this.wobbley=0,this.updateCallback=null}function E(e){this.game=e,this.grid=null,this.gridCollide=null,this.scrollY=0,this.introScroll=!0,this.scrollBackAllowed=!0,this.scrollDownBonus=!1,this.bg=null,this.uiPanel=null,this.rightBlanker=null,this.topBar=null,this.barrier=null,this.barrierHighlight=null,this.hitGong=!1,this.lowestBubbleY=0,this.explosionList=null,this.resizeChargeBlocker=0,this.looseFall=!1,this.killLoose=!1}function A(e){this.game=e}function C(e,t){void 0!=window.ArenaXApi&&null!=window.ArenaXApi&&(this._arenaXapi=ArenaXApi.init(e,t),this._arenaXapi.dispatch({type:"GAME_REGISTERED",payload:null})),void 0!=window.ARK_game_arena_connector&&window.ARK_game_arena_connector.init()}function F(){this.pending=0,this.loader=null}function O(){this.list=null,this.pending=0}function R(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null,this.playedThisFrame=null}var P=[];P.UNDEFINED={type:-1,name:"undefined",animations:{interval:0,"default":["undefined"]}},P.RED={type:1,name:"bubble_red",normal:!0,animations:{interval:0,"default":["bble_red.png"]}},P.GREEN={type:2,name:"bubble_green",normal:!0,animations:{interval:0,"default":["bble_green.png"]}},P.BLUE={type:3,name:"bubble_blue",normal:!0,animations:{interval:0,"default":["bble_blu.png"]}},P.YELLOW={type:4,name:"bubble_yellow",normal:!0,animations:{interval:0,"default":["bble_orng.png"]}},P.PURPLE={type:5,name:"bubble_purple",normal:!0,animations:{interval:0,"default":["bble_prpl.png"]}},P.RAINBOW={type:6,name:"boost_wild",normal:!0,animations:{interval:0,"default":["bble_wild.png"],boost:["boostIcon_rbow.png"]}},P.FIREBALL={type:20,name:"boost_fireball",normal:!1,animations:{interval:100,"default":["fireball_rotate/00.png","fireball_rotate/01.png","fireball_rotate/02.png"],bonus:["fireball_rotate/00.png"],boost:["boostIcon_flame.png"]}},P.MINE={type:21,name:"boost_mine",normal:!1,animations:{interval:0,"default":["mine.png"],boost:["boostIcon_mine.png"]}},P.ICE={type:50,name:"special_frozen_bubble",normal:!1,animations:{noRepeat:!0,interval:150,"default":["frozen01.png"],cracking:["frozen01.png","frozen02.png","frozen03.png","frozen04.png","frozen05.png","frozen06.png","frozen07.png"]}},P.BOMB={type:51,name:"special_bomb",normal:!1,animations:{randomise:!0,interval:250,"default":["bomb_spark/bomb00.png","bomb_spark/bomb01.png","bomb_spark/bomb02.png"],waiting:["bombWait.png"]}},P.ROCKET={type:52,name:"special_rocket",normal:!1,animations:{noRepeat:!0,interval:100,"default":["rocket.png"]}},P.EGG={type:53,name:"goal_egg",normal:!1,animations:{noRepeat:!0,interval:150,"default":["collect_egg.png"],cracking:["egg_crack/00.png","egg_crack/01.png","egg_crack/02.png","egg_crack/03.png","egg_crack/04.png","egg_crack/05.png"]}},P.FISH={type:54,animations:{noRepeat:!0,interval:150,"default":["collect_fish.png"]}},P.DRAGON_EGG={type:60,normal:!1,animations:{interval:250,"default":["gold_flying/00.png","gold_flying/01.png","gold_flying/02.png","gold_flying/01.png"]}},P.DRAGON_PURPLE={type:61,name:"special_carry_bubble",normal:!1,animations:{interval:200,"default":["special_dragon_grab.png"],flying:["purple_flying/00.png","purple_flying/01.png","purple_flying/02.png","purple_flying/01.png"],gliding:["purple_glide_02.png","purple_glide_03.png","purple_glide_02.png","purple_glide_04.png"]}},P.DRAGON_ORANGE={type:62,name:"special_burst_bubble",normal:!1,animations:{interval:100,"default":["special_dragon_pop.png"],flying:["orange_flying/00.png","orange_flying/01.png","orange_flying/02.png","orange_flying/01.png"],shooting:["orange_fireBlow/00.png","orange_fireBlow/01.png","orange_fireBlow/01.png","orange_fireBlow/02.png","orange_fireBlow/03.png","orange_fireBlow/04.png","orange_fireBlow/04.png","orange_fireBlow/05.png","orange_fireBlow/05.png"]}},P.DRAGON_BLUE={type:100,name:"boost_convert_dragon",animations:{interval:200,"default":["blue_flying/00.png"],flying:["blue_flying/00.png","blue_flying/01.png","blue_flying/02.png","blue_flying/01.png"],shooting:["blue_shake/00.png","blue_shake/01.png","blue_shake/02.png","blue_shake/03.png","blue_shake/00.png"],boost:["boostIcon_bluDrag.png"]}},P.PLUS5={type:101,name:"boost_extra_moves",animations:{interval:0,"default":["5plus.png"],boost:["5plus.png"]}},P.EFFECT_POP_BUBBLE={type:200,animations:{noRepeat:!0,interval:50,"default":["zzz_explosion/0000","zzz_explosion/0001","zzz_explosion/0002","zzz_explosion/0003","zzz_explosion/0004","zzz_explosion/0005","zzz_explosion/0006","zzz_explosion/0007","zzz_explosion/0008","zzz_explosion/0009","zzz_explosion/0010","zzz_explosion/0011","zzz_explosion/0012","zzz_explosion/0013","zzz_explosion/0014","zzz_explosion/0015","zzz_explosion/0016","zzz_explosion/0017","zzz_explosion/0018"]}},P.EFFECT_FALL_BUBBLE={type:201,animations:{noRepeat:!0,interval:2e4,"default":["bble_red.png"]}},P.EFFECT_DROP_FISH={type:202,animations:{interval:150,"default":["fish/fish_00.png","fish/fish_01.png","fish/fish_02.png","fish/fish_01.png"]}},P.EFFECT_EXPLOSION={type:203,animations:{noRepeat:!0,interval:50,"default":["00.png","01.png","02.png","03.png","04.png","05.png","06.png","07.png"]}},P.EFFECT_ROCKET_SMOKE={type:206,animations:{noRepeat:!0,interval:250,"default":["rocket_smoke/00.png","rocket_smoke/01.png","rocket_smoke/02.png"]}},P.EFFECT_ROCKET_FIRE={type:207,animations:{interval:150,"default":["rocket_fire/00.png","rocket_fire/01.png","rocket_fire/02.png"]}},P.EFFECT_DRAGON_FLAME_JET={type:208,animations:{noRepeat:!0,interval:100,"default":["orange_fireball/00.png","orange_fireball/01.png","orange_fireball/02.png"]}},P.EFFECT_BOOST_SMOKE={type:209,animations:{noRepeat:!0,interval:250,"default":["fireball_smoke/00.png","fireball_smoke/01.png","fireball_smoke/02.png"]}},P.EFFECT_DRAGON_LIGHTNING={type:210,animations:{noRepeat:!0,interval:150,"default":["blue_lightning/00.png","blue_lightning/01.png","blue_lightning/02.png"]}},P.EFFECT_FISH_SPLASH={type:211,animations:{noRepeat:!0,interval:75,"default":["fishSplash_01.png","fishSplash_02.png","fishSplash_03.png","fishSplash_04.png","fishSplash_05.png"]}},P.EFFECT_FAKE_BUBBLE={type:213,animations:{interval:0,"default":["bble_red.png"]}},P.EFFECT_SPARKLES_WHITE={type:214,animations:{noRepeat:!0,interval:100,"default":["sparkles_white/sparkleWhite_00.png","sparkles_white/sparkleWhite_01.png","sparkles_white/sparkleWhite_02.png","sparkles_white/sparkleWhite_03.png"]}},P.EFFECT_SPARKLES_RAINBOW={type:215,animations:{noRepeat:!0,interval:120,"default":["sparkles_rainbow/sprkleRnbw_00.png","sparkles_rainbow/sprkleRnbw_01.png","sparkles_rainbow/sprkleRnbw_02.png","sparkles_rainbow/sprkleRnbw_03.png"]}},P.EFFECT_STAR={type:216,animations:{interval:0,"default":["hud_star.png"]}},P.LAUNCHER_METER={type:300,animations:{interval:0,"default":["launchMeter.png"]}},P.CEILING_BEAM={type:301,animations:{interval:250,"default":["ceiling/00.png","ceiling/01.png","ceiling/02.png"]}},P.PRELOADER={type:400,key:"load_spinner"},function(){for(var e in P)void 0!==P[e].type&&(P[P[e].type]=P[e]),void 0!==P[e].name&&(P[P[e].name]=P[e])}(),e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.touchDownHandler),t.plugins.interaction.on("touchmove",e.touchMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.touchUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){L.click=e.mouseToStage(t.data.global.x,t.data.global.y),L.mouseMoveLocal=t.data.getLocalPosition(L.gameUILayer),L.mouseUpLocal=t.data.getLocalPosition(L.gameUILayer),L.debug&&console.log("EventHandlers.inputClickHandler")},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(Math.abs(e.deltaX)>=20?(L.swipe=e.deltaX,L.debug&&console.log("swipe detected = "+L.swipe)):L.swipe=0)},e.mouseOutHandler=function(){L.mouseOut=!0},e.mouseMoveHandler=function(t){return e.touchEvent=!1,e.touchMoveHandler(t)},e.touchMoveHandler=function(t){L.mouseOut&&(L.mouseOut=!1),L.hover=e.mouseToStage(t.data.global.x,t.data.global.y),L.mouseMoveLocal=t.data.getLocalPosition(L.gameUILayer),e._mouseSwipeStart&&L.swipeEnabled&&N.distanceBetween(e._mouseSwipeStart,L.hover)>=e.swipeDistance&&L.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:L.hover.x-e._mouseSwipeStart.x,deltaY:L.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,L.mouseDown=null)},e.touchDownHandler=function(t){e.touchEvent=!0,e.mouseDownHandler(t),L.mouseMoveLocal=L.mouseDownLocal},e.mouseDownHandler=function(t){e._showDebugWindowData&&e._showDebugWindowData<L.nowTime&&(e._debugText.destroy(),e._debugText=null,e._showDebugWindowData=0),e._mouseDownWhen=L.nowTime,L.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),L.mouseDownLocal=t.data.getLocalPosition(L.gameUILayer),!e._mouseSwipeStart&&L.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",L.mouseDown.x,L.mouseDown.y)},e.touchUpHandler=function(t){e.touchEvent=!0,e.mouseUpHandler(t),L.mouseMoveLocal=L.mouseUpLocal},e.mouseUpHandler=function(t){var s=0;L.mouseUp&&L.mouseDown&&(s=N.distanceBetween(L.mouseUp,L.mouseDown)),L.mouseDown&&(!L.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||L.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(L.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),L.mouseUpLocal=t.data.getLocalPosition(L.gameUILayer),L.mouseUp&&L.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:L.mouseUp.x-L.mouseDown.x,deltaY:L.mouseUp.y-L.mouseDown.y}))),e._mouseDownWhen=0,L.mouseDown=null,L.mouseDownLocal=null,e._mouseSwipeStart=null},e.resizeCanvas=function(){L.HTMLElement?(L.width!=L.HTMLElement.clientWidth||L.height!=L.HTMLElement.clientHeight)&&e._internalResize(L.HTMLElement.clientWidth,L.HTMLElement.clientHeight):(L.width!=window.innerWidth||L.height!=window.innerHeight)&&e._internalResize(window.innerWidth,window.innerHeight)},e._internalResize=function(e,t){L.resizeTime=L.nowTime,L.width=e,L.height=t,L.resized=!0,L.resizeConsumed=!1,L.forceResize=!1,L.aspectRatio=L.width/L.height,L.isPortrait=L.aspectRatio+1e-5<1.33,L.lowResolutionAssets=Math.max(L.width,L.height)<640||Math.min(L.width,L.height)<480},e.resizeContent=function(){L.aspectRatio=L.width/L.height,L.isPortrait=L.aspectRatio+1e-5<4/3,L.lowResolutionAssets=Math.max(L.width,L.height)<640||Math.min(L.width,L.height)<480,L.renderer.resize(L.width,L.height),L.stage.x=Math.round(L.width/2),L.stage.y=Math.round(L.height/2);var e=L.width/L.gameWide,t=L.height/L.gameHigh,s=Math.max(e,t);L.bgImage.scale.set(s);var i="landscape";L.isPortrait&&(i="portrait");var a=Math.round(4*L.height/3),o=Math.round(a*L.shiftPlayfield),n=a-o,r=n/I.width,l=r/I.bubbleDiameter,h={portrait:L.width/(2*I.sideBarOffset),landscape:l},u={portrait:0,landscape:(L.width-a)/2},c={portrait:0,landscape:u.landscape+o+n/2-L.width/2},d={portrait:L.width,landscape:n},p={portrait:L.width,landscape:a};L.bubbleLayer.scale.set(h[i]),L.gameUILayer.scale.set(h[i]),L.backgroundLayer.scale.set(h[i]),L.bubbleLayer.x=L.gameUILayer.x=L.backgroundLayer.x=c[i],L.marginWidth=u[i],L.backgroundLayer.bubbleAreaWidth=d[i],L.bottomUI.rectWidth=L.topUI.rectWidth=p[i],L.topUI.x=0,L.bottomUI.x=0,L.bottomUI.texture&&!L.bottomUI.texture.noFrame&&L.topUI.texture&&!L.topUI.texture.noFrame&&(L.bottomUI.width=L.bottomUI.rectWidth,L.bottomUI.height=L.height,L.bottomUI.y=L.bottomUI.parent.y,L.topUI.width=L.topUI.rectWidth,L.topUI.height=L.height,L.topUI.y=-L.topUI.parent.y),L.fullUI.scale.set(Math.min(e*L.fullUIScale,t*L.fullUIScale)),L.debug&&(console.log("\nBubble Dragons",L.width,"x",L.height),console.log("aspectRatio:",L.aspectRatio,L.isPortrait?"portrait":"landscape"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",L.lowResolutionAssets?"low":"high"),console.log("View ratio: ",e,":",t),console.log("stage offset: ",L.stage.x,",",L.stage.y,"\n"))},e.registerCallback=function(t,s,i){L.debugSpam&&console.log("registerCallback for",t),e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var a=e.callbackList.length-1;a>=0;--a){var o=e.callbackList[a];o.event==t&&(L.debugSpam&&console.log("triggerCallback for",t),o.callback.call(o.arg.context,s,i,o.arg.args))}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var a=e.callbackList[i];if(a.event==t&&a.callback==s){e.callbackList.splice(i,1),L.debugSpam&&console.log("clearCallback for",t);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=L.width/L.gameWide,s=L.height/L.gameHigh,i="aspectRatio: "+L.aspectRatio+" "+(L.isPortrait>=1?"portrait":"landscape")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(L.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var a=new r(i,L.textStyleMediumTiny);a.create(L.topUI,-0.45,.25,!0),a.anchor.y=1,e._debugText=a,e._showDebugWindowData=L.nowTime+5e3}};var G={};G.isPressed=null,G.edgeDown=null,G.edgeUp=null,G.debug=!1,G.create=function(e){G.debug=e||!1,G.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",G.keyDown,!0):document.addEventListener?document.addEventListener("keydown",G.keyDown,!0):window.addEventListener?window.addEventListener("keydown",G.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",G.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",G.keyUp,!0):document.addEventListener?document.addEventListener("keyup",G.keyUp,!0):window.addEventListener?window.addEventListener("keyup",G.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",G.keyUp)},G.destroy=function(){G.isPressed=null,G.edgeDown=null,G.edgeUp=null},G.update=function(){return!0},G.reset=function(e){void 0===e?(G.isPressed=[],G.edgeDown=[],G.edgeUp=[]):(G.isPressed[e]=!1,G.edgeDown[e]=!1,G.edgeUp[e]=!1)},G.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(L.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},G.keyDown=function(e){e.preventDefault();var t=G.getCode(e);G.isPressed[t]||(G.edgeDown[t]=!0),G.isPressed[t]=!0},G.keyUp=function(e){e.preventDefault();var t=G.getCode(e);G.isPressed[t]&&(G.edgeUp[t]=!0),G.isPressed[t]=!1};var U={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},N={};N.limit=function(e,t,s){return e>=0?Math.min(e,t):Math.max(e,-s)},N.countInList=function(e,t){for(var s=0,i=0,a=e.length;a>i;i++)e[i]==t&&s++;return s},N.formatBigNumber=function(e){var t=e.toString();if(t.length<=3)return t;for(var s=t.length-3;s>0;s-=3)t=t.slice(0,s)+","+t.slice(s);return t},N.sign0=function(e){return e>0?1:0>e?-1:0},N.near=function(e,t){return{x:e.x+2*Math.random()*t-t,y:e.y+2*Math.random()*t-t}},N.removeFromIndexedList=function(e,t,s,i,a){if(e)for(var o=0,n=e.length;n>o;o++){var r=t(e,o);if((s&&r[s]==i||!s&&r==i)&&(e.splice(o,1),!a))return e}return e},N.findPointInList=function(e,t,s){if(t)for(var i,a=0,o=t.length;o>a;a++)if(i=void 0===s?t[a]:t[a][param],i&&i.x==e.x&&i.y==e.y)return a;return-1},N.findNearestPointInList=function(e,t,s){var i=Number.POSITIVE_INFINITY,a=-1;if(t)for(var o,n=0,r=t.length;r>n;n++)if(o=void 0===s?t[n]:t[n][param]){var l=o.x-e.x,h=o.y-e.y,u=l*l+h*h;i>u&&(i=u,a=n)}return a},N.weightedPickRandomFromList=function(e,t,s){s||(s=Math.random);var i,a,o=0;for(i=0,a=t.length;a>i;i++)o+=t[i];var n=s()*o,r=0;for(i=0;a>i;i++)if(r+=t[i],r>=n)return e[i];return e[a-1]},N.pickRandomFromList=function(e,t){if(t||(t=Math.random),!e||0===e.length)return null;var s=Math.floor(t()*e.length);return e[s]},N.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},N.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},N.distance=function(e,t,s,i){var a=s-e,o=i-t;return Math.sqrt(a*a+o*o)},N.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},N.distanceBetweenScaled=function(e,t,s,i){var a=(t.x-e.x)*s,o=(t.y-e.y)*i;return Math.sqrt(a*a+o*o)},N.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var a,o=i/2,n=N.normaliseAnglePositive(e-t+i,i);return a=n>o?e+Math.min(i-n,s):0!==n?e-Math.min(n,s):t,N.normaliseAngle(a,i)},N.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},N.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},N.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,a=e.length;a>i;i++)if(e[i][t]==s)return i;return-1},N.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},N.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),a=(Math.floor(t)%60).toString();return a.length<2&&(a="0"+a),i+":"+a},N.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},N.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},N.makeFunctionForSprite=function(e){return function(t){N.setValuesFromObject(e,t)}},N.focusChangeCallback=null,N.focusChangeContext=null,N._visListener=!1,N._hidden=!1,N._focusIn=function(){N._hidden=!1,L.debug&&console.log("Utils._focusIn hidden =",N._hidden),N.focusChangeContext&&N.focusChangeCallback&&N.focusChangeCallback.call(N.focusChangeContext,N._hidden)},N._focusOut=function(){N._hidden=!0,L.debug&&console.log("Utils._focusOut hidden =",N._hidden),N.focusChangeContext&&N.focusChangeCallback&&N.focusChangeCallback.call(N.focusChangeContext,N._hidden)},N.detectHidden=function(){if(!N._visListener){var e=s(),t=a(e),i=o(e);document.addEventListener(i,function(){document[t]?N._focusOut():N._focusIn()}),window.addEventListener("focus",N._focusIn,!1),window.addEventListener("blur",N._focusOut,!1),N._visListener=!0}},N.isHidden=function(){return document.hidden},N.blanker=null,N.addBlanker=function(e){return null!==N.blanker?void N.blanker.instances++:(N.blanker=new n,N.blanker.create(L.fullUI,"blanker",e,0,0),N.blanker.anchor.set(.5),N.blanker.scale.set(40),void(N.blanker.instances=1))},N.removeBlanker=function(){N.blanker&&(N.blanker.instances--,N.blanker.instances<=0&&(N.blanker.destroy(),N.blanker=null))},Math.rnd=function(e){return function(){e=1e4*Math.sin(e);var t=e-Math.floor(e);return t}},Math.mySeed=function(e){0===e&&(e=1),Math.myRandom=Math.rnd(e)};var D={};D.score=0,D.history=[],D.overrideSeeds=[{level:5,seed:11.1},{level:50,seed:100}],D.difficultyPower=2.5,D.difficultyScaler=1e3,D.difficultyMin=10,D.minimumShots=[0,0,10,18,22,25],D.maximumShots=45,D.minimumHeight=11,D.maximumHeightSoftCap=50,D.standardHeight=14,D.holesMultiplier=3,D.standardHoles=20,D.levelTypeMultiplier=18,D.levelTypeScores={level_hatch_egg:5,level_collect_fish:7,level_protect_barrier:10},D.specialTypeMultiplier=.15,D.specialScores={special_bomb:-7,special_rocket:-10,special_burst_dragon:-4,special_frozen_bubble:2.5,special_carry_dragon:3},D.boostTypeMultiplier=2,D.boostScores={boost_mine:-7,boost_fireball:-9,boost_wild:-2,boost_convert_dragon:-5,boost_extra_moves:-10},D.standardBoostFull=100,D.standardBoostGain=20,D.minBoostFull=20,D.maxBoostFull=200,D.minBoostGain=5,D.maxBoostGain=40,D.boostFullMultiplier=1,D.boostGainMultiplier=8,D.maxBombs=40,D.maxRockets=30,D.maxBurstDragons=20,D.maxFrozen=50,D.maxCarryDragons=20,D.shotsMultiplier=-4,D.heightMultiplier=7,D.holesNumberMultiplier=-.5,D.goalFishMultiplier=8,D.standardFish=8,D.minFish=6,D.maxFish=15,D.minScrollSpeed=5,D.maxScrollSpeed=18,D.scrollSpeedMultiplier=20,D.numColourScores=[-1,-200,-50,0,75,150],D.createLevelData=function(e){e+=1;var t=D.findOverrideSeed(e)||e;Math.mySeed(t);var s=D.getDesiredDifficulty(e),i=Math.floor(s*D.difficultyScaler+D.difficultyMin);return D.createLevelWithDifficulty(e,i)},D.createLevelWithDifficulty=function(e,t){var s,i,a,o,n,r,l,h=D.standardHoles,u=D.standardFish,c=2,d=D.numColourScores.length-1;switch(1>=e?d=2:10>e?d=3:25>e?d=4:c=3,l=Math.floor((c+d)/2),i=D.pickLevelType(e),a=D.pickSpecials(e),o=D.pickBoost(e),n=D.chooseHeight(t,"level_protect_barrier"==i),r=D.chooseShots(t,n,l),i){case"level_hatch_egg":s=N.pickRandomFromList(["game_bg3","game_bg6"],Math.myRandom);break;case"level_collect_fish":s=N.pickRandomFromList(["game_bg2","game_bg5"],Math.myRandom);break;case"level_protect_barrier":s=N.pickRandomFromList(["game_bg1","game_bg4"],Math.myRandom),r=D.maximumShots}var p={_score:0,_difficulty:t,_level:e,_id:i,BackgroundImage:s,width:12,height:10,symmetry:[{x:6,pcnt:20}],holes:{seed:1,number:1,symmetry:[{x:6,pcnt:100}]},list:[],boost:{id:"boost_mine",cost:120,gain:10},boostFullBar:D.standardBoostFull,boostGainCost:D.standardBoostGain,specials:[],turns:10};switch(i){case"level_hatch_egg":break;case"level_collect_fish":p.goal_fish={count:D.standardFish,min:120,max:500};break;case"level_protect_barrier":p.scroll_speed=I.survivalSpeed}for(var g;;){p.height=n,p.holes.number=h,p.boost=o,p.list.length!=l&&(p.list=D.buildColourBubbleList(l)),p.turns=r,p.goal_fish&&(p.goal_fish.count=u),a&&a.length>0&&(p.specials=a);var b=D.calculateScore(p);if(g=t-b,L.debugSpam&&console.log("CreateLevelData.scores difficulty = "+t+" score = "+(t-g)),Math.abs(g)<=.1*t){p._score=b;break}if(g>0)switch(Math.floor(11*Math.myRandom())){case 0:if(g>20&&d>l){l++,r<D.minimumShots[l]&&(r=D.minimumShots[l]);break}case 1:if(r>D.minimumShots[l]){r--;break}case 2:case 3:if(h>0){h--;break}case 4:if(n<D.maximumHeightSoftCap){n++;break}case 5:if(D.changeNumberOfSpecials(p.specials,!0,-1))break;case 6:if(D.changeNumberOfSpecials(p.specials,!1,1))break;case 7:if("level_protect_barrier"==p._id&&p.scroll_speed<D.maxScrollSpeed){p.scroll_speed+=1;break}case 8:if(p.goal_fish&&u<D.maxFish){u++;break}case 9:if(p.boostFullBar<=D.maxBoostFull-10){p.boostFullBar+=10;break}case 10:if(p.boostGainCost<D.maxBoostGain){p.boostGainCost+=1;break}}else switch(Math.floor(12*Math.myRandom())){case 0:if(-20>g&&l>c&&(l--,r<D.minimumShots[l])){r=D.minimumShots[l];break}case 1:if(n>D.minimumHeight){n--;break}case 2:case 3:case 4:if(h<n*D.holesMultiplier){h++;break}case 5:var m=Math.max(r-D.maximumShots,0)/10;if(Math.myRandom()>=m){r++;break}case 6:if(D.changeNumberOfSpecials(p.specials,!0,1))break;case 7:if(D.changeNumberOfSpecials(p.specials,!1,-1))break;case 8:if("level_protect_barrier"==p._id&&p.scroll_speed>D.minScrollSpeed){p.scroll_speed-=1;break}case 9:if(p.goal_fish&&u>D.minFish){u--;break}case 10:if(p.boostFullBar>=D.minBoostFull+9){p.boostFullBar-=9;break}case 11:if(p.boostGainAmount>D.minBoostGain){p.boostGainAmount-=1;break}}}for(D.history.push(p);D.history.length>5;)D.history.shift();return L.debug&&console.log("CreateLevelData.createLevelData data:",p),p},D.removeLastHistory=function(){D.history&&D.history.length>0&&D.history.pop()},D.calculateScore=function(e){var t=D.levelTypeScores[e._id]*D.levelTypeMultiplier;t+=D.numColourScores[e.list.length],t+=(e.turns-D.minimumShots[e.list.length])*D.shotsMultiplier,t+=(e.height-D.standardHeight)*D.heightMultiplier,t+=(e.boostFullBar-D.standardBoostFull)*D.boostFullMultiplier,t+=(e.boostGainCost-D.standardBoostGain)*D.boostGainMultiplier,t+=D.boostScores[e.boost.id]*D.boostTypeMultiplier,t+=e.holes.number*D.holesNumberMultiplier;for(var s in e.specials){var i=Object.keys(e.specials[s]),a=e.specials[s][i[0]].number;t+=D.specialScores[i[0]]*a*D.specialTypeMultiplier}return"level_collect_fish"==e._id&&(t+=e.goal_fish.count*D.goalFishMultiplier),"level_protect_barrier"==e._id&&(t+=(e.scroll_speed-I.survivalSpeed)*D.scrollSpeedMultiplier),t},D.chooseHeight=function(e,t){var s=D.standardHeight,i=.0125,a=1.3,o=Math.floor(s+e*i);return t?(L.debugSpam&&console.log("CreateLevelData.chooseHeight = "+o*a),Math.floor(o*a)):(L.debugSpam&&console.log("CreateLevelData.chooseHeight = "+o),o)},D.chooseShots=function(e,t,s){var i=D.minimumShots[s],a=.2,o=.01,n=i+Math.floor(t*a)-Math.floor(e*o);return n=Math.max(n,i),L.debugSpam&&console.log("CreateLevelData.chooseShots = "+n),n},D.pickLevelType=function(e){var t,s,i=[],a=["level_hatch_egg"];for(e>=3&&a.push("level_collect_fish"),e>=6&&a.push("level_protect_barrier"),t=0,s=a.length;s>t;t++){var o=D.countHistory("_id",a[t],4),n=3-Math.min(o,3);i[t]=n*n}var r=N.weightedPickRandomFromList(a,i,Math.myRandom);return L.debugSpam&&console.log("CreateLevelData.pickLevelType from "+a+" with weights "+i+" picked "+r),r
},D.pickSpecials=function(e){var t=[];if(e>=2&&t.push("special_rocket"),e>=6&&t.push("special_bomb"),e>=10&&t.push("special_frozen_bubble"),e>=15&&t.push("special_burst_dragon"),e>=20&&t.push("special_carry_dragon"),0===t.length)return null;var s=1;e>20&&(s+=Math.floor(Math.min(Math.myRandom()*Math.pow(e-20,.5)/2,3)));var i,a=[];for(i=0;s>i;i++){var o=D.pickSpecialType(t),n={};n[o]={number:10,min:100,max:500},a.push(n)}return L.debugSpam&&console.log("CreateLevelData.pickSpecials from "+t+" picked ",a),a},D.pickSpecialType=function(e){var t,s,i=[];for(t=0,s=e.length;s>t;t++){var a=D.countHistoryList("specials",e[t],4),o=3-Math.min(a,3);i[t]=o*o}return N.weightedPickRandomFromList(e,i,Math.myRandom)},D.pickBoost=function(e){var t=[],s=["boost_mine"];e>=3&&s.push("boost_fireball"),e>=8&&s.push("boost_wild"),e>=25&&s.push("boost_convert_dragon"),e>=30&&s.push("boost_extra_moves");var i,a;for(i=0,a=s.length;a>i;i++){var o=D.countHistoryObject("boost","id",s[i],4),n=3-Math.min(o,3);t[i]=n*n}var r=N.weightedPickRandomFromList(s,t,Math.myRandom),l={id:r,cost:110,gain:20};return L.debugSpam&&console.log("CreateLevelData.pickBoost from "+s+" with weights "+t+" picked ",l),l},D.buildColourBubbleList=function(e){L.debugSpam&&console.log("CreateLevelData.buildColourBubbleList "+e);var t,s=["bubble_blue","bubble_green","bubble_yellow","bubble_red","bubble_purple"],i=[];for(t=0;e>t;t++){var a=Math.floor(Math.myRandom()*s.length);i.push(s[a]),L.debugSpam&&console.log("CreateLevelData.buildColourBubbleList "+s[a]),s.splice(a,1)}return i},D.countHistoryList=function(e,t,s){var i,a,o=0;for(i=0,a=D.history.length;a>i&&s>i;i++){var n=D.history[a-i-1];if(n[e]){var r,l;for(r=0,l=n[e].length;l>r;r++)n[e][r]&&void 0!==n[e][r][t]&&o++}}return o},D.countHistoryObject=function(e,t,s,i){var a,o,n=0;for(a=0,o=D.history.length;o>a&&i>a;a++)D.history[o-a-1][e][t]==s&&n++;return n},D.countHistory=function(e,t,s){var i,a,o=0;for(i=0,a=D.history.length;a>i&&s>i;i++)D.history[a-i-1][e]==t&&o++;return o},D.getDesiredDifficulty=function(e){var t=30,s=.25*Math.min(Math.floor(e/t),3),i=e%t,a=20,o=.0333,n=.5,r=(i*a+270)*Math.PI/180,l=Math.sin(r)*n+n;return l+=o*i+s,Math.pow(l/3,D.difficultyPower)},D.changeNumberOfSpecials=function(e,t,s){if(!e||0===e.length)return!1;var i,a,o=[];for(i=0,a=e.length;a>i;i++){var n=e[i];t?(n.special_bomb&&o.push({ref:n.special_bomb,min:0,max:D.maxBombs}),n.special_rocket&&o.push({ref:n.special_rocket,min:0,max:D.maxRockets}),n.special_burst_dragon&&o.push({ref:n.special_burst_dragon,min:0,max:D.maxBurstDragons})):(n.special_frozen_bubble&&o.push({ref:n.special_frozen_bubble,min:0,max:D.maxFrozen}),n.special_carry_dragon&&o.push({ref:n.special_carry_dragon,min:0,max:D.maxCarryDragons}))}for(;o.length>0;){var r=N.pickRandomFromList(o,Math.myRandom),l=r.ref.number+s;if(l>=r.min&&l<=r.max)return r.number+=s,!0;o.splice(o.indexOf(r),1)}return!1},D.findOverrideSeed=function(e){var t,s;for(t=0,s=D.overrideSeeds.length;s>t;t++)if(D.overrideSeeds[t].level==e)return D.overrideSeeds[t].seed;return null},D.createAllData=function(){console.log("***** start of level data *****"),console.log('\n{\n"levels":\n[\n');var e;for(e=L.generateFirstLevel-1;e<=L.generateLastLevel-1;e++){var t=D.createLevelData(e);console.log(JSON.stringify(t)+(e<L.generateLastLevel-1?",":""))}console.log("\n]\n}\n"),console.log("*****  end of level data  *****")},function(){var e=this,t=function(e){return e instanceof t?e:this instanceof t?void(this._wrapped=e):new t(e)};if(t.userAgent=null,t.getUserAgent=function(){return this.userAgent},t.setUserAgent=function(e){this.userAgent=e},t.isAndroid=function(){return this.getUserAgent().match(/Android/i)},t.isBlackBerry=function(){return this.getUserAgent().match(/BlackBerry/i)},t.isBlackBerryPlayBook=function(){return this.getUserAgent().match(/PlayBook/i)},t.isBlackBerry10=function(){return this.getUserAgent().match(/BB10/i)},t.isIOS=function(){return this.isIPhone()||this.isIPad()||this.isIPod()},t.isIPhone=function(){return this.getUserAgent().match(/iPhone/i)},t.isIPad=function(){return this.getUserAgent().match(/iPad/i)},t.isIPod=function(){return this.getUserAgent().match(/iPod/i)},t.isOpera=function(){return this.getUserAgent().match(/Opera Mini/i)},t.isWindows=function(){return this.isWindowsDesktop()||this.isWindowsMobile()},t.isWindowsMobile=function(){return this.getUserAgent().match(/IEMobile/i)},t.isWindowsDesktop=function(){return this.getUserAgent().match(/WPDesktop/i)},t.isFireFox=function(){return this.getUserAgent().match(/Firefox/i)},t.isNexus=function(){return this.getUserAgent().match(/Nexus/i)},t.isKindleFire=function(){return this.getUserAgent().match(/Kindle Fire/i)},t.isPalm=function(){return this.getUserAgent().match(/PalmSource|Palm/i)},t.isAny=function(){var e=!1,s=Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]});for(var i in s)if("setUserAgent"!==s[i]&&"getUserAgent"!==s[i]&&"isAny"!==s[i]&&"isWindows"!==s[i]&&"isIOS"!==s[i]&&t[s[i]]()){e=!0;break}return e},("function"==typeof window||"object"==typeof window)&&t.setUserAgent(navigator.userAgent),"undefined"!=typeof exports){var s=function(e){return e=void 0===e?!0:e,e?function(e,s,i){var a=e.headers["user-agent"]||"";t.setUserAgent(a),e.SmartPhone=t,"function"==typeof s.locals?s.locals({SmartPhone:t}):s.locals.SmartPhone=t,i()}:t};"undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports=s}else e.SmartPhone=t}.call(this),n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,a,o,n){this.textures=s,this.animation="default",this.frameIndex=0,this.atEnd=!1,this.animInterval=0,this.animNextTick=0,this.taskDone=!1,this.setType(t),this.myFilters=null,this.destroyTexture=!1,this.updateCallback=null,this.key&&(this.texture=this.textures.get(this.key),!this.texture&&L.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+this.key)),n?e.addChildAt(this,0):e.addChild(this),o?(this.pcntx=i||0,this.pcnty=a||0):(this.x=i||0,this.y=a||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.globalScale=null,this.texture&&this.destroyTexture&&this.texture.destroy({texture:!0,baseTexture:!0}),this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this),this.parent=null},n.prototype.update=function(e){return this._texture&&!this._texture.orig&&console.log("_texture has no orig! "+this.key),L.resized&&(this.getGlobalScale(!0),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),L.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),0!==this.animInterval&&0!==this.animNextTick&&L.nowTime>=this.animNextTick&&(this.animNextTick=L.nowTime+this.animInterval,this.frameIndex++,this.frameIndex>=P[this.type].animations[this.animation].length&&(this.atEnd=!0,this.frameIndex=this.noRepeat?P[this.type].animations[this.animation].length-1:0),this.setFrame(P[this.type].animations[this.animation][this.frameIndex])),this.updateCallback&&this.updateCallback(this),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setAnimation=function(e,t,s){if(s||this.animation!=e){this.animation=e,this.atEnd=!1,t||(this.frameIndex=0);var i=P[this.type].animations;if(i)return this.setFrame(i[this.animation][this.frameIndex]),this.noRepeat=i.noRepeat,this.animInterval=i.interval,this.animNextTick=i.randomise?L.nowTime+Math.floor(this.animInterval*Math.random()):L.nowTime+this.animInterval,!0}return!1},n.prototype.setFrame=function(e,t){return(t||this.key!=e)&&(this.key=e,this.key)?(this.texture=this.textures.get(e),!0):!1},n.prototype.setType=function(e){e!=this.type&&(this.type=e,this.animation="default",this.animInterval=0,this.animNextTick=0,this.frameIndex=0,this.atEnd=!1),P[this.type]?this.setAnimation(this.animation,!0,!0)||(P[this.type].key?this.setFrame(P[this.type].key):console.error("ERROR: Sprite.create there is no key or animations for _type: '"+e+"'!")):this.setFrame(this.type)},n.prototype.moveToFront=function(){var e=this.parent;e.removeChild(this),e.addChildAt(this,e.children.length-1)},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),a=this.pickerMaskData[s+i*this.texture.frame.width*4];return a?!0:!1},n.prototype.createCanvasFromTexture=function(){var e=document.createElement("canvas");e.width=this.texture.frame.width,e.height=this.texture.frame.height;var t=e.getContext("2d");return t.drawImage(this.texture.baseTexture.source,this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),e},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,a,o){this.fader=new x,this.fader.setFade(e,t,s,i,a,o)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return L.renderer.render(this,e),L.renderer.extract.pixels(e)},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&(this.x=this.parent.texture.noFrame?e/this.parent.scale.x*L.width:e/this.parent.scale.x*this.parent.width)}},pcnty:{set:function(e){this.percenty=e,this.parent&&(this.y=this.parent.texture.noFrame?e/this.parent.scale.y*L.height:e/this.parent.scale.y*this.parent.height)}},setx:{set:function(e){this.x=e,this.parent&&(this.percentx=e/this.parent.width)}},sety:{set:function(e){this.y=e,this.parent&&(this.percenty=e/this.parent.height)}}}),r.prototype=Object.create(PIXI.Text.prototype),r.prototype.constructor=r,r.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},r.prototype.destroy=function(){PIXI.Text.prototype.destroy.call(this)},r.prototype.update=function(){return L.resized&&(isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),L.resizeConsumed=!0),!0},Object.defineProperties(r.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&(this.x=this.parent.texture.noFrame?e/this.parent.scale.x*L.width:e/this.parent.scale.x*this.parent.width)}},pcnty:{set:function(e){this.percenty=e,this.parent&&(this.y=this.parent.texture.noFrame?e/this.parent.scale.y*L.height:e/this.parent.scale.y*this.parent.height)}},setx:{set:function(e){this.x=e,this.parent&&(this.percentx=this.parent.texture.noFrame?e/L.width:e/this.parent.width)}},sety:{set:function(e){this.y=e,this.parent&&(this.percenty=this.parent.texture.noFrame?e/L.height:e/this.parent.height)}}}),h.prototype.create=function(e,t,s,i,a,o,r,l,h){this.parent=e,this.managers=t,this.texts=[],N.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5,.5),this._create(e,t,s,i,a,o,r,l,h)},h.prototype.createLevelWon=function(e,s,i,a,o){this.parent=e,this.managers=s,this.texts=[],N.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5,.5),this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0;var l,u,c;if(i&&(l=L.textStyleBigMessageTitle.clone(),l.wordWrapWidth=800,l.wordWrap=!0,u=this.managers.locale.get(i)||i,t=new r(u,l),t.create(this.bg,0,-.2,!0),t.anchor.set(.5,.5),this.texts.push(t)),l=L.textStyleBigMessage.clone(),l.wordWrapWidth=800,l.wordWrap=!0,u=this.managers.locale.get(a)||a,t=new r(u,l),t.create(this.bg,0,-.1,!0),t.anchor.set(.5,0),this.texts.push(t),o&&(l=L.textStyleMediumMessage.clone(),l.wordWrapWidth=800,l.wordWrap=!0,u=this.managers.locale.get(o)||o,t=new r(u,l),t.create(this.bg,0,.05,!0),t.anchor.set(.5,0),this.texts.push(t)),!L.challengeMode){var d=0,p=this;c=new n,I.stars>0?(c.create(this.bg,"hud_star.png",this.managers.textures,-.16,.13,!0),c.scale.set(3),c.visible=!1,this.managers.audio.playDelayed("snd_rainbow",d,function(){p.star1.visible=!0}),d+=.7):(c.create(this.bg,"hud_stargrey.png",this.managers.textures,-.16,.13,!0),c.scale.set(1.5)),c.anchor.set(.5),this.star1=c,c=new n,I.stars>1?(c.create(this.bg,"hud_star.png",this.managers.textures,0,.13,!0),c.scale.set(3.4),c.visible=!1,this.managers.audio.playDelayed("snd_rainbow",d,function(){p.star2.visible=!0}),d+=.7):(c.create(this.bg,"hud_stargrey.png",this.managers.textures,0,.13,!0),c.scale.set(1.7)),c.anchor.set(.5),this.star2=c,c=new n,I.stars>2?(c.create(this.bg,"hud_star.png",this.managers.textures,.16,.13,!0),c.scale.set(3.8),c.visible=!1,this.managers.audio.playDelayed("snd_rainbow",d,function(){p.star3.visible=!0})):(c.create(this.bg,"hud_stargrey.png",this.managers.textures,.16,.13,!0),c.scale.set(1.9)),c.anchor.set(.5),this.star3=c}h.tweenIn.step=N.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(h.tweenIn)},h.prototype.createObjective=function(e,s,i,a,o){var l,u,c;this.parent=e,this.managers=s,this.texts=[],N.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_small_v03.png",this.managers.textures),this.bg.anchor.set(.5),c=new n,c.create(this.bg,o,this.managers.textures,-.225,-.03,!0),c.anchor.set(.5),c.scale.set(1.6),this.icon=c,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,l=L.textStyleBigMessageObjTitle.clone(),l.wordWrapWidth=800,l.wordWrap=!0,u=this.managers.locale.get(a)||a,t=new r(u,l),t.create(this.bg,-.1,-.18,!0),t.anchor.set(0,.5),this.texts.push(t),c=new n,c.create(this.bg,"hud_line2px.png",this.managers.textures,-.1,-.11,!0),c.anchor.set(0,.5),c.scale.set(.9,1),this.underline=c,l=L.textStyleBigMessageObjective.clone(),l.wordWrapWidth=800,l.wordWrap=!0,u=this.managers.locale.get(i)||i,t=new r(u,l),t.create(this.bg,-.1,0,!0),t.anchor.set(0,.5),this.texts.push(t),h.tweenIn.step=N.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(h.tweenIn)},h.prototype.createWinLose=function(e,s,i,a,o,l){L.debug&&console.log("BigMessage _subText = "+a+" shotsLeft = "+I.shotsLeft);var u,c,d,p;this.parent=e,this.managers=s,this.texts=[],N.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"popup_large_v03.png",this.managers.textures),this.bg.anchor.set(.5),u=L.textStyleBigMessage.clone(),u.wordWrapWidth=800,u.wordWrap=!0,c=this.managers.locale.get(i)||i,t=new r(c,u),t.create(this.bg,0,-.24,!0),t.anchor.set(.5),this.texts.push(t),a&&(I.shotsLeft<=0&&(a="string_level_out_of_shots"),u=L.textStyleBigMessageSubText.clone(),u.wordWrapWidth=800,u.wordWrap=!0,L.debug&&console.log("BigMessage _subText = "+a),c=this.managers.locale.get(a)||a,t=new r(c,u),t.create(this.bg,0,.03,!0),t.anchor.set(.5,0),this.texts.push(t)),d=new n,d.create(this.bg,"field_01.png",this.managers.textures,0,.02,!0),d.anchor.set(.5),d.scale.set(1),this.fields=[d],u=L.textStyleMediumMessage.clone(),u.wordWrapWidth=800,u.wordWrap=!0,c=this.managers.locale.get("string_score"),t=new r(c,u),t.create(d,0,-.14,!0),t.anchor.set(.5,1),this.texts.push(t),u=L.textStyleBigMessage.clone(),u.wordWrapWidth=800,u.wordWrap=!0,c=N.formatBigNumber(I.score),t=new r(c,u),t.create(d,0,-.08,!0),t.anchor.set(.5),this.texts.push(t),o&&(d=new n,d.create(this.bg,"field_01.png",this.managers.textures,0,.22,!0),d.anchor.set(.5),d.scale.set(1),this.fields.push(d),u=L.textStyleMediumMessage.clone(),u.wordWrapWidth=800,u.wordWrap=!0,c=this.managers.locale.get("string_high_score"),t=new r(c,u),t.create(d,0,-.14,!0),t.anchor.set(.5,1),this.texts.push(t),c=N.formatBigNumber(I.highScore),u=L.textStyleBigMessage.clone(),t=new r(c,u),t.create(d,0,-.08,!0),t.anchor.set(.5),this.texts.push(t)),this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,l&&(p=this.addButton("string_quit","click_quit_event",-200,200),p.scale.set(.65),p=this.addButton("string_retry","click_retry_event",200,200),p.scale.set(.65)),h.tweenIn.step=N.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(h.tweenIn)},h.prototype._create=function(e,s,i,a,o,l,u,c,d){this.callback=a||null,this.context=o||null,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.star1=this.star2=this.star3=null,this.buttons=[],this.buttonPressed=0;var p,g,b;l&&(p=L.textStyleBigMessageTitle.clone(),p.wordWrapWidth=800,p.wordWrap=!0,g=this.managers.locale.get(l)||l,t=new r(g,p),t.create(this.bg,0,-.2,!0),t.anchor.set(.5,.5),this.texts.push(t)),p=L.textStyleBigMessage.clone(),p.wordWrapWidth=800,p.wordWrap=!0,g=this.managers.locale.get(i)||i,t=new r(g,p),t.create(this.bg,0,0,!0),t.anchor.set(.5,.5),this.texts.push(t),u&&(b=new n,b.create(this.bg,u,this.managers.textures,c,d,!0),b.anchor.set(.5),this.icon=b),h.tweenIn.step=N.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.bg.tweener.tween(h.tweenIn)},h.prototype.addButton=function(e,t,s,i){var a=new g(g.TYPE_BUTTON);a.create(this.bg,"menu_play_button",this.managers,s||0,i||340,!1,"menu_play_button","menu_play_button","menu_play_button",t||"click1_event"),a.anchor.set(.5,.5);var o=new r(this.managers.locale.get(e),L.textStyleBoldButtonsLarge);return o.create(a,0,0,!0),o.anchor.set(.5,.5),a.text=o,a.sfx="snd_click",this.buttons.push(a),a},h.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new g(g.TYPE_BUTTON);i.create(this.bg,"menu_play_button",this.managers,-200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click1_event"),i.anchor.set(.5,.5);var a=new r(this.managers.locale.get(e),L.textStyleBoldButtonsLarge);a.create(i,0,0,!0),a.anchor.set(.5,.5),i.text=a,i.sfx="snd_click",this.buttons.push(i),i=new g(g.TYPE_BUTTON),i.create(this.bg,"menu_play_button",this.managers,200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click2_event"),i.anchor.set(.5,.5),a=new r(this.managers.locale.get(t),L.textStyleBoldButtonsLarge),a.create(i,0,0,!0),a.anchor.set(.5,.5),i.text=a,i.sfx="snd_click",this.buttons.push(i)},h.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(h.tweenOut.step=N.makeFunctionForSprite(this.bg),this.bg.tweener.owner=this,this.bg.tweener.context=this,this.bg.tweener.tween(h.tweenOut)),this.removeContext=e||null,this.removeArgument=t||null,!0)},h.prototype.destroy=function(){var e,t;if(N.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();if(this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.icon&&this.icon.destroy(),this.icon=null,this.underline&&this.underline.destroy(),this.underline=null,this.texts)for(e=0,t=this.texts.length;t>e;e++)this.texts[e].destroy();if(this.texts=null,this.fields)for(e=0,t=this.fields.length;t>e;e++)this.fields[e].destroy();this.fields=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,L.idleTimer=L.eventChangeAdOnIdle},h.prototype.update=function(e){var t;if(this.doneIn&&(this.star1&&this.star1.visible&&this.star1.scale.x>1.5&&(this.star1.scale.set(.97*this.star1.scale.x),this.star1.scale.x<1.5&&this.star1.scale.set(1.5),t=B.effects.add(w.STAR,this.star1.parent,this.star1.x,this.star1.y,w.starFall,B.effects,!1,!1),t&&(t.vx=400*Math.random()-200,t.vy=-400*Math.random()-300,t.life=20*Math.random()+20)),this.star2&&this.star2.visible&&this.star2.scale.x>1.7&&(this.star2.scale.set(.97*this.star2.scale.x),this.star2.scale.x<1.7&&this.star2.scale.set(1.7),t=B.effects.add(w.STAR,this.star2.parent,this.star2.x,this.star2.y,w.starFall,B.effects,!1,!1),t&&(t.vx=500*Math.random()-250,t.vy=-500*Math.random()-300,t.life=20*Math.random()+25)),this.star3&&this.star3.visible&&this.star3.scale.x>1.9&&(this.star3.scale.set(.97*this.star3.scale.x),this.star3.scale.x<1.9&&this.star3.scale.set(1.9),t=B.effects.add(w.STAR,this.star3.parent,this.star3.x,this.star3.y,w.starFall,B.effects,!1,!1),t&&(t.vx=600*Math.random()-300,t.vy=-600*Math.random()-300,t.life=20*Math.random()+30)),L.eventChangeAdOnPopup&&!this.adShown&&(L.arenaHelper.sendEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),!this.timeOut||this.buttons&&0!==this.buttons.length||(this.timeOut-=L.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var s,i,a;for(s=0,i=this.buttons.length;i>s&&(a=this.buttons[s].update(),1!=this.buttons[s].alpha&&(a=null),!a);s++);if("click1_event"==a){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==a){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}else{if("click_quit_event"==a)return"quit";if("click_retry_event"==a)return"retry"}}return!this.doneOut},h.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var H=300;h.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:H,easing:"easeInQuad",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneIn=!0}},h.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:H,easing:"easeFrom",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},u.prototype.create=function(e,t,s,i,a,o,n,l){this.parent=i,this.managers=a,this.text=new r(o,s),this.text.create(this.parent,e,t,!1),this.text.anchor.set(.5,.5),u.tweenOut.step=N.makeFunctionForSprite(this.text),u.tweenOut.from.y=t,u.tweenOut.to.y=t+(n||-100),u.tweenOut.duration=l||300*Math.random()+700,this.text.tweener=new Tweenable,this.text.tweener.tween(u.tweenOut),this.text.tweener.context=this},u.prototype.destroy=function(){this.text&&this.text.tweener&&(this.text.tweener.stop(),this.text.tweener.context=null),this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1},u.prototype.active=function(){return null!==this.text},u.tweenOut={from:{y:0},to:{y:0},duration:0,easing:"easeFrom",step:null,finish:function(){this.context.destroy()}},d.prototype.create=function(e,t,s,i,a,o){L.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=a,this.onNo=o,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(L.bgImage,"game_title",t.textures),this.bg.anchor.set(.5,1),this.bg.y=L.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(L.fullUI,"menu_bg",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new g(g.TYPE_BUTTON);l.create(this.panel,"menu_play_button",this.managers,-.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var h=new r(this.managers.locale.get("quit_yes_button_string"),L.textStyleBoldButtons);h.create(l,0,0,!0),h.anchor.set(.5,.5),l.text=h,l.sfx="snd_click",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new g(g.TYPE_BUTTON),l.create(this.panel,"menu_play_button",this.managers,.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),h=new r(this.managers.locale.get("quit_no_button_string"),L.textStyleBoldButtons),h.create(l,0,0,!0),h.anchor.set(.5,.5),l.text=h,l.sfx="snd_click",l.sfxHover="snd_rollOver",this.buttons.push(l);var u=L.textStyleBold.clone();u.wordWrap=!0,u.wordWrapWidth=800,h=new r(this.managers.locale.get(s),u),h.create(this.panel,0,-.1,!0),h.anchor.set(.5,.5),this.texts.push(h),_gameGATracker("send","pageview",{page:"/ExitGamePopup"})},d.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,L.resized=!0,L.resizeConsumed=!1,L.swipeEnabled=!1},d.prototype.update=function(){var e,t;if(this.bg.y=L.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(L.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(L.click=null,this.onNo.call(this.context),!1):!0},p.prototype.create=function(e,t,s){var i;if(this.swipeMem=L.swipeEnabled,L.swipeEnabled=!1,this.game=e,this.managers=t,this.levelsData=this.managers.data.get("levels").levels,this.page=0,this.switchPage=0,this.highlight=null,this.scrollAppear=0,this.scrollRemove=0,null===L.lockedLevels||0===L.lockedLevels.length){for(i=0;i<this.levelsData.length;i++)L.levelStars[i]=0,L.levelScores[i]=0,L.lockedLevels[i]=0!==i;this.managers.loadSave.saveGameStatus()}else if(L.lockedLevels.length!=this.levelsData.length){for(i=L.lockedLevels.length;i<this.levelsData.length;i++)L.levelStars[i]=0,L.levelScores[i]=0,L.lockedLevels[i]=0;this.managers.loadSave.saveGameStatus()}for(i=L.lockedLevels.length-1;i>=0;--i)if(!L.lockedLevels[i]){this.lastUnlockedLevel=i;break}this.page=Math.floor(I.requestQuit?s/this.levelsPerPage:this.lastUnlockedLevel/this.levelsPerPage),this.showPage(L.width),this.scrollAppear=-16,this.managers.audio.play("snd_popup_flying"),L.bgImage.alpha=0},p.prototype.remove=function(){return L.bgImage.alpha-=.1,L.bgImage.alpha<=0?(this.destroy(),!1):!0},p.prototype.destroy=function(){this.destroyPage(),this.game=null,this.managers=null,this.highlight=null,this.levelsData=null,L.resized=!0,L.resizeConsumed=!1,L.swipeEnabled=this.swipeMem},p.prototype.destroyPage=function(){if(this.texts){for(i=0;i<this.texts.length;i++)this.texts[i].destroy();this.texts=null}if(this.buttons){for(i=0;i<this.buttons.length;i++)this.buttons[i].destroy();this.buttons=null}if(this.sprites){for(i=0;i<this.sprites.length;i++)this.sprites[i].destroy();this.sprites=null}},p.prototype.update=function(){var e,t;if(L.resized&&(this.destroyPage(),this.showPage(0)),L.bgImage.alpha<1&&(L.bgImage.alpha+=.1),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}var i=null;if(this.buttons)for(e=0;e<this.buttons.length;e++)if(e>=this.levelsPerPage||L.accessLocked||!L.lockedLevels[this.page*this.levelsPerPage+e]){var a=this.buttons[e];if(t=a.update(),null!==t){i=a;break}}var o;if(0!==this.scrollAppear)return o=p.easeSpeed(this.scrollAppear,this.pageOffset),Math.abs(o)<1&&(o=N.sign0(this.scrollAppear)),N.sign0(this.pageOffset)!=N.sign0(this.pageOffset+o)?(this.scrollButtons(-o),this.scrollAppear=0):(this.scrollButtons(o),this.scrollAppear*=1.1),0;if(0!==this.scrollRemove)return o=p.easeSpeed(this.scrollRemove,this.pageOffset),Math.abs(o)<1&&(o=N.sign0(this.scrollRemove)),this.scrollButtons(o)?(this.destroyPage(),this.page=this.switchPage,this.showPage(-N.sign0(this.scrollRemove)*L.width),this.scrollAppear=16*N.sign0(this.scrollRemove),this.scrollRemove=0):this.scrollRemove*=1.1,0;if(t&&t.length>12&&("click_"==t.substr(0,6)&&i&&i.scale.set(1.1*i.scale.x,1.1*i.scale.y),"click_event_"==t.substr(0,12))){L.click=null;var n=Number.parseInt(t.substr(12));return L.debug&&console.log("Player selected level "+n),n+1}switch(t){case"click_prev_event":this.managers.audio.play("snd_popup_flying"),this.switchPage=this.page-1,this.scrollRemove=8;break;case"click_next_event":this.managers.audio.play("snd_popup_flying"),this.switchPage=this.page+1,this.scrollRemove=-8;break;case"click_home_event":this.switchPage=Math.floor(this.lastUnlockedLevel/this.levelsPerPage),this.switchPage>this.page?this.scrollRemove=-8:this.switchPage<this.page?this.scrollRemove=8:this.showPage()}return 0},p.prototype.showPage=function(e){var t,s,i;void 0===e&&(e=0),this.pageOffset=e/L.bgImage.scale.x;var a=[];a.level_protect_barrier="lvl/lvl_typeBarr.png",a.level_collect_fish="lvl/lvl_typeGoal.png",a.level_hatch_egg="lvl/lvl_typeEgg.png",this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(L.bgImage,"game_bg3",this.managers.textures),this.bg.anchor.set(.5),this.sprites.push(this.bg);var o=.7,l=3,h=6,u=[-.3,-.18,-.06,.06,.18,.3],c=.24;L.isPortrait&&(o=.66,l=5,h=4,u=[-.3,-.1,.1,.3],c=.15);for(var d=this.page*this.levelsPerPage,p=0;l>p;p++){for(var b=0;h>b;b++)if(!L.isPortrait||4!==p||0!==b&&3!==b){var m=this.levelsData[d%this.levelsData.length];if(d==this.lastUnlockedLevel&&(s=new n,s.create(L.bgImage,"lvl/lvl_current.png",this.managers.textures,u[b],-.42+(p+.5)*c,!0),s.anchor.set(.5),s.scale.set(o),s.x+=this.pageOffset,this.highlight=s,this.sprites.push(s)),t=new g(g.TYPE_BUTTON),t.create(L.bgImage,"lvl/lvl_backing.png",this.managers,u[b],-.42+(p+.5)*c,!0,"lvl/lvl_backing.png","lvl/lvl_backing.png","lvl/lvl_backing.png","click_event_"+d.toString()),t.anchor.set(.5),t.scale.set(o),t.x+=this.pageOffset,t.sfx="snd_click",t.sfxHover="snd_rollOver",t.lockIcon=null,this.buttons.push(t),L.lockedLevels[d]){var y=new n;y.create(t,"lvl/lvl_locked.png",this.managers.textures),y.anchor.set(.5),t.lockIcon=y,L.accessLocked||(t.enabled=!1)}else{s=new n,s.create(t,a[m._id],this.managers.textures,0,0,!0),s.anchor.set(.5);var f=L.levelStars[d];f>0&&(s=new n,s.create(t,"lvl/lvl_star01.png",this.managers.textures,0,0,!0),s.anchor.set(.5)),f>1&&(s=new n,s.create(t,"lvl/lvl_star02.png",this.managers.textures,0,0,!0),s.anchor.set(.5)),f>2&&(s=new n,s.create(t,"lvl/lvl_star03.png",this.managers.textures,0,0,!0),s.anchor.set(.5))}if(i=new r((d+1).toString(),L.textStyleSelectLevelNumber),i.create(t,.36,.39,!0),i.anchor.set(1),this.texts.push(i),d++,d>=L.lockedLevels.length)break}if(d>=L.lockedLevels.length)break}this.page>0&&(t=new g(g.TYPE_BUTTON),t.create(L.bgImage,"lvlSlct_arrwLft.png",this.managers,-.425,.4,!0,"lvlSlct_arrwLft.png","lvlSlct_arrwLft.png","lvlSlct_arrwLft.png","click_prev_event"),t.anchor.set(.5),t.scale.set(1),t.sfx="snd_click",t.sfxHover="snd_rollOver",this.buttons.push(t)),this.page<=Math.floor(L.lockedLevels.length/this.levelsPerPage)-1&&(t=new g(g.TYPE_BUTTON),t.create(L.bgImage,"lvlSlct_arrwRgt.png",this.managers,.425,.4,!0,"lvlSlct_arrwRgt.png","lvlSlct_arrwRgt.png","lvlSlct_arrwRgt.png","click_next_event"),t.anchor.set(.5),t.scale.set(1),t.sfx="snd_click",t.sfxHover="snd_rollOver",this.buttons.push(t)),t=new g(g.TYPE_BUTTON),t.create(L.bgImage,"lvlSlct_btnCurrent.png",this.managers,0,.4,!0,"lvlSlct_btnCurrent.png","lvlSlct_btnCurrent.png","lvlSlct_btnCurrent.png","click_home_event"),t.anchor.set(.5),t.sfx="snd_click",t.sfxHover="snd_rollOver",this.buttons.push(t),i=new r((this.lastUnlockedLevel+1).toString(),L.textStyleShowLevelNumber),i.create(t,0,0,!0),i.anchor.set(.5),this.texts.push(i)
},p.easeSpeed=function(e,t){var s=e*(Math.abs(t)/L.width)*8;return s},p.prototype.scrollButtons=function(e){var t,s=0;for(t=0;t<this.buttons.length;t++){var i=this.buttons[t];void 0!==i.lockIcon&&(i.x+=e,Math.abs(i.x)<L.width&&s++)}return this.highlight&&this.highlight.parent&&(this.highlight.x+=e),this.pageOffset+=e,0>=s},g.TYPE_BUTTON=1,g.TYPE_CHECKBOX=2,g.TYPE_TOGGLE=3,g.TYPE_NOLATCH=4,g.prototype=Object.create(n.prototype),g.prototype.constructor=g,g.prototype.create=function(t,s,i,a,o,r,l,h,u,c,d,p,g,b,m,y){this.managers=i,n.prototype.create.call(this,t,s,this.managers.textures,a,o,r),this.upKey={on:l,off:p},this.overKey={on:h,off:g},this.downKey={on:u,off:b},this.downEvent={on:c,off:m},this.overEvent={on:d,off:y},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,this.enabled=!0,e.registerCallback("mousedown",this.playSfx,{context:this})},g.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.managers=null,n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this._toggled=null,this.sfx=this.sfxHover=null},g.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return s=this.type==g.TYPE_BUTTON||this.type==g.TYPE_NOLATCH?this.downDetected&&null!==L.mouseDown&&i.contains(L.mouseDown.x,L.mouseDown.y)||null!==L.click&&i.contains(L.click.x,L.click.y):null!==L.click&&i.contains(L.click.x,L.click.y),s&&(this.setFrame(this.downKey[this._toggled]),L.mouseDown=L.click=null,this.enabled&&(e=this.downEvent[this._toggled]),t=!0),this.type==g.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&L.hover&&i.contains(L.hover.x,L.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&this.enabled&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==g.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},g.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},Object.defineProperties(g.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),b.titles=["help_title_boost","help_title_boost","help_title_boost","help_title_boost","help_title_boost","help_title_special","help_title_special","help_title_special","help_title_special","help_title_special","help_title_special"],b.names=["name_boost_mine","name_boost_wild","name_boost_fireball","name_boost_extra_moves","name_boost_convert_dragon","name_special_bomb","name_special_rocket","name_special_frozen_bubble","name_special_carry_dragon","name_special_burst_dragon","name_special_convert_dragon"],b.descriptions=["desc_boost_mine","desc_boost_wild","desc_boost_fireball","desc_boost_extra_moves","desc_boost_convert_dragon","desc_special_bomb","desc_special_rocket","desc_special_frozen_bubble","desc_special_carry_dragon","desc_special_burst_dragon","desc_special_convert_dragon"],b.icons=["boostIcon_mine.png","bble_wild.png","boostIcon_flame.png","5plus.png","boostIcon_bluDrag.png","bomb_spark/bomb00.png","rocket.png","frozen01.png","purple_flying/00.png","orange_flying/00.png","blue_flying/00.png"],b.requirements=["boost_mine","boost_wild","boost_fireball","boost_extra_moves","boost_convert_dragon","special_bomb","special_rocket","special_frozen_bubble","special_carry_dragon","special_burst_dragon","special_convert_dragon"],b.prototype.create=function(e){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],N.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(L.fullUI,"popup_large_v03.png",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.panel.scale.set(1.1),this.sprites.push(this.panel);var t,s,i;s=new n,s.create(this.panel,"help_banner.png",this.managers.textures,0,-.275,!0),s.anchor.set(.5),this.sprites.push(s);var a=L.textStyleBigMessageObjTitle.clone();txt=this.managers.locale.get("help_title_boost"),i=new r(txt,a),i.create(this.panel,0,-0.267,!0),i.anchor.set(.5),this.title=i,this.texts.push(i),t=new g(g.TYPE_BUTTON),t.create(this.panel,"help_arwRgt.png",this.managers,.3,-.1,!0,"help_arwRgt.png","help_arwRgt.png","help_arwRgt.png","click_nextPage_event"),t.anchor.set(.5),t.sfx="snd_click",t.sfxHover="snd_rollOver",this.nextPageBtn=t,this.buttons.push(t),t=new g(g.TYPE_BUTTON),t.create(this.panel,"help_arwLft.png",this.managers,-.3,-.1,!0,"help_arwLft.png","help_arwLft.png","help_arwLft.png","click_prevPage_event"),t.anchor.set(.5),t.sfx="snd_click",t.sfxHover="snd_rollOver",t.visible=!1,this.prevPageBtn=t,this.buttons.push(t),s=new n,s.create(this.panel,"boostIcon_mine.png",this.managers.textures,0,-.1,!0),s.anchor.set(.5),s.scale.set(1.5),this.icon=s,this.sprites.push(s),a=L.textStyleHelpBoostTitle.clone(),txt=this.managers.locale.get("name_boost_mine"),i=new r(txt,a),i.create(this.panel,0,.05,!0),i.anchor.set(.5),this.nameText=i,this.texts.push(i),a=L.textStyleHelpBoostDescription.clone(),a.wordWrap=!0,a.wordWrapWidth=800,txt=this.managers.locale.get("desc_boost_mine"),i=new r(txt,a),i.create(this.panel,0,.1,!0),i.anchor.set(.5,0),this.nameDesc=i,this.texts.push(i),t=new g(g.TYPE_BUTTON),t.create(this.panel,"button_close.png",this.managers,.412,-.382,!0,"button_close.png","button_close.png","button_close.png","click_close_event"),t.anchor.set(.5),t.scale.set(1.05),t.sfx="snd_click",t.sfxHover="snd_rollOver",this.buttons.push(t),this.page=this.nextPage(-1),this.showPage(),b.tweenIn.step=N.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(b.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_popup_flying")},b.prototype.remove=function(e){this.removing||(this.removing=!0,L.debug&&console.log("Help.remove"),b.tweenOut.step=N.makeFunctionForSprite(this.panel),this.panel.tweener.tween(b.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},b.prototype.destroy=function(){var e;if(N.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.managers=null,this.title=null,this.icon=null,this.nameText=null,this.nameDesc=null,this.nextPageBtn=null,this.prevPageBtn=null,L.resized=!0,L.resizeConsumed=!1},b.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return"click_prevPage_event"==t&&this.page>0&&(this.page=this.previousPage(this.page),this.showPage()),"click_nextPage_event"==t&&this.page<b.icons.length-1&&(this.page=this.nextPage(this.page),this.showPage()),"click_close_event"==t?(L.resetInput(),this.managers.audio.play("snd_popup_flying"),!1):!0},b.prototype.previousPage=function(e){var t=e;do if(t--,0>t)return e;while(!this.validPage(t));return t},b.prototype.nextPage=function(e){var t=e;do if(t++,t>=b.icons.length-1)return e;while(!this.validPage(t));return t},b.prototype.validPage=function(e){if(this.levelData){var t=b.requirements[e];if(this.levelData.boost.id==t)return!0;for(var s=this.levelData.specials,i=0,a=s.length;a>i;i++)if(void 0!==s[i][t])return!0;return!1}return!0},b.prototype.showPage=function(){var e=this.managers.locale.get(b.titles[this.page]),t=this.managers.locale.get(b.names[this.page]),s=this.managers.locale.get(b.descriptions[this.page]),i=b.icons[this.page];this.title.text=e,this.nameText.text=t,this.nameDesc.text=s,this.icon.setFrame(i),this.prevPageBtn.visible=this.previousPage(this.page)!=this.page,this.nextPageBtn.visible=this.nextPage(this.page)!=this.page};var W=350;b.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:W,easing:"easeInQuad",step:null,finish:function(){}},b.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:W,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},m.prototype.create=function(e,t){L.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,N.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(L.fullUI,"popup_small_v03.png",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new g(g.TYPE_BUTTON);s.create(this.panel,"button_close.png",this.managers,.42,-.329,!0,"button_close.png","button_close.png","button_close.png","click_close_event"),s.anchor.set(.5),s.sfx="snd_click",s.sfxHover="snd_rollOver",this.buttons.push(s);var i=-.15,a=.16;L.isAndroid&&L.isChromeMobile||(i=.15,a=.16,s=new g(g.TYPE_BUTTON),s.create(this.panel,"settingsScreen/settingsBtn_fxOn.png",this.managers,-.3,-.06,!0,"settingsScreen/settingsBtn_fxOn.png","settingsScreen/settingsBtn_fxOn.png","settingsScreen/settingsBtn_fxOn.png","click_sound_event",null,"settingsScreen/settingsBtn_fxOff.png","settingsScreen/settingsBtn_fxOff.png","settingsScreen/settingsBtn_fxOff.png","click_sound_event_mute",null),s.anchor.set(.5),s.toggled=!this.managers.audio.mute,s.sfx="snd_click",s.sfxHover="snd_rollOver",this.buttons.push(s),this.soundBtn=s,s=new g(g.TYPE_BUTTON),s.create(this.panel,"settingsScreen/settingsBtn_musicOn.png",this.managers,-.1,-.06,!0,"settingsScreen/settingsBtn_musicOn.png","settingsScreen/settingsBtn_musicOn.png","settingsScreen/settingsBtn_musicOn.png","click_music_event",null,"settingsScreen/settingsBtn_musicOff.png","settingsScreen/settingsBtn_musicOff.png","settingsScreen/settingsBtn_musicOff.png","click_music_event_mute"),s.anchor.set(.5),s.toggled=!this.managers.audio.tunesMuted,s.sfx="snd_click",s.sfxHover="snd_rollOver",this.buttons.push(s),this.musicBtn=s),s=new g(g.TYPE_NOLATCH),s.create(this.panel,"settingsScreen/settingsBtn_help.png",this.managers,.1,-.06,!0,"settingsScreen/settingsBtn_help.png","settingsScreen/settingsBtn_helpDown.png","settingsScreen/settingsBtn_helpDown.png","click_help_event"),s.anchor.set(.5),s.sfx="snd_click",s.sfxHover="snd_rollOver",this.buttons.push(s),s=new g(g.TYPE_NOLATCH),s.create(this.panel,"settingsScreen/settingsBtn_exit.png",this.managers,.3,-.06,!0,"settingsScreen/settingsBtn_exit.png","settingsScreen/settingsBtn_exitDown.png","settingsScreen/settingsBtn_exitDown.png","click_quit_event"),s.anchor.set(.5),s.sfx="snd_click",s.sfxHover="snd_rollOver",this.buttons.push(s),m.tweenIn.step=N.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.context=this,this.panel.tweener.tween(m.tweenIn),this.removing=!1},m.prototype.remove=function(e){this.removing||(this.removing=!0,L.debug&&console.log("Options.remove"),m.tweenOut.step=N.makeFunctionForSprite(this.panel),this.panel.tweener.tween(m.tweenOut),this.panel.tweener.context=this,this.destroyCallback=e)},m.prototype.destroy=function(){var e;if(L.debug&&console.log("Options.destroy"),N.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,L.resized=!0,L.resizeConsumed=!1,L.swipeEnabled=!1,L.idleTimer=L.eventChangeAdOnIdle},m.prototype.update=function(){var e,t;if(this.doneIn&&L.eventChangeAdOnOptions&&!this.adShown&&(L.arenaHelper.sendEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}switch(t){case"click_close_event":return L.click=null,G.reset(U.space_bar),L.playMidRollAdAfterPause&&L.arenaHelper.requestMidroll(),!1;case"click_help_event":this.game.showHelp();break;case"click_quit_event":this.onYesQuit();break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",L.VERSION,"sound","BUBB_HTML5",1));break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",L.VERSION,"sound","BUBB_HTML5",1));break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",L.VERSION,"sound","BUBB_HTML5",1));break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",L.VERSION,"sound","BUBB_HTML5",1))}return!0},m.prototype.onYesQuit=function(){this.destroy(),I.requestQuit=!0,I.options=null},m.prototype.onNoQuit=function(){};var H=350;m.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:H,easing:"easeInQuad",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneIn=!0}},m.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:H,easing:"easeFrom",step:null,start:function(){this.context.managers.audio.play("snd_popup_flying")},finish:function(){this.context.doneOut=!0,this.context&&(this.context.destroy(),this.context=null)}},y.createTweens=function(e,t,s,i,a,o){isNaN(i)&&(i=0),isNaN(a)&&(a=0);for(var l=[],h=[],u=0;u<e.length;u++){var c=e[u];if(c.button){var d=new g(g.TYPE_BUTTON);if(d.create(t,c.key,s,c.x+i,c.y+a,!1,c.key,c.button.over,c.button.down,c.button.clickEvent),d.anchor.x=d.anchor.y=.5,void 0!==c.visible&&(d.visible=c.visible),d.sfx=c.button.sfx,d.sfxHover=c.button.sfxHover,void 0!==c.button.text){var p=new r(s.locale.get(c.button.text),o||L.textStyleBoldButtons);p.create(d,0,0,!0),p.anchor.set(.5,.5),d.text=p}void 0!==c.fade&&d.addFader(c.fade,c.alpha),void 0!==c.tween&&(c.tween.step=N.makeFunctionForSprite(d),d.tweener=new Tweenable,d.tweener.tween(c.tween),d.tweener.owner=d),h.push(d)}else{var b=new n;b.create(t,c.key,s.textures,c.x+i,c.y+a,!1),b.anchor.x=b.anchor.y=.5,void 0!==c.visible&&(b.visible=c.visible),void 0!==c.fade&&b.addFader(c.fade,c.alpha),void 0!==c.tween&&(c.tween.step=N.makeFunctionForSprite(b),b.tweener=new Tweenable,b.tweener.tween(c.tween),b.tweener.owner=b),l.push(b)}}return{sprites:l,buttons:h}},f.prototype.create=function(e){this.managers=e},f.prototype.destroy=function(){this.managers=null},f.prototype.loadGameStatus=function(){L.debug&&console.log("loadGameStatus");var e=localStorage.BubbleBoo2_status;if(e){var t=JSON.parse(e);return L.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),R.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),L.lockedLevels=t.lockedLevels||[],L.levelScores=t.levelScores||[],L.levelStars=t.levelStars||[],L.levelLosses=t.levelLosses||[],!0}return L.lockedLevels=[],L.levelScores=[],L.levelStars=[],L.levelLosses=[],L.debug&&console.log("Game data is not available in localStorage."),!1},f.prototype.saveGameStatus=function(){L.debug&&console.log("saveGameStatus");var e={sfxVolume:R.sfxVolume,musicVolume:R.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted,lockedLevels:L.lockedLevels,levelScores:L.levelScores,levelStars:L.levelStars,levelLosses:L.levelLosses},t=JSON.stringify(e);return localStorage.BubbleBoo2_status=t,!0},v.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},v.prototype.get=function(e){if(!this.dataManager)return L.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=N.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(L.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},v.prototype.onLocaleChanged=function(){L.countryCode=L.debug?"en-US":L.arenaHelper.getLocale();for(var e=[{value:"en",localization:"en-US",name:"English"},{value:"de",localization:"de-DE",name:"Deutsch"},{value:"es",localization:"es-ES",name:"Espaol"},{value:"fr",localization:"fr-FR",name:"Franais"},{value:"it",localization:"it-IT",name:"Italiano"}],t=0;t<e.length;t++)if(e[t].value===L.countryCode){L.countryCode=e[t].localization;break}var s=this.dataManager.get("localizations");L.debug&&console.log("available languages: ",s),s&&s.availableLocales&&-1==N.indexOfStringNoCase(s.availableLocales,L.countryCode)&&(L.debug&&console.log("language is not available: ",L.countryCode),L.countryCode="en-US"),L.debug&&console.log("language code = ",L.countryCode),this.dataManager.loadData("strings",L.arenaHelper.getAbsoluteURL("")+"data/locale/"+L.countryCode+"/strings.json"),this.strings=null},_.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];_.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(L.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else L.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(L.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),L.debug&&console.log("All fonts loaded or failed."),!0)},_.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var a=i.offsetWidth;return i.parentNode.removeChild(i),a},x.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},x.prototype.setFade=function(e,t,s,i,a,o){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=a,null!==o&&(this.trigger=o,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))},x.prototype.reached=function(e){return this.fadeValue==e},x.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,L.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,L.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},w.GRAVITY=11,w.POP_BUBBLE=1,w.FALL_BUBBLE=2,w.ROCKET=3,w.EXPLOSION=4,w.DRAGON_BLUE=5,w.BOOST_BONUS5=6,w.ROCKET_SMOKE=7,w.ROCKET_FIRE=8,w.DRAGON_FLAME_JET=9,w.BOOST_SMOKE=10,w.DRAGON_LIGHTNING=11,w.DRAGON_GOLD=12,w.CRACK_ICE=13,w.FAKE_BUBBLE=14,w.SPARKLES_WHITE=15,w.SPARKLES_RAINBOW=16,w.DROP_FISH=17,w.DRAGON_ORANGE=18,w.DRAGON_PURPLE=19,w.DRAGON_PURPLE_LEAVE=20,w.FISH_SPLASH=21,w.STAR=22,w.DROP_DRAGON_ORANGE=23,w.definitions=[{},{type:P.EFFECT_POP_BUBBLE.type,animation:"default",scale:.75,sound:"snd_pop",soundDelay:.15},{type:P.EFFECT_FALL_BUBBLE.type,animation:"default",lockLast:!0,scale:1},{type:P.ROCKET.type,animation:"default",lockLast:!0,scale:1},{type:P.EFFECT_EXPLOSION.type,animation:"default",scale:1,sound:"snd_bomb",soundDelay:.15},{type:P.DRAGON_BLUE.type,animation:"flying",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:P.PLUS5.type,speed:0,key:"5plus.png",scale:1},{type:P.EFFECT_ROCKET_SMOKE.type,animation:"default",lockLast:!0,scale:1},{type:P.EFFECT_ROCKET_FIRE.type,animation:"default",repeat:!0,scale:1},{type:P.EFFECT_DRAGON_FLAME_JET.type,animation:"default",scale:1,sound:"snd_dragon_fire"},{type:P.EFFECT_BOOST_SMOKE.type,animation:"default",lockLast:!0,scale:1},{type:P.EFFECT_DRAGON_LIGHTNING.type,animation:"default",scale:1,sound:"snd_dragon_zap"},{type:P.DRAGON_EGG.type,animation:"default",repeat:!0,scale:1,sound:"snd_dragon_zap"},{type:P.ICE.type,animation:"cracking",scale:1},{type:P.EFFECT_FAKE_BUBBLE.type,lockLast:!0,key:"bble_red.png",scale:1,noAnim:!0},{type:P.EFFECT_SPARKLES_WHITE.type,animation:"default",scale:1},{type:P.EFFECT_SPARKLES_RAINBOW.type,animation:"default",scale:1},{type:P.EFFECT_DROP_FISH.type,animation:"default",repeat:!0,scale:1},{type:P.DRAGON_ORANGE.type,animation:"flying",repeat:!0,fadeOut:.1,soundOnLoop:"snd_wing",scale:1},{type:P.DRAGON_PURPLE.type,animation:"flying",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:P.DRAGON_PURPLE.type,animation:"gliding",repeat:!0,soundOnLoop:"snd_wing",scale:1},{type:P.EFFECT_FISH_SPLASH.type,animation:"default",scale:1},{type:P.EFFECT_STAR.type,animation:"default",lockLast:!0,scale:.5},{type:P.DRAGON_ORANGE.type,animation:"default",lockLast:!0,scale:1}],w.prototype.create=function(e,t,s,i){this.world=e,this.managers=t,this.playField=s,this.gridCollide=i,this.list=[]},w.prototype.destroy=function(){L.debug&&console.log("Effects.destroy"),this.reset(),this.list=null,this.gridCollide=null,this.playField=null,this.managers=null,this.world=null,this.game=null,this.target=null},w.prototype.reset=function(){L.debug&&console.log("Effects.reset");for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=[]},w.prototype.add=function(e,t,s,i,a,o,r,l){var h=new n,u=w.definitions[e];return h.create(t,u.type,this.managers.textures,s,i,l,r),h.anchor.set(.5),h.scale.set(u.scale),h.fxType=e,h.vx=h.vy=0,h.repeat=u.repeat,this.bespokeInit(e,h,t)?(void 0!==u.animation?h.setAnimation(u.animation,!1,!0):h.fxFrameNumber=u.first,h.bespokeLogic=a?a:null,h.bespokeLogicContext=o?o:this,this.list.push(h),u.sound&&this.game.managers.audio.play(u.sound),L.debugSpam&&console.log("Effects.add ["+this.list.length+"] type = "+e+" "+s+","+i),h):(h.destroy(),h=null,null)},w.prototype.bespokeInit=function(e,t){var s;switch(e){case w.DRAGON_GOLD:t.vx=96*Math.random()-48,t.vy=-48,t.hoverDelay=1500;break;case w.DRAGON_BLUE:if(s=this.game.world.playField.pickVisibleBubble(this.game.world.playField.grid[0].length-5,this.game.world.playField.grid[0].length-2),!s)return!1;t.dest=s,t.sx=35,t.sy=31,t.dx=t.dy=.92,t.vx=400,t.vy=0,t.leaving=!1,t.target=this.game.world.playField.grid[s.y][s.x];break;case w.DRAGON_ORANGE:if(s=this.game.world.playField.pickVisibleBubble(),!s)return!1;t.dest=s,t.vx=40*Math.random()-20,t.vy=-30,t.target=this.game.world.playField.grid[s.y][s.x],t.hoverDelay=1e3;break;case w.DRAGON_PURPLE:if(s=this.playField.pickVisibleSpace(),!s)return!1;var i=this.gridCollide.bubbleToGameUi(t),a=new n;a.create(L.gameUILayer,P.EFFECT_FAKE_BUBBLE.type,this.managers.textures,i.x,i.y,!1,!0),a.anchor.set(.5),t.dest=s,t.vx=40*Math.random()-20,t.vy=-30,t.target=this.game.world.playField.grid[s.y][s.x],t.hoverDelay=1e3,t.vx=64*Math.random()-32,t.vy=-50,t.dragging=a;break;case w.DRAGON_PURPLE_LEAVE:t.vy=-100-100*Math.random();break;case w.BOOST_BONUS5:t.vx=300,t.vy=0,t.sx=21,t.sy=25,t.dx=t.dy=.965,t.landingSpeed=90;break;case w.ROCKET:t.effectOverlay=this.addAttached(w.ROCKET_FIRE,t,-16,0);break;case w.FALL_BUBBLE:t.vx=40*Math.random()-20,t.vy=-60-100*Math.random();break;case w.DROP_FISH:t.moveToFront()}return!0},w.prototype.addAttached=function(e,t,s,i,a,o){L.debugSpam&&console.log("Effects.addAttached type = "+e+" "+s+","+i);var r=new n,l=w.definitions[e];return r.create(t.parent,l.type,this.managers.textures,t.x+s,t.y+i,!1),t.parent.setChildIndex(r,t.parent.getChildIndex(t)),r.anchor.set(t.anchor.x,t.anchor.y),r.scale.set(l.scale),r.fxType=e,r.fxFrameNumber=l.first,r.tz=t.tz,r.repeat=l.repeat,r.bespokeLogic=a?a:null,r.bespokeLogicContext=o?o:this,this.list.push(r),l.sound&&this.game.managers.audio.play(l.sound),r},w.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(null!==t.parent)if(t.shouldDie||t.bespokeLogic&&!t.bespokeLogic.call(t.bespokeLogicContext,t)){t.effectOverlay&&(t.effectOverlay.shouldDie=!0),t.dragging&&t.dragging.parent&&(t.dragging.destroy(),t.dragging=null);var s=t.fxType;t.destroy(),this.list.splice(e,1),L.debugSpam&&console.log("Effects destroy ["+this.list.length+"] type = "+s)}else{var i=w.definitions[t.fxType];if(i.animation&&t.atEnd){if(i.soundOnLoop&&t.repeat&&this.game.managers.audio.play(i.soundOnLoop),!t.repeat&&!i.lockLast){if(i.fadeOut>0&&(t.alpha-=i.fadeOut,t.alpha>0))continue;var a=t.fxType;t.destroy(),this.list.splice(e,1),L.debugSpam&&console.log("Effects anim destroy ["+this.list.length+"] type = "+a);continue}t.atEnd=!1}t.update(),i.rotation&&(t.rotation+=i.rotation)}else t.destroy(),this.list.splice(e,1)}return this.list.length},w.prototype.getKeyName=function(e,t){var s=w.definitions[e];return s.key?s.key:void 0===t||0===s.speed?s.baseKey+(s.keySubscript?s.keySubscript:""):s.digits?s.baseKey+N.padToLength(t.toString(),s.digits,"0",!1)+(s.keySubscript?s.keySubscript:""):s.baseKey+t.toString()+(s.keySubscript?s.keySubscript:"")},w.swoopToGridTarget=function(e,t,s){if(e.target&&null===e.target.game){var i=t.pickVisibleBubble();if(!i)return e.target=null,!1;e.dest=i,e.target=t.grid[i.y][i.x]}var a=t.gridCollide.gridToGameUi(e.dest);return s&&(a.x+=s.x,a.y+=s.y),w.swoopToTarget(e,a)},w.swoopToTarget=function(e,t){var s=t.x-e.x,i=t.y-e.y,a=s*s+i*i,o=Math.sqrt(a);return e.vx+=(e.sx||25)*s/o,e.vy+=(e.sy||21)*i/o,e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,o<4*I.bubbleRadius?(e.vx*=e.dx||.94,e.vy*=e.dy||.94):(e.vx*=.98,e.vy*=.98),o<I.bubbleRadius&&Math.abs(e.vx)+1.6*Math.abs(e.vy)<(e.landingSpeed||55)?!1:!0},w.prototype.countDragonsFlying=function(){for(var e=0,t=this.list.length-1;t>=0;--t){var s=this.list[t];(s.fxType==w.DRAGON_BLUE||s.fxType==w.DRAGON_ORANGE)&&e++}return e},w.prototype.count=function(){return this.list.length},w.starFall=function(e){return w.fall(e),e.rotation+=.1,--e.life>0},w.bubbleFall=function(e){var t;switch(w.fall(e),e.type){case P.EFFECT_DROP_FISH.type:e.rotation+=e.vr,e.y>=I.killAtBottom&&(B.effects.add(w.FISH_SPLASH,e.parent,e.x,e.y),t=B.effects.add(w.FISH_SPLASH,this.game.world.fishWidget,.25,-.5,null,null,!1,!0),t&&t.scale.set(1),this.game.foodCount--,this.game.managers.audio.play("snd_collect_fish"))}return e.y<I.killAtBottom},w.fall=function(e){return e.vx*=.985,e.vy+=w.GRAVITY,e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,!0},GridCollide=function(){},GridCollide.prototype.create=function(e,t,s){this.grid=e,this.offsetY=0,this.spacingx=t,this.spacingy=s},GridCollide.prototype.destroy=function(){L.debug&&console.log("GridCollide.destroy"),this.grid=null},GridCollide.prototype.gameUiToGrid=function(e){var t=(e.x+I.gridOffsetX)/this.spacingx,s=(e.y+I.gridOffsetY-this.offsetY)/this.spacingy,i=Math.round(t),a=Math.round(s);return 0>a&&(console.log("gameUiToGrid outside y "+a),a=0),a>=this.grid.length&&(console.log("gameUiToGrid outside y "+a),a=this.grid.length-1),0>i&&(console.log("gameUiToGrid outside x "+i),i=0),i>=this.grid[a].length&&(console.log("gameUiToGrid outside x "+i),i=this.grid[a].length-1),-1==this.grid[a][i]?i>=this.grid[a].length-1||i>0&&t-Math.floor(t)>=.5?{x:i-1,y:a}:{x:i+1,y:a}:{x:i,y:a}},GridCollide.prototype.bubbleToGrid=function(e){var t=(e.x+I.gridOffsetX)/this.spacingx,s=(e.y+I.gridOffsetY)/this.spacingy,i=Math.round(t),a=Math.round(s);return a>=0&&a<this.grid.length&&i>=0&&i<this.grid[a].length?-1==this.grid[a][i]?i>=this.grid[a].length-1?{x:i-1,y:a}:0>=i?{x:i+1,y:a}:t-Math.floor(t)<.5?{x:i-1,y:a}:{x:i+1,y:a}:{x:i,y:a}:(L.debug&&console.log("WARNING: bubbleToGrid outside of grid. rx="+i+" ry="+a),{x:i,y:a})},GridCollide.prototype.bubbleToFractionalGrid=function(e){var t=(e.x+I.gridOffsetX)/this.spacingx,s=(e.y+I.gridOffsetY)/this.spacingy;return{x:t,y:s}},GridCollide.prototype.gridToGameUi=function(e){var t=e.x*this.spacingx-I.gridOffsetX,s=e.y*this.spacingy-I.gridOffsetY+this.offsetY;return{x:t,y:s}},GridCollide.prototype.gridToBubble=function(e){var t=e.x*this.spacingx-I.gridOffsetX,s=e.y*this.spacingy-I.gridOffsetY;return{x:t,y:s}},GridCollide.prototype.gameUiToBubble=function(e){return{x:e.x,y:e.y-this.offsetY}},GridCollide.prototype.bubbleToGameUi=function(e){return{x:e.x,y:e.y+this.offsetY}},GridCollide.prototype.empty=function(e){if(e.y<0||e.y>=this.grid.length)return!1;if(e.x<0||e.x>=this.grid[e.y].length)return!1;var t=this.grid[e.y][e.x];return!t},GridCollide.prototype.get=function(e){var t=Math.floor(e.y);if(0>t||t>=this.grid.length)return null;var s=Math.floor(e.x);return 0>s||s>=this.grid[t].length?null:this.grid[t][s]},GridCollide.prototype.collide=function(e,t){for(var s=[],i=this.gameUiToGrid(e),a=i.y-t;a<=i.y+t;a++)if(a>=0&&a<this.grid.length)for(var o=i.x-2*t;o<=i.x+2*t;o++)if(o>=0&&o<this.grid[a].length){var n=this.grid[a][o];n&&-1!==n&&s.push(this.grid[a][o])}return s},GridCollide.prototype.outsideGrid=function(e){var t=e.x;if(t<-I.gridOffsetX)return!0;if(t>I.gridOffsetX)return!0;var s=e.y+I.gridOffsetY;return s<I.mapTop[I.levelType]?!0:!1},GridCollide.prototype.randomLocation=function(e,t,s){void 0===s&&(s=Math.random);var i,a;do a=Math.floor(s()*e.length),i=Math.floor(s()*e[a].length);while(-1==e[a][i]||t&&!e[a][i]);return{x:i,y:a}},GridCollide.prototype.removeBubble=function(e){if(this.grid){var t=this.bubbleToGrid(e.sprite),s=this.get(t);s==e&&(L.debugSpam&&console.log("GridCollide.removeBubble "+e.key+" at "+t.x+","+t.y),this.grid[t.y][t.x]=0)}},S.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new F,this.textureManager.create(),this.dataManager=new O,this.dataManager.create(),this.localeManager=new v,this.audioManager=new R,this.loadManager=new f,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers());var s=this.lowResolution?"low":"high";this.textureManager.addImage("load_spinner",this.baseUrl+"images/_reduced/"+s+"/preloader/loading.png"),this.textureManager.addImage("preloader_bg",this.baseUrl+"images/_reduced/high/preloader/splash_screen.jpg"),this.textureManager.addImage("square_red",this.baseUrl+"images/_reduced/high/preloader/redSquare.png"),this.textureManager.addImage("square_green",this.baseUrl+"images/_reduced/high/preloader/greenSquare.png"),this.textureManager.addImage("square_cyan",this.baseUrl+"images/_reduced/high/preloader/cyanSquare.png"),this.textureManager.addImage("square_empty",this.baseUrl+"images/_reduced/high/preloader/emptySquare.png"),this.textureManager.startLoading(this.preloaderReady,this)},S.prototype.preloaderReady=function(){var e=this;L.bottomUI.texture=this.textureManager.get("square_empty"),L.bottomUI.width=L.bottomUI.rectWidth,L.bottomUI.height=L.height,L.bottomUI.y=L.bottomUI.parent.y,L.topUI.texture=this.textureManager.get("square_empty"),L.topUI.width=L.topUI.rectWidth,L.topUI.height=L.height,L.topUI.y=-L.topUI.parent.y,this.bg=new n,this.bg.create(L.bgImage,"preloader_bg",this.textureManager),this.bg.anchor.set(.5),this.loadWidget=new n,this.loadWidget.create(L.fullUI,"load_spinner",this.textureManager),this.loadWidget.anchor.set(.5),this.loadWidget.scale.set(this.lowResolution?4:2);
var t=this.baseUrl+(this.lowResolution?"images/_reduced/low/":"images/_reduced/high/");this.textureManager.addImage("game_title",t+"UI/TitlePage/title_bg.jpg"),this.textureManager.addImage("title_text",t+"UI/TitlePage/title_bubdrag.png"),this.textureManager.addImage("menu_play_button",t+"UI/TitlePage/button_start.png"),this.textureManager.addImage("blanker",t+"menus/blanker.png"),this.textureManager.addAtlas("panelsAtlas",t+"panelsAtlas.json",t+"panelsAtlas.png"),this.textureManager.addAtlas("gameAtlas",t+"gameAtlas.json",t+"gameAtlas.png"),this.textureManager.addImage("game_bg1",t+"backgrounds/forest-stage-bg.jpg"),this.textureManager.addImage("game_bg2",t+"backgrounds/river-stage-bg.jpg"),this.textureManager.addImage("game_bg3",t+"backgrounds/cave-stage-bg.jpg"),this.textureManager.addImage("game_bg4",t+"backgrounds/desert-stage-bg.jpg"),this.textureManager.addImage("game_bg5",t+"backgrounds/lake-stage-bg.jpg"),this.textureManager.addImage("game_bg6",t+"backgrounds/cave-stage-bg2.jpg"),this.textureManager.startLoading(),this.loadAudioAssets();var s=this.baseUrl+"data/levelData.json";L.challengeMode||(s=this.baseUrl+"data/levelDataSaga.json"),this.dataManager.loadData("levels",s,function(){e.levels=e.dataManager.get("levels").levels.length}),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){L.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)})},S.prototype.loadAudioAssets=function(){this.audioManager.loadAudio("game_over_tune",this.baseUrl+"sounds/bgm_game_over",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_win_tune",this.baseUrl+"sounds/bgm_game_win",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/bgm_gameplay",["mp3","m4a","ogg"]),this.audioManager.loadAudio("game_title_tune",this.baseUrl+"sounds/bgm_opening",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_bomb",this.baseUrl+"sounds/sfx_bomb_explosion",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_bubbleBounce",this.baseUrl+"sounds/sfx_bubble_bounce",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_fireball",this.baseUrl+"sounds/sfx_bubble_fireball",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_mine",this.baseUrl+"sounds/sfx_booster_mine",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_pop",this.baseUrl+"sounds/sfx_bubble_pop",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_shoot",this.baseUrl+"sounds/sfx_bubble_shoot",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_stick",this.baseUrl+"sounds/sfx_bubble_stick",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_dragon_zap",this.baseUrl+"sounds/sfx_booster_dragon_zap",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_click",this.baseUrl+"sounds/sfx_button_click",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_crack",this.baseUrl+"sounds/sfx_crack_open",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_firework_launch",this.baseUrl+"sounds/sfx_firework_launch",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_moves_up",this.baseUrl+"sounds/sfx_booster_extra_moves",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_popup_flying",this.baseUrl+"sounds/sfx_popup_movement",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_warning",this.baseUrl+"sounds/sfx_warning_sound",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_wing",this.baseUrl+"sounds/sfx_dragon_fly",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_booster_award",this.baseUrl+"sounds/sfx_booster_gained",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_stick_top",this.baseUrl+"sounds/sfx_bubble_stick_top",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_collect_fish",this.baseUrl+"sounds/sfx_collect_fish",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_ice_crack",this.baseUrl+"sounds/sfx_ice_break",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_dragon_fire",this.baseUrl+"sounds/sfx_special_dragon_fire",["mp3","m4a","ogg"]),this.audioManager.loadAudio("snd_rainbow",this.baseUrl+"sounds/sfx_special_wild",["mp3","m4a","ogg"])},S.prototype.cleanUp=function(){this.root=null,this.loadWidget&&(this.loadWidget.destroy(),this.loadWidget=null),this.bg&&(this.bg.destroy(),this.bg=null)},S.prototype.update=function(){this.loadWidget&&(this.loadWidget.rotation+=Math.PI/180,this.loadWidget.update())},S.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.cleanUp(),!0):!1},S.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},L.timeStarted=Date.now(),L.width=null,L.height=null,L.HTMLElement=null,L.shiftPlayfield=.37083333,L.self=null,L.lockedLevels=null,L.levelScores=null,L.levelStars=null,L.levelLosses=null,L.prototype.createGame=function(t,s,i){new e,e.resizeCanvas(),L.arenaHelper||(L.arenaHelper=new C);var a=window?window.devicePixelRatio:1;L.app=new PIXI.Application(t||L.gameWide,s||L.gameHigh,{autoResize:!0,resolution:a}),L.renderer=L.app.renderer,L.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device"));var o=null;return null!==i&&(o=document.getElementById(i)),L.HTMLElement=o,o?o.appendChild(L.app.view):document.body.appendChild(L.app.view),L.getFocus(),L.suppressBigAnimations=L.renderer instanceof PIXI.CanvasRenderer?!0:!1,L.debug&&console.log("Main.suppressBigAnimations =",L.suppressBigAnimations),L.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,L.debug&&console.log("Main.android device =",L.isAndroid),L.isChromeMobile=PIXI.utils.isMobile.other.chrome,L.debug&&console.log("Main.isChromeMobile =",L.isChromeMobile),L.stage=L.app.stage,L.stage.x=L.gameWide/2,L.stage.y=L.gameHigh/2,L.bgImage=new PIXI.Sprite,L.bgImage.anchor.set(.5,.5),L.stage.addChild(L.bgImage),L.backgroundLayer=new PIXI.Sprite,L.backgroundLayer.anchor.set(.5,.5),L.stage.addChild(L.backgroundLayer),L.bubbleLayer=new PIXI.Sprite,L.bubbleLayer.anchor.set(.5,1),L.stage.addChild(L.bubbleLayer),L.gameUILayer=new PIXI.Sprite,L.gameUILayer.anchor.set(.5,.5),L.stage.addChild(L.gameUILayer),L.bottomUI=new PIXI.Sprite,L.bottomUI.anchor.set(.5,1),L.stage.addChild(L.bottomUI),L.topUI=new PIXI.Sprite,L.topUI.anchor.set(.5,0),L.stage.addChild(L.topUI),L.fullUI=new PIXI.Sprite,L.fullUI.anchor.set(.5,.5),L.fullUIScale=1,L.stage.addChild(L.fullUI),e.resizeCanvas(),e.pixiListeners(L.renderer),_gameGATracker("create","UA-68188765-28","auto"),_gameGATracker("send","pageview",{page:"/LoadingScene"}),L.nowTime=Date.now(),L.time=0,L.repeatedGamesLeft=L.playAgainCount,this.gameControl=new k,this.gameControl.create(),L.generateLevelData?void D.createAllData():void new _(["bub_font1","bub_font2"],this.playGame,this)},L.prototype.playGame=function(){L.debug&&console.log("starting game loop");var t=null;L.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=PIXI.ticker.shared;i.autoStart=!1,i.stop(),i=PIXI.ticker,i.autoStart=!1;var a=!1,o=function(){a?requestAnimationFrame(o):(a=!0,L._lastTime=L.nowTime,L.nowTime=Date.now(),L.elapsedTime=Math.min(L.nowTime-L._lastTime,33),L.time+=L.elapsedTime,requestAnimationFrame(o),t&&t.begin(),L.resized?L.nowTime-L.resizeTime>100&&(e.resizeContent(),s.gameControl.update()):s.gameControl.update(),L.resizeConsumed&&(L.resized=!1,L.resizeConsumed=!1),L.forceResize&&e.resizeCanvas(),t&&t.end(),a=!1)};requestAnimationFrame(o)},L.createTextStyles=function(e){var t=e.get("text_styles");L.textStyleVersionTiny=L.wrapTextStyle(t.textStyleVersionTiny),L.textStyleBigMessageTitle=L.wrapTextStyle(t.textStyleBigMessageTitle),L.textStyleBigMessage=L.wrapTextStyle(t.textStyleBigMessage),L.textStyleMediumMessage=L.wrapTextStyle(t.textStyleMediumMessage),L.textStyleBigMessageSubText=L.wrapTextStyle(t.textStyleBigMessageSubText),L.textStyleBigMessageObjective=L.wrapTextStyle(t.textStyleBigMessageObjective),L.textStyleBigMessageObjTitle=L.wrapTextStyle(t.textStyleBigMessageObjTitle),L.textStyleHelpBannerTitle=L.wrapTextStyle(t.textStyleHelpBannerTitle),L.textStyleHelpBoostTitle=L.wrapTextStyle(t.textStyleHelpBoostTitle),L.textStyleHelpBoostDescription=L.wrapTextStyle(t.textStyleHelpBoostDescription),L.textStyleUIScoreAndShots=L.wrapTextStyle(t.textStyleUIScoreAndShots),L.textStyleUILevelNumber=L.wrapTextStyle(t.textStyleUILevelNumber),L.textStyleSelectLevelNumber=L.wrapTextStyle(t.textStyleSelectLevelNumber),L.textStyleShowLevelNumber=L.wrapTextStyle(t.textStyleShowLevelNumber),L.textStyleBold=L.wrapTextStyle(t.textStyleBold),L.textStyleBoldSmall=L.wrapTextStyle(t.textStyleBoldSmall),L.textStyleBoldButtons=L.wrapTextStyle(t.textStyleBoldButtons),L.textStyleBoldButtonsLarge=L.wrapTextStyle(t.textStyleBoldButtonsLarge),L.textStyleBoldButtonTitles=L.wrapTextStyle(t.textStyleBoldButtonTitles),L.textStyleBoldLargeCentered=L.wrapTextStyle(t.textStyleBoldLargeCentered),L.textStyleMedium=L.wrapTextStyle(t.textStyleMedium),L.textStyleMedium2=L.wrapTextStyle(t.textStyleMedium2),L.textStyleMediumTiny=L.wrapTextStyle(t.textStyleMediumTiny),L.textStyleLarge=L.wrapTextStyle(t.textStyleLarge)},L.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return N.setValuesFromObject(t,e),t},L.render=function(){L.renderer.render(L.stage),e.resizeCanvas()},L.unlockLevel=function(e){L.debug&&console.log("unlocked level "+e),L.lockedLevels||(L.lockedLevels=[]),L.lockedLevels[e]=!1},L.resetInput=function(){e.resetInput(),L.click=null,L.hover=null,L.mouseDown=null,L.mouseUp=null,L.swipe=0},L.getFocus=function(){L.app&&L.app.view&&(L.app.view.setAttribute("tabindex","-1"),L.app.view.focus()),G.create()},k.firstLevel=11,k.GameStates={NONE:-1,PRELOAD:0,TITLES:1,LEVEL_SELECT:2,MENU_FADE:3,PLAY:4},k.pageHidden=!1,k.prototype.create=function(){this.preloader=new S(L.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,L.lowResolutionAssets),this.lastState=k.GameStates.NONE,this.state=k.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null,this.level=1,this.menu=null},k.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,L.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case k.GameStates.PRELOAD:if(this.preloader.update(),this.preloader.allLoaded()){this.state=k.GameStates.TITLES,N.focusChangeCallback=this.onFocusChange,N.focusChangeContext=this,N.detectHidden(),k.pageHidden=N.isHidden();var i=this.preloader.dataManager.get("levels");L.totalShots=i.numShots,this.preloader.loadManager.loadGameStatus(),t=!0}break;case k.GameStates.TITLES:s&&(G.create(),e.clearCallbacks(),this.preloader.audioManager.stopTune(),this.resetInput(),this.titles=new T,this.titles.create(this.preloader)),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,L.challengeMode?(this.level=k.firstLevel,this.state=k.GameStates.PLAY):this.state=k.GameStates.LEVEL_SELECT);break;case k.GameStates.LEVEL_SELECT:s&&(this.preloader.audioManager.startTune("game_title_tune"),this.menu=new p,this.menu.create(this,this.preloader.getManagers(),this.level)),this.level=this.menu.update(),this.level>0&&(this.state=k.GameStates.MENU_FADE);break;case k.GameStates.MENU_FADE:this.menu.remove()||(this.state=k.GameStates.PLAY,this.menu=null);break;case k.GameStates.PLAY:if(s){L.arenaHelper.sendGameStart(),this.resetInput(),this.game=new I;var a=this.preloader.levels;L.challengeMode||(a=L.numSagaLevels),this.game.create(this.preloader.getManagers(),this.level,a)}this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,!I.requestQuit||L.challengeMode?this.state=k.GameStates.TITLES:(this.lastState=k.GameStates.NONE,this.state=k.GameStates.LEVEL_SELECT))}}while(t);L.mouseDown&&L.getFocus(),L.render()},k.prototype.resetInput=function(){G.reset(),L.resetInput()},k.prototype.onFocusChange=function(e){e||L.getFocus(),(L.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(I.paused=null!==I.options,L.time=1e3*Math.floor(L.time/1e3)+999,this.preloader.audioManager.visibilityMute(k.pageHidden),L.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},T.ready=!1,T.first=!0;var H=800,z=100;T.pieces=[{key:"title_text",x:0,y:-90,alpha:0,fade:.05},{key:"menu_play_button",x:0,y:300,button:{over:"menu_play_button",down:"menu_play_button",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){T.ready=!0},duration:H+5*z,easing:"bounce"}}],T.prototype.create=function(e){T.ready=!1,this.preloader=e,this.managers=this.preloader.getManagers(),this.bg=new n,this.bg.create(L.bgImage,"game_title",this.managers.textures),this.bg.anchor.set(.5),this.bg.y=0,this.version=new r(L.VERSION,L.textStyleVersionTiny),this.version.create(L.fullUI,.49,.49,!0),this.version.anchor.set(1),window.devicePixelRatio||(window.devicePixelRatio=1),this.version.scale.set(.5*window.devicePixelRatio/L.fullUI.scale.x),L.fullUIScale=1,L.forceResize=!0;var t=y.createTweens(T.pieces,L.fullUI,this.managers,0,0,L.textStyleBoldButtonTitles);this.sprites=t.sprites,this.buttons=t.buttons,this.fader=new x,this.fader.setFade(.1),L.debug&&console.log("titles are fading in"),T.first||this.managers.audio.startTune("game_title_tune"),T.first=!1,L.eventChangeAdOnTitlesShow&&L.arenaHelper.sendEventChange()},T.prototype.startAudio=function(){e.clearCallback("mousedown",this.startAudio),L.debugSpam&&console.log("Titles.startAudio"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(console.log("retry loadAudioAssets from input gesture"),this.preloader.loadAudioAssets()),this.managers.audio.play("snd_click"))},T.prototype.destroy=function(){var e;if(L.fullUIScale=1,L.forceResize=!0,this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},T.prototype.update=function(){var e,t="";if(L.resized&&(this.version.destroy(),this.version=new r(L.VERSION,L.textStyleVersionTiny),this.version.create(L.fullUI,.49,.49,!0),this.version.anchor.set(1),this.version.scale.set(.5/L.fullUI.scale.x)),!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&T.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.version&&this.version.update(),this.fader.reached(1)&&(0!==L.eventChangeAdOnIdle&&(L.idleTimer-=L.elapsedTime,L.idleTimer<0&&(L.arenaHelper.sendEventChange(),L.idleTimer=Number.MAX_VALUE)),("click_start"==t||G.isPressed[32])&&(this.managers.audio.play("snd_click"),_gameGATracker("send","event",L.VERSION,"start_game","BUBB_HTML5",1),L.idleTimer=L.eventChangeAdOnIdle,L.hover=null,L.click=null,G.reset(32),this.fader.setFade(-.05),L.eventChangeAdOnTitlesClose&&L.arenaHelper.sendEventChange(),L.debug&&console.log("Titles: start fading out"))),!0},I.maxRowsHigh=12,I.width=12,I.height=200,I.bubbleRadius=43,I.bubbleDiameter=2*I.bubbleRadius,I.scrollSpeed=176,I.shotSpeed=2e3,I.shotStep=2,I.trajectoryLength=25,I.mapTop=[-180,5*-I.bubbleDiameter,5*-I.bubbleDiameter],I.gameUILayerTop=-615,I.scrollLineY=[14*-I.bubbleRadius,10*-I.bubbleRadius,10*-I.bubbleRadius],I.goalStrings=["string_level_goal_protect","string_level_goal_crack_egg","string_level_goal_collect"],I.goalFailStrings=["string_level_goal_protect_fail","string_level_goal_crack_egg_fail","string_level_goal_collect_fail"],I.goalIcons=["barrier_objective.png","egg_objective.png","fish_objective.png"],I.barrierOffsetY=2*-I.bubbleDiameter,I.bubbleInvasionY=1.25*-I.bubbleDiameter,I.bubbleInvasionUrgent=2.5*-I.bubbleDiameter,I.bubbleInvasionWarning=3.5*-I.bubbleDiameter,I.killAtBottom=6*I.bubbleDiameter,I.aimAngleLimit=75,I.shooterRadius=1.7*I.bubbleDiameter,I.launcherY=.5,I.shotOffsetY=3.5*I.bubbleDiameter,I.queuePositionX1=2.12*I.bubbleDiameter,I.queuePositionY1=2*I.bubbleDiameter,I.queuePositionScale=.85,I.bubbleRub=10,I.bubbleCollisionRadius=I.bubbleRadius-I.bubbleRub,I.sideBarOffset=I.width/2*I.bubbleDiameter,I.gridOffsetX=(I.width-1)*I.bubbleRadius,I.gridOffsetY=159,I.survivalSpeed=11,I.chainReactionDelay=250,I.pulseScaler=.75,I.pulseDecay=.82,I.fireBallDeceleration=.83,I.bonusShootDelay=100,I.bonusShootSpeed=20,I.popBoost=1,I.catchUpBoost=2,I.dropBubbleBoost=10,I.boostImageOffsetX=-2.17*I.bubbleDiameter,I.boostImageOffsetY=2.6*-I.bubbleDiameter,I.scoreFirstPop=100,I.scoreMultiplyPop=10,I.scoreFirstDrop=20,I.scoreSpecialBadDrop=10,I.scoreSpecialGoodDrop=30,I.scoreCatchUp=5,I.bonusScoreFinale=150,I.bonusScoreFinale_Extras=30,I.defaultBoostFullBar=100,I.defaultBoostGainCost=20,I.starBarFirstStar=50,I.starBarSecondStar=75,I.starBarThirdStar=100,I.frameCount=0,I.paused=!1,I.boostFullBar=I.defaultBoostFullBar,I.boostGainCost=I.defaultBoostGainCost,I.boostCharge=0,I.boostCanCharge=!0,I.boostType=-1,I.requestQuit=!1,I.starScore=0,I.starsPcnt=0,I.stars=0,I.score=0,I.lastScore=0,I.highScore=0,L.debug&&console.log("Game() instanciation resetting shotsLeft"),I.shotsLeft=0,I.options=null,I.levelType=0,I.popCount=0,I.LEVEL_START=1,I.LEVEL_INTRO=2,I.PLAYING=3,I.WON_LEVEL=4,I.LOST_LEVEL=5,I.FINAL_MESSAGE=6,I.NEXT_LEVEL=7,I.GAME_WON=8,I.WAIT_DELAY=9,I.REMOVE_MSG_QUIT=10,I.QUIT_REQUEST=11,LevelType={},LevelType.ConvertNames=null,LevelType.GOAL_PROTECT_BARRIER=0,LevelType.GOAL_BREAK_EGG=1,LevelType.GOAL_RESCUE_FISH=2,I.prototype.create=function(e,t,s){this.managers=e,this.numLevels=s,L.bubbleLayer.alpha=.01,I.paused=!1,I.requestQuit=!1,I.requestQuitHandled=!1,I.starScore=0,I.starsPcnt=0,I.stars=0,I.score=0,I.lastScore=0,L.debug&&console.log("Game.create resetting shotsLeft"),I.shotsLeft=L.totalShots,this.level=t-1,this.help=null,this.menu=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=I.LEVEL_START,this.nextState=-1,this.delay=0,this.foodCount=0,this.foodTotal=0,this.droppedLastFish=!1,L.arenaHelper.addPauseAndResumeActions(I.pauseGame.bind(this),I.resumeGame.bind(this)),_gameGATracker("send","pageview",{page:"/GameScene"})},I.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.menu&&(this.menu.destroy(),this.menu=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),I.options&&(I.options.destroy(),I.options=null),this.managers=null},I.prototype.update=function(){var e=!0,t=this;if(I.frameCount++,this.confirm){if(this.confirm.update())return e;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return e;this.help.remove(function(){t.help=null})}if(I.paused&&I.options)return I.options.update()?e:(I.options.remove(I.optionsDestroyed),e);I.requestQuit&&!I.requestQuitHandled&&(this.state=I.QUIT_REQUEST,I.requestQuitHandled=!0),L.bubbleLayer.alpha<1&&(L.bubbleLayer.alpha=Math.min(L.bubbleLayer.alpha+.05,1),L.backgroundLayer.alpha=L.gameUILayer.alpha=L.bubbleLayer.alpha);var s,i;do switch(i=this.lastState!=this.state,this.lastState=this.state,s=!1,this.state){case I.LEVEL_START:if(i||this.world&&!this.world.game){if(this.managers.audio.startTune("game_tune",!1),_gameGATracker("send","event",L.VERSION,"start_level_"+(this.level+1),"BUBB_HTML5",0),I.boostCharge=0,I.boostCanCharge=!0,I.stars=0,I.starsPcnt=0,this.world=new B(this),this.world.create(this.managers,this.level),L.bubbleLayer.alpha=.01,!L.challengeMode){I.score=0;var a=this.world.levelData,o=11.5*a.height-a.holes.number;I.starScore=500*Math.pow(o/(10+a.list.length),1.5)+("boost_mine"==a.boost.id?2e3:0)+("boost_fireball"==a.boost.id?2e3:0)+("boost_wild"==a.boost.id?2e3:0)+("level_collect_fish"==a._id?-2e3:0)+("level_protect_barrier"==a._id?-2e3:0),I.starScore*=.6,L.debug&&console.log("**** star score = "+I.starScore+" **** bubbles = "+o)}I.lastScore=I.score}L.bgImage.alpha<1&&(L.bgImage.alpha+=.1),this.world.update(),this.world.levelShown()&&(this.state=I.LEVEL_INTRO);break;case I.LEVEL_INTRO:if(i){this.foodTotal=this.foodCount,this.droppedLastFish=!1;var n=I.goalIcons[I.levelType];this.bm=new h,this.bm.createObjective(L.fullUI,this.managers,I.goalStrings[I.levelType],"string_level_goal_title",n),this.bm.timeOut=3e3}this.bm?((L.click||G.isPressed[32])&&(L.click=null,G.reset(),this.bm.remove(this,"bm")),this.bm.update()||(this.bm.destroy(),this.bm=null)):this.state=I.PLAYING;break;case I.PLAYING:i&&(L.idleTimer=L.eventChangeAdOnIdle),this.world.update()?0!==L.eventChangeAdOnIdle&&(L.idleTimer-=L.elapsedTime,L.idleTimer<0&&(L.arenaHelper.sendEventChange(),L.idleTimer=Number.MAX_VALUE)):(this.world.shooter.hideTrajectory(),this.world.levelBeaten()?(L.debug&&console.log("level won"),_gameGATracker("send","pageview",{page:"/LevelCompletePopup"}),this.state=I.WON_LEVEL):(L.debug&&console.log("level lost"),this.state=I.LOST_LEVEL)),this.calculateStars()&&this.world.updateStars();break;case I.WON_LEVEL:if(i){this.managers.audio.startTune("game_win_tune",!0),L.challengeMode||(L.unlockLevel(this.level),I.stars>=1&&L.unlockLevel(this.level+1),L.levelScores[this.level]=Math.max(L.levelScores[this.level],I.score-I.lastScore),L.levelStars[this.level]=Math.max(L.levelStars[this.level],I.stars),L.levelLosses[this.level]=0,this.managers.loadSave.saveGameStatus()),_gameGATracker("send","event",L.VERSION,"win_level_"+(this.level+1),"BUBB_HTML5",I.score);var r=(this.level+1).toString(),l=null;L.challengeMode&&(r+=" / "+this.numLevels.toString(),this.level<this.numLevels-1&&(l=this.managers.locale.get("string_level_complete_carried1")+" "+I.shotsLeft.toString()+" "+this.managers.locale.get("string_level_complete_carried2"))),this.bm=new h,this.bm.createLevelWon(L.fullUI,this.managers,this.managers.locale.get("string_level_complete"),r,l),this.bm.timeOut=L.fastLevelSwitch?1e3:3800,L.debug&&console.log("**** final score = "+(I.score-I.lastScore)+" ****")}this.world&&(this.world.updateScore(),B.effects.update()),this.bm.update()||(this.state=I.NEXT_LEVEL);break;case I.NEXT_LEVEL:if((L.challengeMode||I.stars>=1)&&this.level++,this.level>this.numLevels-1){this.state=I.GAME_WON,s=!0;break}this.world.destroy(),this.state=I.LEVEL_START,s=!0;break;case I.LOST_LEVEL:i&&(this.managers.audio.startTune("game_over_tune",!0),L.challengeMode||(void 0===L.levelLosses[this.level]&&(L.levelLosses[this.level]=0),L.levelLosses[this.level]++,this.managers.loadSave.saveGameStatus()),I.score>I.highScore&&(I.highScore=I.score),this.bm=new h,L.challengeMode?this.bm.createWinLose(L.fullUI,this.managers,"string_lose",I.goalFailStrings[I.levelType],!1):this.bm.createWinLose(L.fullUI,this.managers,"string_lose",I.goalFailStrings[I.levelType],!1,!0),this.state=I.FINAL_MESSAGE);break;case I.GAME_WON:_gameGATracker("send","event",L.VERSION,"win_game_timer","BUBB_HTML5",0),I.score>I.highScore&&(I.highScore=I.score),this.bm=new h,this.bm.createWinLose(L.fullUI,this.managers,"string_win",null,!0),this.state=I.FINAL_MESSAGE;break;case I.QUIT_REQUEST:if(i){_gameGATracker("send","event",L.VERSION,"quit_game_timer","BUBB_HTML5",Math.round((L.nowTime-L.timeStarted)/1e3)),_gameGATracker("send","event",L.VERSION,"submit_score","BUBB_HTML5",I.score),0===I.score&&_gameGATracker("send","event",L.VERSION,"abandon","BUBB_HTML5",1),I.score>I.highScore&&(I.highScore=I.score),this.bm=new h;var u=this.managers.locale.get("game_quit_title")+"\n\n"+this.managers.locale.get("string_score")+" "+N.formatBigNumber(I.score)+"\n"+this.managers.locale.get("string_high_score")+" "+N.formatBigNumber(I.highScore)+"\n";this.bm.create(L.fullUI,this.managers,u),this.state=I.FINAL_MESSAGE}break;case I.FINAL_MESSAGE:if(i){{Math.min(this.level+1,this.numLevels)}this.bm.timeOut=L.fastLevelSwitch?1e3:5e3,_gameGATracker("send","pageview",{page:"/GameOverPopup"})}this.world&&this.world.updateScore();var c=this.bm.update();if(c===!1||"quit"==c||"retry"==c){if(this.bm.destroy(),this.bm=null,"retry"==c){this.world.destroy(),this.delay=1e3,this.state=I.WAIT_DELAY,this.nextState=I.LEVEL_START;break}_gameGATracker("send","event",L.VERSION,"submit_score","BUBB_HTML5",I.score),L.arenaHelper.sendGameEnd(I.highScore),this.delay=I.requestQuit?1e3:4e3,this.state=I.WAIT_DELAY,this.nextState=I.REMOVE_MSG_QUIT}break;case I.WAIT_DELAY:this.delay=Math.max(this.delay-L.elapsedTime,0),0===this.delay?(this.state=this.nextState,s=!0):this.bm&&this.bm.update();break;case I.REMOVE_MSG_QUIT:i&&this.bm&&this.bm.remove(this,"bm"),this.bm?this.bm.update()||(this.bm=null):(this.world.destroy(),e=!1)}while(s);return e},I.prototype.calculateStars=function(){if(L.challengeMode)return!1;var e=I.score-I.lastScore,t=100*e/I.starScore,s=I.stars;return I.stars=50>t?0:75>t?1:100>t?2:3,I.starsPcnt=Math.min(t,100),s!=I.stars},I.prototype.showHelp=function(){this.help=new b(this.world.levelData),this.help.create(this.managers)},I.prototype.showConfirm=function(e,t,s,i){this.confirm=new d,this.confirm.create(this,this.managers,e,t,s,i)},I.prototype.pauseToggle=function(){I.paused=!I.paused,L.debug&&console.log(I.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),I.paused?(I.options=new m,I.options.create(this,this.managers),_gameGATracker("send","event",L.VERSION,"help","BUBB_HTML5",1)):I.options&&(I.options.destroy(),I.options=null)},I.pauseGame=function(){L.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),I.paused=!0,_gameGATracker("send","pageview",{page:"/PausePopup"})},I.resumeGame=function(){L.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),I.paused=null!==I.options,_gameGATracker("send","pageview",{page:"/GameScene"})},I.optionsDestroyed=function(){I.options=null,I.paused=!1},B.brighter=null,B.brighter2=null,B.effects=null,B.prototype.create=function(e,t){if(L.debug&&console.log("World.create "+t),this.managers=e,this.level=t,L.swipeEnabled=!1,L.mouseMoveLocal=null,L.mouseUpLocal=null,L.mouseDown=null,L.mouseUp=null,L.click=null,G.reset(),this.uiBits=null,this.star1=this.star2=this.star3=null,B.SelectionPreviewY=.23,B.SelectionPreviewBotY=.24,B.brighter=new PIXI.filters.ColorMatrixFilter,B.brighter.brightness(1.5,!0),B.brighter2=new PIXI.filters.ColorMatrixFilter,B.brighter2.brightness(1.2,!0),L.generateLevels)this.levelData=D.createLevelData(this.level);else{var s=this.managers.data.get("levels").levels;this.levelData=s[this.level%s.length]}I.levelType=LevelType.ConvertNames[this.levelData._id];var i=0;L.levelLosses&&(i=L.levelLosses[t-1]||0),L.challengeMode?(I.boostFullBar=I.defaultBoostFullBar,I.boostGainCost=I.defaultBoostGainCost):(I.boostFullBar=this.levelData.boostFullBar,I.boostGainCost=this.levelData.boostGainCost,I.shotsLeft=this.levelData.turns,i>1&&(this.levelData.extraTurns=i-1,this.levelData.turns+=this.levelData.extraTurns));var a=i>=3?Math.floor(i/3):0;this.levelData.boostFullBar=Math.max(this.levelData.boostFullBar-10*a,this.levelData.boostFullBar/4),this.playField=new E(this.game),this.playField.create(this,this.managers,this.level,this.levelData),this.gridCollide=this.playField.getGridCollide(),this._createUI(),this.shooter=new A(this.game),this.shooter.create(this,this.managers,this.playField,this.levelData,this.gridCollide),B.effects=new w(this.game),B.effects.create(this,this.managers,this.playField,this.gridCollide),L.resized=!0,L.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.bm=null,this.endSequence=!1,this.shootBubblesAfter=void 0},B.prototype.destroy=function(){this.managers=null;var e,t;if(this.uiBits){for(e=0,t=this.uiBits.length;t>e;e++){var s=this.uiBits[e];s.destroy()}this.uiBits=null}this.boostIcon=null,this.fishIcon=null,this.fishWidget=null,this.scoreText=null,this.shotsText=null,this.fishText=null,this.launcherMeter=null,this.launcherRing=null,this.launcherBeam=null,this.launcherButton=null,this.launcherMask=null,this.starMask=null,this.usePlayerInput&&(this.usePlayerInput.destroy(),this.usePlayerInput=null),B.effects&&(B.effects.destroy(),B.effects=null),this.playField&&(this.playField.destroy(),this.playField=null),this.shooter&&(this.shooter.destroy(),this.shooter=null),B.brighter=null,B.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.star1=this.star2=this.star3=null,this.ignoreClick=null,this.game=null},B.prototype.update=function(){if(L.resized&&this._createUI(),this._levelTypeUpdate(),this._background(),this._movesUpdate(),this._userInterface(),this._userInput(),B.effects.update(),this.endSequence||(this.playField&&this.playField.update(),this.shooter&&this.shooter.update()),this.endSequence)return this.levelEndSequence();if(this.levelEnded()&&(this.endSequence=!0),L.testKeys){if(G.edgeDown[U.key_x])return console.log("cheat key x used"),G.edgeDown[U.key_x]=!1,this.playField.clearAll(),L.challengeMode||(I.score+=I.starScore/2+1),!0;if(G.edgeDown[U.key_l])return console.log("cheat key l used"),G.edgeDown[U.key_l]=!1,!1}return!0},B.prototype.levelShown=function(){return!this.playField.introScroll},B.prototype.levelEnded=function(){return this.playField.effectContinues()||B.effects.count()>0?((this.playField.invaded()||this.playField.won())&&this.shooter.endLevel(),!1):this.playField.invaded()?!0:this.playField.won()?!0:this.shooter.state==A.OUTOFAMMO&&I.shotsLeft<=0?!0:!1},B.prototype.levelEndSequence=function(){if(void 0===this.shootBubblesAfter)return this.playField.won()&&(!L.challengeMode||this.game.level>=this.game.numLevels-1)?(this.shootBubblesAfter=L.nowTime+1e3,this.shooter.hideTrajectory(),!0):!1;if(L.nowTime>this.shootBubblesAfter){this.shooter.hideTrajectory(),this.shooter.shootRemaining(),this.shootBubblesAfter=L.nowTime+200;var e=I.shotsLeft.toString();this.shotsText.text!=e&&(this.shotsText.text=e)}return I.shotsLeft>0||B.effects.count()>0},B.prototype.levelBeaten=function(){return this.playField?this.playField.invaded()?!1:this.playField.won():!0},B.prototype.updateScore=function(){if(I.score=Math.floor(I.score),I.score>this.scoreText._visibleScore){var e=I.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e,this.scoreText.text=N.formatBigNumber(this.scoreText._visibleScore)}},B.prototype._createUI=function(){var e,t;if(L.debug&&console.log("World._createUI "+(L.isPortrait?"portrait":"landscape")+" "+(L.challengeMode?"challenge":"saga")),this.uiBits)for(var s=0,i=this.uiBits.length;i>s;s++)this.uiBits[s].destroy();this.uiBits=[],L.isPortrait?this._portraitLayout():this._landscapeLayout(),this.showStars(),this.launcherMeter=new n,this.launcherMeter.create(L.backgroundLayer,P.LAUNCHER_METER.type,this.managers.textures,0,I.launcherY,!0),this.launcherMeter.anchor.set(.5,1),this.launcherMeter.scale.set(1),this.uiBits.push(this.launcherMeter),this.launcherBeam=new n,this.launcherBeam.create(L.backgroundLayer,"beam.png",this.managers.textures,0,I.launcherY,!0,!0),this.launcherBeam.anchor.set(.5,1),this.launcherBeam.scale.set(1),this.launcherBeam.alpha=.1,this.uiBits.push(this.launcherBeam),this.launcherRing=new n,this.launcherRing.create(L.backgroundLayer,"indicator.png",this.managers.textures,0,I.launcherY,!0),this.launcherRing.anchor.set(.5,1),this.launcherRing.scale.set(1),this.launcherRing.alpha=.1,this.uiBits.push(this.launcherRing),this.launcherButton=new n,this.launcherButton.create(L.backgroundLayer,"button_swap.png",this.managers.textures,0,I.launcherY,!0),this.launcherButton.anchor.set(.5,1),this.launcherButton.scale.set(1),this.uiBits.push(this.launcherButton),this.launcherBar=new n,this.launcherBar.create(this.launcherMeter,"meterFull.png",this.managers.textures,0,0,!0),this.launcherBar.anchor.set(.5,1),this.launcherBar.scale.set(1/this.launcherMeter.scale.x,1/this.launcherMeter.scale.y),this.uiBits.push(this.launcherBar),this.launcherMask=new PIXI.Graphics,this.launcherMask.x=-50,this.launcherMask.y=-150,this.launcherMask.rotation=2.1,this.launcherMask.beginFill(16711680,.3),this.launcherMask.drawRect(0,-220,-300,450),this.launcherMask.endFill(),this.uiBits.push(this.launcherMask),this.launcherBar.addChild(this.launcherMask),this.launcherBar.mask=this.launcherMask,t=new r("",L.textStyleUIScoreAndShots),t.create(this.launcherMeter,0,-.44,!0),t.anchor.set(.5),t.scale.set(1),this.shotsText=t,this.uiBits.push(t),e=new n,e.create(this.launcherMeter,I.boostType,this.managers.textures,I.boostImageOffsetX,I.boostImageOffsetY,!1),e.setAnimation("boost"),e.anchor.set(.5),e.scale.set(I.queuePositionScale),this.boostIcon=e,this.playField.introScroll&&(this.boostIcon.visible=!1),this.uiBits.push(e)
},B.prototype._createStarBar=function(e){var t;t=new n,t.create(e,"hud_meterEmpty.png",this.managers.textures,.5,0,!0),t.anchor.set(.5),t.scale.set(1),this.uiBits.push(t),t=new n,t.create(e,"hud_meterFull.png",this.managers.textures,.5,0,!0),t.anchor.set(.5),t.scale.set(1),this.uiBits.push(t);var s=new PIXI.Graphics;s.x=0,s.y=0,s.beginFill(16711680,.3),s.drawRect(-680,-50,500,100),s.endFill(),this.uiBits.push(s),t.addChild(s),t.mask=s,this.starMask=s,t=new n,t.create(e,"hud_stargrey.png",this.managers.textures,.457,.175,!0),t.anchor.set(.5),t.scale.set(.6),this.uiBits.push(t),t=new n,t.create(e,"hud_stargrey.png",this.managers.textures,.5+.18,.09,!0),t.anchor.set(.5),t.scale.set(.8),this.uiBits.push(t),t=new n,t.create(e,"hud_stargrey.png",this.managers.textures,.5+.41,-.06,!0),t.anchor.set(.5),t.scale.set(1),this.uiBits.push(t),t=new n,t.create(e,"hud_star.png",this.managers.textures,.457,.175,!0),t.anchor.set(.5),t.scale.set(.6),this.uiBits.push(t),this.star1=t,this.star1.visible=!1,t=new n,t.create(e,"hud_star.png",this.managers.textures,.5+.18,.09,!0),t.anchor.set(.5),t.scale.set(.8),this.uiBits.push(t),this.star2=t,this.star2.visible=!1,t=new n,t.create(e,"hud_star.png",this.managers.textures,.5+.41,-.06,!0),t.anchor.set(.5),t.scale.set(1),this.uiBits.push(t),this.star3=t,this.star3.visible=!1},B.prototype._portraitLayout=function(){var e,t,s,i=L.width/640*.5;e=new g(g.TYPE_NOLATCH),e.create(L.bottomUI,"button_settings.png",this.managers,.45,-.01,!0,"button_settings.png","button_settings.png","button_settings.png","click_pause_event"),e.anchor.set(.5,1),e.scale.set(i/L.bottomUI.scale.x,i/L.bottomUI.scale.y),e.sfx="snd_click",e.sfxHover="snd_rollOver",this.uiBits.push(e),t=new n,t.create(L.topUI,"hud_backing.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/L.topUI.scale.x,i/L.topUI.scale.y);var a=t;this.uiBits.push(t),L.challengeMode||this._createStarBar(a),t=new n,t.create(L.topUI,"hud_lvl.png",this.managers.textures,-.47,.045,!0),t.anchor.set(0,.5),t.scale.set(i/L.topUI.scale.x,i/L.topUI.scale.y),this.uiBits.push(t),s=new r(N.padToLength((this.game.level+1).toString(),3,"0"),L.textStyleUILevelNumber),s.create(a,.02,.45,!0),s.anchor.set(0,1),this.uiBits.push(s),s=new r(N.formatBigNumber(I.score),L.textStyleUIScoreAndShots),L.challengeMode?s.create(a,.22,.3,!0):s.create(a,.22,.01,!0),s.anchor.set(0,1),this.scoreText=s,this.scoreText._visibleScore=I.score,this.uiBits.push(s),I.levelType==LevelType.GOAL_RESCUE_FISH&&(t=new n,t.create(L.bottomUI,"goal_backing.png",this.managers.textures,-.49,-.01,!0),t.anchor.set(0,1),t.scale.set(1*i/L.bottomUI.scale.x,1*i/L.bottomUI.scale.y),t.visible=!1,this.fishWidget=t,this.uiBits.push(t),t=new n,t.create(this.fishWidget,"goal_fishIcon.png",this.managers.textures,.44,-.5,!0),t.anchor.set(.5),t.scale.set(1),this.fishIcon=t,this.uiBits.push(t),s=new r("",L.textStyleUIScoreAndShots),s.create(this.fishWidget,-.05+.53,-.45,!0),s.anchor.set(0,.5),s.scale.set(.8),this.fishText=s,this.uiBits.push(s))},B.prototype._landscapeLayout=function(){var e,t,s,i=L.height/640*.48,a=.9;e=new g(g.TYPE_NOLATCH),e.create(L.topUI,"button_settings.png",this.managers,-.185,.94,!0,"button_settings.png","button_settings.png","button_settings.png","click_pause_event"),e.anchor.set(.5),e.scale.set(i/L.topUI.scale.x,i/L.topUI.scale.y),e.sfx="snd_click",e.sfxHover="snd_rollOver",this.uiBits.push(e),t=new n,t.create(L.topUI,"hud_backing.png",this.managers.textures,-.488,.055,!0),t.anchor.set(0,.5),t.scale.set(a*i/L.topUI.scale.x,a*i/L.topUI.scale.y);var o=t;this.uiBits.push(t),L.challengeMode||this._createStarBar(o),t=new n,t.create(o,"hud_lvl.png",this.managers.textures,0,.01,!0),t.anchor.set(0,.5),this.uiBits.push(t),s=new r(N.padToLength((this.game.level+1).toString(),3,"0"),L.textStyleUILevelNumber),s.create(o,.02,.45,!0),s.anchor.set(0,1),this.uiBits.push(s),s=new r(N.formatBigNumber(I.score),L.textStyleUIScoreAndShots),L.challengeMode?s.create(o,.22,.3,!0):s.create(o,.22,.01,!0),s.anchor.set(0,1),this.scoreText=s,this.scoreText._visibleScore=I.score,this.uiBits.push(s),I.levelType==LevelType.GOAL_RESCUE_FISH&&(t=new n,t.create(L.bottomUI,"goal_backing.png",this.managers.textures,-.49,-.01,!0),t.anchor.set(0,1),t.scale.set(1*i/L.bottomUI.scale.x,1*i/L.bottomUI.scale.y),t.visible=!1,this.fishWidget=t,this.uiBits.push(t),t=new n,t.create(this.fishWidget,"goal_fishIcon.png",this.managers.textures,.44,-.5,!0),t.anchor.set(.5),t.scale.set(1),this.fishIcon=t,this.uiBits.push(t),s=new r("",L.textStyleUIScoreAndShots),s.create(this.fishWidget,-.05+.53,-.45,!0),s.anchor.set(0,.5),s.scale.set(.8),this.fishText=s,this.uiBits.push(s))},B.prototype.showBoost=function(e){this.boostIcon&&this.boostIcon.parent&&(void 0!==e&&(this.boostIcon.visible=e),this.boostIcon.x=I.boostImageOffsetX,this.boostIcon.y=I.boostImageOffsetY)},B.prototype._movesUpdate=function(){var e;e=I.shotsLeft.toString(),this.shotsText.text!=e&&(this.shotsText.text=e),I.shotsLeft<4&&L.nowTime%1e3<500?16711680!=this.shotsText.tint&&(this.shotsText.tint=16711680):16777215!=this.shotsText.tint&&(this.shotsText.tint=16777215),this.game.foodTotal>=this.game.foodCount&&(e=(this.game.foodTotal-this.game.foodCount).toString()+"/"+this.game.foodTotal.toString(),this.fishText&&this.fishText.text!=e&&(this.fishWidget.visible=!0,this.fishText.text=e))},B.prototype._levelTypeUpdate=function(){if(!this.playField||!this.playField.introScroll)switch(I.levelType){case LevelType.GOAL_PROTECT_BARRIER:if(this.playField&&(this.playField.scrollBackAllowed=!1,this.playField.scrollDownAllowed=!1,!this.playField.isFairyFlying())){var e=this.levelData.scroll_speed;(void 0===e||Number.isNaN(e))&&(e=I.survivalSpeed),this.playField.autoScroll(e*L.elapsedTime/1e3)}break;case LevelType.GOAL_BREAK_EGG:break;case LevelType.GOAL_RESCUE_FISH:}},B.prototype._background=function(){},B.prototype._awardBoost=function(){this.managers.audio.play("snd_booster_award");var e;I.boostType==P.DRAGON_BLUE.type?(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=L.gameUILayer.toLocal(e),B.effects.add(w.DRAGON_BLUE,L.gameUILayer,e.x,e.y,this.playField.fairyBoostFly,this.playField)):I.boostType==P.PLUS5.type?(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=L.gameUILayer.toLocal(e),B.effects.add(w.BOOST_BONUS5,L.gameUILayer,e.x,e.y,this.playField.bonus5BoostFly,this.playField)):(e=new PIXI.Point(0,0),e=this.boostIcon.toGlobal(e),e=L.gameUILayer.toLocal(e),this.shooter.addBoostToQueue(I.boostType,e),this.showBoost(!1))},B.prototype._userInterface=function(){G.update();var e=I.boostCharge/I.boostFullBar*2.9+2.1;this.launcherMask.rotation=(7*this.launcherMask.rotation+e)/8,this.launcherBeam.alpha=Math.max(Math.abs(I.frameCount%200-100)/100,.5);var t=0;if(!L.challengeMode){var s,i=0,a=145,o=288,n=490;I.starsPcnt>=I.starBarThirdStar?t=n:I.starsPcnt>=I.starBarSecondStar?(s=n-o,t=o+s*(I.starsPcnt-I.starBarSecondStar)*4/100):I.starsPcnt>=I.starBarFirstStar?(s=o-a,t=a+s*(I.starsPcnt-I.starBarFirstStar)*4/100):(s=a-i,t=i+s*(I.starsPcnt-0)*2/100),this.starMask.x=(19*this.starMask.x+t)/20,this.star1.visible&&this.star1.scale.x>.6&&(this.star1.scale.set(.95*this.star1.scale.x),this.star1.scale.x<.6&&this.star1.scale.set(.6)),this.star2.visible&&this.star2.scale.x>.8&&(this.star2.scale.set(.95*this.star2.scale.x),this.star2.scale.x<.6&&this.star2.scale.set(.8)),this.star3.visible&&this.star3.scale.x>1&&(this.star3.scale.set(.95*this.star3.scale.x),this.star3.scale.x<.6&&this.star3.scale.set(1))}this.launcherMeter&&this.launcherMeter.update(),I.boostCharge>=I.boostFullBar&&I.boostCanCharge&&(I.boostCanCharge=!1,I.boostFullBar+=I.boostGainCost,I.boostCharge=I.boostFullBar,this._awardBoost()),L.testKeys&&G.edgeDown[U.key_b]&&(console.log("cheat key b used"),G.edgeDown[U.key_b]=!1,this._awardBoost());var r,h;for(r=0,l=this.uiBits.length;r<l;r++){var u=this.uiBits[r];u instanceof g?(null===h||void 0===h)&&(h=u.update()):u instanceof PIXI.Graphics||u.update()}switch(h){case"click_pause_event":this.game.pauseToggle()}this.updateScore()},B.prototype._userInput=function(){this.bm||(L.testKeys&&G.edgeDown[U.key_c]&&(G.edgeDown[U.key_c]=!1,L.showLockedCursor=!L.showLockedCursor),L.testKeys&&(G.isPressed[U.key_v]||L.mouseDown&&L.mouseDown.x<30&&L.mouseDown.y<30)&&e.debugWindowData())},B.prototype.getLevelBonus=function(){return this.playField.levelBonusValues?this.playField.levelBonusValues[this.game.level]:0},B.prototype.GetTurnCountLocation=function(){var e=this.shotsText.toGlobal({x:0,y:0}),t=L.gameUILayer.toLocal(e);return{x:t.x,y:t.y}},B.prototype.getLauncherLocation=function(e){var t=new PIXI.Point(0,0);t=this.launcherMeter.toGlobal(t);var s=e.toLocal(t);return s.y-=I.shotOffsetY,s},B.prototype.launcherRingReset=function(){this.launcherRing.scale.set(1),this.launcherRing.alpha=0},B.prototype.updateLauncherEffect=function(e){if(this.launcherBeam&&this.launcherRing)if(500>e){var t=e/500;this.launcherBeam.alpha=.5+.5*t,this.launcherRing.alpha=.25+.5*t,this.launcherRing.scale.set(1.015*this.launcherRing.scale.x)}else this.launcherRing.scale.set(1.01*this.launcherRing.scale.x),this.launcherRing.alpha>0&&(this.launcherRing.alpha-=.05),this.launcherBeam.alpha>0&&(this.launcherBeam.alpha-=.05)},B.prototype.updateStars=function(){var e=0;I.stars>0&&!this.star1.visible&&(this.star1.visible=!0,this.star1.scale.set(1.2),this.managers.audio.play("snd_rainbow"),e=.5),I.stars>1&&!this.star2.visible&&(this.star2.visible=!0,this.star2.scale.set(1.6),this.managers.audio.playDelayed("snd_rainbow",e),e+=.5),I.stars>2&&!this.star3.visible&&(this.star3.visible=!0,this.star3.scale.set(2),this.managers.audio.playDelayed("snd_rainbow",e))},B.prototype.showStars=function(){I.stars>0&&!this.star1.visible&&(this.star1.visible=!0),I.stars>1&&!this.star2.visible&&(this.star2.visible=!0),I.stars>2&&!this.star3.visible&&(this.star3.visible=!0)},M.prototype.create=function(e,t,s,i){var a={x:s,y:i},o=this.gridCollide.gridToBubble(a),r=this.getFromGrid(a);L.debug&&0!==r&&null!==r&&console.log("WARNING: bubble created in invalid grid location! "+r),this.type=t,this.under_type=P.UNDEFINED.type,this.overlay=null,this.vx=0,this.vy=0,this.mx=0,this.my=0,this.sprite=new n,this.sprite.create(e,this.type,this.managers.textures,o.x,o.y,!1),this.sprite.anchor.set(.5),this.addToGrid(a),L.debugSpam&&console.log("Bubble.create "+this.sprite.key+" "+t+" "+s+","+i+" "+o.x+","+o.y)},M.prototype.destroy=function(){L.debugSpam&&console.log(this.sprite?"Bubble.destroy at "+this.sprite.x+","+this.sprite.y:"Bubble.destroy WARNING no sprite"),this.gridCollide&&(this.gridCollide.removeBubble(this),this.gridCollide=null),this.overlay&&(this.overlay.destroy(),this.overlay=null),this.sprite&&(this.sprite.dragging&&(this.sprite.dragging.destroy(),this.sprite.dragging=null),this.sprite.destroy(),this.sprite=null),this.updateCallback=null,this.under_type=P.UNDEFINED.type,this.grid=null,this.parent=null,this.managers=null,this.game=null,this.playField=null},M.prototype.update=function(){return 0!==this.wobbleTime&&(this.wobbleTime>L.nowTime?(this.sprite.x=this.wx+Math.random()*this.wobblex*2-this.wobblex,this.sprite.y=this.wy+Math.random()*this.wobbley*2-this.wobbley):(this.sprite.x=this.wx,this.sprite.y=this.wy,this.wobbleTime=0)),this.updateCallback&&this.updateCallback(this),this.sprite.update(),!0},M.prototype.getFromGrid=function(e){return e&&e.y>=0&&e.y<this.grid.length&&e.x>=0&&e.x<this.grid[e.y].length?this.grid[e.y][e.x]:null},M.prototype.addToGrid=function(e){e&&e.y>=0&&e.y<this.grid.length&&e.x>=0&&e.x<this.grid[e.y].length&&(this.grid[e.y][e.x]=this)},M.prototype.matchCheck=function(e){return this.type==e?!0:this.type==P.ICE.type?this.under_type==e:e==P.RAINBOW.type||this.type==P.RAINBOW.type?!0:!1},M.prototype.addOverlay=function(e){L.debug&&console.log("Bubble.addOverlay "+e+" on "+this.sprite.key);var t=new n;return t.create(this.sprite,e,this.managers.textures,0,0,!1),t.anchor.set(.5),this.overlay=t,t},M.prototype.pop=function(e){if(null===this.game)return void(L.debug&&console.log("WARNING: bubble already destroyed!"));if(this.type==P.EGG.type)return void(L.debug&&console.log("Bubble.pop will not pop the egg, it cracks and destroys itself"));L.debugSpam&&console.log("Bubble.pop at "+e.x+","+e.y),I.boostCanCharge&&(I.boostCharge+=I.popBoost),(e.y<0||e.x<0||e.x>=this.grid[e.y].length||-1==this.grid[e.y][e.x])&&alert("snafu!"),this.grid[e.y][e.x]=0,this.overlay&&this.releaseOverlay(!1);var t=this.gridCollide.bubbleToGameUi(this.sprite);this.type!=P.BOMB.type&&B.effects.add(w.POP_BUBBLE,L.gameUILayer,t.x,t.y);var s=I.scoreFirstPop+I.popCount*I.scoreMultiplyPop;I.popCount++,I.score+=s;var i=new u;i.create(t.x,t.y,L.textStyleBoldSmall,L.gameUILayer,this.managers,s.toString()),this.destroy()},M.prototype.changeType=function(e){return this.under_type=this.type,this.type=e,this.sprite.setType(this.type),this},M.prototype.isNormal=function(e){return M.isNormal(this.type,e)},M.isNormal=function(e,t){return P[e].normal?"RAINBOW"==e||e==P.RAINBOW.type&&t===!1?!1:!0:!1},M.isNormalKey=function(e,t){P.UNDEFINED.type;for(var s in P){var i=P[s];if(i.animations&&i.animations["default"]&&i.animations["default"][0]==e&&i.normal)return i.type==P.RAINBOW.type&&t===!1?!1:!0}return!1},M.prototype.releaseOverlay=function(e){L.debug&&console.log("Bubble.releaseOverlay "+this.overlay.key+" on "+this.sprite.key);var t,s=!0,i=this.gridCollide.bubbleToGameUi(this.sprite);switch(i.x+=this.overlay.x,i.y+=this.overlay.y,this.overlay.type){case P.FISH.type:t=B.effects.add(w.DROP_FISH,L.gameUILayer,i.x,i.y,w.bubbleFall),t&&(t.vr=.25*Math.random()-.125),1==this.game.foodCount&&(this.game.droppedLastFish=!0);break;case P.DRAGON_ORANGE.type:e||"default"!=this.overlay.animation?(t=B.effects.add(w.DROP_DRAGON_ORANGE,L.gameUILayer,i.x,i.y,w.bubbleFall),t&&t.moveToFront()):(t=B.effects.add(w.DRAGON_ORANGE,L.gameUILayer,i.x,i.y,this.orangeDragonLogic,this),t&&(t.playField=this.playField),s=!1);break;case P.DRAGON_PURPLE.type:e&&!this.playField.hitGong?"default"==this.overlay.animation&&(t=B.effects.add(w.DRAGON_PURPLE,L.gameUILayer,i.x,i.y,this.purpleDragonLogic,this),t&&(t.playField=this.playField,t.gridCollide=this.gridCollide,t.game=this.game,t.managers=this.managers,t.dragging&&t.dragging.setType(this.type)),s=!1):(t=B.effects.add(w.DRAGON_PURPLE_LEAVE,L.gameUILayer,i.x,i.y,this.purpleDragonLeave,this),t&&(t.vx=200+50*Math.random(),t.vy=-75-50*Math.random()))}return this.overlay.destroy(),this.overlay=null,s},M.prototype.wobble=function(e,t,s){this.wobbleTime=L.nowTime+1e3*e,this.wobblex=t,this.wobbley=s,this.wx=this.sprite.x,this.wy=this.sprite.y},M.prototype.purpleDragonLogic=function(e){var t,s,i,a,o;switch(e.animation){case"gliding":break;case"flying":if(e.alpha<1){if(e.alpha-=L.elapsedTime/1e3,e.alpha<=0)return!1;break}if(e.dragging&&(e.gridCollide.get(e.dest)||!e.playField.adjacentFilled(e.dest))){if(t=e.playField.pickVisibleSpace(),!t){e.alpha-=L.elapsedTime/1e3;break}e.alpha=1,e.dest=t}if(target=e.gridCollide.gridToGameUi(e.dest),s=target.x-e.x,i=target.y-e.y-I.bubbleRadius,a=s*s+i*i,o=Math.sqrt(a),e.vx+=22*s/o,e.vy+=15*i/o,e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,e.y>L.height/3*2&&(e.vy=Math.min(e.vy,-30),e.dest=e.playField.pickVisibleSpace(),null===e.dest&&(e.alpha-=L.elapsedTime/1e3)),e.dragging&&(e.dragging.x=e.x,e.dragging.y=e.y+I.bubbleRadius),e.vx*=.94,e.vy*=.94,o<I.bubbleRadius&&(!e.dragging||Math.abs(e.vx)+1.6*Math.abs(e.vy)<24)){if(e.dragging&&e.y<L.height/3*2){var n=new M(e.game,e.managers,e.playField,e.gridCollide);n.create(L.bubbleLayer,e.dragging.type,e.dest.x,e.dest.y),n.addOverlay(P.DRAGON_PURPLE.type)}return!1}}return!0},M.prototype.purpleDragonLeave=function(e){return e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,e.vx+=10,e.vy*=.995,Math.abs(e.x)>I.gridOffsetX&&(e.alpha-=.05,e.alpha<=0)?!1:!0},M.prototype.orangeDragonLogic=function(e){switch(e.animation){case"flying":w.swoopToGridTarget(e,e.playField,{x:-80,y:4})||(e.setAnimation("shooting"),e.shootingFlag=!1,e.noRepeat=!0,e.repeat=!1);break;case"shooting":if(5==e.frameIndex&&!e.shootingFlag){var t=B.effects.add(w.DRAGON_FLAME_JET,e.parent,e.x,e.y,this.orangeFlameLogic,this);e.shootingFlag=!0,t&&(t.target=e.target,t.dest=e.dest,t.playField=e.playField)}}return!0},M.prototype.orangeFlameLogic=function(e){return e.target&&e.atEnd?(e.target&&e.target.sprite&&(e.playField.matchAt(e.dest,e.target,2),e.target.pop(e.dest),e.target=null,e.playField.looseFall=!0),!1):!0},E.prototype.create=function(e,t,s,i){this.world=e,this.managers=t,this.level=s,this.levelData=i,this.resizeChargeBlocker=0,this.scrollY=-1,this.introScroll=!0,this.scrollBackAllowed=!0,this.scrollDownBonus=!1,L.bubbleLayer.y=Math.floor(this.scrollY*L.bubbleLayer.scale.y),I.boostType=P[this.levelData.boost.id].type,I.boostFullCost=1*this.levelData.boost.cost,I.boostGainCost=1*this.levelData.boost.gain,this.bg=new n,this.bg.create(L.bgImage,this.levelData.BackgroundImage,this.managers.textures),this.bg.anchor.set(.5),this.uiPanel=new n,this.uiPanel.create(L.backgroundLayer,"blanker",this.managers.textures,-I.sideBarOffset,0,!1),this.uiPanel.scale.set(5,8),this.uiPanel.anchor.set(1,.5),this.uiPanel.alpha=.75,this.rightBlanker=new n,this.rightBlanker.create(L.backgroundLayer,"blanker",this.managers.textures,I.sideBarOffset,0,!1),this.rightBlanker.scale.set(4,8),this.rightBlanker.anchor.set(0,.5),this.rightBlanker.alpha=.75,this.hitGong=!1,this.lowestBubbleY=0,this.explosionList=[],this.looseFall=!1,this.killLoose=!1,this.createGrid(I.width,I.height),this.populateLevel(this.levelData);var a=this.gridCollide.gridToBubble({x:0,y:-.4});this.topBar=new n,this.topBar.create(L.bubbleLayer,P.CEILING_BEAM.type,this.managers.textures,0,a.y,!1),this.topBar.anchor.set(.5,1),this.topBar.scale.set(L.backgroundLayer.bubbleAreaWidth/(1920*L.bubbleLayer.scale.x)),I.levelType==LevelType.GOAL_PROTECT_BARRIER&&(this.scrollDownBonus=!0,this.barrier=new n,this.barrier.create(L.backgroundLayer,"barrier.png",this.managers.textures,0,0,!1),this.barrier.anchor.set(.5,0),this.barrier.scale.set(L.backgroundLayer.bubbleAreaWidth/(1520*L.backgroundLayer.scale.x)),this.barrier.alpha=0,this.barrierHighlight=new n,this.barrierHighlight.create(L.backgroundLayer,"barrier_red.png",this.managers.textures,0,0,!1),this.barrierHighlight.anchor.set(.5,0),this.barrierHighlight.scale.set(L.backgroundLayer.bubbleAreaWidth/(1520*L.backgroundLayer.scale.x)),this.barrierHighlight.visible=!1)},E.prototype.destroy=function(){this.gridCollide.destroy(),this.gridCollide=null,this.bg&&(this.bg.destroy(),this.bg=null),this.uiPanel&&(this.uiPanel.destroy(),this.uiPanel=null),this.rightBlanker&&(this.rightBlanker.destroy(),this.rightBlanker=null),this.topBar&&(this.topBar.destroy(),this.topBar=null),this.barrier&&(this.barrier.destroy(),this.barrier=null),this.barrierHighlight&&(this.barrierHighlight.destroy(),this.barrierHighlight=null),this.clearAll(),this.grid=null,this.game=null,this.world=null,this.managers=null},E.prototype.clearAll=function(){if(this.game.foodCount=0,this.hitGong=!0,this.grid)for(var e=0;e<this.grid.length;e++)for(var t=0;t<this.grid[e].length;t++)this.grid[e][t]&&-1!=this.grid[e][t]&&(this.grid[e][t].destroy(),this.grid[e][t]=null)};E.prototype.update=function(){var e=this.world.getLauncherLocation(L.gameUILayer);L.resized&&(this.adjustScroll(),this.resizeChargeBlocker=I.frameCount,this.setBarrierPosition());var t=Number.POSITIVE_INFINITY;if(this.lowestBubbleY=Number.NEGATIVE_INFINITY,this.topBar.update(),this.explosionList&&this.explosionList.length>0&&L.nowTime>this.explosionList[0].when){var s=this.explosionList.shift();L.debug&&console.log("*** explosion *** at "+s.loc.x+","+s.loc.y+" list length now = "+this.explosionList.length);var i=this.gridCollide.gridToGameUi(s.loc);B.effects.add(w.EXPLOSION,L.gameUILayer,i.x,i.y),this.radiusEffect(s.loc,Math.sqrt(5),this.explodeBubble),this.looseFall=!0}for(var a=this.getAllBubbles(),o=a.length-1;o>=0;--o){var n=a[o];if(n&&null!==n.game)if(n.update())if(n.sprite){var r=this.gridCollide.bubbleToGameUi(n.sprite);r.y>this.lowestBubbleY&&(this.lowestBubbleY=r.y),r.y<t&&(t=r.y)}else a.splice(o,1),n.destroy();else a.splice(o,1);else a.splice(o,1)}if(this.lowestBubbleY==Number.NEGATIVE_INFINITY)return L.debug&&console.log("WARNING: PlayField lowestBubbleY wasn't set.  May be harmless."),!1;if(this.lowestBubbleYOffset=e.y-this.lowestBubbleY,a.length>0){var l=this.scrollControl(e);this.scrollY=l,this.gridCollide.offsetY=this.scrollY,L.bubbleLayer.y=Math.floor(this.scrollY*L.bubbleLayer.scale.y)}if(!this.introScroll&&I.levelType==LevelType.GOAL_PROTECT_BARRIER){var h=this.barrierHighlight.visible;this.lowestBubbleY>e.y+I.bubbleInvasionUrgent?(this.barrierHighlight.visible=L.nowTime%500>250?!1:!0,this.barrierHighlight.visible&&!h&&this.managers.audio.play("snd_warning"),this.barrier.alpha>.2&&(this.barrier.alpha-=.01)):this.lowestBubbleY>e.y+I.bubbleInvasionWarning?(this.barrierHighlight.visible=L.nowTime%1e3>500?!1:!0,this.barrierHighlight.visible&&!h&&this.managers.audio.play("snd_warning")):(this.barrierHighlight.visible=!1,this.barrier.alpha<1&&(this.barrier.alpha+=.1))}this.gridCollide.offsetY=this.scrollY,L.bubbleLayer.y=Math.floor(this.scrollY*L.bubbleLayer.scale.y),(this.looseFall||this.killLoose)&&(this.looseFallNow(this.killLoose),this.looseFall=!1,this.killLoose=!1);var u=L.bubbleLayer.children.length-(this.topBar?1:0);return u>0},E.prototype.setBarrierPosition=function(){if(this.barrier){var e=this.world.getLauncherLocation(this.barrier.parent);this.barrier.x=this.barrierHighlight.x=e.x,this.barrier.y=this.barrierHighlight.y=e.y+I.barrierOffsetY}},E.prototype.shotFired=function(e){this.world.updateLauncherEffect(e)},E.prototype.invaded=function(){switch(I.levelType){case LevelType.GOAL_PROTECT_BARRIER:this.setBubbleValues();var e=this.world.getLauncherLocation(this.barrier.parent);if(!this.introScroll&&this.lowestBubbleY>e.y+I.bubbleInvasionY)return this.barrierHighlight.visible=!0,!0}return!1},E.prototype.won=function(){var e=L.bubbleLayer.children.length-(this.topBar?1:0);switch(I.levelType){case LevelType.GOAL_PROTECT_BARRIER:return 0>=e;case LevelType.GOAL_RESCUE_FISH:return this.game.foodCount<=0;case LevelType.GOAL_BREAK_EGG:return this.hitGong&&0>=e}return!1},E.prototype.createGrid=function(e,t){this.grid=[];for(var s=0;t>s;s++){this.grid[s]=[];for(var i=0;2*e-1>i;i++)this.grid[s][i]=1&s?1&i?0:-1:1&i?-1:0}},E.prototype.colourMatch=function(e,t,s,i){void 0===s&&(s=[]),void 0===i&&(i=[]),i.push(e);var a,o;return o={x:e.x-2,y:e.y},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),o={x:e.x+2,y:e.y},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),o={x:e.x-1,y:e.y-1},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),o={x:e.x+1,y:e.y-1},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),o={x:e.x-1,y:e.y+1},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),o={x:e.x+1,y:e.y+1},(a=this.bubbleCheck(o,t,i))&&(s.push({bubble:a,loc:o}),this.colourMatch(o,a.type,s,i)),s},E.prototype.matchAt=function(e,t,s){if(t.sprite){var i=this.colourMatch(e,t.sprite.type);if(i.push({bubble:t,loc:e}),this.radiusEffect(e,Math.sqrt(5),this.pulseBubble),i.length>=s){var a=this.reduceMatches(i);L.debug&&console.log("matched "+a.length+" at "+e.x+","+e.y),a.length>=s&&this.removeList(a)}}},E.prototype.bubbleCheck=function(e,t,s){if(e.y<0||e.y>=this.grid.length)return null;if(e.x<0||e.x>=this.grid[e.y].length)return null;var i=this.grid[e.y][e.x];return i&&-1!=i?i.overlay&&i.overlay.type==P.EGG?null:t&&!i.matchCheck(t)?null:-1!=N.findPointInList(e,s)?null:i:null},E.prototype.reduceMatches=function(e,t){function s(e,t){return e[t].bubble}for(var i=[],a=[],o=0,n=e.length;n>o;o++){i.push(e[o]);var r=e[o].bubble.type;r==P.ICE.type&&(r=e[o].bubble.under_type),a[r]=a[r]+1||1}var l=a[P.RAINBOW.type]||0;delete a[P.RAINBOW.type];for(var h in a)a[h]+l<t&&(i=N.removeFromIndexedList(i,s,"type",h));return i},E.prototype.removeList=function(e){var t,s;for(t=0,s=e.length;s>t;t++){var i=e[t].loc,a=e[t].bubble;a&&a.pop(i)}},E.prototype.looseFallNow=function(e){var t,s,i,a,o,n,r,l=[],h=[];for(a=0,s=this.grid.length;s>a;a++)for(i=0,o=this.grid[a].length;o>i;i++)r=this.grid[a][i],r&&-1!=r&&(l.push({x:i,y:a}),0===a&&h.push({x:i,y:a}));if(L.debug&&console.log("looseFall found "+l.length+" bubbles, with "+h.length+" at the top"),!this.hitGong)for(t=0,s=h.length;s>t;t++)h[t]&&this.connectedGroup(h[t],this.removeFromList,h,l);var u=0;for(t=0,s=l.length;s>t;t++)if(n=l[t]){if(r=this.grid[n.y][n.x],r&&-1!=r){if(u++,e){r.destroy(),this.grid[n.y][n.x]=0;continue}if(r.type==P.BOMB.type&&"waiting"==r.sprite.animation)continue;var c=!0;r.overlay&&(c=r.releaseOverlay(!0)),c&&this.dropBubble(r),r.destroy()}this.grid[n.y][n.x]=0}L.debug&&console.log("looseFallNow dropped "+u+" bubbles")},E.prototype.dropBubble=function(e){var t=this.gridCollide.bubbleToGameUi(e.sprite);L.debugSpam&&console.log("dropping bubble "+t.x+","+t.y);var s=B.effects.add(w.FALL_BUBBLE,L.gameUILayer,t.x,t.y,w.bubbleFall,null,!0),i=this.droppingScore(e);if(I.score+=i,s){s.setFrame(e.sprite.key);var a=new u;a.create(s.x,s.y,L.textStyleBoldSmall,L.gameUILayer,this.managers,i.toString())}I.boostCanCharge&&(I.boostCharge+=I.dropBubbleBoost)},E.prototype.droppingScore=function(e){var t=0;if(e.overlay)switch(e.overlay.type){case P.FISH.type:case P.EGG.type:case P.DRAGON_ORANGE.type:t=I.scoreSpecialGoodDrop;break;case P.DRAGON_PURPLE.type:t=I.scoreSpecialBadDrop;break;default:t=I.scoreFirstDrop}else switch(e.type){case P.ICE.type:t=I.scoreSpecialBadDrop;break;case P.RAINBOW.type:case P.BOMB.type:case P.ROCKET.type:t=I.scoreSpecialGoodDrop;break;default:t=I.scoreFirstDrop}return t},E.prototype.removeFromList=function(e,t){var s=N.findPointInList(e,t);-1!==s&&(t[s]=null)},E.prototype.connectedGroup=function(e,t,s,i,a){void 0===a&&(a=[]),a.push(e),t(e,s),t(e,i);var o,n;n={x:e.x-2,y:e.y},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a),n={x:e.x+2,y:e.y},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a),n={x:e.x-1,y:e.y-1},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a),n={x:e.x+1,y:e.y-1},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a),n={x:e.x-1,y:e.y+1},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a),n={x:e.x+1,y:e.y+1},(o=this.bubbleCheck(n,null,a))&&this.connectedGroup(n,t,s,i,a)},E.prototype.radiusEffect=function(e,t,s){for(var i=Math.floor(e.x-2*t);i<=e.x+2*t;i++)for(var a=Math.floor(e.y-t);a<=e.y+t;a++){var o={x:i,y:a},n=this.gridCollide.get(o);if(n&&-1!=n){var r=(e.x-i)/2,l=e.y-a,h=Math.sqrt(r*r+l*l);t>=h&&s.call(this,n,e,o,h)}}},E.prototype.explodeBubble=function(e,t,s){var i,a=this.grid[s.y][s.x];if(a&&-1!=a&&a==e){if(e.type==P.EGG.type&&"cracking"==e.sprite.animation)return e.wobble(.75,8,4),!1;switch(e.type){case P.BOMB.type:if("default"==e.sprite.animation)return this.addExplosion(s,e),L.debug&&console.log("bomb chain reaction at "+s.x+","+s.y+" list = "+this.explosionList.length),!0;if(s.x!=t.x||s.y!=t.y)return!0;break;case P.ROCKET.type:L.debug&&console.log("explosion triggered rocket bubble at "+s.x+","+s.y),i=B.effects.add(w.ROCKET,L.bubbleLayer,e.sprite.x,e.sprite.y,this.rocketLogic,this),i&&(this.managers.audio.play("snd_firework_launch"),i.scale.x*=N.sign0(e.sprite.scale.x),i.vx=50*N.sign0(e.sprite.scale.x));break;case P.ICE.type:L.debug&&console.log("explosion opened shell at "+s.x+","+s.y),this.crackShell(e,s,!0);break;case P.EGG.type:return e.wobble(.75,8,4),!0}return e.pop(s),!0}return!1},E.prototype.pulseBubble=function(e,t,s,i){if(!e.updateCallback){var a=(s.y-t.y)*i*I.pulseScaler,o=(s.x-t.x)*i*I.pulseScaler*(0===a?.5:1);return e.px=e.sprite.x,e.py=e.sprite.y,e.sprite.x+=o,e.sprite.y+=a,e.vx=e.vy=0,e.updateCallback=function(e){e.vx+=.125*(e.px-e.sprite.x),e.vy+=.125*(e.py-e.sprite.y),e.sprite.x+=e.vx*=I.pulseDecay,e.sprite.y+=e.vy*=I.pulseDecay,Math.abs(e.vx)<.25&&Math.abs(e.vy)<.25&&Math.abs(e.sprite.x-e.px)<.1&&Math.abs(e.sprite.y-e.py)<.1&&(e.updateCallback=null,e.sprite.x=e.px,e.sprite.y=e.py)},!0}return!1},E.prototype.addExplosion=function(e,t){var s,i=this.explosionList.length;s=0===i?L.nowTime+I.chainReactionDelay:this.explosionList[i-1].when+I.chainReactionDelay,t.sprite.setAnimation("waiting",!1,!0),this.explosionList.push({loc:e,when:s})},E.prototype.autoScroll=function(e){this.scrollY+=e},E.prototype.directHit=function(e){var t={x:e.x-2,y:e.y};this.hit(t),t={x:e.x+2,y:e.y},this.hit(t),t={x:e.x-1,y:e.y-1},this.hit(t),t={x:e.x+1,y:e.y-1},this.hit(t),t={x:e.x-1,y:e.y+1},this.hit(t),t={x:e.x+1,y:e.y+1},this.hit(t)},E.prototype.hit=function(e,t){if(!(e.y<0||e.y>=this.grid.length||e.x<0||e.x>=this.grid[0].length)){var s=this.grid[e.y][e.x];if(s){var i,a;switch(s.type){case P.BOMB.type:L.debug&&console.log("direct hit on bomb bubble at "+e.x+","+e.y),s.sprite.key="invalid_key",a=this.gridCollide.gridToGameUi(e),B.effects.add(w.EXPLOSION,L.gameUILayer,a.x,a.y),this.radiusEffect(e,Math.sqrt(5),this.explodeBubble),this.looseFall=!0;break;case P.ROCKET.type:L.debug&&console.log("hit rocket bubble at "+e.x+","+e.y),i=B.effects.add(w.ROCKET,L.bubbleLayer,s.sprite.x,s.sprite.y,this.rocketLogic,this),i&&(this.managers.audio.play("snd_firework_launch"),i.scale.x*=N.sign0(s.sprite.scale.x),i.vx=50*N.sign0(s.sprite.scale.x)),s.destroy();break;case P.ICE.type:L.debug&&console.log("hit shell bubble at "+e.x+","+e.y+" "+s.under_type),this.crackShell(s,e,!1);break;case P.EGG.type:return L.debug&&console.log("hit egg bubble at "+e.x+","+e.y),t||void 0===t?(this.crackEgg(s),s.wobble(0,0,0)):s.wobble(1,8,4),!0}}return!1}},E.prototype.crackShell=function(e,t,s){this.managers.audio.play("snd_ice_crack");this.gridCollide.gridToGameUi(t);if(e.changeType(e.under_type),s){var i=B.effects.add(w.FAKE_BUBBLE,e.sprite.parent,e.sprite.x,e.sprite.y,this.fakeBubbleLogic,this);i&&(i.setFrame(e.sprite.key),i.createdTime=L.nowTime)}B.effects.add(w.CRACK_ICE,e.sprite.parent,e.sprite.x,e.sprite.y)},E.prototype.crackEgg=function(e){e.overlay&&(this.managers.audio.play("snd_crack"),e.sprite.setAnimation("cracking",!0,!0),e.overlay.destroy(),e.overlay=null,e.animDelay=100,e.animTime=L.nowTime+e.animDelay,e.playField=this,e.updateCallback=function(){if(0===(1&I.frameCount)){var e=this.gridCollide.bubbleToGameUi(this.sprite),t=N.near(e,I.bubbleRadius);B.effects.add(w.SPARKLES_WHITE,L.gameUILayer,t.x,t.y)}})},E.prototype.fairyBoostFly=function(e){if(e.leaving)return e.vx-=12,e.vy+=8*Math.random()-4,e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,e.vy*=.99,e.x<-I.sideBarOffset-1*I.bubbleDiameter&&(e.alpha-=.05,e.alpha<=0)?!1:!0;if(e.type==P.DRAGON_BLUE.type&&"shooting"==e.animation)if(2!=e.frameIndex||e.shootingFlag){if(4==e.frameIndex){var t=this.pickVisibleBubble(e.dest.x-8,e.dest.x-5,!1);if(!t||e.transformCount>=3)return L.debug&&console.log("fairy leaving the grid..."),e.leaving=!0,e.animation="flying",I.boostCharge=0,I.boostCanCharge=!0,!0;e.dest=t,e.vx=0,e.vy=-9,e.target=this.grid[t.y][t.x],e.animation="flying"}}else this.changeToSpecial(e.dest),e.shootingFlag=!0,void 0===e.transformCount&&(e.transformCount=0),e.transformCount++;else w.swoopToGridTarget(e,this,{x:-80,y:35})||(B.effects.add(w.DRAGON_LIGHTNING,e.parent,e.x,e.y),e.setAnimation("shooting"),e.shootingFlag=!1);return!0},E.prototype.bonus5BoostFly=function(e){return w.swoopToTarget(e,this.game.world.GetTurnCountLocation())?!0:(I.boostCharge=0,I.boostCanCharge=!0,I.shotsLeft+=5,this.managers.audio.play("snd_moves_up"),!1)},E.prototype.fakeBubbleLogic=function(e){if(L.nowTime<e.createdTime+1e3)return!0;var t=this.gridCollide.bubbleToGameUi(e);return B.effects.add(w.POP_BUBBLE,L.gameUILayer,t.x,t.y),!1},E.prototype.smokeLogic=function(e){return e.y+=e.vy*L.elapsedTime/1e3,e.vy-=10,e.alpha-=.03,e.alpha<=0?!1:!0},E.prototype.rocketLogic=function(e){var t=N.sign0(e.scale.x);e.x+=e.vx*L.elapsedTime/1e3,e.vx=Math.min(e.vx+21*t,880),0===(1&I.frameCount)&&B.effects.add(w.ROCKET_SMOKE,e.parent,e.x-.9*I.bubbleDiameter*t,e.y,this.smokeLogic,this),e.effectOverlay&&(e.effectOverlay.x=e.x-1.3*I.bubbleRadius*t);
var s=this.gridCollide.bubbleToGrid(e);if(Math.abs(e.x)>I.gridOffsetX||!s)return e.alpha-=.05,e.alpha<=0?(this.looseFall=!0,!1):!0;var i=this.gridCollide.get(s);if(i){switch(i.type){case P.EGG.type:return L.debug&&console.log("rocket hit egg bubble at "+s.x+","+s.y),this.crackEgg(i),!1;case P.BOMB.type:return this.addExplosion(s,i),this.looseFall=!0,B.effects.add(w.EXPLOSION,L.bubbleLayer,e.x,e.y),!1;case P.ICE.type:return this.crackShell(i,s,!0),!1}i.pop(s)}return!0},E.prototype.dragonHatchLogic=function(e){if(0===(7&I.frameCount)){var t=N.near(e,I.bubbleRadius/2);B.effects.add(w.SPARKLES_WHITE,e.parent,t.x,t.y)}if(e.scale.set(1.002*e.scale.x),e.hoverDelay>0)w.swoopToTarget(e,e.dest)||(e.hoverDelay-=L.elapsedTime);else if(e.alpha-=1*L.elapsedTime/1e3,e.alpha<=0)return!1;return!0};var Y=Math.tan(60*Math.PI/180);E.prototype.populateLevel=function(e){Math.mySeed(this.game.level+1),L.forceResize=!0,this.gridCollide=new GridCollide,this.gridCollide.create(this.grid,I.bubbleRadius,I.bubbleRadius*Y);for(var t=e.goal_fish?e.goal_fish.count:0,s=0;s<e.height;s++)for(var i=0;i<2*e.width-1;i++)if(-1!=this.grid[s][i]){var a=N.pickRandomFromList(e.list,Math.myRandom),o=P[a].type;o=this.symmetry(this.grid,i,s,o,e.symmetry);var n=new M(this.game,this.managers,this,this.gridCollide);n.create(L.bubbleLayer,o,i,s)}switch(e.holes&&this.makeHoles(e.holes),this.looseFallNow(!0),I.levelType){case LevelType.GOAL_PROTECT_BARRIER:break;case LevelType.GOAL_RESCUE_FISH:this.game.foodCount=t,this.addOverlays(this.grid,t,e.goal_fish);break;case LevelType.GOAL_BREAK_EGG:this.addGong()}e.specials&&this.addSpecials(this.grid,e.specials)},E.prototype.changeToSpecial=function(e){var t=N.pickRandomFromList(["bomb","rocket","fairy","bat"],Math.myRandom);L.debug&&console.log("changeToSpecial "+t+" at "+e.x+","+e.y),this.addOneSpecial(e,t)},E.prototype.addOneSpecial=function(e,t){switch(t){case"bomb":this.addBomb(this.grid,e);break;case"rocket":this.addRocket(this.grid,e);break;case"shell":this.addShell(this.grid,e);break;case"fairy":this.addFairy(this.grid,e);break;case"bat":this.addBat(this.grid,e)}},E.prototype.addSpecials=function(e,t){for(var s=0,i=t.length;i>s;s++)this.addSpecial(e,t[s])},E.prototype.addSpecial=function(e,t){void 0!==t.special_bomb&&this.addBombs(e,t.special_bomb),void 0!==t.special_rocket&&this.addRockets(e,t.special_rocket),void 0!==t.special_frozen_bubble&&this.addShells(e,t.special_frozen_bubble),void 0!==t.special_burst_dragon&&this.addFairies(e,t.special_burst_dragon),void 0!==t.special_carry_dragon&&this.addBats(e,t.special_carry_dragon)},E.prototype.addBats=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addBat(e,t)})},E.prototype.addBat=function(e,t){var s=e[t.y][t.x];if(s&&s.isNormal()&&!s.overlay){var i=s.addOverlay(P.DRAGON_PURPLE.type);return i.parent}return null},E.prototype.addFairies=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addFairy(e,t)})},E.prototype.addFairy=function(e,t){var s=e[t.y][t.x];if(s&&s.isNormal()&&!s.overlay){var i=s.addOverlay(P.DRAGON_ORANGE.type);return i.parent}return null},E.prototype.addBombs=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addBomb(e,t)})},E.prototype.addBomb=function(e,t){var s=e[t.y][t.x],i=null;return s&&s.isNormal()&&!s.overlay&&(i=s.changeType(P.BOMB.type)),i},E.prototype.addRockets=function(e,t){var s=this,i=this.createEdgeGrid(e,3,3);this.findLocations(i,t.number,t,function(t){return s.addRocket(e,t)})},E.prototype.addRocket=function(e,t){var s=e[t.y][t.x],i=null;return s&&s.isNormal()&&!s.overlay&&(i=s.changeType(P.ROCKET.type),t.x>=2*I.width/2&&(i.sprite.scale.x=-Math.abs(i.sprite.scale.x))),i},E.prototype.addShells=function(e,t){var s=this;this.findLocations(e,t.number,t,function(t){return s.addShell(e,t)})},E.prototype.addShell=function(e,t){var s=e[t.y][t.x],i=null;return s.isNormal()&&!s.overlay&&(i=s.changeType(P.ICE.type)),i},E.prototype.addOverlays=function(e,t,s){this.findLocations(e,t,s,function(t){var s=e[t.y][t.x];if(s&&s.isNormal(!1)&&!s.overlay){var i=s.addOverlay(P.FISH.type);return i.parent}return null})},E.prototype.addGong=function(){var e,t=this.grid,s={x:Math.floor(t[0].length/2),y:0},i=s.x;do e=t[s.y][i],-1==e&&(i>2*I.width/2?i--:i++,e=t[s.y][i]),i=Math.floor(Math.myRandom()*I.width*2);while(!e);e.addOverlay(P.EGG.type),e.changeType(P.EGG.type);var a=this;e.sprite.updateCallback=function(e){if("cracking"==e.animation){if(3==e.frameIndex&&!e.taskDone){var t=a.gridCollide.bubbleToGameUi(e),s=B.effects.add(w.DRAGON_GOLD,L.gameUILayer,t.x,t.y,a.dragonHatchLogic,a);s&&(s.dest={x:0,y:0}),e.taskDone=!0}e.atEnd&&(a.hitGong=!0,a.looseFall=!0)}}},E.prototype.makeHoles=function(e){for(var t=0;t<e.number;t++){var s,i;do s=this.gridCollide.randomLocation(this.grid,!0,Math.myRandom),i=this.grid[s.y][s.x];while(i.overlay);i.destroy(),this.grid[s.y][s.x]=0}},E.prototype.symmetry=function(e,t,s,i,a){var o=i;if(a&&a.length>0)for(var n=a.length-1;n>=0;--n){var r=2*a[n].x-1;if(t>r){var l=r-(t-r);l>=0&&l<e[s].length&&100*Math.myRandom()<a[n].pcnt&&(o=e[s][l].type,-1==o&&(o=e[s][l+1].type));break}}return o},E.prototype.findLocations=function(e,t,s,i){for(var a=[],o=10,n=100*t,r=t;r>0;){var l=!1,h=this.gridCollide.randomLocation(e,!0,Math.myRandom);if(this.validateDistanceFromList(e,a,h.x,h.y,s)){var u=i(h);u&&(a.push(u),r--,l=!0)}if(!l&&--n<=0){if(L.debug&&console.log("WARNING: PlayField.findLocations got stuck, changing ranges "+s.min+" "+s.max),s.min>2){s.min-=2,s.max<1e3&&(s.max+=2),n=500;continue}if(s.max<1e3){s.max+=2,n=500;continue}if(--o<=0){console.log("ERROR: PlayField.findLocations got irrevocably stuck! Exiting with list length = "+a.length);break}n=100}}return a},E.prototype.validateDistanceFromList=function(e,t,s,i,a){var o=this.gridCollide.gridToBubble({x:s,y:i}),n=N.findNearestPointInList(o,t);if(-1==n)return!0;var r=N.distanceBetween(o,t[n]);return(!a.min||r>=a.min*I.bubbleRadius/16)&&(!a.max||r<a.max*I.bubbleRadius/16)?!0:!1},E.prototype.createEdgeGrid=function(e,t,s){for(var i=[],a=e[0].length,o=0;o<e.length;o++){i[o]=[];for(var n=0;n<e[o].length;n++)i[o][n]=e[o][n]&&-1==e[o][n]?-1:t>n||n>a-s?e[o][n]:0}return i},E.prototype.effectContinues=function(){return I.frameCount-this.resizeChargeBlocker<4?!0:this.introScroll?!0:this.explosionList&&this.explosionList.length>0?!0:this.isFairyFlying()?!0:!1},E.prototype.isFairyFlying=function(){return B.effects.countDragonsFlying()>0?!0:!1},E.prototype.pickVisibleBubble=function(e,t,s){L.debug&&console.log("PlayField.pickVisibleBubble "+e+" -> "+t),void 0===s&&(s=!0);var i=this.findLowestBubble();if(!i)return L.debug&&console.log("no lowest bubble!"),null;(void 0===e||0>e)&&(e=0),e>=this.grid[0].length&&(e=this.grid[0].length-1),(void 0===t||t>this.grid[0].length)&&(t=this.grid[0].length),0>t&&(t=0);var a,o=5,n=[];do{for(var r=i.y;r>=Math.max(0,i.y-o);--r)for(var l=e;l<Math.min(t,this.grid[r].length);l++){var h=this.grid[r][l];h&&-1!=h&&h.isNormal()&&!h.overlay&&n.push({x:l,y:r})}if(0===n.length){if(o++<=i.y)continue;if(s){if(e-->0)continue;if(t++<this.grid[0].length-1)continue}return L.debug&&console.log("failed to find any bubbles!"),null}a=N.pickRandomFromList(n,Math.myRandom)}while(!a);return n=null,a},E.prototype.pickVisibleSpace=function(){var e=this.findLowestBubble();if(!e)return null;var t=[],s=e.y;do{for(var i=Math.max(s-6,0),a=s;a>=i;--a)for(var o=0;o<this.grid[a].length;o++){var n=this.grid[a][o];if(!n){var r={x:o,y:a};this.adjacentFilled(r)&&t.push(r)}}s-=6,0>s&&(s=e.y+1)}while(0===t.length);var l=N.pickRandomFromList(t,Math.myRandom);return t=null,l},E.prototype.adjacentFilled=function(e){return this.gridCollide.get({x:e.x-2,y:e.y})?!0:this.gridCollide.get({x:e.x+2,y:e.y})?!0:this.gridCollide.get({x:e.x-1,y:e.y-1})?!0:this.gridCollide.get({x:e.x+1,y:e.y-1})?!0:this.gridCollide.get({x:e.x-1,y:e.y+1})?!0:this.gridCollide.get({x:e.x+1,y:e.y+1})?!0:!1},E.prototype.findLowestBubble=function(){for(var e=this.grid.length-1;e>=0;--e)for(var t=0;t<this.grid[e].length;t++)if(this.grid[e][t]&&-1!=this.grid[e][t])return{x:t,y:e};return null},E.prototype.getAllBubbles=function(){for(var e=[],t=0;t<this.grid.length;t++)for(var s=0;s<this.grid[t].length;s++)this.grid[t][s]&&-1!=this.grid[t][s]&&e.push(this.grid[t][s]);return e},E.prototype.getGridCollide=function(){return this.gridCollide},E.prototype.setBubbleValues=function(){var e=Number.POSITIVE_INFINITY;this.lowestBubbleY=Number.NEGATIVE_INFINITY;for(var t=this.getAllBubbles(),s=t.length-1;s>=0;--s){var i=t[s];if(i&&null!==i.game){var a=this.gridCollide.bubbleToGameUi(i.sprite);a.y>this.lowestBubbleY&&(this.lowestBubbleY=a.y),a.y<e&&(e=a.y)}}return e},E.prototype.adjustScroll=function(){var e=this.world.getLauncherLocation(L.gameUILayer);if(this.setBubbleValues(),I.levelType==LevelType.GOAL_PROTECT_BARRIER){if(this.lowestBubbleYOffset){var t=e.y-this.lowestBubbleYOffset,s=this.lowestBubbleY-t,i=this.scrollY-s;this.scrollY=i}}else if(!this.introScroll){var t=e.y+I.scrollLineY[I.levelType],s=this.lowestBubbleY-t,i=this.scrollY-s;this.scrollY=i}this.gridCollide.offsetY=this.scrollY,L.bubbleLayer.y=Math.floor(this.scrollY*L.bubbleLayer.scale.y)},E.prototype.scrollControl=function(e){this.setBubbleValues();var t=I.scrollSpeed*L.elapsedTime/1e3,s=20;if(I.levelType==LevelType.GOAL_PROTECT_BARRIER){if(this.introScroll){var i=this.lowestBubbleY-(e.y+I.scrollLineY[I.levelType]),a=this.scrollY-i,o=(this.scrollY*(s-1)+a)/s,n=N.limit(o-this.scrollY,t,5*t);return this.introScroll&&Math.abs(this.scrollY-a)<.5&&(this.introScroll=!1,this.world.showBoost(!0)),this.scrollY+n}if(this.lowestBubbleY<e.y+I.scrollLineY[I.levelType]-3*I.bubbleRadius){var r=I.scrollSpeed*L.elapsedTime/1e3;this.autoScroll(r),this.scrollDownBonus&&I.boostCanCharge&&I.frameCount-this.resizeChargeBlocker>4&&(I.boostCharge+=I.catchUpBoost*r,I.score+=I.scoreCatchUp*r)}return this.scrollY}var i=this.lowestBubbleY-(e.y+I.scrollLineY[I.levelType]),a=this.scrollY-i,o=(this.scrollY*(s-1)+a)/s,n=N.limit(o-this.scrollY,t,4*t);return this.introScroll&&Math.abs(this.scrollY-a)<.5&&(this.introScroll=!1,this.world.showBoost(!0)),this.scrollY+n},A.ANIMATING=0,A.WAITING=1,A.LOADSHOT=2,A.AIMING=3,A.ARM_SHOT=4,A.FIRE=5,A.MOVING=6,A.CANCEL=7,A.CHANGEORDER=8,A.OUTOFAMMO=9,A.ENDOFLEVEL=10,A.colourFromType=[],A.prototype.create=function(e,t,s,i,a){this.world=e,this.managers=t,this.playField=s,this.levelData=i,this.gridCollide=a,this.bubblesInLevel=i.list,A.colourFromType[P.BLUE.type]="traj_blue.png",A.colourFromType[P.GREEN.type]="traj_green.png",A.colourFromType[P.RED.type]="traj_red.png",A.colourFromType[P.YELLOW.type]="traj_yellow.png",A.colourFromType[P.PURPLE.type]="traj_purple.png",A.colourFromType[P.RAINBOW.type]="traj_special.png",A.colourFromType[P.FIREBALL.type]="traj_special.png",A.colourFromType[P.MINE.type]="traj_special.png",this.state=A.WAITING,this.lastState=-1,this.rememberFiredTypes=[],this.bubbleQueue=[],this.addBubbleToQueue(),this.addBubbleToQueue(),this.shotLoading=!1,this.shotFired=null,this.aimPoint=null,this.angleTooMuch=!0,this.shotStartTime=-1,this.ignoreCollisions=null,this.trajectory=[],this.cursor=null,this.remainingSpread=0,this.remainingAngle=0,this.remainingDelay=0,this.launchTime=0,this.bonusShotsFired=0,this.shotLoadedLocation=this.world.getLauncherLocation(L.gameUILayer)},A.prototype.destroy=function(){if(this.game=null,this.world=null,this.levelData=null,this.playField=null,this.managers=null,this.aimPoint=null,this.ignoreCollisions=null,this.bubblesInLevel=null,this.rememberFiredTypes=null,this.destroyShots(),this.trajectory){for(var e=0;e<this.trajectory.length;e++)this.trajectory[e]&&this.trajectory[e].destroy();this.trajectory=null}this.cursor&&(this.cursor.destroy(),this.cursor=null)},A.prototype.destroyShots=function(){var e=!1;if(this.bubbleQueue){for(var t=0;t<this.bubbleQueue.length;t++)M.isNormalKey(this.bubbleQueue[t].key,!1)||(e=!0),this.bubbleQueue[t].destroy(),this.bubbleQueue[t]=null;this.bubbleQueue=null}return this.shotLoaded&&(M.isNormalKey(this.shotLoaded.key,!1)||(e=!0),this.shotLoaded.destroy(),this.shotLoaded=null),this.shotFired&&(this.shotFired.destroy(),this.shotFired=null),e},A.prototype.update=function(){L.resized&&(this.shotLoadedLocation=this.world.getLauncherLocation(L.gameUILayer),this.shotLoaded&&(this.shotLoaded.x=this.shotLoadedLocation.x,this.shotLoaded.y=this.shotLoadedLocation.y,this.showQueue(1),this.world.showBoost()));var e=this.state!=this.lastState;switch(this.lastState=this.state,this.state){case A.OUTOFAMMO:I.shotsLeft>0&&(this.state=A.WAITING);break;case A.ENDOFLEVEL:case A.ANIMATING:break;case A.WAITING:this.readyForShot()?this.state=A.LOADSHOT:(this.launchTime<500&&(this.launchTime=500),this.playField.shotFired(this.launchTime+=L.elapsedTime),this.hideTrajectory());break;case A.LOADSHOT:if(e&&this.world.launcherRingReset(),0===I.shotsLeft){this.state=A.OUTOFAMMO;break}if(!this.shotLoaded){this.showQueue(0),this.loadShot();break}this.showQueue(1),this.world.showBoost(),this.state=A.AIMING;break;case A.AIMING:if(e&&(this.mouseMoveLocal=null),this.playField.hitGong||this.game.droppedLastFish){this.state=A.CANCEL,this.hideTrajectory();break}this.shotLoaded.alpha<1&&(this.shotLoaded.alpha+=.1),this.specialAim(this.shotLoaded),this.aimShot();break;case A.ARM_SHOT:this.shotLoaded.alpha<1&&(this.shotLoaded.alpha+=.1),this.specialAim(this.shotLoaded),this.readyForShot()?this.armShot():(this.hideTrajectory(),this.state=A.AIMING);break;case A.FIRE:e&&(I.popCount=0,this.shotLoaded.alpha=1,this.specialFire(this.shotLoaded)),this.fireShot(),this.takeBubbleFromQueue(),this.addBubbleToQueue();break;case A.MOVING:e&&(this.ignoreCollisions=[],this.launchTime=0),this.playField.shotFired(this.launchTime+=L.elapsedTime),this.moveShot(this.shotFired,!0)||(this.playField.looseFall=!0,this.state=A.WAITING);break;case A.CHANGEORDER:this.rotateQueue();break;case A.CANCEL:this.state=A.WAITING}this.playField.introScroll&&this.shotLoaded&&(this.shotLoaded.alpha=0),this.shotLoaded&&null===this.shotLoaded.parent&&(this.shotLoaded=null),this.shotFired&&null===this.shotFired.parent&&(this.shotFired=null),this.shotFired&&this.shotFired.update(),this.shotLoaded&&this.shotLoaded.update()},A.prototype.readyForShot=function(){return this.playField.effectContinues()?!1:this.shotLoading?!1:this.playField.hitGong||this.game.droppedLastFish?!1:!0},A.prototype.showQueue=function(e){var t=this.bubbleQueue[e];t.x=this.shotLoadedLocation.x+I.queuePositionX1,t.y=this.shotLoadedLocation.y+I.queuePositionY1,t.anchor.set(.5),t.scale.set(I.queuePositionScale),t.visible=!0},A.prototype.aimShot=function(){this.matchAvailableColours(),L.mouseMoveLocal&&(this.aimPoint={x:L.mouseMoveLocal.x,y:L.mouseMoveLocal.y},e.touchEvent||(L.showLockedCursor?this.cursor||(this.cursor=new n,this.cursor.create(L.gameUILayer,"bubble_cursor",this.managers.textures,0,0,!1),this.cursor.anchor.set(.5)):this.cursor&&(this.cursor.destroy(),this.cursor=null),I.shotsLeft>0&&this.drawTrajectory(L.mouseMoveLocal,I.trajectoryLength))),I.shotsLeft>0&&(L.mouseDown&&(this.state=A.ARM_SHOT,this.shotStartTime=L.nowTime,L.mouseUp=L.click=null),G.isPressed[U.space_bar]&&(this.state=A.CHANGEORDER))},A.prototype.armShot=function(){return this.drawTrajectory(L.mouseMoveLocal,I.trajectoryLength),this.aimPoint={x:L.mouseMoveLocal.x,y:L.mouseMoveLocal.y},L.mouseUp||L.click?(this.state=this.aimingAtOwnShooter()?L.nowTime-this.shotStartTime<=L.shortTapDurationMS?A.CHANGEORDER:A.WAITING:this.angleTooMuch?A.WAITING:A.FIRE,void(L.mouseUp=L.click=L.mouseUpLocal=null)):void(G.isPressed[U.space_bar]&&(this.state=A.CHANGEORDER))},A.prototype.aimingAtOwnShooter=function(e){if(!e){if(!this.aimPoint)return!1;e=this.aimPoint}var t=this.world.launcherButton,s=new PIXI.Point(0,0);return s=t.toGlobal(s),s.y-=40*L.height/480,t=L.gameUILayer.toLocal(s),N.distanceBetweenScaled(e,{x:t.x,y:t.y},1,1)<I.shooterRadius},A.prototype.hideTrajectory=function(){if(this.trajectory)for(var e=0;e<this.trajectory.length;e++)this.trajectory[e]&&(this.trajectory[e].visible=!1)},A.prototype.drawTrajectory=function(e,t){if(!this.aimingAtOwnShooter(e)){this.trajectory||(this.trajectory=[]);var s=e.x-this.shotLoadedLocation.x,i=e.y-this.shotLoadedLocation.y,a=180*Math.atan2(s,-i)/Math.PI;if(Math.abs(a)<=I.aimAngleLimit){this.angleTooMuch=!1;for(var o=this.simulateShotMovement(),r=0,l=0,h=o.length;h>l&&t>l;l+=I.shotStep){var u=this.trajectory[r];u||(u=new n,u.create(L.gameUILayer,"traj_blue.png",this.managers.textures,0,0,!1,!0),u.anchor.set(.5),this.trajectory[r]=u),u.x=o[l].x,u.y=o[l].y,u.visible=!0,u.setFrame(A.colourFromType[this.shotLoaded.type]),r++}for(h=this.trajectory.length;h>r;r++)this.trajectory[r]&&(this.trajectory[r].destroy(),this.trajectory[r]=null);o=null}else this.angleTooMuch=!0,this.hideTrajectory()}},A.prototype.simulateShotMovement=function(){var e=[];this.simulateShot=new n,this.simulateShot.create(L.gameUILayer,this.shotLoaded.type,this.managers.textures,this.shotLoaded.x,this.shotLoaded.y,!1),this.simulateShot.anchor.set(.5),this.simulateShot.visible=!1;var t=this.aimPoint.x-this.simulateShot.x,s=this.aimPoint.y-this.simulateShot.y,i=Math.sqrt(t*t+s*s);for(this.simulateShot.vx=t/i*I.shotSpeed,this.simulateShot.vy=s/i*I.shotSpeed,this.ignoreCollisions=[];this.moveShot(this.simulateShot,!1);)e.push({x:this.simulateShot.x,y:this.simulateShot.y});return this.cursor&&(this.cursor.x=this.simulateShot.x,this.cursor.y=this.simulateShot.y,this.cursor.visible=!0),this.simulateShot.destroy(),this.simulateShot=null,e},A.prototype.fireShot=function(){if(L.debug&&console.log("*** fireShot *** "+this.shotLoaded.type+" shotsLeft = "+I.shotsLeft),I.shotsLeft>0){for(I.shotsLeft--,this.rememberFiredTypes.push(this.shotLoaded.type);this.rememberFiredTypes.length>4;)this.rememberFiredTypes.shift();L.idleTimer=L.eventChangeAdOnIdle,this.shotFired=this.shotLoaded,this.shotLoaded=null;var e=this.aimPoint.x-this.shotFired.x,t=this.aimPoint.y-this.shotFired.y,s=Math.sqrt(e*e+t*t);this.shotFired.vx=e/s*I.shotSpeed,this.shotFired.vy=t/s*I.shotSpeed,this.state=A.MOVING,this.managers.audio.play("snd_shoot")}this.hideTrajectory()},A.prototype.addBubbleToQueue=function(){if(this.bubbleQueue.length<2){var e=this.pickABubble(),t=new n;t.create(L.gameUILayer,e,this.managers.textures,0,0,!1),t.anchor.set(.5),t.visible=!1,this.bubbleQueue.push(t)}},A.prototype.boostInQueue=function(e){for(var t=0;t<this.bubbleQueue.length;t++)if(this.bubbleQueue[t].type==e)return!0;return!1},A.prototype.addBoostToQueue=function(e,t){if(!this.boostInQueue(e)&&this.bubbleQueue&&this.bubbleQueue.length>0){var s=this.bubbleQueue.pop();s&&(s.setType(e),s.setAnimation("default",!0,!0),this.bubbleQueue.push(s),s.x=t.x,s.y=t.y,this.tweenLoadBoost(s,{x:this.shotLoadedLocation.x+I.queuePositionX1,y:this.shotLoadedLocation.y+I.queuePositionY1,scale:I.queuePositionScale},function(){}))}},A.prototype.loadShot=function(e){var t=this;this.hideTrajectory();var s=this.bubbleQueue[0];s.tweener||(this.shotLoaded=s,L.debug&&console.log("Shooter.loadShot "+this.shotLoaded.key),e!==!1?(this.shotLoading=!0,this.tweenLoad(this.shotLoaded,{x:this.shotLoadedLocation.x,y:this.shotLoadedLocation.y,scale:1},function(){t.showQueue(1),t.world.showBoost(),t.state=A.AIMING,t.shotLoading=!1})):(this.showQueue(1),this.world.showBoost()),this.state=A.WAITING)},A.prototype.rotateQueue=function(){L.debug&&console.log("Shooter.rotateQueue");var e=this;this.state=A.ANIMATING;var t=this.bubbleQueue[this.bubbleQueue.length-1];t.x=this.shotLoadedLocation.x+I.queuePositionX1,t.y=this.shotLoadedLocation.y+I.queuePositionY1,this.tweenSwap(this.bubbleQueue[0],t,function(){var t=e.bubbleQueue.shift();e.bubbleQueue.push(t),e.loadShot(!1),e.showQueue(1),e.state=A.WAITING}),this.hideTrajectory()},A.prototype.pickABubble=function(){var e,t=3;do{var s=N.pickRandomFromList(this.bubblesInLevel);e=P[s].type}while(N.countInList(this.rememberFiredTypes,e)>=3&&t-->0);return e},A.prototype.takeBubbleFromQueue=function(){this.bubbleQueue&&this.bubbleQueue.length>0&&this.bubbleQueue.shift()},A.prototype.moveShot=function(e,t){e.mx=e.x,e.my=e.y,t?(e.x+=e.vx*L.elapsedTime/1e3,e.y+=e.vy*L.elapsedTime/1e3,this.specialAnim(e)):(e.x+=16*e.vx/1e3,e.y+=16*e.vy/1e3),e.x<=-I.gridOffsetX&&(e.x=-I.gridOffsetX+1e-4,e.vx=Math.abs(e.vx),t&&this.managers.audio.play("snd_bubbleBounce")),e.x>=I.gridOffsetX&&(e.x=I.gridOffsetX-1e-4,e.vx=-Math.abs(e.vx),t&&this.managers.audio.play("snd_bubbleBounce"));var s=this.gridCollide.gridToBubble({x:0,y:0}),i=this.gridCollide.bubbleToGameUi(s);e.y<i.y&&(e.y=i.y,e.vy=0);var a=this.gridCollide.gameUiToBubble(e);a.type=e.type;var o=this.gridCollide.gameUiToBubble({x:e.mx,y:e.my});a.mx=o.x,a.my=o.y;var n=this.gridCollide.bubbleToGrid(a);if(n.y>this.playField.grid.length)return!1;if(a.y<=-(I.gridOffsetY-.01)){if(this.canStickToTop(a.type))return t&&this.managers.audio.play("snd_stick_top"),a.x=a.mx,a.y=a.my,this.makeShotIntoBubble(a,t),!1;if(t){if(a.type==P.MINE.type){var r=this.gridCollide.bubbleToGrid(a);this.playField.radiusEffect(r,Math.sqrt(11.5),this.playField.explodeBubble),B.effects.add(w.EXPLOSION,L.gameUILayer,e.x,e.y),L.debug&&console.log("Mine explodes against top at location "+r.x+","+r.y," pixels = "+e.x+","+e.y)}e.destroy()}return!1}var l=this.gridCollide.collide(e,1);return null!==l&&l.length>0&&(l=this.getActualCollisions(a,l,I.bubbleCollisionRadius),l&&l.length>0&&!this.handleCollisions(l,a,e,t))?!1:!0},A.prototype.canStickToTop=function(e){return e==P.FIREBALL.type?!1:e==P.MINE.type?!1:!0},A.prototype.handleCollisions=function(e,t,s,i){var a=this.specialCollide(s,e,i);if(null!==a)return a;if(s.vx=s.vy=0,t.x=(t.x+t.mx)/2,t.y=(t.y+t.my)/2,s.type==P.MINE.type){if(i){var o=this.gridCollide.bubbleToGrid(t);this.playField.directHit(o),this.playField.radiusEffect(o,Math.sqrt(11.5),this.playField.explodeBubble);var n=B.effects.add(w.EXPLOSION,L.gameUILayer,s.x,s.y);n&&n.scale.set(1.5),this.shotFired.destroy(),this.shotFired=null}return!1}return this.makeShotIntoBubble(t,i),!1},A.prototype.makeShotIntoBubble=function(e,t){var s;if(null!==e.key)if(t){s=this.snapBubbleToGrid(e),L.debug&&console.log("makeShotIntoBubble snapped to "+s.x+","+s.y+" "+e.key);var i=new M(this.game,this.managers,this.playField,this.gridCollide);i.create(L.bubbleLayer,e.type,s.x,s.y),this.shotFired.destroy(),this.shotFired=null,this.managers.audio.play("snd_stick"),this.playField.matchAt(s,i,3),this.playField.directHit(s),this.playField.looseFall=!0}else{s=this.gridCollide.bubbleToGrid(e);var a=this.gridCollide.gridToGameUi(s);this.simulateShot.x=a.x,this.simulateShot.y=a.y}},A.prototype.snapBubbleToGrid=function(e){return this.findClosestEmptyGridTo(e)},A.prototype.findClosestEmptyGridTo=function(e){for(var t=Number.MAX_VALUE,s=null,i=this.gridCollide.bubbleToGrid(e),a=-1;1>=a;a++)for(var o=-2;2>=o;o++){var n={x:i.x+o,y:i.y+a},r=this.gridCollide.get(n);if(0===r||null===r){var l=this.gridCollide.gridToBubble(n),h=e.x-l.x,u=e.y-l.y,c=h*h+u*u;t>c&&(t=c,s={x:n.x,y:n.y})}}return s},A.prototype.triggerAndPopBubbleFromSprite=function(e,t){if(e&&e.transform){var s=this.gridCollide.bubbleToGrid(e);if(!this.playField.hit(s,t)){var i=this.gridCollide.get(s);i&&-1!=i&&i.pop(s)}}else console.log("WARNING: triggerAndPopBubbleFromSprite has an invalid sprite!"),console.log(e),console.log(e.transform)},A.prototype.getActualCollisions=function(e,t,s){for(var i=[],a=2*s*s*2,o=0,n=t.length;n>o;o++){var r=t[o].sprite;r.transform?this.contact(e,r,a)&&i.push(r):alert("snafu! invalid sprite found")}return i},A.prototype.contact=function(e,t,s){var i=e.x-t.x,a=e.y-t.y,o=i*i+a*a;return s>=o},A.prototype.reverseMotion=function(e,t,s){var i=2*s*2*s,a=e.x,o=e.y,n=e.mx-a,r=e.my-o,l=!0;do{n/=2,r/=2,e.x=a+=n,e.y=o+=r;for(var h=!1,u=0,c=t.length;c>u;u++)if(this.contact(e,t[u],i)){h=!0;break}this.gridCollide.outsideGrid(e)&&(h=!0),h!=l&&(n=-n,r=-r,l=h)}while(Math.abs(n)>=.5||Math.abs(r)>=.5)},A.prototype.matchAvailableColours=function(){if(this.bubbleQueue&&L.bubbleLayer&&L.bubbleLayer.children){var e,t=L.bubbleLayer.children.length-(this.playField.topBar?1:0);if(15>t&&t>0){var s=[];for(e=0;e<L.bubbleLayer.children.length;e++){var i=L.bubbleLayer.children[e];i!=this.playField.topBar&&M.isNormal(i.type,!1)&&-1==s.indexOf(i.type)&&s.push(i.type)}for(e=0;e<this.bubbleQueue.length;e++){var a=this.bubbleQueue[e].type;if(-1==s.indexOf(a)&&M.isNormal(this.bubbleQueue[e].type,!1)){var o=N.pickRandomFromList(s);if(null===o||o===P.UNDEFINED.type)return;this.bubbleQueue[e].setType(o)}}}}},A.prototype.shootRemaining=function(){if(I.shotsLeft>0&&(this.remainingSpread||(L.debug&&console.log("*** start bonus sequence ***"),this.destroyShots(),this.remainingSpread=Math.max(70/(I.shotsLeft+1),10),this.remainingAngle=-35+this.remainingSpread,this.remainingDelay=L.nowTime),L.nowTime>=this.remainingDelay)){this.remainingDelay=L.nowTime+I.bonusShootDelay;var e=this.world.getLauncherLocation(L.gameUILayer),t=B.effects.add(w.FAKE_BUBBLE,L.gameUILayer,e.x,e.y,this.endSequenceLogic,this);t&&(t.score=!this.levelData.extraTurns||this.bonusShotsFired>=this.levelData.extraTurns?I.bonusScoreFinale:I.bonusScoreFinale_Extras,t.vx=Math.sin(this.remainingAngle*Math.PI/180)*I.bonusShootSpeed,t.vy=-Math.cos(this.remainingAngle*Math.PI/180)*I.bonusShootSpeed,t.setType(this.pickABubble())),this.managers.audio.play("snd_shoot"),this.bonusShotsFired++,I.shotsLeft--,L.debug&&console.log("shoot bonus at "+L.nowTime+" next at "+this.remainingDelay+" shotsLeft = "+I.shotsLeft),this.remainingAngle+=this.remainingSpread,this.remainingAngle>35?(this.remainingSpread=-Math.abs(this.remainingSpread),this.remainingAngle=35+this.remainingSpread):this.remainingAngle<-35&&(this.remainingSpread=Math.abs(this.remainingSpread),this.remainingAngle=-35+this.remainingSpread)}},A.prototype.endLevel=function(){this.hideTrajectory(),this.state=A.ENDOFLEVEL},A.prototype.endSequenceLogic=function(e){if(e.x+=e.vx,e.y+=e.vy,e.y<2*-I.bubbleDiameter){B.effects.add(w.EXPLOSION,L.gameUILayer,e.x,e.y),I.score+=e.score;var t=new u;return t.create(e.x,e.y,L.textStyleBoldSmall,L.gameUILayer,this.managers,e.score.toString()),!1}return!0},A.prototype.boostSmokeLogic=function(e){return e.y+=e.vy*L.elapsedTime/1e3,e.vy-=1,e.vy>0&&(e.vy=0),e.alpha-=.03,e.alpha<=0?!1:!0},A.prototype.specialAim=function(e){if(e.type==P.FIREBALL.type&&0===(7&I.frameCount))c=e.key.substring(16,18),c=c-0+1,c>2&&(c=0),e.frameIndex=c;else if(e.type==P.RAINBOW.type&&0===(3&I.frameCount)){var t=N.near(e,I.bubbleRadius);Math.random()<.5?B.effects.add(w.SPARKLES_RAINBOW,L.gameUILayer,t.x,t.y):B.effects.add(w.SPARKLES_WHITE,L.gameUILayer,t.x,t.y)}},A.prototype.specialFire=function(e){e.type==P.FIREBALL.type?(this.managers.audio.play("snd_fireball"),I.boostCharge=0,I.boostCanCharge=!0,this.world.showBoost(!0)):e.type==P.MINE.type?(this.managers.audio.play("snd_mine"),I.boostCharge=0,I.boostCanCharge=!0,this.world.showBoost(!0)):e.type==P.RAINBOW.type&&(this.managers.audio.play("snd_rainbow"),I.boostCharge=0,I.boostCanCharge=!0,this.world.showBoost(!0))},A.prototype.specialAnim=function(e){if(e.type==P.FIREBALL.type){if(0===(7&I.frameCount)){var t=e.key.substring(16,18);t=t-0+1,t>2&&(t=0),e.frameIndex=t}if(0===(3&I.frameCount)){var s=B.effects.add(w.BOOST_SMOKE,e.parent,e.x,e.y+16,this.boostSmokeLogic,this,!0);s&&s.scale.set(1.25*s.scale.x,s.scale.y)}Math.abs(e.vx)+Math.abs(e.vy)<.5*I.shotSpeed&&e.scale.set(.95*e.scale.x)}else if(e.type==P.RAINBOW.type&&0===(3&I.frameCount)){var i=N.near(e,I.bubbleRadius);Math.random()<.5?B.effects.add(w.SPARKLES_RAINBOW,L.gameUILayer,i.x,i.y):B.effects.add(w.SPARKLES_WHITE,L.gameUILayer,i.x,i.y)}},A.prototype.specialCollide=function(e,t,s){if(e.type==P.FIREBALL.type){for(var i=0,a=t.length;a>i;i++){var o=t[i];if(!s)return!1;if(this.triggerAndPopBubbleFromSprite(o,Math.abs(e.vx)+Math.abs(e.vy)>.75*I.shotSpeed),e.vx*=I.fireBallDeceleration,e.vy*=I.fireBallDeceleration,Math.abs(e.vx)+Math.abs(e.vy)<I.shotSpeed/4)return e.destroy(),!1}return!0}return null},A.prototype.tweenLoadBoost=function(e,t,s){if(e&&t){if(0===e.x&&0===e.y)return e.x=t.x,e.y=t.y,e.scale.set(t.scale),void(s&&s());A.tweenBoost.from.x=e.x,A.tweenBoost.from.y=e.y,A.tweenBoost.from.scaleFactor=e.scale.x,A.tweenBoost.to.x=t.x,A.tweenBoost.to.y=t.y,A.tweenBoost.to.scaleFactor=t.scale,A.tweenBoost.step=N.makeFunctionForSprite(e),e.tweener=new Tweenable,e.tweener.tween(A.tweenBoost),e.tweener.owner=e,e.tweener.callback=s}},A.prototype.tweenLoad=function(e,t,s){if(e&&t){if(0===e.x&&0===e.y)return e.x=t.x,e.y=t.y,e.scale.set(t.scale),void(s&&s());A.tweenSwap1.from.x=e.x,A.tweenSwap1.from.y=e.y,A.tweenSwap1.from.scaleFactor=e.scale.x,A.tweenSwap1.to.x=t.x,A.tweenSwap1.to.y=t.y,A.tweenSwap1.to.scaleFactor=t.scale,A.tweenSwap1.step=N.makeFunctionForSprite(e),e.tweener=new Tweenable,e.tweener.tween(A.tweenSwap1),e.tweener.owner=e,e.tweener.callback=s}},A.prototype.tweenSwap=function(e,t,s){e&&t&&(A.tweenSwap1.from.x=A.tweenSwap2.to.x=e.x,A.tweenSwap1.from.y=A.tweenSwap2.to.y=e.y,A.tweenSwap1.from.scaleFactor=A.tweenSwap2.to.scaleFactor=e.scale.x,A.tweenSwap2.from.x=A.tweenSwap1.to.x=t.x,A.tweenSwap2.from.y=A.tweenSwap1.to.y=t.y,A.tweenSwap2.from.scaleFactor=A.tweenSwap1.to.scaleFactor=t.scale.x,A.tweenSwap1.step=N.makeFunctionForSprite(e),A.tweenSwap2.step=N.makeFunctionForSprite(t),e.tweener=new Tweenable,e.tweener.tween(A.tweenSwap1),e.tweener.owner=e,e.tweener.callback=null,t.tweener=new Tweenable,t.tweener.tween(A.tweenSwap2),t.tweener.owner=t,t.tweener.callback=s)};var H=350;A.tweenSwap1={from:{scaleFactor:1},to:{scaleFactor:1},duration:H,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},A.tweenSwap2={from:{scaleFactor:1},to:{scaleFactor:1},duration:H,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},A.tweenBoost={from:{scaleFactor:1},to:{scaleFactor:1},duration:2*H,easing:"easeInQuad",step:null,finish:function(){this.owner.tweener=null,this.callback&&this.callback()}},C.prototype.addPauseAndResumeActions=function(e,t){this._arenaXapi?(this._arenaXapi.addAction("GAME_PAUSE",e),this._arenaXapi.addAction("GAME_RESUME",t)):(window.ARK_game_arena_connector.registerAction("pause",e),window.ARK_game_arena_connector.registerAction("resume",t))},C.prototype.requestMidroll=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"PAUSE_READY",payload:null}):window.ARK_game_arena_connector.fireEventToArena("pause_ready")},C.prototype.handleMidrollStart=function(){},C.prototype.handleMidrollFinish=function(){},C.prototype.sendEventChange=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"EVENT_CHANGE",payload:null}):window.ARK_game_arena_connector.fireEventToArena("event_change")},C.prototype.sendGameStart=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"GAME_START",payload:null}):window.ARK_game_arena_connector.fireEventToArena("game_start")},C.prototype.sendGameEnd=function(e){this._arenaXapi?(this._arenaXapi.dispatch({type:"CHANGE_SCORE",payload:e}),this._arenaXapi.dispatch({type:"GAME_END",payload:null})):(window.ARK_game_arena_connector.changeScore(e),window.ARK_game_arena_connector.fireEventToArena("game_end"))},C.prototype.shouldShowGameEnd=function(){return this._arenaXapi?!0:"true"==window.ARK_game_arena_connector.showGameEnd()},C.prototype.getAbsoluteURL=function(e){return this._arenaXapi?[this._arenaXapi.assetOriginUrl,e].join(""):e},C.prototype.getLocale=function(){return this._arenaXapi?this._arenaXapi.locale:window.ARK_game_arena_connector.getParam("locale","en-US")},C.prototype.destroy=function(){this._arenaXapi&&(this._arenaXapi.removeAction("GAME_PAUSE"),this._arenaXapi.removeAction("GAME_RESUME"))},F.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},F.prototype.destroy=function(){this.pending=0,this.loader=null},F.prototype.addImage=function(e,t){this.loader.add(e,t),L.debugSpam&&console.log("Textures.addImage ",e,t),this.pending++},F.prototype.addAtlas=function(e,t){this.loader.add(e,t),L.debugSpam&&console.log("Textures.addAtlas ",e,t),this.pending++
},F.prototype.startLoading=function(e,t){var s=this;L.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,L.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():L.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},F.prototype.loadImage=function(e,t,s,i){L.debugSpam&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){L.debugSpam&&console.log("Texture loaded!"),s.call(i)}).load()},F.prototype.get=function(e,t){if(!PIXI.loader.resources[e])return PIXI.Texture.fromFrame(e);if(PIXI.loader.resources[e].texture)return PIXI.loader.resources[e].texture;if(t)return null;L.debug&&console.log("texture created from canvas",e);var s=PIXI.Texture.fromCanvas(PIXI.loader.resources[e]);return PIXI.loader.resources[e].texture=s,s},F.prototype.set=function(e,t){var s=PIXI.loader.resources[e];s&&s!=t&&(L.debug&&console.log("Textures.set removing image from cache",e),this.remove(e)),L.debug&&console.log("Textures.set adding image to cache",e,t.width,"x",t.height),s=PIXI.loader.resources[e]=t},F.prototype.exists=function(e,t){return PIXI.loader.resources[e]?PIXI.loader.resources[e].texture?!0:!t:!1},F.isCanvas=function(e){return e?e instanceof HTMLCanvasElement||"HTMLCanvasElement"==e.constructor.name||"HTMLCanvasElement"==(e.prototype?e.prototype.constructor:e.constructor).toString():(L.debug&&alert("ERROR: null or undefined object being tested for HTMLCanvasElement!"),!1)},F.prototype.remove=function(e){var t=PIXI.loader.resources[e];return t?t.texture?(F.isCanvas(t.texture)||t.texture.destroy({texture:!0,baseTexture:!0}),t.texture=null,F.isCanvas(t)?L.debug&&console.log("Textures.remove removing a Texture with a Canvas",e):(L.debug&&console.log("Textures.remove removing a Texture",e),t.destroy({texture:!0,baseTexture:!0})),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):(L.debug&&(F.isCanvas(t)?console.log("Textures.remove removing a Canvas",e):console.log("Textures.remove can't remove a null texture",e)),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):void(L.debug&&alert("ERROR: Textures.remove can't remove a null resource",e))},O.prototype.create=function(){this.list=[]},O.prototype.destroy=function(){this.list=null},O.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];L.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var a=this,o=new XMLHttpRequest;return o.overrideMimeType("application/json"),o.open("GET",t,!0),o.onreadystatechange=function(){4==o.readyState&&"200"==o.status&&(i.isReady=!0,i.data=JSON.parse(o.responseText),s&&s(),a.pending--)},o.send(null),this.pending++,i.src=t,i},O.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(L.debug&&console.log("DataManager.get(): data not in cache",e),null)},O.prototype.set=function(e,t){if(this.list[e])return void(L.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return L.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,L.debug&&console.log("DataManager.set(): data added to cache",e)},R.sfxVolume=.75,R.musicVolume=1,R.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.playedThisFrame=[],this.mute=!1,this.tunesMuted=!1,R.sfxVolume=.75,R.musicVolume=.5},R.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null,this.playedThisFrame=null},R.prototype.update=function(){if(!L.isAndroid||!L.isChromeMobile){for(var e=L.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];if(s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time))this.delayed.splice(t,1);else if(e>s.time){s.playCallback&&s.playCallback.call(this);var i=this.list[s.key];i.play(),this.delayed.splice(t,1)}}this.playedThisFrame=[]}},R.prototype.loadAudio=function(e,t,s){for(var i=[],a=0,o=s.length;o>a;a++)i.push(t+"."+s[a]);this.pending++,L.debugSpam&&console.log("AudioManager.loadAudio "+e+" "+t);var n=this;this.list[e]=new Howl({src:i,onload:function(){n.pending--}})},R.prototype.play=function(e){if(this.mute||L.isAndroid&&L.isChromeMobile)return null;if(Array.isArray(e)){var t=N.pickRandomFromList(e);return this._playOne(t)}return this._playOne(e)},R.prototype._playOne=function(e){if(L.isAndroid&&L.isChromeMobile)return null;if(e&&this.list&&this.list[e]&&L.muteUntil<=L.time){var t=this.list[e];if("loaded"!=t._state)return L.debug&&console.log("AudioManager.playOne "+e+" SFX not loaded!"),null;if(-1!=this.playedThisFrame.indexOf(e))return null;this.playedThisFrame.push(e),t.volume(R.sfxVolume);var s=t.play();return L.debug&&(s||console.log("SFX not playable!")),t}return null},R.prototype.playDelayed=function(e,t,s,i,a){return L.isAndroid&&L.isChromeMobile?null:(Array.isArray(e)&&(e=N.pickRandomFromList(e)),void(e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:L.time+1e3*t,playCallback:s,cancelCallback:i,context:a})))},R.prototype.visibilityMute=function(e){L.isAndroid&&L.isChromeMobile||(L.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0))},R.prototype.setMute=function(e,t){if(!L.isAndroid||!L.isChromeMobile){L.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()}},R.prototype.muteTunes=function(e,t){L.isAndroid&&L.isChromeMobile||(L.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus())},R.prototype.startTune=function(e,t,s){L.debug&&console.log("AudioManager.startTune "+e),L.isAndroid&&L.isChromeMobile||(this.gameTune&&this.stopTune(),this.list[e].loop(t?!1:!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(R.musicVolume*L.volumeControl),void 0!==s?this.muteTunes(s,!0):this.muteTunes(this.tunesMuted,!0))},R.prototype.stopTune=function(){L.isAndroid&&L.isChromeMobile||this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},R.prototype.setMusicVolume=function(e){L.isAndroid&&L.isChromeMobile||(R.musicVolume=e,this.gameTune&&this.gameTune.volume(R.musicVolume*L.volumeControl))},R.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0},console.time("Game create"),L.arenaHelper=new C(null),(new L).createGame(),console.timeEnd("Game create")}();