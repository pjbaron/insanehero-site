!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=0,e._debugText=null,window.addEventListener("resize",e.resizeCanvas,!1)}function t(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function s(e){return e?e+"Hidden":"hidden"}function i(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.anchor.set(0,0),this.responsive=null,this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.globalScale=null}function a(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0,this.responsive=null}function r(){this.parent=null,this.managers=null,this.bg=null,this.text=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1}function o(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function l(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.tab1=null,this.tab2=null,this.whichTab=0,this.checkBox=null}function h(e){n.call(this),this.textures=null,this.type=e||h.TYPE_BUTTON,this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null}function u(){this.checked=!1,this.tick=null,this.toggleEvent=null,h.call(this,h.TYPE_CHECKBOX)}function c(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[]}function d(){this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.chain=0,this.multiMatch=0,this.spriteList=null,this.lastHovered=null}function p(){this.managers=null}function g(){this.strings=null}function m(e,t,s){I.debug&&console.log("FontLoaded ",e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=m.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function f(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function _(){this.list=null}function y(){this.pending=0,this.loader=null}function v(){}function b(){this.list=null,this.pending=0}function x(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null}function w(e){void 0!=window.ArenaXApi&&null!=window.ArenaXApi&&(this._arenaXapi=ArenaXApi.init(e),this._arenaXapi.dispatch({type:"GAME_REGISTERED",payload:null})),void 0!=window.ARK_game_arena_connector&&window.ARK_game_arena_connector.init()}function T(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e}function M(e,t,s,i,a,r,o,l){this.managers=t,this.symbol=r,this.value=o,this.timer=1e3*l,this.name="cube_"+this.symbol+"_1",n.call(this),this.create(e,this.name,this.managers.textures),this.setPickerData(this.managers.data.get("maskData_1")),this.anchor.set(.5,.5),this.scale.x=M.scale,this.scale.y=M.scale,this.sizex=125*M.scale,this.sizey=125*M.scale,this.scalez=.28,this.cx=s,this.cy=i,this.cz=a,this.wobbleCount=0,this.angle=35*Math.PI/180,this.rotate3d(this.angle)}function k(){PIXI.Container.call(this),this.angle=0,this.targetAngle=0,this.speedMatchValue=0,this.speedMatchTime=0,this.multiMatchValue=0,this.levelBonusValues=null,this.world=null,this.overrideTileTimer=0,this.overrideTileKey=null,this.tileDescriptions=null,this.puzzleLayout=null,this.levelName="",this.tiles=null,this.managers=null,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.cacheSpriteList=[],this.second=!1,this.removeTiles=null,this.blankCubes=null,this.blankTimeCubes=null,this.lastTimeString="",this.verticalOffset=0,k.turnSpeed=4*Math.PI/180}function S(){this.preloader=null,this.titles=null,this.game=null,this.bm=null}function I(){I.VERSION="v1.001",I.testKeys=!0,I.debug=!0,I.showFPS=!1,I.pauseOnFocusLoss=!1,I.playAgainCount=0,I.playMidRollAd=!1,I.playMidRollAdAfterPause=!1,I.eventChangeAdOnMatch=!1,I.eventChangeAdOnTitlesShow=!1,I.eventChangeAdOnTitlesClose=!1,I.eventChangeAdOnRotate=!1,I.eventChangeAdOnPopup=!0,I.eventChangeAdOnOptions=!0,I.eventChangeAdOnIdle=3e3,I.idleTimer=Number.MAX_VALUE,I.timerStart=120999,I.gameWide=1200,I.gameHigh=900,I.volumeControl=.5,I.click=null,I.hover=null,I.mouseDown=null,I.mouseUp=null,I.swipe=0,I.swipeEnabled=!1,I.showHelp=!0,I.forceResize=!1,I.resized=!1,I.resizeConsumed=!1,I.time=0,I.elapsedTime=0,I.muteUntil=-1,I.isPortrait=!0,I.aspectRatio=1,I.countryCode="en-US",I.nowTime=0,I.repeatedGamesLeft=0,I.lowResolutionAssets=!1,I.suppressBigAnimations=!1,I.pieceScale=1,I._lastTime=0,this.gameControl=null}function P(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function A(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=A.STARTING,this.nextState=-1,this.delay=0,this.won=!1,A.paused=!1,A.quit=!1,A.requestQuit=!1,A.effects=null,A.timeLeft=0,A.score=0,A.options=null}function C(e){this.game=e,this.managers=null,this.lastMatchTime=-1,this.bg=null,this.buttons=null,this.icons=null,this.sprites=null,this.texts=null,this.timeText=null,this.scoreText=null,this.bm=null,this.container1=null,this.container2=null,this.ignoreClick=null,this.puzzleInput=null,this.puzzle=null}e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.mouseDownHandler),t.plugins.interaction.on("touchmove",e.mouseMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.mouseUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){I.click=e.mouseToStage(t.data.global.x,t.data.global.y)},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(I.swipe=e.deltaX<-20?-1:e.deltaX>20?1:0)},e.mouseOutHandler=function(){I.mouseOut=!0},e.mouseMoveHandler=function(t){I.mouseOut&&(I.mouseOut=!1),I.hover=e.mouseToStage(t.data.global.x,t.data.global.y),e._mouseSwipeStart&&I.swipeEnabled&&E.distanceBetween(e._mouseSwipeStart,I.hover)>=e.swipeDistance&&I.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:I.hover.x-e._mouseSwipeStart.x,deltaY:I.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,I.mouseDown=null)},e.mouseDownHandler=function(t){e._showDebugWindowData&&e._showDebugWindowData<I.nowTime&&(e._debugText.destroy(),e._debugText=null,e._showDebugWindowData=0),e._mouseDownWhen=I.nowTime,I.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),!e._mouseSwipeStart&&I.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",I.mouseDown.x,I.mouseDown.y)},e.mouseUpHandler=function(t){var s=0;I.mouseUp&&I.mouseDown&&(s=E.distanceBetween(I.mouseUp,I.mouseDown)),I.mouseDown&&(!I.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||I.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(I.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),I.mouseUp&&I.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:I.mouseUp.x-I.mouseDown.x,deltaY:I.mouseUp.y-I.mouseDown.y}))),e._mouseDownWhen=0,I.mouseDown=e._mouseSwipeStart=null},e.resizeCanvas=function(){null===I.HTMLElement?e._internalResize(window.innerWidth,window.innerHeight):e._internalResize(I.HTMLElement.clientWidth,I.HTMLElement.clientHeight)},e._internalResize=function(e,t){I.width=e,I.height=t,I.aspectRatio=I.width/I.height,I.isPortrait=I.aspectRatio<1,I.lowResolutionAssets=!1;var s=I.lowResolutionAssets?1/.75:1;I.renderer.resize(I.width,I.height),I.stage.x=Math.round(I.width/2),I.stage.y=Math.round(I.height/2);var i=I.width/I.gameWide,n=I.height/I.gameHigh;I.background.scale.set(s*Math.max(i,n));var a=M.pieceSizePixels*M.scale*k.maxHalfTilesWide*.5,r=I.width/a,o=M.pieceSizePixels*M.scale*k.maxTilesHigh,l=I.height/o;I.puzzle.scale.set(s*Math.min(I.pieceScale*r,I.pieceScale*l)),console.log(s*Math.min(I.pieceScale*r,I.pieceScale*l));var h=I.pieceScale>1?3:1==I.pieceScale?1:0;I.puzzle.y=-(I.height*h/30),console.log(-(I.height*h/30)),I.topUI.y=-I.height/2,I.topUI.scale.set(s*Math.min(i,n)),I.fullUI.scale.set(s*Math.min(i*I.fullUIScale,n*I.fullUIScale)),I.rightUI.scale.set(s*Math.min(i,n)),I.rightUI.x=.45*I.width,I.rightUI.y=-I.height/2,I.bottomUI.scale.set(s*Math.min(r,l)),I.resized=!0,I.resizeConsumed=!1,I.forceResize=!1,console.log("\nMahjonggDarkDimensions",I.width,"x",I.height),I.debug&&(console.log("aspectRatio:",I.aspectRatio,I.aspectRatio>=1?"landscape":"portrait"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",I.lowResolutionAssets?"low":"high"),console.log("View ratio: ",i,":",n),console.log("stage offset: ",I.stage.x,",",I.stage.y,"\n"))},e.registerCallback=function(t,s,i){I.debug&&console.log("registerCallback for",t),e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var n=e.callbackList.length-1;n>=0;--n){var a=e.callbackList[n];a.event==t&&(I.debug&&console.log("triggerCallback for",t),a.callback.call(a.arg.context,s,i,a.arg.args))}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var n=e.callbackList[i];if(n.event==t&&n.callback==s){e.callbackList.splice(i,1),I.debug&&console.log("clearCallback for",t);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=I.width/I.gameWide,s=I.height/I.gameHigh,i="aspectRatio: "+I.aspectRatio+" "+(I.aspectRatio>=1?"landscape":"portrait")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(I.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var n=new a(i,I.textStyleMediumTiny);n.create(I.topUI,-0.45,.25,!0),n.anchor.y=1,e._debugText=n,e._showDebugWindowData=I.nowTime+5e3}},function(){var e=this,t=function(e){return e instanceof t?e:this instanceof t?void(this._wrapped=e):new t(e)};if(t.userAgent=null,t.getUserAgent=function(){return this.userAgent},t.setUserAgent=function(e){this.userAgent=e},t.isAndroid=function(){return this.getUserAgent().match(/Android/i)},t.isBlackBerry=function(){return this.getUserAgent().match(/BlackBerry/i)},t.isBlackBerryPlayBook=function(){return this.getUserAgent().match(/PlayBook/i)},t.isBlackBerry10=function(){return this.getUserAgent().match(/BB10/i)},t.isIOS=function(){return this.isIPhone()||this.isIPad()||this.isIPod()},t.isIPhone=function(){return this.getUserAgent().match(/iPhone/i)},t.isIPad=function(){return this.getUserAgent().match(/iPad/i)},t.isIPod=function(){return this.getUserAgent().match(/iPod/i)},t.isOpera=function(){return this.getUserAgent().match(/Opera Mini/i)},t.isWindows=function(){return this.isWindowsDesktop()||this.isWindowsMobile()},t.isWindowsMobile=function(){return this.getUserAgent().match(/IEMobile/i)},t.isWindowsDesktop=function(){return this.getUserAgent().match(/WPDesktop/i)},t.isFireFox=function(){return this.getUserAgent().match(/Firefox/i)},t.isNexus=function(){return this.getUserAgent().match(/Nexus/i)},t.isKindleFire=function(){return this.getUserAgent().match(/Kindle Fire/i)},t.isPalm=function(){return this.getUserAgent().match(/PalmSource|Palm/i)},t.isAny=function(){var e=!1,s=Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]});for(var i in s)if("setUserAgent"!==s[i]&&"getUserAgent"!==s[i]&&"isAny"!==s[i]&&"isWindows"!==s[i]&&"isIOS"!==s[i]&&t[s[i]]()){e=!0;break}return e},("function"==typeof window||"object"==typeof window)&&t.setUserAgent(navigator.userAgent),"undefined"!=typeof exports){var s=function(e){return e=void 0===e?!0:e,e?function(e,s,i){var n=e.headers["user-agent"]||"";t.setUserAgent(n),e.SmartPhone=t,"function"==typeof s.locals?s.locals({SmartPhone:t}):s.locals.SmartPhone=t,i()}:t};"undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports=s}else e.SmartPhone=t}.call(this);var z={};z.isPressed=null,z.edgeDown=null,z.edgeUp=null,z.debug=!1,z.create=function(e){z.debug=e||!1,z.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",z.keyDown,!0):document.addEventListener?document.addEventListener("keydown",z.keyDown,!0):window.addEventListener?window.addEventListener("keydown",z.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",z.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",z.keyUp,!0):document.addEventListener?document.addEventListener("keyup",z.keyUp,!0):window.addEventListener?window.addEventListener("keyup",z.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",z.keyUp)},z.destroy=function(){z.isPressed=null,z.edgeDown=null,z.edgeUp=null},z.update=function(){return!0},z.reset=function(e){void 0===e?(z.isPressed=[],z.edgeDown=[],z.edgeUp=[]):(z.isPressed[e]=!1,z.edgeDown[e]=!1,z.edgeUp[e]=!1)},z.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(I.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},z.keyDown=function(e){e.preventDefault();var t=z.getCode(e);z.isPressed[t]||(z.edgeDown[t]=!0),z.isPressed[t]=!0},z.keyUp=function(e){e.preventDefault();var t=z.getCode(e);z.isPressed[t]&&(z.edgeUp[t]=!0),z.isPressed[t]=!1};var L={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},E={};E.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},E.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},E.distance=function(e,t,s,i){var n=s-e,a=i-t;return Math.sqrt(n*n+a*a)},E.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},E.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var n,a=i/2,r=E.normaliseAnglePositive(e-t+i,i);return n=r>a?e+Math.min(i-r,s):0!==r?e-Math.min(r,s):t,E.normaliseAngle(n,i)},E.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},E.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},E.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,n=e.length;n>i;i++)if(e[i][t]==s)return i;return-1},E.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},E.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),n=(Math.floor(t)%60).toString();return n.length<2&&(n="0"+n),i+":"+n},E.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},E.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},E.randomFromList=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},E.makeFunctionForSprite=function(e){return function(t){E.setValuesFromObject(e,t)}},E.focusChangeCallback=null,E.focusChangeContext=null,E._visListener=!1,E._hidden=!1,E._focusIn=function(){E._hidden=!1,I.debug&&console.log("Utils._focusIn hidden =",E._hidden),E.focusChangeContext&&E.focusChangeCallback&&E.focusChangeCallback.call(E.focusChangeContext,E._hidden)},E._focusOut=function(){E._hidden=!0,I.debug&&console.log("Utils._focusOut hidden =",E._hidden),E.focusChangeContext&&E.focusChangeCallback&&E.focusChangeCallback.call(E.focusChangeContext,E._hidden)},E.detectHidden=function(){if(!E._visListener){var e=t(),n=s(e),a=i(e);document.addEventListener(a,function(){document[n]?E._focusOut():E._focusIn()}),window.addEventListener("focus",E._focusIn,!1),window.addEventListener("blur",E._focusOut,!1),E._visListener=!0}},E.isHidden=function(){return document.hidden},E.blanker=null,E.addBlanker=function(e){return null!==E.blanker?void E.blanker.instances++:(E.blanker=new n,E.blanker.create(I.fullUI,"blanker",e,0,0),E.blanker.anchor.set(.5),E.blanker.scale.set(40),void(E.blanker.instances=1))},E.removeBlanker=function(){E.blanker&&(E.blanker.instances--,E.blanker.instances<=0&&(E.blanker.destroy(),E.blanker=null))},n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,n,a){I.debug&&console.log("Sprite.create",t),this.key=t,this.textures=s,this.myFilters=null,this.destroyTexture=!1,this.key&&(this.texture=this.textures.get(t),!this.texture&&I.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+t)),e.addChild(this),a?(this.pcntx=i||0,this.pcnty=n||0):(this.x=i||0,this.y=n||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){I.debug&&console.log("Sprite.destroy",this.key),this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.responsive=null,this.globalScale=null,this.texture&&this.destroyTexture&&this.texture.destroy({texture:!0,baseTexture:!0}),this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this)},n.prototype.update=function(e){return this._texture&&!this._texture.orig&&console.log("_texture has no orig! "+this.key),I.resized&&(this.getGlobalScale(!0),this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),I.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setFrame=function(e,t){return(t||this.key!=e)&&(this.key=e,this.key)?(this.texture=this.textures.get(e),!0):!1},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),n=this.pickerMaskData[s+i*this.texture.frame.width*4];return n?!0:!1},n.prototype.createCanvasFromTexture=function(){var e=document.createElement("canvas");e.width=this.texture.frame.width,e.height=this.texture.frame.height;var t=e.getContext("2d");return t.drawImage(this.texture.baseTexture.source,this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),e},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,n,a){this.fader=new f,this.fader.setFade(e,t,s,i,n,a)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return I.renderer.render(this,e),I.renderer.extract.pixels(e)},n.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(I.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(I.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},n.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},n.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=I.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent==I.window?e*I.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=I.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent==I.window?e*I.height:e*this.parent.height}},setx:{set:function(e){this.x=e,this.parent&&this.parent.texture.noFrame?(this.msx=I.width/this.parent.scale.x,this.percentx=e/this.msx):this.percentx=this.parent==I.window?e/I.width:e/this.parent.width}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),a.prototype=Object.create(PIXI.Text.prototype),a.prototype.constructor=a,a.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},a.prototype.destroy=function(){this.responsive=null,PIXI.Text.prototype.destroy.call(this)},a.prototype.update=function(){return I.resized&&(this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),I.resizeConsumed=!0),!0},a.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(I.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(I.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},a.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},a.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(a.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=I.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent==I.window?e*I.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=I.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent==I.window?e*I.height:e*this.parent.height}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),r.prototype.create=function(e,t,s,i,o){this.parent=e,this.managers=t,this.callback=i||null,this.context=o||null,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,E.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"menu_popup_bg",this.managers.textures),this.bg.anchor.set(.5,.5);var l=I.textStyleBoldHugeCentered.clone();l.wordWrapWidth=800;var h=this.managers.locale.get(s)||s;this.text=new a(h,l),this.text.create(this.bg,0,0,!0),this.text.anchor.set(.5,.5),r.tweenIn.step=E.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.tween(r.tweenIn),this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.managers.audio.play("snd_rotate")},r.prototype.addButton=function(e,t){var s=new h(h.TYPE_BUTTON);s.create(this.bg,"menu_play_button",this.managers,0,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down",t||"click1_event"),s.anchor.set(.5,.5);var i=new a(this.managers.locale.get(e),I.textStyleBoldButtonsLarge);i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",this.buttons.push(s)},r.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new h(h.TYPE_BUTTON);i.create(this.bg,"menu_play_button",this.managers,-200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click1_event"),i.anchor.set(.5,.5);var n=new a(this.managers.locale.get(e),I.textStyleBoldButtonsLarge);n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i),i=new h(h.TYPE_BUTTON),i.create(this.bg,"menu_play_button",this.managers,200,340,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click2_event"),i.anchor.set(.5,.5),n=new a(this.managers.locale.get(t),I.textStyleBoldButtonsLarge),n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i)},r.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(r.tweenOut.step=E.makeFunctionForSprite(this.bg),this.bg.tweener.tween(r.tweenOut),this.bg.tweener.owner=this,this.bg.tweener.context=this),this.removeContext=e||null,this.removeArgument=t||null,!0)},r.prototype.destroy=function(){var e,t;if(E.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,I.idleTimer=I.eventChangeAdOnIdle},r.prototype.update=function(e){if(this.doneIn&&(I.eventChangeAdOnPopup&&!this.adShown&&(I.arenaHelper.sendEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),this.timeOut&&(this.timeOut-=I.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var t,s,i;for(t=0,s=this.buttons.length;s>t&&(i=this.buttons[t].update(),1!=this.buttons[t].alpha&&(i=null),!i);t++);if("click1_event"==i){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==i){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}}return!this.doneOut},r.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var O=350;r.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},r.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},o.prototype.create=function(e,t,s,i,r,o){I.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=r,this.onNo=o,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(I.background,"game_title",t.textures),this.bg.anchor.set(.5,1),this.bg.y=I.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(I.fullUI,"menu_bg",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new h(h.TYPE_BUTTON);l.create(this.panel,"menu_play_button",this.managers,-.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var u=new a(this.managers.locale.get("quit_yes_button_string"),I.textStyleBoldButtons);u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new h(h.TYPE_BUTTON),l.create(this.panel,"menu_play_button",this.managers,.2,.2,!0,"menu_play_button","menu_play_button_over","menu_play_button_down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),u=new a(this.managers.locale.get("quit_no_button_string"),I.textStyleBoldButtons),u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l);var c=I.textStyleBold.clone();c.wordWrap=!0,c.wordWrapWidth=800,u=new a(this.managers.locale.get(s),c),u.create(this.panel,0,-.1,!0),u.anchor.set(.5,.5),this.texts.push(u),_gameGATracker("send","pageview",{page:"/ExitGamePopup"})},o.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,I.resized=!0,I.resizeConsumed=!1,I.swipeEnabled=!0},o.prototype.update=function(){var e,t;if(this.bg.y=I.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(I.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(I.click=null,this.onNo.call(this.context),!1):!0},l.prototype.create=function(e,t){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],E.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(I.fullUI,"menu_bg",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new h(h.TYPE_BUTTON);s.create(this.panel,"menu_play_button",this.managers,0,361,!1,"menu_play_button","menu_play_button_over","menu_play_button_down","click_event"),s.anchor.set(.5,.5),this.buttons.push(s);var i;i=t?new a(this.managers.locale.get("help_play_string"),I.textStyleBoldButtonsLarge):new a(this.managers.locale.get("continue_button_string"),I.textStyleBoldButtonsLarge),i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menu_tab1_on",this.managers,-.432,-.4322,!0,"menu_tab1_on","menu_tab1_on","menu_tab1_on","click_tab1_event",null,"menu_tab1_off","menu_tab1_off_over","menu_tab1_off","click_tab1_event"),s.toggled=!0,this.buttons.push(s),this.tab1={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menu_tab2_off",this.managers,-.175,-.4322,!0,"menu_tab2_on","menu_tab2_on","menu_tab2_on","click_tab2_event",null,"menu_tab2_off","menu_tab2_off_over","menu_tab2_off","click_tab2_event"),s.toggled=!1,this.buttons.push(s),this.tab2={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",i=new a(this.managers.locale.get("help_page1_text_string"),I.textStyleMedium),i.create(this.panel,-.3,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i),i=new a(this.managers.locale.get("help_page2_text_string"),I.textStyleMedium),i.create(this.panel,-0,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i);
var r=new u;r.create(this.panel,"menu_check_box",this.managers,208,-315,!1,"menu_check_box","menu_check_box_over","menu_check_box","check_toggled_event",27,0),r.anchor.set(0,.5),r.sfx="snd_clickPlay",r.sfxHover="snd_rollOver",this.buttons.push(r),this.checkBox=r,r.setCheck(I.showHelp);var o=I.textStyleMediumTiny.clone();o.wordWrap=!0,o.wordWrapWidth=170,i=new a(this.managers.locale.get("help_show_help_string"),o),i.create(this.panel,264,-315,!1),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list=[];var c=I.textStyleMedium2.clone();c.wordWrap=!0,c.wordWrapWidth=600,i=new a(this.managers.locale.get("help_page1_text1_string"),c),i.create(this.panel,-.1,-.24,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i);var d=new n;d.create(this.panel,"menu_matching_rules",this.managers.textures,-.28,-.15,!0),d.anchor.set(.5,.5),d.scale.set(.6,.6),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"time_icon",this.managers.textures,.24,.02,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab1.list.push(d),i=new a("2:55",I.textStyleSemiBold),i.create(this.panel,.28,.02,!0),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list.push(i);var p=c.clone();p.wordWrapWidth=700,i=new a(this.managers.locale.get("help_page1_text2_string"),p),i.create(this.panel,-.4,-.02,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),d=new n,d.create(this.panel,"rotate_lft_button",this.managers.textures,-.34,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"rotate_rgt_button",this.managers.textures,-.18,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),i=new a(this.managers.locale.get("help_page1_text3_string"),c),i.create(this.panel,-.1,.14,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),this.tab2.list=[],d=new n,d.create(this.panel,"menu_speedmatch",this.managers.textures,-.305,-.2,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text1_string"),p),i.create(this.panel,-.2,-.2-.04,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"menu_multimatch",this.managers.textures,-.305,-.015,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text2_string"),p),i.create(this.panel,-.2,-0.055,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"menu_timebonus",this.managers.textures,-.305,.17,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text6_string"),p),i.create(this.panel,-.2,.13,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i);var g=p.clone();g.wordWrapWidth=900,i=new a(this.managers.locale.get("help_page2_text5_string"),g),i.create(this.panel,0,.25,!0),i.anchor.set(.5,0),this.texts.push(i),this.tab2.list.push(i),this.showTab(1,!1),l.tweenIn.step=E.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(l.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},l.prototype.remove=function(e){this.removing||(this.removing=!0,I.debug&&console.log("Help.remove"),l.tweenOut.step=E.makeFunctionForSprite(this.panel),this.panel.tweener.tween(l.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},l.prototype.destroy=function(){var e;if(E.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.tab1=this.tab2=null,this.managers=null,I.resized=!0,I.resizeConsumed=!1},l.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return"click_event"==t||z.isPressed[32]?(I.resetInput(),!1):("check_toggled_event"==t&&(I.showHelp=this.checkBox.checked,this.managers.preloader.loadManager.saveGameStatus()),("click_tab1_event"==t&&!this.tab1.button.toggled||"click_tab2_event"==t&&!this.tab2.button.toggled)&&(this.tab2.button.toggled=this.tab1.button.toggled,this.tab1.button.toggled=!this.tab1.button.toggled,this.showTab(this.tab1.button.toggled?1:0,!1),this.showTab(this.tab1.button.toggled?0:1,!0)),!0)},l.prototype.showTab=function(e,t){var s=0===e?this.tab1.list:this.tab2.list;if(s)for(var i=0;i<s.length;i++)s[i].visible=t};var U=350;l.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:U,easing:"easeInQuad",step:null,finish:function(){}},l.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:U,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},h.TYPE_BUTTON=1,h.TYPE_CHECKBOX=2,h.TYPE_TOGGLE=3,h.TYPE_NOLATCH=4,h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.prototype.create=function(t,s,i,a,r,o,l,h,u,c,d,p,g,m,f,_){this.managers=i,n.prototype.create.call(this,t,s,this.managers.textures,a,r,o),this.upKey={on:l,off:p},this.overKey={on:h,off:g},this.downKey={on:u,off:m},this.downEvent={on:c,off:f},this.overEvent={on:d,off:_},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,e.registerCallback("mousedown",this.playSfx,{context:this})},h.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.managers=null,n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this._toggled=null,this.sfx=this.sfxHover=null},h.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return s=this.type==h.TYPE_BUTTON||this.type==h.TYPE_NOLATCH?this.downDetected&&null!==I.mouseDown&&i.contains(I.mouseDown.x,I.mouseDown.y)||null!==I.click&&i.contains(I.click.x,I.click.y):null!==I.click&&i.contains(I.click.x,I.click.y),s&&(this.setFrame(this.downKey[this._toggled]),I.mouseDown=I.click=null,e=this.downEvent[this._toggled],t=!0),this.type==h.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&I.hover&&i.contains(I.hover.x,I.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==h.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},h.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},Object.defineProperties(h.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),u.EVENT_CLICK="check_click",u.prototype=Object.create(h.prototype),u.prototype.constructor=u,u.prototype.create=function(e,t,s,i,a,r,o,l,c,d,p,g){this.tick=new n,this.tick.create(this,"menu_check",s.textures,p,g,!1),this.tick.anchor.set(.5),this.checked=!0,this.toggleEvent=d,h.prototype.create.call(this,e,t,s,i,a,r,o,l,c,u.EVENT_CLICK),this.downDetected=!1},u.prototype.destroy=function(){h.prototype.destroy.call(this)},u.prototype.update=function(){var e=h.prototype.update.call(this);return e==u.EVENT_CLICK&&(this.setCheck(!this.checked),this.toggleEvent&&(e=this.toggleEvent)),e},u.prototype.setCheck=function(e){this.checked=e,this.tick.visible=e},c.prototype.create=function(e,t){I.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,E.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(I.fullUI,"menu_bg",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new a(this.managers.locale.get("options_header_string"),I.textStyleBold);s.create(this.panel,0,-.34,!0),s.anchor.set(.5,.5),this.texts.push(s);var i=new h(h.TYPE_BUTTON);i.create(this.panel,"menu_close_button",this.managers,.33,-.3,!0,"menu_close_button","menu_close_button_over","menu_close_button_down","click_close_event"),i.anchor.set(.5,.5),i.scale.set(2),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i);var r=-.15,o=.16;if(!I.isAndroid||!I.isChromeMobile){r=.15,o=.16,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menu_sound_button",this.managers,-.22,r-.35+0*o,!0,"menu_sound_button","menu_sound_button_over","menu_sound_button_down","click_sound_event",null,"menu_sound_button_mute","menu_sound_button_mute_over","menu_sound_button_mute_down","click_sound_event_mute",null),i.anchor.set(0,.5),i.toggled=!this.managers.audio.mute,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.soundBtn=i;var l=new n;l.create(this.panel,"menu_slider_bar",this.managers.textures,-.1,r-.35+0*o,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[0]=l,l=new n,l.create(this.sliderBar[0],"menu_slider_tab",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),this.sprites.push(l),l.setx=this.sliderBar[0].width*x.sfxVolume,this.sliderTab[0]=l,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menu_music_button",this.managers,-.22,r-.35+1*o,!0,"menu_music_button","menu_music_button_over","menu_music_button_down","click_music_event",null,"menu_music_button_mute","menu_music_button_mute_over","menu_music_button_mute_down","click_music_event_mute"),i.anchor.set(0,.5),i.toggled=!this.managers.audio.tunesMuted,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.musicBtn=i,l=new n,l.create(this.panel,"menu_slider_bar",this.managers.textures,-.1,r-.35+1*o,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[1]=l,l=new n,l.create(this.sliderBar[1],"menu_slider_tab",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),l.setx=this.sliderBar[1].width*x.musicVolume,this.sprites.push(l),this.sliderTab[1]=l}i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menu_help_button",this.managers,-.22,r-.35+2*o,!0,"menu_help_button","menu_help_button_over","menu_help_button_down","click_help_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("help_header_string"),I.textStyleLarge),s.create(this.panel,-.1,r-.35+2*o,!0),s.anchor.set(0,.5),this.texts.push(s),i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menu_quit_button",this.managers,-.22,r-.35+3*o,!0,"menu_quit_button","menu_quit_button_over","menu_quit_button_down","click_quit_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("options_quit_string"),I.textStyleLarge),s.create(this.panel,-.1,r-.35+3*o,!0),s.anchor.set(0,.5),this.texts.push(s),c.tweenIn.step=E.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(c.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},c.prototype.remove=function(e){this.removing||(this.removing=!0,I.debug&&console.log("Options.remove"),c.tweenOut.step=E.makeFunctionForSprite(this.panel),this.panel.tweener.tween(c.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},c.prototype.destroy=function(){var e;if(E.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,I.resized=!0,I.resizeConsumed=!1,I.swipeEnabled=!0,I.idleTimer=I.eventChangeAdOnIdle},c.prototype.update=function(){var e,t;if(this.doneIn&&I.eventChangeAdOnOptions&&!this.adShown&&(I.arenaHelper.sendEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(null!==I.mouseDown){var i=I.hover;for(null===i&&(i=I.mouseDown),e=0;e<this.sliderBar.length;e++)this.sliderBar[e].getGlobalScale(!0),this.sliderBar[e].bounds=this.sliderBar[e].getBounds(!1),this.sliderBar[e].bounds.contains(i.x,i.y)&&(this.sliderTab[e].pcntx=E.clamp((i.x-this.sliderBar[e].bounds.left)/this.sliderBar[e].globalScale.x/this.sliderBar[e].width,0,1),0===e?(x.sfxVolume=this.sliderTab[e].percentx,this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1))):(this.managers.audio.setMusicVolume(this.sliderTab[e].percentx),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1))),this.managers.preloader.loadManager.saveGameStatus())}if(this.buttons)for(e=0;e<this.buttons.length;e++){var n=this.buttons[e];if(t=n.update(),null!==t)break}switch(null===t&&z.isPressed[L.space_bar]&&(t="click_close_event"),t){case"click_close_event":return I.click=null,z.reset(L.space_bar),I.playMidRollAdAfterPause&&I.arenaHelper.requestMidroll(),!1;case"click_help_event":this.game.showHelp(!1);break;case"click_quit_event":this.game.showConfirm("quit_header_string",this,this.onYesQuit,this.onNoQuit);break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1));break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1));break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1));break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",I.VERSION,"sound","MJDD_HTML5",1))}return!A.quit},c.prototype.onYesQuit=function(){this.destroy(),A.requestQuit=!0,A.options=null},c.prototype.onNoQuit=function(){};var O=350;c.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},c.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},d.prototype.create=function(e,t){this.managers=e,this.puzzle=t,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.chain=1,this.multiMatch=0,this.selectedPiece=null,this.spriteList=[]},d.prototype.destroy=function(){if(this.removeHoverPiece(),this._removeSelectedPiece(),this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.spriteList){for(var e=0,t=this.spriteList.length;t>e;e++)this.spriteList[e].alpha=0,this.spriteList[e].destroy();this.spriteList=null}},d.prototype.update=function(){if(this.spriteList&&this.spriteList.length>0){for(var e=this.spriteList.length-1;e>=0;--e){var t=this.spriteList[e];t.y-=4,t.alpha-=.02,t.alpha<=0?(t.destroy(),this.spriteList.splice(e,1)):t.update()}return this.spriteList.length>0}return!1},d.prototype.clickedPiece=function(e){if(this.puzzle.tornadoRemove)return!1;if(this.puzzle.tileOpen(e)){if(this.selectedPiece){if(e!=this.selectedPiece)if(this.managers.audio.play("snd_clickTile"),e.symbol==this.selectedPiece.symbol||e.isOverridden()&&this.selectedPiece.isOverridden()){this._matchedPieces(e);var t=e.timeBonus();t>=0&&(this._timeBonusScoring(e,t),A.timeLeft+=t);var s=this._chainBonusScoring(e);this._multiBonusScoring(e);var i=0;s&&(i+=this.puzzle.speedMatchValue*this.chain),A.score+=(0|e.value)+i+this.puzzle.multiMatchValue*this.multiMatch,I.debug&&console.log("chain =",this.chain,"value =",e.value,"speedMatchValue =",this.puzzle.speedMatchValue,"score =",A.score);var n=16;this.managers.audio.play(this.chain<=n?["snd_match"+Math.min(this.chain,n).toString()]:["snd_correct1","snd_correct2"]),this.lastMatchTime=I.time,this.lastMatchType=e.symbol}else this._deselectPiece(this.selectedPiece),this._selectPiece(e)}else this.managers.audio.play("snd_clickTile"),this._selectPiece(e);return!0}return e&&e.wobble(),this.managers.audio.playDelayed(["snd_error1","snd_error2","snd_error3"],.1,this.cancelIfSwipe,this),!1},d.prototype.createHoveredPiece=function(e){this.hoveredPiece={piece:null,sprite:e,fallSpeed:0}},d.prototype.createDroppedPiece=function(e){this.dropPiece={piece:null,sprite:e,fallSpeed:0}},d.prototype.showDropAndHoverPieces=function(){if(this.dropPiece){this.dropPiece.sprite.setFrame(this.dropPiece.sprite.key,!0);var e=this.dropPiece.sprite.y;this.dropPiece.sprite.pcnty=C.SelectionPreviewY,C.SelectionPreviewBotY=this.dropPiece.sprite.y+this.dropPiece.sprite.height,this.dropPiece.sprite.y=e,I.isPortrait?(this.dropPiece.sprite.y=C.SelectionPreviewBotY,this.dropPiece.fallSpeed=0):(this.dropPiece.sprite.y+=this.dropPiece.fallSpeed,this.dropPiece.fallSpeed++,this.dropPiece.sprite.y>C.SelectionPreviewBotY&&(this.dropPiece.sprite.y=C.SelectionPreviewBotY,this.dropPiece.fallSpeed=0)),this.dropPiece.sprite.update()}this.hoveredPiece&&(this.hoveredPiece.sprite.setFrame(this.hoveredPiece.sprite.key,!0),this.hoveredPiece.sprite.pcnty=C.SelectionPreviewY,this.hoveredPiece.sprite.update())},d.prototype.resetSidePieces=function(){this.dropPiece&&this.dropPiece.sprite&&this.dropPiece.piece&&this.dropPiece.sprite.setFrame(this.dropPiece.piece.isOverridden()?"cube_"+this.dropPiece.piece.parent.overrideTileKey+"_1":"cube_"+this.dropPiece.piece.symbol+"_1"),this.hoveredPiece&&this.hoveredPiece.sprite&&this.hoveredPiece.piece&&this.hoveredPiece.sprite.setFrame(this.hoveredPiece.piece.isOverridden()?"cube_"+this.hoveredPiece.piece.parent.overrideTileKey+"_1":"cube_"+this.hoveredPiece.piece.symbol+"_1")},d.prototype.cancelIfSwipe=function(e){return e&&null!==I.mouseDown?!0:I.swipeEnabled&&0!==I.swipe?!0:!1},d.prototype._selectPiece=function(e){this.selectedPiece=e,this.selectedPiece.addFilter(C.brighter),this.dropPiece&&(this.dropPiece.piece=null,this.dropPiece.sprite.destroy(),this.dropPiece=null);var t=new n,s=e.symbol;"s0"==s&&(s="s0b"),t.create(I.rightUI,"cube_"+e.symbol+"_1",this.managers.textures,-.02,C.SelectionPreviewY,!0),e.isOverridden()&&t.setFrame("cube_"+e.parent.overrideTileKey+"_1"),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=M.scale,this.dropPiece={piece:e,sprite:t,fallSpeed:0},this.removeHoverPiece()},d.prototype._deselectPiece=function(e){e&&e.removeFilter(C.brighter),this._removeSelectedPiece()},d.prototype._removeSelectedPiece=function(){this.dropPiece&&(this.dropPiece.piece=null,this.dropPiece.sprite&&this.dropPiece.sprite.destroy(),this.dropPiece=null)},d.prototype._matchedPieces=function(e){I.debug&&console.log("Matched symbol",e.symbol),this.puzzle.fadeTile(this.selectedPiece,this.puzzle.removeTile),this._selectPiece(e),this.puzzle.fadeTile(e,this.puzzle.removeTile),this._removeSelectedPiece(),this.removeHoverPiece(),this.selectedPiece=null,A.levelMatches++},d.prototype.showHoveredPiece=function(e){if(e)if(this.selectedPiece&&this.selectedPiece==e)this.lastHovered&&(this.lastHovered.removeFilter(C.brighter2),this.lastHovered=null);else if(this.lastHovered&&this.lastHovered!==e&&(this.lastHovered.removeFilter(C.brighter2),this.lastHovered=null),e.addFilter(C.brighter2),this.lastHovered=e,!this.hoveredPiece||!this.hoveredPiece.piece||this.hoveredPiece.piece.symbol!=e.symbol){this.hoveredPiece&&this.removeHoverPiece();var t=new n;t.create(I.rightUI,"cube_"+e.symbol+"_1",this.managers.textures,-.02,C.SelectionPreviewY,!0),e.isOverridden()&&t.setFrame("cube_"+e.parent.overrideTileKey+"_1"),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=M.scale,this.hoveredPiece={piece:e,sprite:t,fallSpeed:0}}},d.prototype.removeHoverPiece=function(){if(this.lastHovered&&(this.lastHovered.removeFilter(C.brighter2),this.lastHovered=null),this.hoveredPiece){if(this.hoveredPiece.piece=null,this.sprites){var e=this.hoveredPiece.sprite;this.sprites.push(e),this.hoveredPiece.sprite.addFader(-.1,1,this.destroySprite,this,e,0)}else this.hoveredPiece.sprite.destroy();this.hoveredPiece=null}},d.prototype._chainBonusScoring=function(e){var t=!1;if(-1!==this.lastMatchTime&&I.time<=this.lastMatchTime+1e3*this.puzzle.speedMatchTime){this.chain++,t=!0;var s,i=this.chain.toString(),a="speed"+i[0];i.length>1&&(s="speed"+i[1]);var r=new n;r.create(e.parent,"speedmatch",this.managers.textures,e.x,e.y,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),r=new n,r.create(e.parent,a,this.managers.textures,e.x+156-154+27.5,e.y+39-78.5+24,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),s&&(r=new n,r.create(e.parent,s,this.managers.textures,e.x+156-154+27.5+48,e.y+39-78.5+24,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r)),e.parent.reSort()}else this.chain=1;return t},d.prototype._multiBonusScoring=function(e){if(e.symbol==this.lastMatchType){this.multiMatch+=0===this.multiMatch?2:1;var t,s=this.multiMatch.toString(),i="multi"+s[0];s.length>1&&(t="multi"+s[1]);var a=new n;a.create(e.parent,"multimatch",this.managers.textures,e.x,e.y+150,!1),a.anchor.set(.5),a.tz=-1e3,this.spriteList&&this.spriteList.push(a),a=new n,a.create(e.parent,i,this.managers.textures,e.x+146-143+27.5,e.y+150+47-80.5+24,!1),a.anchor.set(.5),a.tz=-1e3,this.spriteList&&this.spriteList.push(a),t&&(a=new n,a.create(e.parent,t,this.managers.textures,e.x+146-143+27.5+48,e.y+150+47-80.5+24,!1),a.anchor.set(.5),a.tz=-1e3,this.spriteList&&this.spriteList.push(a)),e.parent.reSort()}else this.multiMatch=0},d.prototype._timeBonusScoring=function(e,t){isNaN(t)&&I.debug&&alert("ERROR: _timeBonus NaN!");var s,i,a,r=E.timeToString(t);s="multi"+r[0],i="multi"+r[2],a="multi"+r[3];var o=new n;o.create(e.parent,"timematch",this.managers.textures,e.x,e.y+150,!1),o.anchor.set(.5),o.tz=-1e3,o.alpha=1.2,this.spriteList&&this.spriteList.push(o),o=new n,o.create(e.parent,s,this.managers.textures,e.x+75-143+27.5,e.y+140+47-80.5+24,!1),o.anchor.set(.5),o.tz=-1e3,o.alpha=1.2,this.spriteList&&this.spriteList.push(o),o=new n,o.create(e.parent,"colon",this.managers.textures,e.x+75-143+27.5+40,e.y+140+47-80.5+24,!1),o.anchor.set(.5),o.tz=-1e3,o.alpha=1.2,this.spriteList&&this.spriteList.push(o),o=new n,o.create(e.parent,i,this.managers.textures,e.x+75-143+27.5+40+40,e.y+140+47-80.5+24,!1),o.anchor.set(.5),o.tz=-1e3,o.alpha=1.2,this.spriteList&&this.spriteList.push(o),o=new n,o.create(e.parent,a,this.managers.textures,e.x+75-143+27.5+40+40+52,e.y+140+47-80.5+24,!1),o.anchor.set(.5),o.tz=-1e3,o.alpha=1.2,this.spriteList&&this.spriteList.push(o),e.parent.reSort()},p.prototype.create=function(e){this.managers=e},p.prototype.destroy=function(){this.managers=null},p.prototype.loadGameStatus=function(){I.debug&&console.log("loadGameStatus");var e=localStorage.MahjonggDarkDimensions_status;if(e){var t=JSON.parse(e);return I.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute,"show help =",t.showHelp),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),x.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),I.showHelp=t.showHelp,!0}return I.debug&&console.log("Game data is not available in localStorage."),!1},p.prototype.saveGameStatus=function(){I.debug&&console.log("saveGameStatus");var e={sfxVolume:x.sfxVolume,musicVolume:x.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted,showHelp:I.showHelp},t=JSON.stringify(e);return localStorage.MahjonggDarkDimensions_status=t,!0},g.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},g.prototype.get=function(e){if(!this.dataManager)return I.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=E.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(I.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},g.prototype.onLocaleChanged=function(){I.countryCode=I.arenaHelper.getLocale();var e=this.dataManager.get("localizations");I.debug&&console.log("available languages: ",e),e&&e.availableLocales&&-1==E.indexOfStringNoCase(e.availableLocales,I.countryCode)&&(I.debug&&console.log("language is not available: ",I.countryCode),I.countryCode="en-US"),I.debug&&console.log("language code = ",I.countryCode),this.dataManager.loadData("strings",I.arenaHelper.getAbsoluteURL("")+"data/locale/"+I.countryCode+"/strings.json"),this.strings=null},m.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];m.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(I.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else I.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(I.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),I.debug&&console.log("All fonts loaded or failed."),!0)},m.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var n=i.offsetWidth;return i.parentNode.removeChild(i),n},f.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},f.prototype.setFade=function(e,t,s,i,n,a){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=n,null!==a&&(this.trigger=a,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))},f.prototype.reached=function(e){return this.fadeValue==e},f.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,I.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,I.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},_.REMOVE_TILE=1,_.PRELOADER=2,_.definitions=[{},{first:1,last:30,baseKey:"fx_m",scale:2.2},{first:0,last:67,baseKey:"loading_",scale:1,repeat:!0}],_.prototype.create=function(e){this.textureManager=e,this.list=[]},_.prototype.destroy=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=null},_.prototype.add=function(e,t,s,i){var a=new n,r=_.definitions[e];a.create(t.parent,this.getKeyName(e,r.first),this.textureManager,t.x+s,t.y+i,!1),t.parent.setChildIndex(a,t.parent.getChildIndex(t)),a.anchor.set(t.anchor.x,t.anchor.y),a.scale.set(r.scale,r.scale),a.fxType=e,a.fxFrameNumber=r.first,a.repeat=r.repeat===!0?!0:!1,a.tz=t.tz,this.list.push(a)},_.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(t.fxFrameNumber>_.definitions[t.fxType].last){if(!t.repeat){t.destroy(),this.list.splice(e,1);continue}t.fxFrameNumber=0}var s=this.getKeyName(t.fxType,Math.floor(t.fxFrameNumber));t.setFrame(s),t.update(),t.fxFrameNumber+=.06*I.elapsedTime}return this.list.length},_.prototype.getKeyName=function(e,t){return _.definitions[e].baseKey+t.toString()},y.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},y.prototype.destroy=function(){this.pending=0,this.loader=null},y.prototype.addImage=function(e,t){this.loader.add(e,t),I.debug&&console.log("Textures.addImage ",e,t),this.pending++},y.prototype.startLoading=function(e,t){var s=this;I.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,I.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():I.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},y.prototype.loadImage=function(e,t,s,i){I.debug&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){I.debug&&console.log("Texture loaded!"),s.call(i)}).load()},y.prototype.get=function(e,t){if(!PIXI.loader.resources[e])return null;if(PIXI.loader.resources[e].texture)return PIXI.loader.resources[e].texture;if(t)return null;I.debug&&console.log("texture created from canvas",e);var s=PIXI.Texture.fromCanvas(PIXI.loader.resources[e]);return PIXI.loader.resources[e].texture=s,s},y.prototype.set=function(e,t){var s=PIXI.loader.resources[e];s&&s!=t&&(I.debug&&console.log("Textures.set removing image from cache",e),this.remove(e)),I.debug&&console.log("Textures.set adding image to cache",e,t.width,"x",t.height),s=PIXI.loader.resources[e]=t},y.prototype.exists=function(e,t){return PIXI.loader.resources[e]?PIXI.loader.resources[e].texture?!0:!t:!1},y.isCanvas=function(e){return e?e instanceof HTMLCanvasElement||"HTMLCanvasElement"==e.constructor.name||"HTMLCanvasElement"==(e.prototype?e.prototype.constructor:e.constructor).toString():(I.debug&&alert("ERROR: null or undefined object being tested for HTMLCanvasElement!"),!1)},y.prototype.remove=function(e){var t=PIXI.loader.resources[e];return t?t.texture?(y.isCanvas(t.texture)||t.texture.destroy({texture:!0,baseTexture:!0}),t.texture=null,y.isCanvas(t)?I.debug&&console.log("Textures.remove removing a Texture with a Canvas",e):(I.debug&&console.log("Textures.remove removing a Texture",e),t.destroy({texture:!0,baseTexture:!0})),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):(I.debug&&(y.isCanvas(t)?console.log("Textures.remove removing a Canvas",e):console.log("Textures.remove can't remove a null texture",e)),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):void(I.debug&&alert("ERROR: Textures.remove can't remove a null resource",e))},v.createTweens=function(e,t,s,i,r,o){isNaN(i)&&(i=0),isNaN(r)&&(r=0);for(var l=[],u=[],c=0;c<e.length;c++){var d=e[c];if(d.button){var p=new h(h.TYPE_BUTTON);if(p.create(t,d.key,s,d.x+i,d.y+r,!1,d.key,d.button.over,d.button.down,d.button.clickEvent),p.anchor.x=p.anchor.y=.5,void 0!==d.visible&&(p.visible=d.visible),p.sfx=d.button.sfx,p.sfxHover=d.button.sfxHover,void 0!==d.button.text){var g=new a(s.locale.get(d.button.text),o||I.textStyleBoldButtons);g.create(p,0,0,!0),g.anchor.set(.5,.5),p.text=g}void 0!==d.fade&&p.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=E.makeFunctionForSprite(p),p.tweener=new Tweenable,p.tweener.tween(d.tween),p.tweener.owner=p),u.push(p)}else{var m=new n;m.create(t,d.key,s.textures,d.x+i,d.y+r,!1),m.anchor.x=m.anchor.y=.5,void 0!==d.visible&&(m.visible=d.visible),void 0!==d.fade&&m.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=E.makeFunctionForSprite(m),m.tweener=new Tweenable,m.tweener.tween(d.tween),m.tweener.owner=m),l.push(m)
}}return{sprites:l,buttons:u}},b.prototype.create=function(){this.list=[]},b.prototype.destroy=function(){this.list=null},b.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];I.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var n=this,a=new XMLHttpRequest;return a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&(i.isReady=!0,i.data=JSON.parse(a.responseText),s&&s(),n.pending--)},a.send(null),this.pending++,i.src=t,i},b.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(I.debug&&console.log("DataManager.get(): data not in cache",e),null)},b.prototype.set=function(e,t){if(this.list[e])return void(I.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return I.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,I.debug&&console.log("DataManager.set(): data added to cache",e)},x.sfxVolume=.75,x.musicVolume=1,x.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.mute=!1,this.tunesMuted=!1,x.sfxVolume=.75,x.musicVolume=.5},x.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null},x.prototype.loadAudio=function(e,t,s){for(var i=[],n=0,a=s.length;a>n;n++)i.push(t+"."+s[n]);this.pending++,I.debug&&console.log("AudioManager.loadAudio ",e,t);var r=this;this.list[e]=new Howl({src:i,onload:function(){r.pending--}})},x.prototype.play=function(e){if(this.mute||I.isAndroid&&I.isChromeMobile)return null;if(Array.isArray(e)){var t=E.randomFromList(e);return this._playOne(t)}return this._playOne(e)},x.prototype._playOne=function(e){if(I.isAndroid&&I.isChromeMobile)return null;if(e&&this.list&&this.list[e]&&I.muteUntil<=I.time){var t=this.list[e];if("loaded"!=t._state)return I.debug&&console.log("AudioManager.playOne",e,"SFX not loaded!"),null;t.volume(x.sfxVolume);var s=t.play();return I.debug&&(console.log("AudioManager.playOne",e,"=",s),s||console.log("SFX not playable!")),t}return null},x.prototype.playDelayed=function(e,t,s,i){return I.isAndroid&&I.isChromeMobile?null:(Array.isArray(e)&&(e=E.randomFromList(e)),void(e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:I.time+1e3*t,cancelCallback:s,context:i})))},x.prototype.update=function(){if(!I.isAndroid||!I.isChromeMobile)for(var e=I.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];if(s&&s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time))this.delayed.splice(t,1);else if(e>s.time){var i=this.list[s.key];i.play(),this.delayed.splice(t,1)}}},x.prototype.visibilityMute=function(e){I.isAndroid&&I.isChromeMobile||(I.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0))},x.prototype.setMute=function(e,t){if(!I.isAndroid||!I.isChromeMobile){I.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()}},x.prototype.muteTunes=function(e,t){I.isAndroid&&I.isChromeMobile||(I.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus())},x.prototype.startTune=function(e,t){I.isAndroid&&I.isChromeMobile||(this.gameTune&&this.stopTune(),this.list[e].loop(!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(x.musicVolume*I.volumeControl),void 0!==t?this.muteTunes(t,!0):this.muteTunes(this.tunesMuted,!0))},x.prototype.stopTune=function(){I.isAndroid&&I.isChromeMobile||this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},x.prototype.setMusicVolume=function(e){I.isAndroid&&I.isChromeMobile||(x.musicVolume=e,this.gameTune&&this.gameTune.volume(x.musicVolume*I.volumeControl))},x.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0},w.prototype.addPauseAndResumeActions=function(e,t){this._arenaXapi?(this._arenaXapi.addAction("GAME_PAUSE",e),this._arenaXapi.addAction("GAME_RESUME",t)):(window.ARK_game_arena_connector.registerAction("pause",e),window.ARK_game_arena_connector.registerAction("resume",t))},w.prototype.requestMidroll=function(){console.log("[ArenaHelper] handleMidrollRequest"),this._arenaXapi?this._arenaXapi.dispatch({type:"PAUSE_READY",payload:null}):window.ARK_game_arena_connector.fireEventToArena("pause_ready")},w.prototype.handleMidrollStart=function(){console.log("[ArenaHelper] handleMidrollStart")},w.prototype.handleMidrollFinish=function(){console.log("[ArenaHelper] handleMidrollFinish")},w.prototype.sendEventChange=function(){console.log("[ArenaHelper] handleEventChange"),this._arenaXapi?this._arenaXapi.dispatch({type:"EVENT_CHANGE",payload:null}):window.ARK_game_arena_connector.fireEventToArena("event_change")},w.prototype.sendGameStart=function(){console.log("[ArenaHelper] handleGameStart"),this._arenaXapi?this._arenaXapi.dispatch({type:"GAME_START",payload:null}):window.ARK_game_arena_connector.fireEventToArena("game_start")},w.prototype.sendGameEnd=function(e){console.log("[ArenaHelper] handleGameEnd"),this._arenaXapi?(this._arenaXapi.dispatch({type:"CHANGE_SCORE",payload:e}),this._arenaXapi.dispatch({type:"GAME_END",payload:null})):(window.ARK_game_arena_connector.changeScore(e),window.ARK_game_arena_connector.fireEventToArena("game_end"))},w.prototype.shouldShowGameEnd=function(){return this._arenaXapi?!0:"true"==window.ARK_game_arena_connector.showGameEnd()},w.prototype.getAbsoluteURL=function(e){return this._arenaXapi?[this._arenaXapi.assetOriginUrl,e].join(""):e},w.prototype.getLocale=function(){return this._arenaXapi?this._arenaXapi.locale:window.ARK_game_arena_connector.getParam("locale","en-US")},w.prototype.destroy=function(){this._arenaXapi&&(this._arenaXapi.removeAction("GAME_PAUSE"),this._arenaXapi.removeAction("GAME_RESUME"))},T.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new y,this.textureManager.create(),this.dataManager=new b,this.dataManager.create(),this.localeManager=new g,this.audioManager=new x,this.loadManager=new p,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers());for(var s=0;67>=s;s++)this.textureManager.addImage("loading_"+s.toString(),this.baseUrl+"images/_reduced/high/preloader/frame_"+s.toString()+"_delay-0.03s.png");this.textureManager.addImage("preloader_bg",this.baseUrl+"images/_reduced/high/preloader/title_bg.jpg"),this.textureManager.startLoading(this.preloaderReady,this)},T.prototype.preloaderReady=function(){var e=this;this.bg=new n,this.bg.create(I.background,"preloader_bg",this.textureManager),this.bg.anchor.set(.5,1),this.bg.y=I.height/2/this.bg.parent.scale.y,this.effects=new _,this.effects.create(this.textureManager),this.effects.add(_.PRELOADER,I.fullUI,0,0);var t=this.baseUrl+(this.lowResolution?"images/_reduced/low/":"images/_reduced/high/");this.textureManager.addImage("game_title",t+"UI/bg.jpg"),this.textureManager.addImage("letter_m",t+"intro/m.png"),this.textureManager.addImage("letter_a",t+"intro/a.png"),this.textureManager.addImage("letter_h",t+"intro/h.png"),this.textureManager.addImage("letter_j",t+"intro/j.png"),this.textureManager.addImage("letter_o",t+"intro/logo_tiles.png"),this.textureManager.addImage("letter_n",t+"intro/n.png"),this.textureManager.addImage("letter_g",t+"intro/g.png"),this.textureManager.addImage("title_dimensions",t+"intro/logo_dimensions.png"),this.textureManager.addImage("title_panel",t+"intro/logo_panel.png"),this.textureManager.addImage("blanker",t+"menus/blanker.png"),this.textureManager.addImage("menu_bg",t+"menus/backboard.png"),this.textureManager.addImage("menu_popup_bg",t+"menus/popup.png"),this.textureManager.addImage("menu_check",t+"menus/check.png"),this.textureManager.addImage("menu_check_box",t+"menus/check-box.png"),this.textureManager.addImage("menu_check_box_over",t+"menus/check-box-rollover.png"),this.textureManager.addImage("menu_close_button",t+"menus/close.png"),this.textureManager.addImage("menu_close_button_over",t+"menus/close_rollover.png"),this.textureManager.addImage("menu_close_button_down",t+"menus/close-down.png"),this.textureManager.addImage("menu_tab1_off",t+"menus/basic-gameplay-off.png"),this.textureManager.addImage("menu_tab1_off_over",t+"menus/basic-gameplay-off-rollover.png"),this.textureManager.addImage("menu_tab1_on",t+"menus/basic-gameplay-on.png"),this.textureManager.addImage("menu_tab2_off",t+"menus/max-your-score-button-off.png"),this.textureManager.addImage("menu_tab2_off_over",t+"menus/max-your-score-button-off-rollover.png"),this.textureManager.addImage("menu_tab2_on",t+"menus/max-your-score-button-on.png"),this.textureManager.addImage("menu_help_button",t+"menus/help.png"),this.textureManager.addImage("menu_help_button_over",t+"menus/help_rollover.png"),this.textureManager.addImage("menu_help_button_down",t+"menus/help-down.png"),this.textureManager.addImage("menu_music_button",t+"menus/music.png"),this.textureManager.addImage("menu_music_button_over",t+"menus/music_rollover.png"),this.textureManager.addImage("menu_music_button_down",t+"menus/music-down.png"),this.textureManager.addImage("menu_music_button_mute",t+"menus/music-no.png"),this.textureManager.addImage("menu_music_button_mute_over",t+"menus/music-no_rollover.png"),this.textureManager.addImage("menu_music_button_mute_down",t+"menus/music-no-down.png"),this.textureManager.addImage("menu_sound_button",t+"menus/sound.png"),this.textureManager.addImage("menu_sound_button_over",t+"menus/sound_rollover.png"),this.textureManager.addImage("menu_sound_button_down",t+"menus/sound-down.png"),this.textureManager.addImage("menu_sound_button_mute",t+"menus/sound-no.png"),this.textureManager.addImage("menu_sound_button_mute_over",t+"menus/sound-no_rollover.png"),this.textureManager.addImage("menu_sound_button_mute_down",t+"menus/sound-no-down.png"),this.textureManager.addImage("menu_quit_button",t+"menus/quit.png"),this.textureManager.addImage("menu_quit_button_over",t+"menus/quit_rollover.png"),this.textureManager.addImage("menu_quit_button_down",t+"menus/quit-down.png"),this.textureManager.addImage("menu_slider_tab",t+"menus/slider.png"),this.textureManager.addImage("menu_slider_bar",t+"menus/slider-bar.png"),this.textureManager.addImage("menu_play_button",t+"menus/play-button.png"),this.textureManager.addImage("menu_play_button_over",t+"menus/play-button-rollover.png"),this.textureManager.addImage("menu_play_button_down",t+"menus/play-button-down.png"),this.textureManager.addImage("menu_matching_rules",t+"menus/matching_rules.png"),this.textureManager.addImage("menu_timebonus",t+"menus/time-bonus.png"),this.textureManager.addImage("menu_speedmatch",t+"menus/x2_speedmatch.png"),this.textureManager.addImage("menu_multimatch",t+"menus/x5_multimatch.png"),this.textureManager.addImage("game_bg",t+"UI/bg.jpg"),this.textureManager.addImage("rotate_lft_button",t+"UI/arrow_lft.png"),this.textureManager.addImage("rotate_lft_button_over",t+"UI/arrow_lft-rollover.png"),this.textureManager.addImage("rotate_rgt_button",t+"UI/arrow_rgt.png"),this.textureManager.addImage("rotate_rgt_button_over",t+"UI/arrow_rgt-rollover.png"),this.textureManager.addImage("reshuffle_button",t+"UI/reshuffle_button.png"),this.textureManager.addImage("reshuffle_button_over",t+"UI/reshuffle_button-rollover.png"),this.textureManager.addImage("reshuffle_button_down",t+"UI/reshuffle_button-down.png"),this.textureManager.addImage("pause_button",t+"UI/pause_button.png"),this.textureManager.addImage("pause_button_over",t+"UI/pause_button-rollover.png"),this.textureManager.addImage("pause_button_down",t+"UI/pause_button-down.png"),this.textureManager.addImage("score_icon",t+"UI/score icon.png"),this.textureManager.addImage("time_icon",t+"UI/time icon.png"),this.textureManager.addImage("preview_container",t+"UI/preview-tile-icon.png"),this.textureManager.addImage("speedmatch",t+"effects/noglowtext/speedmatch.png"),this.textureManager.addImage("multimatch",t+"effects/noglowtext/multimatch.png"),this.textureManager.addImage("timematch",t+"effects/noglowtext/time-bonus.png"),this.textureManager.addImage("colon",t+"effects/noglowtext/timecolon.png"),this.textureManager.addImage("speed0",t+"effects/noglowtext/SM0.png"),this.textureManager.addImage("speed1",t+"effects/noglowtext/SM1.png"),this.textureManager.addImage("speed2",t+"effects/noglowtext/SM2.png"),this.textureManager.addImage("speed3",t+"effects/noglowtext/SM3.png"),this.textureManager.addImage("speed4",t+"effects/noglowtext/SM4.png"),this.textureManager.addImage("speed5",t+"effects/noglowtext/SM5.png"),this.textureManager.addImage("speed6",t+"effects/noglowtext/SM6.png"),this.textureManager.addImage("speed7",t+"effects/noglowtext/SM7.png"),this.textureManager.addImage("speed8",t+"effects/noglowtext/SM8.png"),this.textureManager.addImage("speed9",t+"effects/noglowtext/SM9.png"),this.textureManager.addImage("multi0",t+"effects/noglowtext/MM0.png"),this.textureManager.addImage("multi1",t+"effects/noglowtext/MM1.png"),this.textureManager.addImage("multi2",t+"effects/noglowtext/MM2.png"),this.textureManager.addImage("multi3",t+"effects/noglowtext/MM3.png"),this.textureManager.addImage("multi4",t+"effects/noglowtext/MM4.png"),this.textureManager.addImage("multi5",t+"effects/noglowtext/MM5.png"),this.textureManager.addImage("multi6",t+"effects/noglowtext/MM6.png"),this.textureManager.addImage("multi7",t+"effects/noglowtext/MM7.png"),this.textureManager.addImage("multi8",t+"effects/noglowtext/MM8.png"),this.textureManager.addImage("multi9",t+"effects/noglowtext/MM9.png");var s;for(s=1;9>=s;s++)this.textureManager.addImage("tile_"+s.toString(),t+"cube/tile_0000"+s.toString()+".png"),this.textureManager.addImage("time_tile_"+s.toString(),t+"cube/time_tile_0000"+s.toString()+".png");for(s=1;44>=s;s++)this.textureManager.addImage("s"+s.toString(),t+"icons/"+s.toString()+".png");for(this.textureManager.addImage("timeText_icon",t+"icons/time_icon.png"),s=1;30>=s;s++){var i="matchEffect00"+E.padToLength(s.toString(),2,"0",!1);this.textureManager.addImage("fx_m"+s.toString(),t+"effects/match/"+i+".png")}this.textureManager.startLoading(),this.loadAudioAssets(),this.dataManager.loadData("levels",this.baseUrl+"data/mahjongg_dimensions_levelData.json"),this.dataManager.loadData("symbol_offsets",this.baseUrl+"data/symbol_offsets.json"),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){I.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)}),this.levels=3},T.prototype.loadAudioAssets=function(){this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/music_loop",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickPlay",this.baseUrl+"sounds/play_button_press",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rollOver",this.baseUrl+"sounds/menu_rollover_generic",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickTile",this.baseUrl+"sounds/click_tile",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct1",this.baseUrl+"sounds/correct_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct2",this.baseUrl+"sounds/correct_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match1",this.baseUrl+"sounds/tilematch1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match2",this.baseUrl+"sounds/tilematch2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match3",this.baseUrl+"sounds/tilematch3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match4",this.baseUrl+"sounds/tilematch4",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match5",this.baseUrl+"sounds/tilematch5",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match6",this.baseUrl+"sounds/tilematch6",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match7",this.baseUrl+"sounds/tilematch7",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match8",this.baseUrl+"sounds/tilematch8",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match9",this.baseUrl+"sounds/tilematch9",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match10",this.baseUrl+"sounds/tilematch10",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match11",this.baseUrl+"sounds/tilematch11",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match12",this.baseUrl+"sounds/tilematch12",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match13",this.baseUrl+"sounds/tilematch13",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match14",this.baseUrl+"sounds/tilematch14",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match15",this.baseUrl+"sounds/tilematch15",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match16",this.baseUrl+"sounds/tilematch16",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error1",this.baseUrl+"sounds/error_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error2",this.baseUrl+"sounds/error_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error3",this.baseUrl+"sounds/error_sound_3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rotate",this.baseUrl+"sounds/rotate",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_startSting",this.baseUrl+"sounds/game_opening_sting",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_endSting",this.baseUrl+"sounds/level_end",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle1",this.baseUrl+"sounds/reshuffle_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle2",this.baseUrl+"sounds/reshuffle_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timerWarning",this.baseUrl+"sounds/timer_warning",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timeUp",this.baseUrl+"sounds/out_of_time_sting",["mp3","mp4","ogg"])},T.prototype.cleanUp=function(){this.root=null,this.effects&&(this.effects.destroy(),this.effects=null),this.bg&&(this.bg.destroy(),this.bg=null)},T.prototype.update=function(){this.effects&&this.effects.update()},T.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.cleanUp(),!0):!1},T.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},M.prototype=Object.create(n.prototype),M.prototype.constructor=M,M.scale=.75,M.pieceSizePixels=188,M.prototype.destroy=function(){this.name=null,this.managers=null,this.symbol=null,n.prototype.destroy.call(this)},M.prototype.update=function(e){if(e&&(this.wobbleCount=0),this.wobbleCount>0)if(this.wobbleCount--,0===this.wobbleCount)this.x=this.startX,this.y=this.startY;else{var t=this.wobbleCount>10?4:2;this.x=this.startX+Math.random()*t-t/2,this.y=this.startY+Math.random()*t-t/2}if(this.timer&&!A.paused&&!S.pageHidden){var s=Math.floor(this.timer/1e3);this.timer-=I.elapsedTime,this.timer<0&&(this.timer=0);var i=Math.floor(this.timer/1e3);i!=s&&(this.parent.timeTile(this.symbol,i,null),this.setFrame(this.key,!0))}n.prototype.update.call(this)},M.prototype.clone=function(){var e=new M(this.parent,this.managers,this.cx,this.cy,this.cz,this.symbol,this.value);return e.name=this.name,e.create(this.parent,e.name,e.managers.textures),e.setPickerData(e.managers.data.get("maskData_1")),e.anchor.set(this.anchor.x,this.anchor.y),e.scale.set(this.scale.x,this.scale.y),e.sizex=this.sizex,e.sizey=this.sizey,e.scalez=this.scalez,e.timer=this.timer,e.rotate3d(this.angle),e},M.prototype.copyLocation=function(e){e.cx=this.cx,e.cy=this.cy,e.cz=this.cz,e.rotate3d(e.angle)},M.prototype.isOverridden=function(){return this.parent.overrideTileTimer>0&&null!==this.parent.overrideTileKey&&"s0"!=this.symbol},M.prototype.setPicture=function(e){this.setFrame(this.isOverridden()?"cube_"+this.parent.overrideTileKey+"_"+e.toString():"cube_"+this.symbol+"_"+e.toString()),this.setPickerData(this.managers.data.get("maskData_"+e.toString()))},M.prototype.rotate3d=function(e){void 0!==e&&(this.angle=e);var t=Math.round(180*this.angle/Math.PI),s=t-t%10+5;e=s*Math.PI/180;var i=Math.sin(e),n=Math.cos(e);this.tx=this.cx*n-this.cz*i,this.tz=this.cx*i+this.cz*n,this.x=this.tx*this.sizex,this.y=(this.cy-this.tz*this.scalez)*this.sizey,this.tz+=.001*this.y,this.setPicture(Math.round(180*e/Math.PI/10+5)%9+1)},M.prototype.picked=function(e,t){return this.pixelPicker(e,t)>0},M.prototype.wobble=function(){0===this.wobbleCount&&(this.startX=this.x,this.startY=this.y,this.wobbleCount=20)},M.prototype.timeBonus=function(){return"s0"==this.symbol?this.timer:-1},k.prototype=Object.create(PIXI.Container.prototype),k.prototype.constructor=k,k.maxTilesHigh=6,k.maxHalfTilesWide=12,k.prototype.create=function(e,t,s,i){this.world=e,this.managers=t,this.levelName=s._id,this.tileDescriptions=s.TileImages,this.parent=I.puzzle,this.x=0,this.y=.27*I.gameHigh,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.second=!1,this.lastTimeString="",this.overrideTileTimer=0,this.overrideTileKey=null,this.verticalOffset=parseFloat(s.yOffset);var n=parseFloat(s.nScale);I.pieceScale=n,I.forceResize=!0,this.createCubes(this.cacheSpriteList),this.createTiles(this.tileDescriptions,this.cacheSpriteList),this.removeTiles=[],this.tiles=[],this.puzzleLayout=s.TileStructure,this.resetPuzzle(["1","2"],["-","+"],this.puzzleLayout),this.multiMatchValue=0,this.speedMatchValue=i.nSpeedBonusValue,this.speedMatchTime=i.nSpeedBonusTime,this.levelBonusValues=JSON.parse("["+i.aLevelCompleteBonuses+"]");for(var a,r,o=0,l=0;;){if(0===l){if(o>=this.tileDescriptions.length)break;l=this.tileDescriptions[o]._num||0,a=this.tileDescriptions[o]._name,r=this.tileDescriptions[o]._value,o++}"s0"==a?this.addTileToPuzzle(a,r,this.puzzleLayout,"2","+",r):this.addTileToPuzzle(a,r,this.puzzleLayout,"1","-"),l--}I.puzzle.addChild(this)},k.prototype.destroy=function(){var e;if(PIXI.Container.prototype.destroy.call(this),this.levelBonusValues=null,this.tileDescriptions=null,this.world=null,this.tiles){for(e=0;e<this.tiles.length;e++)this.tiles[e].destroy({texture:!0,baseTexture:!0});this.tiles=null}this.managers=null,this.puzzleLayout=null;for(var t=0;t<this.blankCubes.length;t++)this.blankCubes[t].destroy({texture:!0,baseTexture:!0}),this.blankTimeCubes[t].destroy({texture:!0,baseTexture:!0});if(this.blankCubes=null,this.blankTimeCubes=null,this.cacheSpriteList){for(e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}},k.prototype.update=function(){var e;if(this.cacheSpriteList&&this.cacheSpriteList.length>0&&this.second){for(I.debug&&console.log("Puzzle.prototype destroying cacheSpriteList items",this.cacheSpriteList.length),e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}this.second=!0,this.overrideTileTimer>0&&(this.overrideTileTimer-=I.elapsedTime,this.overrideTileTimer<=0&&(I.debug&&console.log("Puzzle.overrideTileTimer expired"),this.overrideTileTimer=0,this.overrideTileKey=null,this.forceDraw(),this.world.puzzleInput.resetSidePieces())),this.removePendingTiles();var t=!1;for(this.angle!=this.targetAngle&&(this.angle=E.rotateTo(this.angle,this.targetAngle,k.turnSpeed*I.elapsedTime*.06),this.rotate(this.angle),t=!0),e=this.tiles.length-1;e>=0;--e)this.tiles[e].update(t);return this.tornadoRemove&&this.tornado(),this.angle!=this.targetAngle||this.tornadoRemove?!0:!this.puzzleLocked()},k.prototype.setTargetAngle=function(e,t){this.targetAngle=E.normaliseAngle(e),t&&(this.angle=this.targetAngle,this.rotate(this.angle))},k.prototype.adjustTargetAngle=function(e){return this.angle==this.targetAngle?(this.targetAngle=E.normaliseAngle(this.targetAngle+e),!0):!1},k.prototype.isTurning=function(){return this.angle!=this.targetAngle},k.prototype.rotate=function(e){for(var t=E.normaliseAnglePositive(e),s=this.tiles.length-1;s>=0;--s)this.tiles[s].rotate3d(t);this.reSort()},k.prototype.reSort=function(){this.children.sort(function(e,t){return e.tz=e.tz||0,t.tz=t.tz||0,t.tz-e.tz})},k.prototype.forceDraw=function(){for(var e=this.tiles.length-1;e>=0;--e)this.tiles[e].rotate3d();this.reSort()},k.prototype.createCubes=function(){this.blankCubes=[],this.blankTimeCubes=[];var e=this.managers.data.get("symbol_offsets"),t=new n;t.create(this,"timeText_icon",this.managers.textures);for(var s=1;9>=s;s++){var i=new n;i.create(this,"tile_"+s.toString(),this.managers.textures),this.blankCubes.push(i);var a=i.getPixels();this.managers.data.set("maskData_"+s.toString(),a),i.x=i.y=-1e3;var r=new n,o="time_tile_"+s.toString();r.create(this,o,this.managers.textures,-1e3,-1e3,!1);var l=this.addSymbolToCube(t,s-1,r,e);this.managers.textures.set(o+"b",l),r.setFrame(o+"b",!0),this.blankTimeCubes.push(r)}t.destroy()},k.prototype.createTiles=function(e,t){for(var s=this.managers.data.get("symbol_offsets"),i=0;i<e.length;i++){var a=e[i]._name;if("s0"!=a){var r=new n;r.create(this,a,this.managers.textures);for(var o=0;o<this.blankCubes.length;o++){var l="cube_"+a+"_"+(o+1).toString();if(!this.managers.textures.exists(l,!1)){var h=this.addSymbolToCube(r,o,this.blankCubes[o],s);this.managers.textures.set(l,h)}var u=new n;u.create(I.puzzle,l,this.managers.textures,-1e3,-1e3),t.push(u)}r.destroy()}else this.timeTile(a,90,t)}},k.prototype.addSymbolToCube=function(e,t,s,i){var n=e.createCanvasFromTexture(),a=e.createCanvasFromTexture(),r=s.createCanvasFromTexture(),o=r.width/2,l=r.height/2,h=r.getContext("2d");return h.save(),h.scale(.5*i.scalex[0][t],.5),h.transform(1,i.skewy[0][t],0,1,0,0),h.drawImage(n,o+i.offx[0][t]-n.width/2,l+i.offy[0][t]-n.height/2),h.restore(),h.scale(.5*i.scalex[1][t],.5),h.transform(1,i.skewy[1][t],0,1,0,0),h.drawImage(a,o+i.offx[1][t]-a.width/2,l+i.offy[1][t]-a.height/2),h.restore(),r},k.prototype.timeTile=function(e,t,s){I.debug&&console.log("Puzzle.timeTile",t,e);var i=this.managers.data.get("symbol_offsets"),n=E.timeToString(1e3*t);if(n!=this.lastTimeString){this.lastTimeString=n;var a=new PIXI.Text("\n"+n,{fontFamily:"mjd_font1",fontSize:100,fill:"#ffffff",align:"center"});a.renderCanvas(I.renderer);for(var r=a.canvas,o=0;o<this.blankTimeCubes.length;o++)this.addTimeToTile(e,i,o,r,!1,s);this.addTimeToTile(e,i,0,r,!0,null),this.cacheSpriteList||(this.cacheSpriteList=[]),this.cacheSpriteList.push(a)}},k.prototype.addTimeToTile=function(e,t,s,i,a,r){var o;o=a?"cube_s0b_1":"cube_"+e+"_"+(s+1).toString();var l=i,h=i,u=this.blankTimeCubes[s].createCanvasFromTexture(),c=u.width/2,d=u.height/2,p=u.getContext("2d");if(p.save(),p.scale(.5*t.scalex[0][s],.5),p.transform(1,t.skewy[0][s],0,1,0,0),p.drawImage(l,c+t.offx[0][s]-l.width/2,d+t.offy[0][s]-l.height/2),p.restore(),p.scale(.5*t.scalex[1][s],.5),p.transform(1,t.skewy[1][s],0,1,0,0),p.drawImage(h,c+t.offx[1][s]-h.width/2,d+t.offy[1][s]-h.height/2),p.restore(),this.managers.textures.set(o,u),r){var g=new n;g.create(I.puzzle,o,this.managers.textures,-1e3,-1e3),g.destroyTexture=!0,r.push(g)}},k.prototype.tilePicker=function(e,t){for(var s=[],i=null,n=null,a=this.tiles.length-1;a>=0;--a)n=this.tiles[a],!n.fader&&n.picked(e,t)&&s.push(n);if(s.length>0){for(a=s.length-1;a>=0;--a)n=s[a],(!i||i.tz>n.tz)&&(i=n);return i}return null},k.prototype.tileOpen=function(e){var t=e.cx,s=e.cy,i=e.cz;return this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i-1)||this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i-1)},k.prototype.spaceOpen=function(e,t,s){for(var i=this.tiles.length-1;i>=0;--i){var n=this.tiles[i];if(!n.fader&&n.cx==e&&n.cy==t&&n.cz==s)return!1}return!0},k.prototype.removeTile=function(e){this.removeTiles||(this.removeTiles=[]),this.removeTiles.push(e)},k.prototype.removePendingTiles=function(){if(this.removeTiles&&0!==this.removeTiles.length){for(var e=this.removeTiles.length-1;e>=0;--e){var t=this.removeTiles[e];if(!(t.children.length>0)){var s=this.tiles.indexOf(t);-1!=s&&(t.destroy(),this.tiles.splice(s,1)),this.removeTiles.splice(e,1)}}I.eventChangeAdOnMatch&&I.arenaHelper.sendEventChange(),this.reSort()}},k.prototype.fadeTile=function(e,t){A.effects.add(_.REMOVE_TILE,e,0,0),e.addFader(-0.1,1,t,this,e,-.5),this.reSort()},k.prototype.resetPuzzle=function(e,t,s){for(var i=0;i<s._x;i++)for(var n=0;n<s._y;n++)for(var a=0;a<s._z;a++){var r=s.layer[a].row[n].charAt(i),o=t.indexOf(r);-1!=o&&(s.layer[a].row[n]=E.replaceAt(s.layer[a].row[n],i,e[o]))}},k.prototype.addTileToPuzzle=function(e,t,s,i,n,a){var r,o,l,h=1e3;do r=Math.floor(Math.random()*s._x),o=Math.floor(Math.random()*s._y),l=Math.floor(Math.random()*s._z);while(s.layer[l].row[o].charAt(r)!==i&&--h>0);if(0>=h){for(r=0;r<s._x;r++)for(o=0;o<s._y;o++)for(l=0;l<s._z&&s.layer[l].row[o].charAt(r)!=i;l++);console.alert("ERROR in level data, cannot add Tile to full puzzle!")}this.tiles.push(new M(this,this.managers,r-(s._x-1)/2,-l+this.verticalOffset,o-(s._y-1)/2,e,t,a)),s.layer[l].row[o]=E.replaceAt(s.layer[l].row[o],r,n)},k.prototype.matchingPair=function(e,t){for(var s=t.length-1;s>=0;--s)if(t[s].symbol==e.symbol)return!0;return!1},k.prototype.puzzleLocked=function(){for(var e=[],t=this.tiles.length;--t>=0;){var s=this.tiles[t];if(this.tileOpen(s)){if(this.matchingPair(s,e))return!1;e.push(s)}}return!0},k.prototype.finished=function(e){if(!this.tiles||0===this.tiles.length)return!0;if(e){for(var t=this.tiles.length-1;t>=0;--t)if(!this.tiles[t].fader)return!1;return!0}return!1},k.prototype.reshuffle=function(){for(var e=1e3,t=this.tiles.length;e-->0;){var s=Math.floor(Math.random()*t),i=Math.floor(Math.random()*t);if(s!=i){var n=this.tiles[s].clone();this.tiles[i].copyLocation(n),this.tiles[s].copyLocation(this.tiles[i]),this.tiles[s].destroy(),this.tiles[s]=this.tiles[i].clone(),this.tiles[i].destroy(),this.tiles[i]=n}}I.debug&&console.log("Puzzle pieces reshuffled"),this.setTargetAngle(this.targetAngle,!0)},k.prototype.highestTile=function(){for(var e=null,t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.fader||s.tornadoRemove||(!e||s.cy<e.cy&&e.tz>s.tz)&&(e=s)}return e},k.prototype.tornado=function(){if(this.setTargetAngle(this.angle+k.turnSpeed),!this.lastTornadoPiece||I.time-this.lastTornadoPiece>100){this.lastTornadoPiece=I.time;var e=this.highestTile();e&&(I.suppressBigAnimations?e.cy=-100:e.tornadoRemove=!0)}for(var t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.tornadoRemove&&(s.cy-=.2),s.cy<-13&&(s.destroy(),this.tiles.splice(t,1))}0===this.tiles.length&&(this.tornadoRemove=!1)},k.prototype.contains=function(e){var t=this.getBounds();return t.contains(e.x,e.y)},k.prototype.overrideTiles=function(e,t){I.debug&&console.log("Puzzle.overrideTiles with "+t+" for "+e+" secs."),this.overrideTileTimer=1e3*e,this.overrideTileKey=t,this.forceDraw(),this.world.puzzleInput.resetSidePieces()},S.GameStates={NONE:-1,PRELOAD:0,TITLES:1,PLAY:2},S.pageHidden=!1,S.prototype.create=function(){this.preloader=new T(I.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,I.lowResolutionAssets),this.lastState=S.GameStates.NONE,this.state=S.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null},S.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,I.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case S.GameStates.PRELOAD:this.preloader.update(),this.preloader.allLoaded()&&(this.state=S.GameStates.TITLES,E.focusChangeCallback=this.onFocusChange,E.focusChangeContext=this,E.detectHidden(),S.pageHidden=E.isHidden(),this.preloader.loadManager.loadGameStatus(),this.preloader.levels=this.preloader.dataManager.get("levels").levels.length,I.debug&&console.log("Data has "+this.preloader.levels+" levels."),t=!0);
break;case S.GameStates.TITLES:s&&(z.create(),e.clearCallbacks(),this.resetInput(),this.titles=new P,this.titles.create(this.preloader),this.preloader.audioManager.stopTune()),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,this.state=S.GameStates.PLAY);break;case S.GameStates.PLAY:s&&(I.arenaHelper.sendGameStart(),this.resetInput(),this.game=new A,this.game.create(this.preloader.getManagers(),this.preloader.levels)),this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,this.state=S.GameStates.TITLES)}}while(t);I.mouseDown&&I.getFocus(),I.render()},S.prototype.resetInput=function(){z.reset(),I.resetInput()},S.prototype.onFocusChange=function(e){console.log("GameControl.onFocusChange hidden="+e),e||I.getFocus(),(I.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(e?(this.bm&&this.bm.removing&&(this.bm.destroy(),this.bm=null),!this.bm&&this.game&&(this.bm=new r,this.bm.create(I.fullUI,this.preloader.getManagers(),"click_to_continue_string"))):(this.bm&&this.bm.remove(this,"bm")&&(I.mouseDown=null,I.mouseUp=null),A.paused=null!==A.options),I.time=1e3*Math.floor(I.time/1e3)+999,this.preloader.audioManager.visibilityMute(pageHidden),I.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},I.timeStarted=Date.now(),I.HTMLElement=null,I.prototype.createGame=function(t,s,i){new e,I.arenaHelper||(I.arenaHelper=new w),I.app=new PIXI.Application(t||I.gameWide,s||I.gameHigh,{autoResize:!0}),I.renderer=I.app.renderer,I.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device"));var n=null;null!==i&&(n=document.getElementById(i)),I.HTMLElement=n,n?n.appendChild(I.app.view):document.body.appendChild(I.app.view),I.getFocus(),I.suppressBigAnimations=I.renderer instanceof PIXI.CanvasRenderer?!0:!1,I.debug&&console.log("Main.suppressBigAnimations =",I.suppressBigAnimations),I.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,I.debug&&console.log("Main.android device =",I.isAndroid),I.isChromeMobile=PIXI.utils.isMobile.other.chrome,I.debug&&console.log("Main.isChromeMobile =",I.isChromeMobile),I.stage=I.app.stage,I.stage.x=I.gameWide/2,I.stage.y=I.gameHigh/2,I.background=new PIXI.Sprite,I.background.anchor.set(.5),I.stage.addChild(I.background),I.puzzle=new PIXI.Sprite,I.puzzle.anchor.set(.5,1),I.stage.addChild(I.puzzle),I.bottomUI=new PIXI.Sprite,I.bottomUI.anchor.set(.5,1),I.stage.addChild(I.bottomUI),I.rightUI=new PIXI.Sprite,I.rightUI.anchor.set(.5),I.stage.addChild(I.rightUI),I.topUI=new PIXI.Sprite,I.topUI.anchor.set(.5,0),I.stage.addChild(I.topUI),I.fullUI=new PIXI.Sprite,I.fullUI.anchor.set(.5,.5),I.fullUIScale=1,I.stage.addChild(I.fullUI),e.resizeCanvas(),e.pixiListeners(I.renderer),_gameGATracker("create","UA-68188765-24","auto"),_gameGATracker("send","pageview",{page:"/LoadingScene"}),I.nowTime=Date.now(),I.time=0,I.repeatedGamesLeft=I.playAgainCount,this.gameControl=new S,this.gameControl.create(),new m(["mjd_font1","mjd_font2","mjd_font3"],this.playGame,this)},I.prototype.playGame=function(){I.debug&&console.log("starting game loop");var t=null;I.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=function(){I._lastTime=I.nowTime,I.nowTime=Date.now(),I.elapsedTime=Math.min(I.nowTime-I._lastTime,50),I.time+=I.elapsedTime,requestAnimationFrame(i),t&&t.begin(),s.gameControl.update(),I.resizeConsumed&&(I.resized=!1,I.resizeConsumed=!1),I.forceResize&&e.resizeCanvas(),t&&t.end()};requestAnimationFrame(i)},I.createTextStyles=function(e){var t=e.get("text_styles");I.textStyleBold=I.wrapTextStyle(t.textStyleBold),I.textStyleBoldHugeCentered=I.wrapTextStyle(t.textStyleBoldHugeCentered),I.textStyleBoldButtons=I.wrapTextStyle(t.textStyleBoldButtons),I.textStyleBoldButtonsLarge=I.wrapTextStyle(t.textStyleBoldButtonsLarge),I.textStyleBoldButtonTitles=I.wrapTextStyle(t.textStyleBoldButtonTitles),I.textStyleBoldLargeCentered=I.wrapTextStyle(t.textStyleBoldLargeCentered),I.textStyleMedium=I.wrapTextStyle(t.textStyleMedium),I.textStyleMedium2=I.wrapTextStyle(t.textStyleMedium2),I.textStyleMediumTiny=I.wrapTextStyle(t.textStyleMediumTiny),I.textStyleVersionTiny=I.wrapTextStyle(t.textStyleVersionTiny),I.textStyleLarge=I.wrapTextStyle(t.textStyleLarge),I.textStyleSemiBold=I.wrapTextStyle(t.textStyleSemiBold)},I.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return E.setValuesFromObject(t,e),t},I.render=function(){I.renderer.render(I.stage),!I.HTMLElement||I.HTMLElement.clientWidth==I.width&&I.HTMLElement.clientHeight==I.height||e.resizeCanvas()},I.resetInput=function(){e.resetInput(),I.click=null,I.hover=null,I.mouseDown=null,I.mouseUp=null,I.swipe=0},I.getFocus=function(){I.app&&I.app.view&&(I.debug&&console.log("Main.getFocus - grab keyboard focus"),I.app.view.setAttribute("tabindex","-1"),I.app.view.focus()),z.create()},P.ready=!1;var O=800,D=100;P.pieces=[{key:"title_panel",x:0,y:-90,alpha:0,fade:.05},{key:"letter_o",x:0,y:-131,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+4*D,easing:"bounce"}},{key:"letter_m",x:-216,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+0*D,easing:"bounce"}},{key:"letter_a",x:-161,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+1*D,easing:"bounce"}},{key:"letter_h",x:-109,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+2*D,easing:"bounce"}},{key:"letter_j",x:-60,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+3*D,easing:"bounce"}},{key:"letter_n",x:67,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+5*D,easing:"bounce"}},{key:"letter_g",x:128,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+6*D,easing:"bounce"}},{key:"letter_g",x:190,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+7*D,easing:"bounce"}},{key:"title_dimensions",x:-10,y:-28,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+8*D,easing:"bounce"}},{key:"menu_play_button",x:4,y:130,button:{over:"menu_play_button_over",down:"menu_play_button_down",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){P.ready=!0},duration:O+8*D,easing:"bounce"}}],P.prototype.create=function(t){P.ready=!1,this.preloader=t,this.managers=this.preloader.getManagers(),this.bg=new n,this.bg.create(I.background,"game_title",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=I.height/2/this.bg.parent.scale.y,this.version=null,this.version=new a(I.VERSION,I.textStyleVersionTiny),this.version.anchor.y=1,this.version.create(I.bottomUI,-0.49,.493,!0),I.fullUIScale=1,I.forceResize=!0;var s=v.createTweens(P.pieces,I.fullUI,this.managers,0,0,I.textStyleBoldButtonTitles);this.sprites=s.sprites,this.buttons=s.buttons,e.registerCallback("mousedown",this.startTune,{context:this}),this.fader=new f,this.fader.setFade(.1),I.debug&&console.log("titles are fading in"),I.eventChangeAdOnTitlesShow&&I.arenaHelper.sendEventChange()},P.prototype.startTune=function(){e.clearCallback("mousedown",this.startTune),console.log("Titles.startTune"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(console.log("retry loadAudioAssets from input gesture"),this.preloader.loadAudioAssets()),console.log("play the tune..."),this.managers.audio.startTune("game_tune"))},P.prototype.destroy=function(){var e;if(I.fullUIScale=1,I.forceResize=!0,this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},P.prototype.update=function(){var e,t="";if(!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.y=I.height/2/this.bg.parent.scale.y,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&P.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.version&&this.version.update(),this.fader.reached(1)&&(0!==I.eventChangeAdOnIdle&&(I.idleTimer-=I.elapsedTime,I.idleTimer<0&&(I.arenaHelper.sendEventChange(),I.idleTimer=Number.MAX_VALUE)),("click_start"==t||z.isPressed[32])&&(_gameGATracker("send","event",I.VERSION,"start_game","MJDD_HTML5",1),I.idleTimer=I.eventChangeAdOnIdle,I.hover=null,I.click=null,z.reset(32),this.fader.setFade(-.05),I.eventChangeAdOnTitlesClose&&I.arenaHelper.sendEventChange(),I.debug&&console.log("Titles: start fading out"))),!0},A.frameCount=0,A.paused=!1,A.quit=!1,A.requestQuit=!1,A.effects=null,A.score=0,A.highScore=0,A.timeLeft=0,A.options=null,A.levelMatches=0,A.STARTING=0,A.PLAYING=1,A.WON_LEVEL=2,A.FINAL_MESSAGE=3,A.NEXT_LEVEL=4,A.TIME_UP=5,A.NO_MOVES=6,A.GAME_WON=7,A.WAIT_DELAY=8,A.REMOVE_MSG_QUIT=9,A.prototype.create=function(e,t){this.managers=e,this.numLevels=t,A.paused=!1,A.quit=!1,A.requestQuit=!1,A.score=0,A.levelMatches=0,A.timeLeft=I.timerStart,A.effects=new _,A.effects.create(this.managers.textures),this.level=0,this.help=null,this.confirm=null,this.bm=null,this.state=A.PLAYING,this.nextState=-1,this.delay=0,this.won=!1,I.arenaHelper.addPauseAndResumeActions(A.pauseGame.bind(this),A.resumeGame.bind(this)),_gameGATracker("send","pageview",{page:"/GameScene"}),this.managers.audio.play("snd_startSting"),I.showHelp&&this.showHelp(!0)},A.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),A.effects&&(A.effects.destroy(),A.effects=null),A.options&&(A.options.destroy(),A.options=null),this.managers=null},A.prototype.update=function(){var e=!A.quit;if(A.frameCount++,this.confirm){if(this.confirm.update())return e;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return e;var t=this;this.help.remove(function(){t.help=null})}if(A.paused&&A.options)return A.options.update()?e:(A.options.remove(A.optionsDestroyed),e);A.requestQuit&&(A.requestQuit=!1,_gameGATracker("send","event","Quit Game",this.level+1,A.score),_gameGATracker("send","event",I.VERSION,"quit_game","MJDD_HTML5",A.score),_gameGATracker("send","event",I.VERSION,"quit_game_timer","MJDD_HTML5",Math.round(I.nowTime-I.timeStarted/1e3)),_gameGATracker("send","event",I.VERSION,"submit_score","MJDD_HTML5",A.score),this.level==this.numLevels-1&&_gameGATracker("send","event",I.VERSION,"final_level_quit","MJDD_HTML5",1),0===A.score&&_gameGATracker("send","event",I.VERSION,"abandon","MJDD_HTML5",1),I.arenaHelper.sendGameEnd(A.highScore),this.delay=4e3,this.state=A.WAIT_DELAY,this.nextState=A.REMOVE_MSG_QUIT),I.puzzle.alpha<1&&(I.puzzle.alpha+=.2);var s;do{s=!1;var i=this.lastState!=this.state;switch(this.lastState=this.state,this.state){case A.PLAYING:i&&(_gameGATracker("send","event",I.VERSION,"start_level_"+(this.level+1),"MJDD_HTML5",Math.round(A.timeLeft/1e3)),this.world=new C(this),this.world.create(this.managers,this.level),A.levelMatches=0,I.idleTimer=I.eventChangeAdOnIdle),this.world.update()?0!==I.eventChangeAdOnIdle&&(I.idleTimer-=I.elapsedTime,I.idleTimer<0&&(I.arenaHelper.sendEventChange(),I.idleTimer=Number.MAX_VALUE)):this.world.levelBeaten()?(_gameGATracker("send","event","Level Complete",this.level,A.score),_gameGATracker("send","pageview",{page:"/LevelCompletePopup"}),this.state=A.WON_LEVEL):this.state=this.world.timeUp()?A.TIME_UP:A.NO_MOVES;break;case A.WON_LEVEL:if(i){this.managers.audio.play("snd_endSting");var n=this.world.getLevelBonus();A.score+=n,_gameGATracker("send","event",I.VERSION,"win_level_"+(this.level+1),"MJDD_HTML5",A.score);var a=this.managers.locale.get("gvp_level_good_job_text_string")+"\n"+(n>0?"+"+n.toString():"");this.bm=new r,this.bm.create(I.fullUI,this.managers,a),this.bm.timeOut=1e3}this.world&&this.world.updateScore(),this.bm.update()||(this.state=A.NEXT_LEVEL,1===this.level&&0===I.repeatedGamesLeft&&I.playMidRollAd&&I.arenaHelper.requestMidroll());break;case A.NEXT_LEVEL:if(i){if(this.level++,this.level>this.numLevels-1){this.state=A.GAME_WON,this.won=!0,s=!0;break}this.world.destroy(),this.state=A.PLAYING,s=!0}break;case A.TIME_UP:this.managers.audio.play("snd_timeUp"),this.bm=new r,A.score>A.highScore&&(A.highScore=A.score);var o=this.managers.locale.get("gvp_level_times_up_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.highScore.toString();this.bm.create(I.fullUI,this.managers,o),this.world.puzzle.tornadoRemove=!0,this.level==this.numLevels-1&&_gameGATracker("send","event",I.VERSION,"final_level_lose","MJDD_HTML5",1),this.state=A.FINAL_MESSAGE;break;case A.NO_MOVES:this.managers.audio.play("snd_error2"),this.bm=new r,A.score>A.highScore&&(A.highScore=A.score);var l=this.managers.locale.get("gvp_level_no_more_move_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.highScore.toString();this.bm.create(I.fullUI,this.managers,l),this.world.puzzle.tornadoRemove=!0,this.level==this.numLevels-1&&_gameGATracker("send","event",I.VERSION,"final_level_lose","MJDD_HTML5",1),this.state=A.FINAL_MESSAGE;break;case A.GAME_WON:_gameGATracker("send","event",I.VERSION,"win_game_timer","MJDD_HTML5",Math.round(A.timeLeft/1e3)),this.bm=new r,A.score>A.highScore&&(A.highScore=A.score);var h=this.managers.locale.get("game_over_win_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.highScore.toString();this.bm.create(I.fullUI,this.managers,h),this.state=A.FINAL_MESSAGE;break;case A.FINAL_MESSAGE:i&&(this.bm.timeOut=5e3,this.won?_gameGATracker("send","event","Game Complete",this.level+1,A.score):_gameGATracker("send","event","Game Over",this.level+1,A.score),_gameGATracker("send","pageview",{page:"/GameOverPopup"}),_gameGATracker("send","event",I.VERSION,"level_"+(this.level+1)+"_matches","MJDD_HTML5",A.levelMatches)),this.world&&(this.world.updateScore(),this.world.puzzle.tornadoRemove&&this.world.puzzle.update()),this.bm.update()||(this.bm.destroy(),this.bm=null,_gameGATracker("send","event",I.VERSION,"submit_score","MJDD_HTML5",A.score),I.arenaHelper.sendGameEnd(A.highScore),this.delay=4e3,this.state=A.WAIT_DELAY,this.nextState=A.REMOVE_MSG_QUIT);break;case A.WAIT_DELAY:this.delay=Math.max(this.delay-I.elapsedTime,0),0===this.delay?(this.state=this.nextState,s=!0):this.bm&&this.bm.update();break;case A.REMOVE_MSG_QUIT:i&&this.bm&&this.bm.remove(this,"bm"),this.bm?this.bm.update()||(this.bm=null):(this.world.destroy(),e=!1)}}while(s);return A.effects.update(),e},A.prototype.showHelp=function(e){this.help=new l,this.help.create(this.managers,e)},A.prototype.showConfirm=function(e,t,s,i){this.confirm=new o,this.confirm.create(this,this.managers,e,t,s,i)},A.prototype.pauseToggle=function(){A.paused=!A.paused,I.debug&&console.log(A.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),A.paused?(A.options=new c,A.options.create(this,this.managers),_gameGATracker("send","event",I.VERSION,"help","MJDD_HTML5",1)):A.options&&(A.options.destroy(),A.options=null)},A.pauseGame=function(){I.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),A.paused=!0,_gameGATracker("send","pageview",{page:"/PausePopup"})},A.resumeGame=function(){I.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),A.paused=null!==A.options,_gameGATracker("send","pageview",{page:"/GameScene"})},A.optionsDestroyed=function(){A.options=null,A.paused=!1},C.brighter=null,C.brighter2=null,C.prototype.create=function(e,t){this.managers=e,I.swipeEnabled=!0,C.SelectionPreviewY=.23,C.SelectionPreviewBotY=.24,C.brighter=new PIXI.filters.ColorMatrixFilter,C.brighter.brightness(1.5,!0),C.brighter2=new PIXI.filters.ColorMatrixFilter,C.brighter2.brightness(1.2,!0),this.bg=new n,this.bg.create(I.background,"game_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=I.height/2/this.bg.parent.scale.y,this.icons=[],this.buttons=[],this.sprites=[],this.texts=[],this.puzzle=new k,this.puzzle.create(this,this.managers,this.managers.data.get("levels").levels[t],this.managers.data.get("levels")),this.puzzle.setTargetAngle(210*Math.PI/180,!0),this.puzzle.adjustTargetAngle(90*Math.PI/180),this.puzzleInput=new d,this.puzzleInput.create(this.managers,this.puzzle),this._createUI(),I.resized=!0,I.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.reshuffled=!1,this.bm=null},C.prototype.destroy=function(){this.managers=null,this.bg&&(this.bg.destroy(),this.bg=null);var e;if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.icons){for(e=0;e<this.icons.length;e++)this.icons[e].destroy();this.icons=null}if(this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.puzzleInput&&(this.puzzleInput.destroy(),this.puzzleInput=null),this.puzzle&&(this.puzzle.destroy(),this.puzzle=null),C.brighter=null,C.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.container1&&(this.container1.destroy(),this.container1=null),this.container2&&(this.container2.destroy(),this.container2=null),this.ignoreClick=null,this.game=null},C.prototype.update=function(){if(this._background(),this._userInput(),this.puzzle){if(!this._timerUpdate())return!1;if(!this._finishedOrStuck())return!1}var e=!this.puzzle.finished(!1);return this._userInterface()?!0:e},C.prototype.levelBeaten=function(){return this.puzzle?this.puzzle.finished(!1):!0},C.prototype.timeUp=function(){return A.timeLeft<=0},C.prototype.updateScore=function(){if(A.score>this.scoreText._visibleScore){var e=A.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e,this.scoreText.text=this.scoreText._visibleScore.toString()}},C.prototype._createUI=function(){var e=new h(h.TYPE_NOLATCH);e.create(I.topUI,"pause_button",this.managers,.43,.07,!0,"pause_button","pause_button_over","pause_button_down","click_pause_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.buttons.push(e);var t=new n;t.create(I.topUI,"time_icon",this.managers.textures,-0.45,.07,!0),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var s=new a("",I.textStyleSemiBold);s.create(I.topUI,-0.4,.07,!0),s.anchor.y=.5,this.texts.push(s),this.timeText=s,t=new n,t.create(I.topUI,"score_icon",this.managers.textures,-0.45,.22,!0),t.responsiveLayout=[{aspectRatioMin:1.35,position:{x:-0.13,y:.07}}],t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t),s=new a(A.score.toString(),I.textStyleSemiBold),s.create(I.topUI,-0.4,.22,!0),s.responsiveLayout=[{aspectRatioMin:1.35,position:{x:-0.13+.055,y:.07}}],s.anchor.y=.5,this.texts.push(s),this.scoreText=s,this.scoreText._visibleScore=A.score,e=new h(h.TYPE_BUTTON),e.create(I.bottomUI,"rotate_lft_button",this.managers,-.5+.16,.4,!0,"rotate_lft_button","rotate_lft_button_over","rotate_lft_button","click_left_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.75,e.sfxHover="snd_rollOver",e.responsiveLayout=[{minWidth:800,position:{x:-.3,y:.43}}],this.buttons.push(e),e=new h(h.TYPE_BUTTON),e.create(I.bottomUI,"rotate_rgt_button",this.managers,-.5+.84,.4,!0,"rotate_rgt_button","rotate_rgt_button_over","rotate_rgt_button","click_right_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.75,e.sfxHover="snd_rollOver",e.responsiveLayout=[{minWidth:800,position:{x:.3,y:.43}}],this.buttons.push(e);var i;i=new n,i.create(I.rightUI,"preview_container",this.managers.textures,-.02,C.SelectionPreviewY,!0),i.anchor.x=i.anchor.y=.5,i.scale.x=1.3,i.scale.y=1.2,i.alpha=.5,this.container1=i,i=new n,i.create(I.rightUI,"preview_container",this.managers.textures,-.02,C.SelectionPreviewY,!0),i.anchor.x=i.anchor.y=.5,i.scale.x=1.3,i.scale.y=1.2,i.alpha=.5,this.container2=i,this.container1.visible=this.container2.visible=I.isPortrait?!1:!0,i=new n,i.create(I.rightUI,"cube_s1_1",this.managers.textures,-.02,C.SelectionPreviewY,!0),i.anchor.x=i.anchor.y=.5,i.scale.x=i.scale.y=M.scale,this.puzzleInput.createHoveredPiece(i),i=new n,i.create(I.rightUI,"cube_s1_1",this.managers.textures,-.02,C.SelectionPreviewY,!0),i.y+=i.height,i.anchor.x=i.anchor.y=.5,i.scale.x=i.scale.y=M.scale,this.puzzleInput.createDroppedPiece(i),this.container2&&(this.container2.y=C.SelectionPreviewBotY=i.y)},C.prototype._timerUpdate=function(){if(this.bm)this.bm.update("bm");else if(!this.puzzle.tornadoRemove&&!A.paused){if(A.timeLeft-=I.elapsedTime,this.timeUp())return!1;var e=E.timeToString(A.timeLeft);this.timeText.text!=e&&(this.timeText.text=e),A.timeLeft/1e3<10&&(A.timeLeft%1e3<500?16711680!=this.timeText.tint&&(A.timeLeft/1e3<5&&this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16711680):16777215!=this.timeText.tint&&(this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16777215))}return!0},C.prototype._finishedOrStuck=function(){if(!this.puzzle.update()&&!this.puzzle.finished(!0)){if(this.reshuffled)return this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]),!1;if(!this.puzzle.overrideTileKey)for(;this.puzzle.puzzleLocked();)this._reshuffle()}return!0},C.prototype._background=function(){this.bg.y=I.height/2/this.bg.parent.scale.y,this.bg.update()},C.prototype._userInterface=function(){z.update(),this.container1.visible=this.container2.visible=I.isPortrait?!1:!0;for(var e,t=this.puzzleInput.update(),s=0;s<this.buttons.length&&(e=this.buttons[s].update(),null===e||void 0===e);s++);switch(e){case"click_pause_event":this.puzzleInput.removeHoverPiece(),this.game.pauseToggle();break;case"click_left_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),I.eventChangeAdOnRotate&&I.arenaHelper.sendEventChange();break;case"click_right_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),I.eventChangeAdOnRotate&&I.arenaHelper.sendEventChange()}for(s=0;s<this.icons.length;s++)this.icons[s].update();for(s=0;s<this.sprites.length;s++)this.sprites[s].update();for(this.updateScore(),s=0;s<this.texts.length;s++)this.texts[s].update();return this.puzzleInput.showDropAndHoverPieces(),this.container1&&(this.container1.pcnty=C.SelectionPreviewY),this.container2&&(this.container2.y=C.SelectionPreviewBotY),t},C.prototype._userInput=function(){if(!this.bm&&!this.puzzle.tornadoRemove){(I.swipe<0||z.isPressed[L.left_arrow]||z.isPressed[L.key_a]||z.isPressed[L.key_q])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),I.eventChangeAdOnRotate&&I.arenaHelper.sendEventChange()),I.swipe=0,I.idleTimer=I.eventChangeAdOnIdle),(I.swipe>0||z.isPressed[L.right_arrow]||z.isPressed[L.key_d]||z.isPressed[L.key_e])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),I.eventChangeAdOnRotate&&I.arenaHelper.sendEventChange()),I.swipe=0,I.idleTimer=I.eventChangeAdOnIdle);var t;if(null!==I.mouseDown||null!==I.click||null===I.hover||isNaN(I.hover.x)||isNaN(I.hover.y)||!this.puzzle.contains(I.hover)||(t=this.puzzle.tilePicker(I.hover.x,I.hover.y),I.hover=null,t?this.puzzleInput.showHoveredPiece(t):this.puzzleInput.removeHoverPiece()),null!==I.click){I.idleTimer=I.eventChangeAdOnIdle;var s=!1;this.ignoreClick&&E.distanceBetween(this.ignoreClick,I.click)<10&&A.frameCount-this.ignoreClick.when<30&&(s=!0),s||(t=this.puzzle.tilePicker(I.click.x,I.click.y),t&&this.puzzleInput.clickedPiece(t)),I.click=null,this.ignoreClick=null}null!==I.mouseDown&&(I.idleTimer=I.eventChangeAdOnIdle,t=this.puzzle.tilePicker(I.mouseDown.x,I.mouseDown.y),this.ignoreClick=I.mouseDown,this.ignoreClick.when=A.frameCount,t&&this.puzzleInput.clickedPiece(t)&&(I.mouseDown=null)),I.testKeys&&z.isPressed[L.key_o]&&this.puzzle.overrideTiles(5,"s10"),I.testKeys&&z.isPressed[L.key_r]&&this._reshuffleClick(),I.testKeys&&z.isPressed[L.key_t]&&(this.puzzle.tornadoRemove=!0),I.testKeys&&z.isPressed[L.key_x]&&(A.timeLeft=1),I.testKeys&&(z.isPressed[L.key_v]||I.mouseDown&&I.mouseDown.x<30&&I.mouseDown.y<30)&&e.debugWindowData()}},C.prototype.destroySprite=function(e){var t=this.sprites.indexOf(e);-1!==t&&this.sprites.splice(t,1),e.destroy()},C.prototype._reshuffle=function(){_gameGATracker("send","event",I.VERSION,"shuffle","MJDD_HTML5",1),this.managers.audio.playDelayed(["snd_reshuffle2"],1.5),this.puzzle.reshuffle()},C.prototype._reshuffleClick=function(){this.puzzleInput.removeHoverPiece(),this.reshuffled?this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]):(this.managers.audio.play(["snd_reshuffle1"]),this.bm=new r,this.bm.create(I.fullUI,this.managers,"gvp_level_reshuffle_text_string",this._reshuffle,this),this.bm.timeOut=2500,this.reshuffleBtn&&(this.reshuffleBtn.visible=!1))},C.prototype.getLevelBonus=function(){return this.puzzle.levelBonusValues?this.puzzle.levelBonusValues[this.game.level]:0},console.time("Game create"),I.arenaHelper=new w(null),(new I).createGame(),console.timeEnd("Game create")}();